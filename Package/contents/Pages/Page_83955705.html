<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<script type="text/javascript" src="../tocDataApi.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>Intermediate File Optimizer | NintendoSDK Documents</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="text-align: center;"><img src="../template/img/noscript.svg" /></div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- Intermediate File Optimizer -->
<div class="pagetitle" id="PageId_83955705">Intermediate File Optimizer</div>
<div class="text_separate">
<p>This section describes the usage and considerations for the intermediate file optimizer (<code>%NINTENDO_SDK_ROOT%\Tools\Graphics\3dTools\3dIntermediateFileOptimizer.exe</code>).</p>
<p>
  <ul class="macro_toc">
    <li>
      <a href="#Anchor_83955705_h1_1">Overview</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_2">Command-Line Options</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_3">Optimization Processes Applicable to Different File Types</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_4">Usage Examples</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955705_h2_1">Merging Intermediate Files</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_2">Multilevel Optimization of Intermediate Files</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83955705_h1_5">Sample Description</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955705_h2_3">Recursively Applied Optimization of Primitives (RecursiveOptimizePrimitive)</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83955705_h1_6">Limitations</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_7">Material Compression</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955705_h2_4">Alphabetical Order</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_5">Algorithms</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83955705_h1_8">Convert Rigid Body to Rigid Skinning</a>
    </li>
    <ul>
      <ul>
        <li>
          <a href="#Anchor_83955705_h3_1">Algorithms</a>
        </li>
      </ul>
    </ul>
    <li>
      <a href="#Anchor_83955705_h1_9">Bone Compression</a>
    </li>
    <li>
      <a href="#Anchor_83955705_h1_10">Shape Compression</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955705_h2_6">Sub-Options</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_7">Conditions for Combining Shapes</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83955705_h1_11">Merging</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955705_h2_8">Sub-Options</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_9">Common Merge Specifications</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_10">Merging Model Intermediate Files</a>
      </li>
      <ul>
        <li>
          <a href="#Anchor_83955705_h3_2">Merging LOD</a>
        </li>
        <li>
          <a href="#Anchor_83955705_h3_3">Merging Samplers</a>
        </li>
      </ul>
      <li>
        <a href="#Anchor_83955705_h2_11">Merging Skeletal Animation Files</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_12">Merging Material Animations</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_13">Merging Shader Parameter Animations</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_14">Merging Texture Pattern Animations</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_15">Merging Bone Visibility Animations</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_16">Merging Material Visibility Animations</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_17">Merging Shape Animations</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_18">Merging Scene Animations</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83955705_h1_12">Merging</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955705_h2_19">Sub-Options</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_20">Common Specifications for Merging</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_21">Merging Texture Pattern Animations</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83955705_h1_13">Deleting Nearby Vertices</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955705_h2_22">Sub-Options</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_23">Algorithms</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_24">Usage Examples</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83955705_h1_14">Submesh Division</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955705_h2_25">Sub-Options</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_26">Algorithms</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_27">Usage Examples</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_28">Displaying Results</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83955705_h1_15">Polygon Reduction</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955705_h2_29">Note: Cases Where Simplification Is Not Performed</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_30">Sub-Options</a>
      </li>
      <ul>
        <li>
          <a href="#Anchor_83955705_h3_4">Specifying an Arguments File</a>
        </li>
        <li>
          <a href="#Anchor_83955705_h3_5">Shape Reduction Rate Settings</a>
        </li>
        <li>
          <a href="#Anchor_83955705_h3_6">Settings for Properties Considered During Polygon Reduction</a>
        </li>
        <li>
          <a href="#Anchor_83955705_h3_7">Settings for Protecting Edges</a>
        </li>
        <li>
          <a href="#Anchor_83955705_h3_8">Reduction Calculation Method Settings</a>
        </li>
        <li>
          <a href="#Anchor_83955705_h3_9">Cost Calculation Weight Settings</a>
        </li>
        <li>
          <a href="#Anchor_83955705_h3_10">Other Settings</a>
        </li>
      </ul>
      <li>
        <a href="#Anchor_83955705_h2_31">Example of Option Settings</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83955705_h1_16">Combining LOD Models</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955705_h2_32">Sub-Options</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_33">Usage Example</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_34">Restrictions</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83955705_h1_17">Optimizing Primitives</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955705_h2_35">Sub-Options</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_36">Algorithms</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_37">Usage Example</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83955705_h1_18">Quantization Analysis</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83955705_h2_38">Algorithms</a>
      </li>
      <li>
        <a href="#Anchor_83955705_h2_39">Usage Example</a>
      </li>
    </ul>
  </ul>
</p>
<h1 id="Anchor_83955705_h1_1">Overview</h1>
<p>Performs various optimization processes on intermediate files.</p>
<h1 id="Anchor_83955705_h1_2">Command-Line Options</h1>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe [--args-file] [--version] [-h] [-s] [-j &quot;&quot;] [--disable-xsd-check]
[--disable-file-info] [--error-detail-output &quot;&quot;] [--compress-material] [--rigid-body-to-rigid-skinning] [--compress-bone-cull] [--compress-bone-merge]
[--compress-bone-unite-child] [--compress-bone-unite] [--compress-bone-unite-all] [--compress-shape] [--compress-shape-options]
[--merge] [--merge-options &quot;&quot;] [--combiner] [--combine-options &quot;&quot;] [--delete-near-vertex] [--delete-near-vertex-options &quot;&quot;] [--unite-submesh]
[--divide-submesh] [--divide-submesh-options &quot;&quot;] [--trim-lod-model] [--polygon-reduction] [--polygon-reduction-options &quot;&quot;]
[--unite-lod-model] [--unite-lod-model-options &quot;&quot;] [--optimize-primitive][--optimize-primitive-options &quot;&quot;]
[--quantization-analysis] [-o &quot;&quot;] [intermediate file]</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>Optimizes intermediate files.</p>
<p>The optimization options are executed in the following order, regardless of the order in which they are specified.</p>
<p>
  <strong>--args-file &quot;&quot;</strong>
</p>
<p>Specifies the file.<br />You can use the contents in the parameter file to specify arguments. <br />The parameter file allows you to specify each option over several lines. <br />Lines starting with a number sign (#) are treated as comments. <br />Newline characters cannot be included in escape sequences used in option specifications that appear between quotation marks (&quot;).</p>
<p>
  <strong>--version</strong>
</p>
<p>Displays version information.</p>
<p>
  <strong>-h --help</strong>
</p>
<p>Displays Help.</p>
<p>
  <strong>-s --silent</strong>
</p>
<p>Suppresses the display of messages during processing.</p>
<p>
  <strong>-j &quot;&quot; --jobs &quot;&quot;</strong>
</p>
<p>Specifies the number of jobs. When unspecified, the processor count is assigned.</p>
<p>
  <strong>--disable-xsd-check</strong>
</p>
<p>Disables format checking of intermediate files using schemas (XSD files).<br />Only the latest version intermediate files can be processed when this option is enabled.</p>
<p>
  <strong>--disable-file-info</strong>
</p>
<p>Does not update <code>&lt;file_info&gt;</code> when saving intermediate files.</p>
<p>
  <strong>--error-detail-output</strong>
</p>
<p>Specifies a folder for saving detailed information when an error occurs. If not specified, this information is written to the default folder.</p>
<p>
  <strong>Intermediate file</strong>
</p>
<p>Specifies the intermediate file to convert.</p>
<p>
  <strong>--compress-material</strong>
</p>
<p>Merges files with materials having the same settings and then compresses materials.<br />This optimization is primarily applied when exporting from a DCC tool.<br />Supported intermediate files: FMD</p>
<p>
  <strong>--rigid-body-to-rigid-skinning</strong>
</p>
<p>Converts a rigid body shape to rigid skinning. m<br />Supported intermediate files: FMD</p>
<p>
  <strong>--compress-bone-cull</strong>
</p>
<p>Deletes bones located at the end of the hierarchical structure that will not be used for rendering, and then compresses bones.<br />This optimization is primarily applied when exporting from a DCC tool.<br />Sorting after compression is not currently supported.<br />Supported intermediate files: FMD, FSK, FVB</p>
<p>
  <strong>--compress-bone-merge</strong>
</p>
<p>Deletes bones located at the end of the hierarchical structure that will not be used for rendering, and then executes bone compression.<br />This optimization is primarily applied when exporting from a DCC tool.<br />Sorting after compression is not currently supported.<br />Supported intermediate files: FMD, FSK, FVB</p>
<p>
  <strong>--compress-bone-unite-child</strong>
</p>
<p>Deletes bones located at the end of the hierarchical structure that will be used for rendering of rigid bodies only, and then compresses bones.<br />This optimization is primarily applied when exporting from a DCC tool. <br />Supported intermediate files: FMD, FSK, FVB</p>
<p>
  <strong>--compress-bone-unite</strong>
</p>
<p>Compresses compressible bones into a single bone. <br />This optimization is primarily applied when exporting from a DCC tool. <br />Supported intermediate files: FMD, FSK, FVB</p>
<p>
  <strong>--compress-bone-unite-all</strong>
</p>
<p>Compresses all bones into a single bone. <br />This optimization is primarily applied when exporting from a DCC tool. <br />Supported intermediate files: FMD, FSK, FVB</p>
<p>
  <strong>--compress-shape</strong>
</p>
<p>Merges files with shapes having the same settings and then compresses shapes. <br />This optimization is primarily applied when exporting from a DCC tool.<br />Perform quantization analysis again because quantization analysis results are invalid for a compressed shape.<br />To perform quantization analysis after this process, specify the <a href="#Anchor_83955705_quantization_analysis"><code>--quantization-analysis</code></a> option at the same time. <br />Supported intermediate files: FMD</p>
<p>
  <strong>--compress-shape-options</strong>
</p>
<p>Specifies sub-options for the <code>--compress-shape</code> option.<br />For more information about these sub-options, see the <a href="#Anchor_83955705_compress_shape">shape compression documentation</a>. <br />Supported intermediate files: FMD </p>
<p>
  <strong>-m --merge</strong>
</p>
<p>Specifies the intermediate files to be merged after editing using 3DEditor or other tool. <br />This optimization is primarily applied when exporting from a DCC tool.<br />Supported intermediate files: FMD, FSK, FMA, FSP, FCL, FTS, FTP, FVB, FVM, FSH, FSN</p>
<p>
  <strong>--merge-options &quot;&quot;</strong>
</p>
<p>Specifies sub-options of the <code>--merge</code> option.<br />For more information about these sub-options, see <a href="#Anchor_83955705_merge">Merging</a> later in this document.</p>
<p>
  <strong>
    <a name="Anchor_83955705_delete_near_vertex"></a>--delete-near-vertex</strong>
</p>
<p>Deletes approximated vertices.<br />Vertex counts are changed by deletion.<br />The primitive optimization becomes invalid after deletion. Run the primitive optimization again after deletion.<br />Specify the <a href="#Anchor_83955705_optimize_primitive">--optimize-primitive</a> option to run the primitive optimization after this process. <br />Supported intermediate files: FMD</p>
<p>
  <strong>--combine</strong>
</p>
<p>Combines multiple material animations. It can also be used to convert shader animations, texture pattern animations, and material visibility animations to material animations.<br />To combine multiple files, you must specify <code>--combine-options</code>.<br />Supported intermediate files: FSP, FCL, FTS, FTP, FVM, FMA.</p>
<p>
  <strong>--combine-options &quot;&quot;</strong>
</p>
<p>Specifies sub-options of the <code>--combine</code> option.<br />For more information about these sub-options, see the documentation for <a href="#Anchor_83955705_combine">Combine</a>.</p>
<p>
  <strong>--delete-near-vertex-options &quot;&quot;</strong>
</p>
<p>Specifies sub-options of the <code>--delete-near-vertex</code> option.<br />For more information about these sub-options, see <a href="#Anchor_83955705_delete_near_vertex_detail">Deleting Nearby Vertices</a> later in this document. <br />Supported intermediate files: FMD </p>
<p>
  <strong>--unite-submesh</strong>
</p>
<p>Combines submeshes.<br />The primitive optimization becomes invalid after uniting the submesh. Run the primitive optimization again after uniting.<br />Specify the <a href="#Anchor_83955705_optimize_primitive">--optimize-primitive</a> option to run the primitive optimization after this process.<br />Supported intermediate files: FMD <br /></p>
<p>
  <strong>--divide-submesh</strong>
</p>
<p>Divides submeshes.<br />The primitive optimization becomes invalid after a submesh division. Run the primitive optimization again after division.<br />Specify the <a href="#Anchor_83955705_optimize_primitive">--optimize-primitive</a> option to run the primitive optimization after this process. <br />Supported intermediate files: FMD</p>
<p>
  <strong>--divide-submesh-options &quot;&quot;</strong>
</p>
<p>Specifies sub-options of the <code>--divide-submesh</code> option.<br />For more information about these sub-options, see the documentation for <a href="#Anchor_83955705_divide_submesh">Divide Submesh</a>. <br />Supported intermediate files: FMD </p>
<p>
  <strong>--trim-lod-model</strong>
</p>
<p>Deletes LOD models combined by <code>--unite-lod-model</code>.<br />Supported intermediate files: FMD</p>
<p>
  <strong>--polygon-reduction</strong>
</p>
<p>Automatically generates an LOD model from the base model.<br />Supported intermediate files: FMD</p>
<p>
  <strong>--polygon-reduction-options &quot;&quot;</strong>
</p>
<p>Specifies sub-options of the <code>--polygon-reduction</code> option.<br />For more information about these sub-options, see <a href="#Anchor_83955705_polygon_reduction">Polygon Reduction</a> later in this document.<br />Supported intermediate files: FMD</p>
<p>
  <strong>--unite-lod-model</strong>
</p>
<p>Combines LOD models.<br />Perform quantization analysis again because quantization analysis results are disabled after combination.<br />To perform quantization analysis after this process, specify the <a href="#Anchor_83955705_quantization_analysis"><code>--quantization-analysis</code></a> option at the same time. <br />Supported intermediate files: FMD</p>
<p>
  <strong>--unite-lod-model-options &quot;&quot;</strong>
</p>
<p>Specifies sub-options of the <code>--unite-lod-model</code> option.<br />For more information about these sub-options, see <a href="#Anchor_83955705_unite_lod_model">Combining LOD Models</a> later in this document.<br />Supported intermediate files: FMD</p>
<p>
  <a name="Anchor_83955705_optimize_primitive"></a>
  <strong>--optimize-primitive</strong>
</p>
<p>Optimizes primitives<br />Supported intermediate files: FMD</p>
<p>
  <strong>--optimize-primitive-options &quot;&quot;</strong>
</p>
<p>Specifies sub-options of the <code>--optimize-primitive</code> option.<br />For more information about these sub-options, see <a href="#Anchor_83955705_optimize_primitive_detail">Optimizing Primitives</a> later in this document.<br />Supported intermediate files: FMD</p>
<p>
  <a name="Anchor_83955705_quantization_analysis"></a>
  <strong>--quantization-analysis</strong>
</p>
<p>Sets the quantization precision.<br />This optimization is primarily applied when exporting from a DCC tool.<br />Supported intermediate files: FMD, FSK, FMA, FSP, FCL, FTS, FTP, FVB, FVM, FSH, FSN</p>
<p>
  <strong>--submesh-to-shape </strong>
</p>
<p>
  <br />
</p>
<div class="info_new">
  <div class="info_new_left">Info</div>
  <div class="info_new_right">
    <p>(This feature is currently being verified.) Compatibility might be lost without warning.</p>
  </div>
</div>
<!--Remove-->
<p>Converts a submesh to a shape. Allows creation of model intermediate files that maintain submesh boundaries between LOD models by externally creating LOD models that maintain polygon boundaries for these shapes, joining them to the LOD model, and then executing <code>--shape-to-submesh</code>. For more information on LOD models that maintain submesh boundaries, see <a href="../Pages/Page_106333688.html#Anchor_106333688_view_frustum_culling_combination">Using LOD and View Frustum Culling Together</a>.</p>
<p>Supported intermediate files: FMD</p>
<p>
  <strong>--shape-to-submesh</strong>
</p>
<div class="info_new">
  <div class="info_new_left">Info</div>
  <div class="info_new_right">
    <p>(This feature is currently being verified.) Compatibility might be lost without warning.</p>
  </div>
</div>
<!--Remove-->
<p>
  <code>--submesh-to-shape</code> converts a shape converted from a submesh back into a submesh.</p>
<p>Supported intermediate files: FMD</p>
<p>
  <strong>-o &quot;&quot; --output &quot;&quot;</strong>
</p>
<p>Specifies the output file.<br />If not specified, the file being processed is overwritten.<br />Supported intermediate files: FMD, FSK, FMA, FSP, FCL, FTS, FTP, FVB, FVM, FSH, FSN</p>
<h1 id="Anchor_83955705_h1_3">Optimization Processes Applicable to Different File Types</h1>
<p>The table lists the different optimization processes that can be applied to the different types of intermediate files.</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>
        <br />
      </th>
      <th>Material Compression</th>
      <th>Convert Rigid Body to Rigid Skinning</th>
      <th>Bone Compression</th>
      <th>Shape compression</th>
      <th>Merge</th>
      <th>Merging</th>
      <th>Deleting Nearby Vertices</th>
      <th>Submesh Deletions</th>
      <th>LOD Model Deletions</th>
      <th>Submesh Division</th>
      <th>Converting a Submesh to a Shape</th>
      <th>Polygon Reduction</th>
      <th>Combining LOD Models</th>
      <th>Converting a Shape to a Submesh</th>
      <th>Submesh Division</th>
      <th>Optimizing Primitives</th>
      <th>Quantization Analysis</th>
    </tr>
    <tr>
      <th>Model</th>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable (Note 1)</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable (Note 2)</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
    </tr>
    <tr>
      <th>Skeletal Animation</th>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
    </tr>
    <tr>
      <th>Material Animation</th>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
    </tr>
    <tr>
      <th>Bone Visibility Animation</th>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
    </tr>
    <tr>
      <th>Shape Animation</th>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
    </tr>
    <tr>
      <th>Scene Animation</th>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <br />
      </td>
      <td>
        <span style="color: rgb(51,153,102);">Enable</span>
      </td>
    </tr>
  </tbody>
</table>
<p>Note 1: Valid only when Combining LOD Models is disabled or Submesh to Shape is enabled.</p>
<p>Note 2: Valid only when Combining LOD Models is enabled and Submesh to Shape is disabled.</p>
<h1 id="Anchor_83955705_h1_4">Usage Examples</h1>
<p>This section includes examples of using the intermediate file optimizer.</p>
<h2 id="Anchor_83955705_h2_1">Merging Intermediate Files</h2>
<p>Merges <code>edited.fmdb</code> with <code>dcc.fmdb</code>.</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe dcc.fmdb --merge --merge-options &quot;--merge-file edited.fmdb&quot;</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_2">Multilevel Optimization of Intermediate Files</h2>
<p>Compress materials, <code>Merge</code> bones, <code>Unite Child</code> bones, and shape into <code>optimize.fmdb</code>; then, merge <code>optimize.fmdb</code> with <code>edited.fmdb</code>, apply primitive optimization and quantization analysis, and save to <code>output.fmdb</code>.</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe optimize.fmdb --compress-material --compress-bone-merge --compress-bone-unite-child --compress-shape --merge --merge-options &quot;--merge-file edited.fmdb&quot; --optimize-primitive --quantization-analysis -o=output.fmdb</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_83955705_h1_5">Sample Description</h1>
<p>The intermediate file optimizer sample is found in <code>Samples/Sources/Tools/3dTools/3dIntermediateFileOptimizer/</code>.</p>
<h2 id="Anchor_83955705_h2_3">Recursively Applied Optimization of Primitives (RecursiveOptimizePrimitive)</h2>
<p>If you drag model intermediate files or folders to <code>RecursiveOptimizePrimitive.bat</code>, they undergo primitive optimization using the <code>force</code> option and are then saved (overwriting the existing files and folders).</p>
<h1 id="Anchor_83955705_h1_6">Limitations</h1>
<p>There might be errors in some optimizations if the input is peculiar, such as shapes with no area or shapes with coordinate values near infinity.</p>
<h1 id="Anchor_83955705_h1_7">Material Compression</h1>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe --compress-material [-o &quot;&quot;] [intermediate file]</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>If two or more materials have the same status in all ways except for their names, they can all be combined to reduce the total number of materials. <code>&lt;original_material&gt;</code>, simultaneously corresponding with materials (<code>&lt;material&gt;</code>), is also included in compression.</p>
<p class="note">Material compression is used on models to improve rendering efficiency by reducing the number of materials.</p>
<h2 id="Anchor_83955705_h2_4">Alphabetical Order</h2>
<p>In the NintendoWare 3D development environment, alphabetical order is defined as follows: Arabic numerals first, uppercase Roman letters next, and then lowercase Roman letters last.</p>
<p>(First) 0, 1 ... 9, A, B ... Z, a, b ... z (Last)</p>
<h2 id="Anchor_83955705_h2_5">Algorithms</h2>
<p>If two or more materials in the FMD file meet the following conditions, the first material in alphabetic order is skipped and all subsequent materials are deleted.</p>
<ul>
  <li>All parameters, except for the filenames, are exactly the same.</li>
  <li>All material parameters, except for the names of <code>&lt;original_material&gt;</code> elements, are exactly the same.</li>
  <li>Either material can be deleted (<code>compress_enable=&quot;true&quot;</code>).</li>
</ul>
<p>When any sort of animation has been set for a material using a DCC tool, or if you always want to keep a particular material, set <code>compress_enable</code> to <code>false</code> for that material so it will not be deleted during material compression.</p>
<p>To perform material compression, specify the <code>--compress-material</code> option for the FMD file.</p>
<h1 id="Anchor_83955705_h1_8">Convert Rigid Body to Rigid Skinning</h1>
<!--Remove-->
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe --rigid-body-to-rigid-skinning [-o &quot;&quot;] [intermediate file]</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>Converts a rigid body shape to rigid skinning.</p>
<p>The number of shapes can be reduced by combining this and shape compression.</p>
<h3 id="Anchor_83955705_h3_1">Algorithms</h3>
<p>Converts a rigid body shape to a rigid skinning that references a single bone (the bone specified in <code>bone_name</code> of the shape).</p>
<p>When the bones being referenced can be reduced (<code>compress_enable=&quot;true&quot;</code>), the parents of those bones are navigated, and the first bone found that cannot be deleted (<code>compress_enable=&quot;false&quot;</code>) is set to <code>bone_name</code> of the shape, making shape compression possible. When no bones that cannot be deleted are found, <code>bone_name</code> is set to the root bone. If you want to apply bone visibility animation, set the target bone so that it cannot be deleted.</p>
<p>To convert rigid body to rigid skinning, specify the <code>--rigid-body-to-rigid-skinning</code> option for the FMD file.</p>
<h1 id="Anchor_83955705_h1_9">
  <a name="Anchor_83955705_compress_bone"></a>Bone Compression</h1>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe [--compress-bone-cull] [--compress-bone-merge]
[--compress-bone-unite-child] [--compress-bone-unite] [--compress-bone-unite-all] [-o &quot;&quot;] [intermediate file]</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>This optimization compresses bones that do not need to be rendered to reduce data size and rendering cost. For the specific algorithm and considerations, see <a href="../Pages/Page_291410825.html">Compress Bone</a>.</p>
<h1 id="Anchor_83955705_h1_10">
  <a name="Anchor_83955705_compress_shape"></a>Shape Compression</h1>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe --compress-shape --compress-shape-options &quot;[--ignore-skinning-count]&quot; [-o &quot;&quot;] [intermediate file]</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>Groups together all shapes that belong to the same bone and use the same material for rendering.</p>
<p>This option can be used in combination with bone compression. Where possible, all shape groups rendered using the same material but belonging to different bones as expressed on the DCC tool are combined into one when they belong to the same bone after bone compression.</p>
<p class="note">Shape compression is used on models to improve rendering efficiency by reducing the number of shapes.</p>
<p>The result of quantization analysis is invalid for the compressed shape, so specify the <code>--quantization-analysis</code> option at the same time.</p>
<h2 id="Anchor_83955705_h2_6">Sub-Options</h2>
<p>
  <strong>--ignore-skinning-count</strong>
</p>
<p>Compresses shapes that have different settings for number of bones affecting a single vertex. Expands the vertex and other data according to shapes with a large number of bones that affect a single vertex. If shape compression causes the number of bones that affect a single vertex to change, all other shapes connected to that shape (shapes with the same <code>original_bone_name</code>) are expanded in the same way so that gaps do not occur among that shape and contiguous shapes.</p>
<p>Specifying this option reduces the shape count and may in some cases provide a performance increase by reducing the number of render/draw processes.<br />However, this option also increases the number of vertex attribute elements for shapes that have a large number of affected bones, which increases the file size and the size of the vertex buffer.<br /></p>
<h2 id="Anchor_83955705_h2_7">Conditions for Combining Shapes</h2>
<p>You can combine shapes when the following conditions are met.</p>
<ul>
  <li>The same material is used for rendering (the <code>mat_name</code> attribute of <code>&lt;shape_info&gt;</code>).</li>
  <li>The value of the <code>bone_name</code> attribute of <code>&lt;shape_info&gt;</code> is the same.<br />A skinning model is required to combine rigid bodies with different values for this attribute.<br />(Increase the size of the display list to make a skinning model.)</li>
  <li>The primitive type of the vertex index is the same (the <code>mode</code> attribute of <code>&lt;mesh&gt;</code>).</li>
  <li>
    <code>&lt;key_shape_array&gt;</code> is not present.</li>
  <li>If the <code>--ignore-skinning-count</code> sub-option is specified:<ul><li>The number of bones influencing a single vertex (the <code>vertex_skinning_count</code> attribute of the <code>&lt;shape_info&gt;</code>) is set to at least 1.</li><li>The structure of the <code>&lt;shape_info&gt;</code> element is the same as the structure of the <code>&lt;vertex&gt;</code> element that is referenced by the <code>vertex_index</code> attribute except for the information about skinning.<br />In <code>&lt;vtx_attrib&gt;</code> elements that are for skinning, the hint information is <code>blendindex0</code> through <code>blendindex31</code> and <code>blendweight0</code> through <code>blendweight31</code>.<br />All attributes must be the same, except for the number of <code>&lt;vtx_attrib&gt;</code> elements included in <code>&lt;vertex&gt;</code> elements for skinning and the <code>stream_index</code>, <code>count</code>, and <code>quantize_type</code> of each <code>&lt;vtx_attrib&gt;</code>.<br />For example, in the DCC tool, if the <code>&lt;vtx_attrib&gt;</code> structure is not the same between shapes because of the absence of vertex color settings, the shapes will not be combined.</li></ul></li>
  <li>If the <code>--ignore-skinning-count</code> sub-option is not specified:<br /><ul><li>The same number of bones influencing a single vertex is the same (the <code>vertex_skinning_count</code> attribute of the <code>&lt;shape_info&gt;</code>).</li><li><code>&lt;shape_info&gt;</code> is structured in the same way as the <code>&lt;vertex&gt;</code> accessed in the <code>vertex_index</code> attributes.<br />All attributes must be the same, except for the number of <code>&lt;vtx_attrib&gt;</code> elements included in <code>&lt;vertex&gt;</code> and the <code>stream_index</code>, <code>count</code>, and <code>quantize_type</code> of each <code>&lt;vtx_attrib&gt;</code>.<br />For example, in the DCC tool, if the <code>&lt;vtx_attrib&gt;</code> structure is not the same between shapes because of the absence of vertex color settings, the shapes will not be combined.</li></ul></li>
</ul>
<p>To perform shape compression, specify the <code>--compress-shape</code> option for the FMD file.</p>
<h1 id="Anchor_83955705_h1_11">
  <a name="Anchor_83955705_merge"></a>Merging</h1>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe --merge --merge-options &quot;--merge-file '' [--sampler-merge-priority] [--texture-srt-merge-priority] [--bone-visibility-merge-priority] [--material-assign-merge-nonpriority]&quot; [-o &quot;&quot;] [intermediate_file]</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>Supports merging of model intermediate files (FMD files), skeletal animation files (FSK files), shader parameter animation files (FSP, FCL, and FTS files), texture pattern animation files (FTP files), bone visibility animation files (FVB files), material visibility animation files (FVM files), shape animations (FSH files), and scene animations (FSN files).</p>
<h2 id="Anchor_83955705_h2_8">Sub-Options</h2>
<p>
  <strong>--merge-file &quot;&quot;</strong>
</p>
<p>Specifies the files to merge.</p>
<p>Supported intermediate files: FMD, FSK, FMA, FSP, FCL, FTS, FTP, FVB, FVM, FSH, FSN</p>
<p>
  <strong>--sampler-merge-priority</strong>
</p>
<p>When merging model intermediate files, prioritizes and leaves the sampler in the parameter file. Specify this option when you want to keep a sampler you edited with the DCC tool. Ignored when merging files other than model intermediate files.</p>
<p>
  <strong>--texture-srt-merge-priority</strong>
</p>
<p>When merging model intermediate files, prioritizes and leaves the texture SRT in the parameter file. Specify this option to keep the texture SRT edited with the DCC tool. Ignored when merging files other than model intermediate files.</p>
<p>
  <strong>--bone-visibility-merge-priority</strong>
</p>
<p>When model intermediate files are merged, the bone visibility of the parameter file takes precedence and is preserved. Specify this option to preserve the bone visibility as edited using the DCC tool. Ignored when merging files other than model intermediate files.</p>
<p>
  <strong>--material-assign-merge-nonpriority</strong>
</p>
<p>When merging model intermediate files, prioritizes the material name of the merged files. Specify this option when you want to keep the material assignments edited in 3DEditor. Ignored when merging files other than model intermediate files.</p>
<h2 id="Anchor_83955705_h2_9">Common Merge Specifications</h2>
<p>In the following descriptions, the file that specifies the parameters for <code>3dIntermediateFileOptimizer.exe</code> is called the <em>parameter file</em>, and the file that specifies the <code>--merge-file</code> sub-options is called the <em>merge file</em>.</p>
<p>The following elements are merged for all file types.</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>Element</th>
      <td>Merging behavior</td>
    </tr>
    <tr>
      <td>&lt;user_data_array&gt;</td>
      <td>
        <code>&lt;user_data&gt;</code> elements with a <code>name</code> attribute not found in the parameter file are copied from merge file to the parameter file.</td>
    </tr>
    <tr>
      <td>&lt;comment&gt;</td>
      <td>Elements omitted in the parameter file are copied from the merge file to the parameter file.</td>
    </tr>
    <tr>
      <td>&lt;tool_data&gt;</td>
      <td>Copies all elements from the merge file to the parameter file.</td>
    </tr>
    <tr>
      <td>&lt;user_tool_data&gt;</td>
      <td>Copies all elements from the merge file to the parameter file.</td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_10">Merging Model Intermediate Files</h2>
<p>Some parameters are copied from <code>&lt;material&gt;</code> and <code>&lt;bone&gt;</code> in the merge file to the <code>&lt;material&gt;</code> and <code>&lt;bone&gt;</code> with the same name in the parameter file.</p>
<p>Also, when the following conditions apply, some parameters are copied from <code>&lt;shape&gt;</code> in the merge file to the <code>&lt;shape&gt;</code> with the same name in the parameter file, along with some parameters of the <code>&lt;vertex&gt;</code> referenced by the <code>vertex_index</code> attribute of <code>&lt;shape_info&gt;</code>.</p>
<ul>
  <li>The number of matching <code>&lt;shape&gt;</code> is the same as the number of <code>original_mat_name</code> and <code>original_bone_name</code> for <code>&lt;shape_info&gt;</code>.</li>
</ul>
<p>These conditions are demonstrated by using a model intermediate file of the following configuration.</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <td>shapeA ('bone1', &quot;mat1&quot;)<br />shapeB ('bone1', &quot;mat1&quot;)<br />shapeC ('bone2', &quot;mat2&quot;)<br />shapeD ('bone2', &quot;mat2&quot;)<br />shapeE ('bone2', &quot;mat2&quot;)</td>
      <td>shapeA ('bone1', &quot;mat1&quot;)<br />shapeB ('bone1', &quot;mat1&quot;)<br />shapeC ('bone2', &quot;mat2&quot;)<br />shapeD ('bone2', &quot;mat2&quot;)</td>
    </tr>
  </tbody>
</table>
<p>The leftmost characters are the shape name, the characters enclosed in single quotes (') within parentheses (( )) are bone names referenced by the shapes, and the characters enclosed in quotation marks (&quot;) are the original material names referenced by the shapes. The only meshes merged in this configuration are <code>shapeA</code> and <code>shapeB</code>. Because their numbers of shapes referenced by the same bones and materials differ, <code>shapeC</code> and <code>shapeD</code> are not merged.</p>
<p>The parameters in the following list are copied when model intermediate files are merged.</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th colspan="2" align="left">Merge Models</th>
    </tr>
    <tr>
      <td>&lt;model_info&gt;</td>
      <td>unite_pos_quantize</td>
    </tr>
    <tr>
      <th colspan="2" align="left">Merging Materials</th>
    </tr>
    <tr>
      <td>&lt;material_info&gt;</td>
      <td>visibility<br />mesh_adjacency</td>
    </tr>
    <tr>
      <td>&lt;sampler_array&gt;</td>
      <td>All elements <a href="#Anchor_83955705_anchor_01">(Note 1)</a></td>
    </tr>
    <tr>
      <td>&lt;shader_assign&gt;</td>
      <td>All elements <a href="#Anchor_83955705_anchor_02">(Note 2)</a></td>
    </tr>
    <tr>
      <th colspan="2" align="left">Merging Bones</th>
    </tr>
    <tr>
      <td>&lt;skeleton_info&gt;</td>
      <td>
        <p>scale_enable</p>
      </td>
    </tr>
    <tr>
      <td>&lt;bone&gt;</td>
      <td>billboard<br />visibility</td>
    </tr>
    <tr>
      <th colspan="2" align="left">Merging Vertex Data</th>
    </tr>
    <tr>
      <td>&lt;lod_offset&gt;</td>
      <td>All elements <a href="#Anchor_83955705_anchor_03">(Note 3)</a></td>
    </tr>
    <tr>
      <td>&lt;vtx_attrib&gt;</td>
      <td>quantize_type <a href="#Anchor_83955705_anchor_04">(Note 4)</a><br />count <a href="#Anchor_83955705_anchor_03">(Note 3)</a></td>
    </tr>
    <tr>
      <td>&lt;vtx_buffer&gt;</td>
      <td>All elements <a href="#Anchor_83955705_anchor_05">(Note 5)</a></td>
    </tr>
    <tr>
      <th colspan="2" align="left">Merging Shapes</th>
    </tr>
    <tr>
      <td>&lt;shape_info&gt;</td>
      <td>
        <p>mat_name <a href="#Anchor_83955705_anchor_06">(Note 6)</a></p>
        <p>original_material_name <a href="#Anchor_83955705_anchor_04">(Note 4)</a></p>
        <p>original_bone_name <a href="#Anchor_83955705_anchor_04">(Note 4)</a></p>
        <p>optimize_primitive_mode <a href="#Anchor_83955705_anchor_04">(Note 4)</a> <br />original_shape_hash <a href="#Anchor_83955705_anchor_04">(Note 4)</a> <br />optimize_primitive_mode <a href="#Anchor_83955705_anchor_04">(Note 4)</a> <br />delete_near_vertex_mode <a href="#Anchor_83955705_anchor_04">(Note 4)</a> <br />divide_submesh_mode <a href="#Anchor_83955705_anchor_04">(Note 4)</a> <br />polygon_reduction_mode <a href="#Anchor_83955705_anchor_04">(Note 4)</a></p>
      </td>
    </tr>
    <tr>
      <td>&lt;mesh&gt;</td>
      <td>All elements included in <code>&lt;submesh_array&gt;</code> <a href="#Anchor_83955705_anchor_03">(Note 3)</a>, <a href="#Anchor_83955705_anchor_04">(Note 4)</a></td>
    </tr>
    <tr>
      <th colspan="2" align="left">Merging Streams</th>
    </tr>
    <tr>
      <td>&lt;stream&gt;</td>
      <td>Data array referenced from <code>&lt;vtx_attrib&gt;</code> and <code>&lt;mesh&gt;</code><a href="#Anchor_83955705_anchor_03">(Note 3)</a>, <a href="#Anchor_83955705_anchor_04">(Note 4)</a></td>
    </tr>
  </tbody>
</table>
<p>
  <br />
</p>
<p>
  <a name="Anchor_83955705_anchor_01"></a>
  <strong>Note 1:</strong> <a href="#Anchor_83955705_sampler_merge">Sampler merging</a> is performed when the <code>--sampler-merge-priority</code> option is specified.<br />Omitting this option keeps the samplers in both merge files.</p>
<p>
  <a name="Anchor_83955705_anchor_02"></a>
  <strong>Note 2:</strong> If the <code>--texture-srt-merge-priority</code> option is specified, set the shader parameter of the merge file and then, if <code>hint</code> of <code>&lt;original_texsrt&gt;</code> in the argument file matches the <code>original_hint</code> of <code>&lt;shader_param&gt;</code> with a <code>type</code> of <code>texsrt</code> or <code>texsrt_ex</code>, use the <code>&lt;original_texsrt&gt;</code> value. </p>
<p>
  <a name="Anchor_83955705_anchor_03"></a>
  <strong>Note 3:</strong> <a href="#Anchor_83955705_lod_merge">LOD merging</a> is also performed when, in addition to the conditions described in <strong>Note 4</strong>, the <code>&lt;shape&gt;</code> element of the merge file has LOD and <code>polygon_reduction_mode</code> is set for the <code>&lt;shape_info&gt;</code> element. When <code>polygon_reduction_mode</code> is not set, LOD is not merged and the only thing that is merged is the <code>&lt;mesh&gt;</code> element at the start of <code>&lt;mesh_array&gt;</code>.</p>
<p>
  <a name="Anchor_83955705_anchor_04"></a>
  <strong>Note 4:</strong>  Merging does not take place when <code>original_shape_hash</code> is set for <code>&lt;shape_info&gt;</code> of the merge file and it matches the <code>original_shape_hash</code> of the parameter file.<br />If the parameter file and the <code>original_shape_hash</code> of the merge file match, a merge is performed.</p>
<p>
  <a name="Anchor_83955705_anchor_05"></a>
  <strong>Note 5:</strong> Only copies when the <code>&lt;vtx_attrib&gt;</code> value matches <code>hint</code>. Also, if a merged file of the <code>&lt;vtx_buffer_array&gt;</code> is omitted, it remains in the content of the parameter file.</p>
<p>
  <a name="Anchor_83955705_anchor_06"></a>
  <strong>Note 6:</strong> Merging is only performed when the <code>--material-assign-merge-nonpriority</code> option is specified. After merging, materials that are not referenced by the argument file are deleted.</p>
<p>
  <a name="Anchor_83955705_lod_merge"></a>
</p>
<h3 id="Anchor_83955705_h3_2">Merging LOD</h3>
<p>LOD is merged when <code>polygon_reduction_mode</code> is set for <code>&lt;shape_info&gt;</code>. The process merges all elements of <code>&lt;mesh_array&gt;</code> and <code>&lt;stream&gt;</code> that are referenced by <code>&lt;vtx_attrib&gt;</code> and <code>&lt;mesh&gt;</code>.</p>
<p>When <code>polygon_reduction_mode</code> is not set, the only thing that gets merged is the <code>&lt;mesh&gt;</code> element at the start of <code>&lt;mesh_array&gt;</code>. The <code>&lt;stream&gt;</code> being referenced by <code>&lt;vtx_attrib&gt;</code> is merged after the LOD vertex data has been removed.</p>
<p>
  <a name="Anchor_83955705_sampler_merge"></a>
</p>
<h3 id="Anchor_83955705_h3_3">Merging Samplers</h3>
<p>Sampler merging is performed when the <code>--sampler-merge-priority</code> option is specified. If you do not specify this option, only the sampler in the merge file is kept.</p>
<p>When merging samplers, <code>&lt;sampler&gt;</code> elements with the same name and hint in both the parameter file and the merge file are treated as the same samplers. For such samplers, the <code>&lt;wrap&gt;</code>, <code>&lt;filter&gt;</code>, and <code>&lt;lod&gt;</code> elements are simply copied from the merge file into the parameter file.</p>
<p>If a sampler in the merge file has a reserved name that starts with an underscore (_), it is not merged into the parameter file unless the parameter file contains a sampler with the same name.</p>
<p>If a sampler in the merge file does not have a reserved name, all of the parameters including the texture data will be merged if neither that sampler name nor hint overlaps with any sampler in the parameter file, or if that sampler has an empty hint and its name does not overlap with any sampler in the parameter file.</p>
<p>Samplers exported from the DCC tool must have names starting with an underscore (_) and non-empty hints to be merged correctly. For example, a sampler named <code>_ao</code> with hint <code>ambient_occlusion</code> would be merged correctly, but a sampler named <code>ao</code> or a sampler with no hint information would not be merged correctly because it would not be recognized as having been exported from the DCC tool.</p>
<h2 id="Anchor_83955705_h2_11">Merging Skeletal Animation Files</h2>
<p>During processing of <code>&lt;skeletal_anim_info&gt;</code>, some parameters are copied from the merge file to the parameter file.</p>
<p>The parameters in the following list are copied.</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <td>&lt;skeletal_anim_info&gt;</td>
      <td>quantize_tolerance_scale<br />quantize_tolerance_rotate<br />quantize_tolerance_translate</td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_12">Merging Material Animations</h2>
<p>
  <code>&lt;per_material_anim_array&gt;</code> and  a portion of <code>&lt;material_anim_info&gt;</code> are copied from the merge file to the parameter file. After that, merging of the animations involves those elements with the same <code>mat_name</code> in the parameter file's <code>&lt;per_material_anim&gt;</code> and <code>&lt;original_per_material_anim&gt;</code>.</p>
<p>The following parameters in <code>&lt;material_anim_info&gt;</code> are copied.</p>
<table class="wrapped" style="margin-left: 1.5em;">
  <tbody>
    <tr>
      <td>&lt;material_anim_info&gt;</td>
      <td>quantize_tolerance_tex_scale<br />quantize_tolerance_tex_rotate<br />quantize_tolerance_tex_translate</td>
    </tr>
  </tbody>
</table>
<p>For more information about the merge processes for the various elements in <code>&lt;per_material_anim&gt;</code>, see the following links.</p>
<table class="wrapped">
  <tbody>
    <tr>
      <td>&lt;shader_param_anim_array&gt;</td>
      <td>
        <a href="#Anchor_83955705_merge_shader_param_anim">Merging Shader Parameter Animations</a>
      </td>
    </tr>
    <tr>
      <td>&lt;tex_pattern_anim_array&gt;</td>
      <td>
        <a href="#Anchor_83955705_merge_tex_pattern_anim">Merging Texture Pattern Animations</a>
      </td>
    </tr>
    <tr>
      <td>&lt;material_visibility_anim&gt;</td>
      <td>
        <a href="#Anchor_83955705_merge_material_visibility_anim">Merging Material Visibility Animations</a>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_13">
  <a name="Anchor_83955705_merge_shader_param_anim"></a>Merging Shader Parameter Animations</h2>
<p>Part of <code>&lt;shader_param_anim_info&gt;</code> and all of <code>&lt;shader_param_mat_anim_array&gt;</code> are copied from the merge file to the parameter file. Then, animations are merged for all parameters with the same <code>mat_name</code> between <code>&lt;shader_param_mat_anim&gt;</code> and <code>&lt;original_material_anim&gt;</code> in the parameter file.</p>
<p>The following parameters in <code>&lt;shader_param_anim_info&gt;</code> are copied.</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <td>&lt;shader_param_anim_info&gt;</td>
      <td>quantize_tolerance_tex_scale<br />quantize_tolerance_tex_rotate<br />quantize_tolerance_tex_translate</td>
    </tr>
  </tbody>
</table>
<p>The merge process searches for <code>&lt;param_anim&gt;</code> with an empty <code>original_hint</code> from the merge file. For the argument file, if <code>&lt;original_color_anim&gt;</code> or <code>&lt;original_texsrt_anim&gt;</code> do not have the same <code>hint</code>, then <code>&lt;param_anim&gt;</code> from the merge file is copied to the argument file.</p>
<p>Also, searches for <code>&lt;param_anim&gt;</code> with the same <code>original_hint</code> as <code>&lt;original_color_anim&gt;</code> or <code>&lt;original_texsrt_anim&gt;</code>. If one is found, then <code>&lt;original_color_anim_target&gt;</code> and <code>&lt;original_texsrt_anim_target&gt;</code> are copied to <code>&lt;param_anim_target&gt;</code>.</p>
<p>The following table shows the correspondence among <code>&lt;original_color_anim_target&gt;</code>, the <code>target</code> attribute under <code>&lt;original_texsrt_anim_target&gt;</code>, and the <code>component_index</code> of <code>&lt;param_anim_target&gt;</code>. Data is copied across between corresponding parameters.</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr align="center">
      <th>target Attribute Under &lt;original_color_anim_target&gt;</th>
      <th>component_index Attribute Under &lt;param_anim_target&gt;</th>
    </tr>
    <tr align="center">
      <td>color_r</td>
      <td>0</td>
    </tr>
    <tr align="center">
      <td>color_g</td>
      <td>1</td>
    </tr>
    <tr align="center">
      <td>color_b</td>
      <td>2</td>
    </tr>
    <tr>
      <th>target Attribute Under &lt;original_texsrt_anim_target&gt;</th>
      <th>component_index Attribute Under &lt;param_anim_target&gt;</th>
    </tr>
    <tr align="center">
      <td>scale_x</td>
      <td>1</td>
    </tr>
    <tr align="center">
      <td>scale_y</td>
      <td>2</td>
    </tr>
    <tr align="center">
      <td>rotate</td>
      <td>3</td>
    </tr>
    <tr align="center">
      <td>translate_x</td>
      <td>4</td>
    </tr>
    <tr align="center">
      <td>translate_y</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
<p>
  <br />
</p>
<p>Copy operations differ depending on whether <code>&lt;original_color_anim_target&gt;</code>, <code>&lt;original_texsrt_anim_target&gt;</code>, and <code>&lt;param_anim_target&gt;</code> are present.</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>&lt;original_color_anim_target&gt;<br />&lt;original_texsrt_anim_target&gt;</th>
      <th>&lt;param_anim_target&gt;</th>
      <th>Operation</th>
    </tr>
    <tr>
      <td align="center">Yes</td>
      <td align="center">Yes</td>
      <td>
        <code>&lt;original_color_anim_target&gt;</code> and <code>&lt;original_texsrt_anim_target&gt;</code> are copied into <code>&lt;param_anim_target&gt;</code>.</td>
    </tr>
    <tr>
      <td align="center">Yes</td>
      <td align="center">No</td>
      <td>Creates <code>&lt;param_anim_target&gt;</code> from <code>&lt;original_color_anim_target&gt;</code> and <code>&lt;original_texsrt_anim_target&gt;</code>.</td>
    </tr>
    <tr>
      <td align="center">No</td>
      <td align="center">Yes</td>
      <td>Deletes <code>&lt;param_anim_target&gt;</code>.</td>
    </tr>
  </tbody>
</table>
<p>
  <br />
</p>
<p>Creates a shader parameter that represents values from the <code>mode</code> attribute of <code>&lt;original_texsrt_anim&gt;</code>. If <code>mode</code> value shader parameters already exist, they are replaced with the <code>mode</code> attribute of <code>&lt;original_texsrt_anim&gt;</code>. <code>0</code> is set as the <code>component_index</code> of the created mode value parameters.</p>
<p>
  <br />
</p>
<p>The parameters in the following list are copied from <code>&lt;original_color_anim_target&gt;</code> and <code>&lt;original_texsrt_anim_target&gt;</code> to <code>&lt;param_anim_target&gt;</code>.</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th colspan="2">Copy from</th>
      <th colspan="2">Copy destination</th>
    </tr>
    <tr>
      <td>&lt;original_color_anim_target&gt;</td>
      <td>base_value</td>
      <td>&lt;param_anim_target&gt;</td>
      <td>base_value</td>
    </tr>
    <tr>
      <td>&lt;original_texsrt_anim&gt;</td>
      <td>mode</td>
      <td>&lt;param_anim_target&gt;</td>
      <td>base_value</td>
    </tr>
    <tr>
      <td>&lt;original_texsrt_anim_target&gt;</td>
      <td>base_value</td>
      <td>&lt;param_anim_target&gt;</td>
      <td>base_value</td>
    </tr>
    <tr>
      <td>&lt;original_hermite&gt;</td>
      <td>count<br />pre_wrap<br />post_wrap<br />baked</td>
      <td>&lt;hermite_curve&gt;</td>
      <td>count<br />pre_wrap<br />post_wrap<br />baked</td>
    </tr>
    <tr>
      <td>&lt;original_linear&gt;</td>
      <td>count<br />pre_wrap<br />post_wrap<br />baked</td>
      <td>&lt;linear_curve&gt;</td>
      <td>count<br />pre_wrap<br />post_wrap<br />baked</td>
    </tr>
    <tr>
      <td>&lt;original_step&gt;</td>
      <td>count<br />pre_wrap<br />post_wrap<br />baked</td>
      <td>&lt;step_curve&gt;</td>
      <td>count<br />pre_wrap<br />post_wrap<br />baked</td>
    </tr>
  </tbody>
</table>
<p>Because there is no parameter to copy from for the <code>frame_type</code>, <code>key_type</code>, <code>scale</code>, and <code>offset</code> attributes of <code>&lt;hermite_curve&gt;</code>, <code>&lt;linear_curve&gt;</code>, and <code>&lt;step_curve&gt;</code>, these attributes are respectively set to <code>none</code>, <code>none</code>, <code>1</code>, and <code>0</code>.</p>
<p>When copying <code>&lt;original_hermite&gt;</code>, <code>&lt;original_linear&gt;</code>, and <code>&lt;original_step&gt;</code>, the <code>&lt;stream&gt;</code> component being referenced by <code>stream_index</code> is copied from the merge file to the parameter file, and the <code>stream_index</code> of the <code>&lt;stream&gt;</code> component copied into the <code>stream_index</code> attribute of <code>&lt;hermite_curve&gt;</code>, <code>&lt;linear_curve&gt;</code>, or <code>&lt;step_curve&gt;</code> is set.</p>
<h2 id="Anchor_83955705_h2_14">
  <a name="Anchor_83955705_merge_tex_pattern_anim"></a>Merging Texture Pattern Animations</h2>
<p>The <code>&lt;tex_pattern_mat_anim&gt;</code> components are merged if the <code>&lt;tex_pattern_mat_anim&gt;</code> components that have the same <code>mat_name</code> as <code>&lt;text_pattern_mat_anim&gt;</code> in the merge file exist in the parameter file. If they do not exist, the <code>&lt;tex_pattern_mat_anim&gt;</code> component is copied from the merge file to the parameter file.</p>
<p>The <code>&lt;pattern_anim_target&gt;</code> component in the parameter file remains if the <code>&lt;pattern_anim_target&gt;</code> components that have the same <code>hint</code> attribute as <code>&lt;pattern_anim_target&gt;</code> exist in the merge file.</p>
<p>The <code>pattern_index</code> attribute of <code>&lt;tex_pattern&gt;</code>, the <code>index</code> attribute of <code>&lt;tex_pattern_mat_anim&gt;</code>, the <code>stream_index</code> attribute of <code>&lt;step_curve</code>&gt;, and the <code>stream_index</code> attribute of <code>&lt;stream&gt;</code> are changed to match the indices of data copied into the parameter file. The <code>pattern_index</code> of <code>&lt;tex_pattern&gt;</code> in the parameter file is set for the <code>base_value</code> of <code>&lt;pattern_anim_target&gt;</code>.</p>
<p>When <code>&lt;pattern_anim_target&gt;</code> is copied from a merge file into a parameter file, <code>&lt;step_curve&gt;</code> and the <code>&lt;stream&gt;</code> attribute referenced by the <code>stream_index</code> under <code>&lt;step_curve&gt;</code> are also copied. <code>&lt;tex_pattern&gt;</code> in the merge file is copied to the parameter file if the <code>&lt;tex_pattern&gt;</code> referenced by the <code>&lt;stream&gt;</code> component that was copied does not exist in the parameter file. <code>&lt;tex_pattern&gt;</code> components copied to the parameter file are maintained in the order they appear in the merge file.</p>
<p>The contents of the <code>&lt;stream&gt;</code> component that was copied are used to overwrite the <code>pattern_index</code> of the <code>&lt;tex_pattern&gt;</code> component in the parameter file.</p>
<p>The following list shows the data that is copied.</p>
<table class="wrapped">
  <tbody>
    <tr>
      <td>&lt;tex_pattern_mat_anim&gt;</td>
      <td>mat_name</td>
    </tr>
    <tr>
      <td>&lt;pattern_anim_target&gt;</td>
      <td>sampler_name<br />hint</td>
    </tr>
    <tr>
      <td>&lt;step_curve&gt;</td>
      <td>count<br />frame_type<br />key_type<br />scale<br />offset<br />pre_wrap<br />post_wrap<br />baked</td>
    </tr>
    <tr>
      <td>&lt;stream&gt;</td>
      <td>type<br />count<br />column</td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_15">Merging Bone Visibility Animations</h2>
<p>
  <code>&lt;bone_vis_bone_anim&gt;</code> components are merged if the <code>&lt;bone_vis_bone_anim&gt;</code> components that have the same bone name as the <code>&lt;bone_vis_bone_anim&gt;</code> component in the merge file exist in the parameter file and <code>base_value</code> is <code>1</code>. When they do not exist, <code>&lt;bone_vis_bone_anim&gt;</code> is not copied.</p>
<p>When <code>&lt;step_curve&gt;</code> is copied from a merge file into a parameter file, the <code>&lt;stream&gt;</code> component referenced by the <code>stream_index</code> attribute under <code>&lt;step_curve&gt;</code> is also copied. The <code>stream_index</code> attribute under <code>&lt;step_curve&gt;</code> and the <code>stream_index</code> attribute under <code>&lt;stream&gt;</code> are changed to match the <code>&lt;stream&gt;</code> component copied into the parameter file.</p>
<p>The following list shows the data that is copied.</p>
<table class="wrapped">
  <tbody>
    <tr>
      <td>&lt;bone_vis_bone_anim&gt;</td>
      <td>binarize_visibility<br />base_value</td>
    </tr>
    <tr>
      <td>&lt;step_curve&gt;</td>
      <td>count<br />frame_type<br />key_type<br />scale<br />offset<br />pre_wrap<br />post_wrap<br />baked</td>
    </tr>
    <tr>
      <td>&lt;stream&gt;</td>
      <td>type<br />count<br />column</td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_16">
  <a name="Anchor_83955705_merge_material_visibility_anim"></a>Merging Material Visibility Animations</h2>
<p>The <code>&lt;mat_vis_mat_anim&gt;</code> components that have <code>mat_name</code> attributes not found in the parameter file are copied from the merge files into the parameter files.</p>
<p>When <code>&lt;step_curve&gt;</code> is copied from a merge file into a parameter file, the <code>&lt;stream&gt;</code> component referenced by the <code>stream_index</code> attribute under <code>&lt;step_curve&gt;</code> is also copied. The <code>stream_index</code> attribute under <code>&lt;step_curve&gt;</code> and the <code>stream_index</code> attribute under <code>&lt;stream&gt;</code> are changed to match the <code>&lt;stream&gt;</code> indices copied into the parameter file.</p>
<p>The following list shows the data that is copied.</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <td>&lt;mat_vis_mat_anim&gt;</td>
      <td>mat_name<br />base_value</td>
    </tr>
    <tr>
      <td>&lt;step_curve&gt;</td>
      <td>count<br />frame_type<br />key_type<br />scale<br />offset<br />pre_wrap<br />post_wrap<br />baked</td>
    </tr>
    <tr>
      <td>&lt;stream&gt;</td>
      <td>type<br />count<br />column</td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_17">Merging Shape Animations</h2>
<p>
  <code>&lt;vertex_shape_anim&gt;</code> is not merged. Only <code>&lt;user_data_array&gt;</code>, <code>&lt;tool_data&gt;</code>, <code>&lt;user_tool_data&gt;</code>, and <code>&lt;comment&gt;</code>  are merged.</p>
<h2 id="Anchor_83955705_h2_18">Merging Scene Animations</h2>
<p>The tool copies part of <code>&lt;scene_anim_info&gt;</code>, the <code>&lt;camera_anim&gt;</code> elements with the <code>camera_name</code> attribute not found in parameter files, the <code>&lt;light_anim&gt;</code> elements with the <code>light_name</code> attribute not found in parameter files, and the <code>&lt;fog_anim&gt;</code> elements with the <code>fog_name</code> attribute not found in parameter files from the merged file into the parameter file. Only <code>&lt;comment&gt;</code> is merged between data for which the <code>camera_name</code>, <code>light_name</code>, and <code>fog_name</code> are consistent.</p>
<p>When <code>&lt;step_curve&gt;</code>, <code>&lt;hermite_curve&gt;</code>, and <code>&lt;linear_curve&gt;</code> are copied from a merge file into a parameter file, the <code>&lt;stream&gt;</code> component referenced by <code>stream_index</code> under <code>&lt;step_curve&gt;</code> is also copied. The <code>stream_index</code> attribute under <code>&lt;hermite_curve&gt;</code>, <code>&lt;linear_curve&gt;</code>, and <code>&lt;step_curve&gt;</code>, and the <code>stream_index</code> attribute under <code>&lt;stream&gt;</code> are changed to match the <code>&lt;stream&gt;</code> indexes copied into the parameter file.</p>
<p>The following list shows the data that is copied.</p>
<table class="wrapped">
  <tbody>
    <tr>
      <td>&lt;scene_anim_info&gt;</td>
      <td>quantize_tolerance_rotate<br />quantize_tolerance_translate</td>
    </tr>
    <tr>
      <td>&lt;camera_anim&gt;</td>
      <td>All parameters</td>
    </tr>
    <tr>
      <td>&lt;light_anim&gt;</td>
      <td>All parameters</td>
    </tr>
    <tr>
      <td>&lt;fog_anim&gt;</td>
      <td>All parameters</td>
    </tr>
    <tr>
      <td>&lt;hermite_curve&gt;</td>
      <td>count<br />frame_type<br />key_type<br />scale<br />offset<br />pre_wrap<br />post_wrap<br />baked</td>
    </tr>
    <tr>
      <td>&lt;linear_curve&gt;</td>
      <td>count<br />frame_type<br />key_type<br />scale<br />offset<br />pre_wrap<br />post_wrap<br />baked</td>
    </tr>
    <tr>
      <td>&lt;step_curve&gt;</td>
      <td>count<br />frame_type<br />key_type<br />scale<br />offset<br />pre_wrap<br />post_wrap<br />baked</td>
    </tr>
    <tr>
      <td>&lt;stream&gt;</td>
      <td>type<br />count<br />column</td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_83955705_h1_12">
  <a name="Anchor_83955705_combine"></a>Merging</h1>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe --combine --combine-options &quot;[intermediate file].. [--ignore-frame-loop-unmatch] [--ignore-animaton-conflict]&quot; [-o &quot;&quot;] [intermediate file]</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>Merging is supported for material animation (FMA) files, shader parameter animation (FSP, FCL, and FTS) files, texture pattern animation (FTP) files, and material visibility animation (FVM) files.</p>
<h2 id="Anchor_83955705_h2_19">Sub-Options</h2>
<p>
  <strong>Intermediate file</strong>
</p>
<p>Specifies the files to merge.<br />Supported intermediate files: FMA, FSP, FCL, FTS, FTP, FVM.</p>
<p>
  <strong>--ignore-frame-loop-unmatch</strong>
</p>
<p>Merges animations even if the number of frames and loop settings do not match.</p>
<p>
  <strong>--ignore-animation-conflict</strong>
</p>
<p>Merges animations even if there are materials with similar animations.</p>
<h2 id="Anchor_83955705_h2_20">Common Specifications for Merging</h2>
<p>In the following description, the file that specifies the parameters for <code>3dIntermediateFileOptimizer.exe</code> is called the <em>parameter file</em>, and the file that specifies the <code>--combine-options</code> options is called the <em>merge file</em>.</p>
<p>If the parameter file is for anything other than a material animation (FMA file), you must specify the <code>--output</code> option.</p>
<p>The content of the parameter file is output for <code>&lt;user_data_array&gt;</code>, <code>&lt;comment&gt;</code>, <code>&lt;tool_data&gt;</code>, <code>&lt;user_tool_data&gt;</code>, <code>&lt;user_data_array&gt;</code>, and <code>&lt;material_anim_info&gt;</code>.</p>
<p>If the parameter file is for anything other than a material animation (FMA file), the  <code>&lt;material_anim_info&gt;</code> converted from each <code> &lt;????_anim_Info&gt;</code> is output.<br />(If there is no quantization tolerance, the default values are output.)</p>
<p>If multiple merge files have been specified, the parameter files are merged in the order of the specified merge files.</p>
<p>If the animation files being merged have <code>&lt;per_material_anim&gt;</code> with the same <code>mat_name</code>, they are merged into one.<br />Also, the <code>&lt;shader_param_anim_array&gt;</code> and <code>&lt;tex_pattern_anim_array&gt;</code> elements in <code>&lt;per_material_anim&gt;</code> are merged into one.</p>
<p>If the animation files being merged have <code>&lt;original_per_material_anim&gt;</code> with the same <code>mat_name</code>, they are merged into one.<br />Also, the <code>&lt;original_color_anim_array&gt;</code> and <code>&lt;original_texsrt_anim_array&gt;</code> elements in <code>&lt;original_per_material_anim&gt;</code> are merged into one.</p>
<p>If the number of frames and the loop settings do not match among the animation files being merged, an error will occur. To ignore these mismatches, specify the <code>--ignore-frame-loop-unmatch</code> option.<br />(The number of frames and the loop setting from the parameter file are output.) </p>
<p>Similarly, an error will occur if there are materials with similar animations among the animation files being merged. To ignore this error, specify the <code>--ignore-animation-conflict</code> option.<br />(The animation of the parameter file or the initially specified merge file is output.) </p>
<h2 id="Anchor_83955705_h2_21">Merging Texture Pattern Animations</h2>
<p>If both the parameter file and the merge file include texture pattern animation, <code>&lt;tex_pattern_array&gt;</code> will be merged.</p>
<p>If files with the same name are specified in the <code>&lt;tex_pattern_array&gt;</code> that are being merged, the result of the merge is that only one is specified.</p>
<p>The texture pattern animation is adjusted according to the index of the merged texture patterns.</p>
<h1 id="Anchor_83955705_h1_13">
  <a name="Anchor_83955705_delete_near_vertex_detail"></a>Deleting Nearby Vertices</h1>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe --delete-near-vertex --delete-near-vertex-options &quot;[--position ''] [--normal ''] [--tangent ''] [--binormal ''] [--color ''] [--uv ''] [--blend-index ''] [--blend-weight ''] [--threshold '']&quot; [-o &quot;&quot;] [intermediate file]</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>Deletes nearby vertices. Because primitive optimization results are invalid after optimization, optimize again using <code>--optimize-primitive</code>.</p>
<p>
  <br />
</p>
<h2 id="Anchor_83955705_h2_22">Sub-Options</h2>
<p>
  <strong>--position &quot;&quot;</strong>
</p>
<p>Specifies the tolerance for the position. The default is <strong>1.0/4096.0</strong>. </p>
<p>
  <strong>--normal &quot;&quot;</strong>
</p>
<p>Specifies the normal tolerance as an angle. The default is <strong>0.1</strong>.</p>
<p>
  <strong>--tangent &quot;&quot;</strong>
</p>
<p>Specifies the tangent tolerance as an angle. The default is <strong>0.1</strong>.</p>
<p>
  <strong>--binormal &quot;&quot;</strong>
</p>
<p>Specifies the binormal tolerance as an angle. The default is <strong>0.1</strong>.</p>
<p>
  <strong>--color &quot;&quot;</strong>
</p>
<p>Specifies the tolerance for vertex color. The default is <strong>1.0/255.0</strong>.</p>
<p>
  <strong>--uv &quot;&quot;</strong>
</p>
<p>Specifies the tolerance for the UV values. The default is <strong>1.0/256.0</strong>.</p>
<p>
  <strong>--blend-index &quot;&quot;</strong>
</p>
<p>Specifies the tolerance for the blend index. The default is <strong>1.0e-7</strong>.</p>
<p>
  <strong>--blend-weight &quot;&quot;</strong>
</p>
<p>Specifies the tolerance for the blend weight. The default is <strong>1.0e-7</strong>.</p>
<p>
  <strong>--threshold &quot;&quot;</strong>
</p>
<p>Specifies the tolerance for an arbitrary vertex attribute. Specify in the format of &quot;vertex attribute name: tolerance, vertex attribute name: tolerance,&quot; and so on.</p>
<p>Example</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe --delete-near-vertex --delete-near-vertex-options &quot;----threshold _u0:0.02,_p0:0.01&quot; input.fmdb</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>
  <br />
</p>
<h2 id="Anchor_83955705_h2_23">Algorithms</h2>
<p>All vertex attributes delete one attribute from the two vertices closest to the standard. They also adjust indexes so that problems do not occur in reduced states.</p>
<p>For intermediate files that have merged LOD models, only the base level is optimized.</p>
<h2 id="Anchor_83955705_h2_24">Usage Examples</h2>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe --delete-near-vertex --delete-near-vertex-options &quot;--position 0.001 --tangent 90.0 --binormal 180.0&quot; input.fmdb</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_83955705_h1_14">
  <a name="Anchor_83955705_divide_submesh"></a>Submesh Division</h1>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe --divide-submesh --divide-submesh-options &quot;[--max-bounding-box-width ''] [--max-division-depth ''] [--min-triangle-count '']&quot; [-o &quot;&quot;] [intermediate file]</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>Divides a submesh and configures a binary tree. Dividing the submesh makes it possible to achieve finer control when using <a href="../Pages/Page_106333662.html#Anchor_106333662_view_frustum_culling">view frustum culling</a>. Because primitive optimization results are invalid after optimization, optimize again using <code>--optimize-primitive</code>. For intermediate files that have merged LOD models, the files are optimized after the LOD's are deleted. Divided submeshes can be combined using submesh combination optimization. </p>
<h2 id="Anchor_83955705_h2_25">Sub-Options</h2>
<p>
  <strong>--max-bounding-box-width &quot;&quot;</strong>
</p>
<p>Specifies the maximum size for the bounding box for the submesh that will be divided.<br />Triangular polygons larger than this are treated as exceptions.<br />The default value is <code>100.0</code>.</p>
<p>
  <strong>--max-division-depth &quot;&quot;</strong>
</p>
<p>Specifies the maximum depth for the binary tree that will be created during the division process.<br />Use this option when you cannot get the desired result using only the <code>--max-bounding-box-width</code> option, such as when you want more subdivisions.<br />The default value is <code>5</code>.</p>
<p>
  <strong>--min-triangle-count &quot;&quot;</strong>
</p>
<p>Specifies the minimum number of triangles when dividing the submesh.<br />Use this option when you want to avoid dividing the submesh too finely and cannot get the desired result using only the <code>--max-bounding-box-width</code> option.<br />The default value is <code>1</code>.</p>
<h2 id="Anchor_83955705_h2_26">Algorithms</h2>
<p>Divides by combining multiple methods by using mesh types. The bounding box might not necessarily be less than the <code>--max-bounding-box-width</code>.</p>
<h2 id="Anchor_83955705_h2_27">Usage Examples</h2>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe --divide-submesh --divide-submesh-options &quot;--max-bounding-box-width 100 --max-division-depth 5 --min-triangle-count 1&quot; input.fmdb</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_28">Displaying Results</h2>
<p>The following example shows how the results of attempting to divide each division node are totaled.</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>&nbsp;&nbsp;&nbsp;NotDivide: 0      Success: 10   LessTriangle: 1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TooDeep: 2      ShortBox: 8       TooSmall: 0
NotReduction: 0   Discrepancy: 0      Exclusion: 0</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>Possible results of attempting divisions are shown on the left and the count for each result type is shown on the right. The following list describes the displayed items.</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>Terminology</th>
      <th>Description</th>
    </tr>
    <tr>
      <td align="center">NotDivide</td>
      <td align="center">Not divisible by the division algorithm.</td>
    </tr>
    <tr>
      <td align="center">Success</td>
      <td align="center">Divided.</td>
    </tr>
    <tr>
      <td align="center">LessTriangle</td>
      <td align="center">Too few target triangles.<br />This result occurs only if <code>--max-bounding-box-width</code> is small enough compared to the polygon.</td>
    </tr>
    <tr>
      <td align="center">TooDeep</td>
      <td align="center">The number of node levels exceeds the maximum allowed.<br />If this happens a lot, you can expect more divisions by increasing <code>--max-division-depth</code> .</td>
    </tr>
    <tr>
      <td align="center">ShortBox</td>
      <td align="center">The division nodes are already small enough.<br />This result occurs only if <code>--max-bounding-box-width</code> is large enough compared to the polygon.</td>
    </tr>
    <tr>
      <td align="center">TooSmall</td>
      <td align="center">The object is too small if subdivided (such as a line).</td>
    </tr>
    <tr>
      <td align="center">NotReduction</td>
      <td align="center">Size is not reduced even if divided (95 percent of original size or larger).</td>
    </tr>
    <tr>
      <td align="center">Discrepancy</td>
      <td align="center">A discrepancy occurred during division.</td>
    </tr>
    <tr>
      <td align="center">Exclusion</td>
      <td align="center">The division algorithm cannot handle exception polygons.</td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_83955705_h1_15">
  <a name="Anchor_83955705_polygon_reduction"></a>Polygon Reduction</h1>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe --polygon-reduction --polygon-reduction-options &quot;--target-rate-lod-level1 '' [--target-rate-lod-level2 ''] ... [--target-rate-lod-level9 ''] [--target-rate ''] [-q ''] [--property-flag ''] [--lock-open-edge-angle ''] [--feature-face-angle ''] [--lock-uv-hard-edge-angle ''] [--optimize-position-policy ''] [--smoothing] [-policy ''] [--distance-offset ''] [--uv-weight ''] [--anim-blend-weight ''] [--color-weight ''] [--disable-merge-shape] [--allowable-color-gradient-threshold '']&quot; [-o &quot;&quot;] [intermediate file]</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>Automatically generates an LOD model from the base model. <code>--polygon-reduction-options</code> must be specified.</p>
<p>For more information about the polygon reduction algorithm, see <a href="../Pages/Page_162186377.html">Polygon Reduction</a> in the description of the features of the 3D module.</p>
<p>Supported intermediate files: FMD</p>
<p>If you are deleting nearby vertices and dividing submeshes, make sure to perform these optimizations before performing polygon reduction.</p>
<h2 id="Anchor_83955705_h2_29">Note: Cases Where Simplification Is Not Performed</h2>
<p>Simplification is not performed in some cases, such as when there is a non-manifold mesh in <code>Shape</code>, or when <code>--disable-merge-shape</code> is used and there are redundant polygons in the FMD file, resulting in a non-manifold geometry.</p>
<p>In these cases, a warning is shown in the output message  on execution.</p>
<h2 id="Anchor_83955705_h2_30">Sub-Options</h2>
<h3 id="Anchor_83955705_h3_4">Specifying an Arguments File</h3>
<p>
  <strong>--args-file &quot;&quot;</strong>
</p>
<p>Specifies an arguments file with the arguments to specify for polygon reduction.<br />You can use the contents in the parameter file to specify arguments. <br />The parameter file allows you to specify each option over several lines. <br />Lines starting with a number sign (#) are treated as comments. <br />Newline characters cannot be included in escape sequences used in option specifications that appear between quotation marks (&quot;).</p>
<h4 id="Anchor_83955705_h4_1">Option Presets</h4>
<p>You can specify one of the following files for the <code>--args-file</code> option to use preset combinations of arguments.</p>
<p>
  <code>%NINTENDO_SDK_ROOT%\Tools\Graphics\3dTools\Presets\PolygonReduction</code>
</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>Filename</th>
      <th>Description</th>
    </tr>
    <tr>
      <td>CommonSet.txt</td>
      <td>A preset with the common settings.</td>
    </tr>
    <tr>
      <td>NatureMajorSet.txt</td>
      <td>A preset with settings geared toward models with lots of smooth shapes.</td>
    </tr>
    <tr>
      <td>BuildingsMajorSet.txt</td>
      <td>A preset with settings geared toward models with lots of angular shapes.</td>
    </tr>
  </tbody>
</table>
<p>Usage Examples</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe Input.fmdb --polygon-reduction --polygon-reduction-options &quot;--target-rate-lod-level1 0.5 --args-file Presets/PolygonReduction/CommonSet.txt&quot;</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h3 id="Anchor_83955705_h3_5">Shape Reduction Rate Settings</h3>
<p>
  <strong>--target-rate-lod-level1 &lt;arg&gt; ~ --target-rate-lod-level9 &lt;arg&gt;</strong>
</p>
<p>(# is an integer between 1 and 9 that indicates the level.)<br />Specify the percentage number of polygons to keep after polygon reduction. For example, if you specify <code>0.2</code> for a model that originally had 10,000 polygons, the reduction process attempts to create a new model with 2000 polygons.<br />The number of polygons that can be reduced, depends on other parameters and may not necessarily reach the specified number of polygons.<br />Minimum value: 0.0 Maximum value: 1.0</p>
<p>
  <strong>--target-rate &lt;arg&gt;</strong>
</p>
<p>Provides a simpler way to set the target polygon reduction rate for each LOD level than using <code>--target-rate-lod-level1 &lt;arg&gt;</code> to <code>--target-rate-lod-level9 &lt;arg&gt;</code>.</p>
<p>It is possible to specify an order for the shape reduction from level one to level 9, such as <code>--target-rate &quot;0.75 0.5 0.25&quot;</code>.</p>
<p>
  <strong>--target-rate-per-shapes &lt;arg&gt;</strong>
</p>
<p>Specifies the lower limit, per shape, for the proportion of polygons with respect to the original model, after reduction.</p>
<p>Specify with a <em>shape name:proportion</em> format, as in <code>--target-rate-per-shapes &quot;shapeA:0.8, shapeB:0.6, shapeC:0.5&quot;</code>. You can use commas as delimiters to specify multiple shapes.</p>
<p>You can prevent shapes from breaking down when that occurs, after reducing certain shapes, by setting a lower limit with this option.</p>
<p>
  <strong>-q, --quality &lt;arg&gt;</strong>
</p>
<p>Sets the cost for edges that can be degenerated. Specifies the ratio of cost of the reducible edge to the maximum initial cost.<br />For example, specifying <code>0.1</code> treats edges up to 10 percent of the maximum cost value as reducible edges.<br />Minimum value: 0.0 Maximum value: 1.0 Default value: 0.99</p>
<h3 id="Anchor_83955705_h3_6">Settings for Properties Considered During Polygon Reduction</h3>
<p>
  <strong>
    <a name="Anchor_83955705_poly-red-property"></a>--property-flag &lt;arg&gt;</strong>
</p>
<p>This parameter specifies the properties that are considered during polygon reduction.</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>Value</th>
      <th>Description</th>
    </tr>
    <tr>
      <td>Position</td>
      <td>Consider vertex positions.</td>
    </tr>
    <tr>
      <td>Normal</td>
      <td>Consider vertex normals.</td>
    </tr>
    <tr>
      <td>UV</td>
      <td>Consider the UV texture coordinates.</td>
    </tr>
    <tr>
      <td>BlendWeight</td>
      <td>Consider motion.</td>
    </tr>
    <tr>
      <td>Color</td>
      <td>Consider the vertex color.</td>
    </tr>
    <tr>
      <td>All</td>
      <td>Consider all.</td>
    </tr>
  </tbody>
</table>
<p>Specifies the properties that are considered during polygon reduction. The strings defining the properties can be combined, or they can be added by configuring them separately.</p>
<p>Consider this example:</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>--property-flag Position|Normal</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>(In this example the strings have been spliced together using the pipe character (|).)</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>--property-flag Position --property-flag Normal</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>(These properties are specified by making multiple calls.)</p>
<p>Default: Position|UV</p>
<h3 id="Anchor_83955705_h3_7">Settings for Protecting Edges</h3>
<p>
  <strong>
    <a name="Anchor_83955705_poly-red-open-edge"></a>--lock-open-edge-angle &lt;arg&gt;</strong>
</p>
<p>This parameter controls reduction of open edges (outside edges where there is a plane on only one side of the edge) by looking at and using the angle between adjacent open edges when determining whether to delete them. Preserves edges below the specified minor angle. At 180 degrees all edges are preserved.</p>
<p>Minimum value: 0.0, Maximum value: 180.0, Default value: 0.0</p>
<p>
  <strong>
    <a name="Anchor_83955705_poly-red-uv-hard-edge"></a>--lock-uv-hard-edge-angle &lt;arg&gt;</strong>
</p>
<p>Sets the maximum angle between consecutive UV hard edges as the condition for determining whether a UV hard edge can be degenerated. Preserves edges below the specified minor angle. At 180 degrees all edges are preserved. Use by adding the UV coordinates to <code>--property-flag.</code></p>
<p>Minimum value: 0.0, Maximum value: 180.0, Default value: 0.0</p>
<p>
  <strong>
    <a name="Anchor_83955705_poly-red-feature-angle"></a>--feature-face-angle &lt;arg&gt;</strong>
</p>
<p>This parameter specifies the minimum angle between edges for them to be feature edges. Preserves feature edges below the specified minor angle. At 180 degrees all edges are preserved.</p>
<p>This protection is not absolute, so all vertices are reduction targets in a state of being weighted more heavily.</p>
<p>Minimum value: 0.0, Maximum value: 180.0, Default value: 0.0</p>
<p>
  <strong>--allowable-color-gradient-threshold &lt;arg&gt;</strong>
</p>
<p>If the gradient of the vertex color between two vertices forming the edge (color space distance) is larger than the specified value, it protects that edge.</p>
<p>Minimum value: 0.0, Maximum value: 2.0, Default value: 2.0</p>
<h3 id="Anchor_83955705_h3_8">Reduction Calculation Method Settings</h3>
<p>
  <strong>
    <a name="Anchor_83955705_poly-red-opt-policy"></a>--optimize-position-policy &lt;arg&gt;</strong>
</p>
<p>This option controls position calculations after reduction. This option specifies how to calculate new position coordinates when deleting edges.</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>Value</th>
      <th>Description</th>
    </tr>
    <tr>
      <td>SharedPosition</td>
      <td>Use one of the vertices, and also share the vertex with the base model.<p>Submesh boundaries are also protected and do not move. This setting makes it easier to share vertices with the base model, but the overall degree of simplification decreases significantly.</p></td>
    </tr>
    <tr>
      <td>OptimalOnEdge</td>
      <td>Get and use the position with the optimal position on the edge. New vertices are placed somewhere along the edge that gets deleted, so the overall shape is almost never significantly changed. This setting is safe regardless of the shape.<p>Best for angular shapes such as machines and buildings.</p></td>
    </tr>
    <tr>
      <td>OptimalOnSpace</td>
      <td>Calculate the position after reduction, and then find the optimal position in space.<p>Best for smoother shapes such as animals and people.</p></td>
    </tr>
    <tr>
      <td>OptimalOnFace</td>
      <td>The position will be some arbitrary point on one of the two planes sharing the edge after deleting the edge. Requires the most calculation time.</td>
    </tr>
  </tbody>
</table>
<pre>OptimalOnSpace &gt;= OptimalOnEdge &gt;= OptimalOnFace &gt; SharedPosition.<br />  In terms of processing time, in order by fastest: OptimalOnSpace &gt;= OptimalOnEdge &gt; SharedPosition &gt; OptimalOnFace. <br />  With SharedPosition</pre>
<p>Default: OptimalOnEdge</p>
<!--Remove-->
<p>
  <strong>--smoothing</strong>
</p>
<p>Specifies whether to apply smoothing to the whole shape.<br />This option works best for models such as buildings with well-defined features. It may negatively affect the characteristic features of smoother models such as animals and people.</p>
<p>
  <strong>--policy &lt;arg&gt;</strong>
</p>
<p>This parameter specifies the weighting policy used during reduction. Use this where required, for example, to avoid creating thin polygons.</p>
<table class="wrapped">
  <colgroup>
    <col />
    <col />
  </colgroup>
  <tbody>
    <tr>
      <th>Value</th>
      <th>Description</th>
    </tr>
    <tr>
      <td>AreaBased</td>
      <td>Prioritize area. Polygon area is weighted to make all polygons have the same surface area.</td>
    </tr>
    <tr>
      <td>AngleBased</td>
      <td>Prioritize shape. Polygon angle is weighted to make it optimal that all polygons are equilateral triangles.</td>
    </tr>
    <tr>
      <td>AreaAngleBased</td>
      <td>Polygon area and angle are both weighted.</td>
    </tr>
  </tbody>
</table>
<p>Default: No weighting.</p>
<p>
  <strong>--distance-offset &quot;&quot;</strong>
</p>
<p>The distance offset.<br />Polygon reduction does not change the distance between new vertices and the plane for objects such an infinite floors. Adding this offset for such objects enables you to evaluate objects using changes in area.<br />A small value such as 0.0001 is usually more than sufficient for this parameter.<br />Type: <code>Double</code>, Minimum value: <code>0</code>, Maximum value: <code>DoubleMax</code>, Default value: <code>0</code></p>
<h3 id="Anchor_83955705_h3_9">Cost Calculation Weight Settings</h3>
<p>
  <strong>
    <a name="Anchor_83955705_poly-red-uv-weight"></a>--uv-weight &quot;&quot;</strong>
</p>
<p>Evaluation ratio against UV in %. At 0.0, UV is not considered. At 1.0, only UV is 100% considered in the reduction. To place a greater emphasis on UV coordinates during reduction, specify a larger value.<br />If the effect on UV coordinates is large, specify a smaller value to weaken the effect. Use by adding the UV coordinates to <code>--property-flag</code>.<br />Minimum value: 0, Maximum value: 1.0, Default value: 0.05</p>
<p>
  <br />
</p>
<p>
  <strong>--normal-weight &quot;&quot;</strong>
</p>
<p>Weighting on the vertex normal. Specifying a value of <code>0.0</code> is the same as giving no consideration to the normal. Set a value of <code>0.0</code> or greater.<br />When the vertex normal is heavily weighted, angles are more preserved.<br />Minimum: 0, Maximum: DoubleMax, Default: 1.0.</p>
<p>
  <br />
</p>
<p>
  <strong>--anim-blend-weight &quot;&quot;</strong>
</p>
<p>The base number for calculating vertex weights based on animation blend weights.<br />Calculates the weight specified for <code>pow(<em>specified value</em>, <em>calculated value</em>)</code>.</p>
<p>Specifying a value larger than 1 prioritizes cases where the blend weight is usually assigned. Specifying a value smaller than 1 prioritizes cases where blend weights are not usually assigned.</p>
<p>Add <code>BlendWeight</code> to <code>--property-flag</code> to use this feature.<br />Type: <code>Double</code>, Minimum value: <code>0</code>, Maximum value: e (Napier's constant), Default value: <code>1.0</code></p>
<p>
  <strong>--color-weight &quot;&quot;</strong>
</p>
<p>Weight for vertex color when simplifying, using vertex colors.</p>
<p>Minimum value: 1.0, Maximum value: 10.0, Default value: 2.0</p>
<h3 id="Anchor_83955705_h3_10">Other Settings</h3>
<p>
  <strong>
    <a name="Anchor_83955705_poly-red-merge-shape"></a>--disable-merge-shape</strong>
</p>
<p>Applies polygon reduction without merging the shapes in the file.<br />If this option is not specified, shapes are merged before polygon reduction and then split back apart after polygon reduction.<br />Default: Disable</p>
<p>
  <strong>--exclude-shapes &quot;&quot;</strong>
</p>
<p>Excludes the specified shapes from the polygon reduction process.</p>
<p>Asterisks and question marks can be used as wildcard characters to match sub-strings or single characters, respectively. To specify multiple shapes, specify a comma-separated list of shapes or invoke the option multiple times.</p>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>--exclude-shapes *_Wall_?_*</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_31">Example of Option Settings</h2>
<p>
  <strong>--polygon-reduction --polygon-reduction-options &quot;--target-rate-lod-level1 0.5 --target-rate-lod-level2 0.25 --property-flag 7 --optimize-position-policy 2 --open-edge-lock-angle 30 --lock-uv-hard-edge 30 --uv-weight 0.0&quot;</strong>
</p>
<p>This creates a LOD level 1 of 50% (<code>--target-rate-lod-level1=0.5</code>) and level 2 of 25% (<code>--target-rate-lod-level2=0.25</code>), taking into consideration the vertices, UVs, and normals (<code>--property-flag=7</code>).<br />Prioritizes quality over memory usage, without using vertex sharing at the base level (<code>--optimize-position-policy=2</code>).<br />Protects open edges (<code>--open-edge-lock-angle=30</code>) and UV hard edges (<code>--lock-uv-hard-edge=30</code>).<br />UV weight is set to <code>0</code> and excluded from the cost calculations so the shape is not stretched by UV (<code>--uv-weight=0.0</code>).</p>
<h1 id="Anchor_83955705_h1_16">
  <a name="Anchor_83955705_unite_lod_model"></a>Combining LOD Models</h1>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe --unite-lod-model --unite-lod-model-options &quot;[--lod-level1 '' ... --lod-level9 '']&quot; [-o &quot;&quot;] [intermediate file]</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>You can combine LOD models with a base model. If a model already has LOD levels, you can also replace the specified level. Because the results of primitive optimization and quantization analysis are invalid after optimization, perform these optimizations again using <code>--optimize-primitive --quantization-analysis</code>.</p>
<p>If you are deleting nearby vertices, make sure to perform this optimization before combining LOD models.</p>
<h2 id="Anchor_83955705_h2_32">Sub-Options</h2>
<p>
  <strong>--lod-level# &quot;&quot;</strong>
</p>
<p>(# is an integer between 1 and 9 that indicates the LOD level.)</p>
<p>Specifies the LOD models to be combined.<br />You cannot specify levels that would leave an intermediate level empty.<br />Supported intermediate files: FMD</p>
<h2 id="Anchor_83955705_h2_33">Usage Example</h2>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe Input.fmdb --unite-lod-model --unite-lod-model-options &quot;--lod-level1 LodModel.fmdb&quot;</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="Anchor_83955705_h2_34">
  <a name="Anchor_83955705_unite_lod_model_limitation"></a>Restrictions</h2>
<p>The following restrictions are placed on LOD models being combined.</p>
<ul>
  <li>The following information must match between the base model and any LOD models.<ul><li>The skeleton structure<ul><li>Each bone's translation, rotation, and scale must match. However, the models can be combined if the direction of rotation matches and the absolute value of the difference is less than <code>1.0e-5</code>.</li></ul></li><li>The skinning bind pose</li><li>The correspondence between shapes and materials</li><li>The structure of the vertex attributes for the corresponding shapes.</li></ul></li>
  <li>The number of skinning weights for the LOD shape must be less than the number of skinning weights of the base shape.</li>
  <li>An LOD model cannot have shapes, materials, or bones that do not exist in the base model. However, an LOD model does not necessarily have to have the shapes, materials, and bones that exist in the base model. LOD combining is skipped for shapes that do not exist in an LOD model.</li>
  <li>All meshes must include at least one primitive.</li>
  <li>Skinning weights cannot be applied to bones in LOD models unless that bone has a weight in the base model.</li>
  <li>Bones that only use rigid skinning in the base model cannot use smooth skinning in LOD models.</li>
</ul>
<p>The following method is used to create associations for shapes to merge between the base model and LOD model. The following criteria must be satisfied to correctly associate shapes.</p>
<ol>
  <li>If there is only one shape with matching <code>mat_name</code> and <code>bone_name</code> for <code>&lt;shape_info&gt;</code>, that is considered the corresponding shape.</li>
  <li>If there is no shape that satisfies the first criteria, combining LOD models is skipped for that shape.</li>
  <li>If multiple shapes satisfy the first criterion, the one with the matching <code>original_bone_name</code> and <code>original_material_name</code> for <code>&lt;shape_info&gt;</code> is considered the corresponding shape. <code>original_bone_name</code> does not need to be an exact match. For example, <code>bone_a,bone_b,bone_c</code> is treated as a match for <code>bone_b</code>. However, if <code>original_bone_name</code> is empty, the one with the matching <code>&lt;shape&gt;</code> <code>name</code> is considered the corresponding shape.</li>
  <li>If there are multiple shapes with matching <code>original_bone_name</code> and <code>original_material_name</code>, but only one that is an exact match, that shape is considered the corresponding shape.</li>
  <li>An error is generated if none of the criteria are satisfied, or if there are multiple shapes that meet the criteria.</li>
</ol>
<h1 id="Anchor_83955705_h1_17">
  <a name="Anchor_83955705_optimize_primitive_detail"></a>Optimizing Primitives</h1>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe --optimize-primitive --optimize-primitive-options &quot;[--mode '']&quot; [-o &quot;&quot;] [intermediate file]</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>Rearranges index streams and vertex streams to achieve a more efficient rendering order.</p>
<h2 id="Anchor_83955705_h2_35">Sub-Options</h2>
<p>
  <strong>--mode &quot;&quot;</strong>
</p>
<p>Executes normal optimization when <code>Normal</code> is specified for the option value.<br />Takes time to optimize when <code>Force</code> is specified for the option value.<br />Takes even more time to optimize when <code>BruteForce</code> is specified for the option value.<br />When <code>Forsyth</code> is specified for the option value, the data is optimized using the algorithm described at <a href="http://tomforsyth1000.github.io/papers/fast_vert_cache_opt.html">http://tomforsyth1000.github.io/papers/fast_vert_cache_opt.html</a>.<br />The Forsyth optimization algorithm is used by default if this sub-option is not specified. Also see the <a href="../Pages/Page_95696747.html">platform-specific information</a>.</p>
<h2 id="Anchor_83955705_h2_36">Algorithms</h2>
<p>The algorithm rearranges the index streams to increase the vertex cache rate as much as possible.<br />Finally, the order of vertex streams is changed to match the order they are referenced by index.</p>
<p>The Normal, Force, and BruteForce algorithms are inclusive of one another and satisfy the following relationship.</p>
<p>Normal &lt; Force &lt; BruteForce</p>
<p>The higher the algorithm is within this relationship, the longer the optimization takes to complete. After data has undergone primitive optimization using one of these algorithms, no further optimization is made if a same or lesser optimization is executed again. This applies when you attempt to run the Normal algorithm on data that has already been optimized using the Force algorithm, for example. If you want to optimize data again, make sure that you first <a href="../Pages/Page_83955970.html#Anchor_83955970_remove_cache">remove the primitive optimization cache (RemoveOptimizePrimitiveCache)</a>. This limitation does not apply to the Forsyth algorithm.</p>
<p>However, if running the algorithm again does not yield any further optimizations, the data is not updated. The degree of optimization is determined by evaluating the index stream, after the algorithm has been applied to calculate the processed vertex count. The processed vertex count is calculated by evaluating the index stream as follows.</p>
<p>First, the index stream is scanned until the following condition is satisfied.</p>
<ul>
  <li>32 unique triangle primitives or 32 unique vertices have appeared.</li>
</ul>
<p>When this condition has been satisfied, the current number of unique vertices is added to the processed vertex count. After this sum is calculated, the number of unique triangle primitives and the number of unique vertices are cleared. To calculate the total processed vertex count, the process is repeated until the index stream is empty.</p>
<h2 id="Anchor_83955705_h2_37">Usage Example</h2>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe --optimize-primitive --optimize-primitive-options &quot;--mode Forsyth&quot; Input.fmdb</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<h1 id="Anchor_83955705_h1_18">Quantization Analysis</h1>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe --quantization-analysis [-o &quot;&quot;] [intermediate file]</pre></div>
      </td>
    </tr>
  </tbody>
</table>
<p>Analyzes the quantization of vertices and animations using threshold values.</p>
<p>To remove quantization settings, use <a href="../Pages/Page_83955970.html#Anchor_83955970_remove_quantize">Removing the Quantization Settings (RemoveQuantizeType)</a>, which can be found among the intermediate file filter samples.</p>
<h2 id="Anchor_83955705_h2_38">Algorithms</h2>
<p>The algorithm quantizes the size of vertices and animations into the smallest quantized format possible for each shape. Quantization precision is maintained between shapes that were originally the same shape in the DCC tool.</p>
<p>For the specific algorithm, see <a href="../Pages/Page_106333848.html">Quantization</a>.</p>
<h2 id="Anchor_83955705_h2_39">Usage Example</h2>
<pre style="margin-top: 10.0px;">
  <br />
</pre>
<table class="codeblock">
  <tbody>
    <tr>
      <td class="code">
        <div class="codeblock"><pre>3dIntermediateFileOptimizer.exe --quantization-analysis Input.fmdb</pre></div>
      </td>
    </tr>
  </tbody>
</table>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
<p>&nbsp;</p>
<hr />
<p>CONFIDENTIAL</p>
</div>
</div>
</body>
</html>
