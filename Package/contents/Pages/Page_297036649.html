<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<script type="text/javascript" src="../tocDataApi.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>Distributed Compilation | NintendoSDK Documents</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="text-align: center;"><img src="../template/img/noscript.svg" /></div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- Distributed Compilation -->
<div class="pagetitle" id="PageId_297036649">Distributed Compilation</div>
<div class="text_separate">
<h1 id="Anchor_297036649_h1_1">Distributed Compilation</h1>
<p>This section describes a method of shortening compilation time for large-scale shaders by distributing the compilation over multiple computers.</p>
<h2 id="Anchor_297036649_h2_1">Overview</h2>
<p>When compiling a shader, the compilation result can be saved to disk by specifying a caching option. If there has been no change in the input at the time of the next compilation, compilation time can be vastly shortened because processing is merely to write the cache results, instead of performing a full compile.</p>
<p>While the shader cache has utility value on its own, applying this feature makes it possible to perform a parallel distributed compilation on multiple computers. Namely, for shaders with a large amount of variation, the varied portions can be individually complied by multiple computers. Ultimately, the shader caches produced by each computer, are collected in a single location and used to compile all of the variations. Because the final compilation is completed at this time using the shader caches, compilation times can ultimately be achieved that are inversely proportional to the number of computers.</p>
<p>Depending on the tool, you can specify an option to only perform compilation processing, without performing conversion processing. This allows you to only create shader caches on each computer, thereby saving the time to create unnecessary binary code. The scenario is that the compilation portion is performed in parallel on multiple computers, while the final conversion portion is performed on a single computer.</p>
<p>Alternatively, rather than using shader caches, you can merge multiple shader files from conversion results into one shader file using a tool. The steps of the process are generally the same as the steps for using shader caches. Although shader caches can create a large number of files depending on the variation count, this process produces only one shader file each time it is executed to make management easier. On the other hand, you must perform conversion in addition to compilation for each file. The conversion process cannot be skipped.</p>
<h2 id="Anchor_297036649_h2_2">How to Use</h2>
<p>As an example, consider a case in which a shader with 100 variations is complied in parallel, using five computers. The work is divided into equal portions.</p>
<p>The following diagram shows the steps of the process.</p>
<div class="flowchart-svg-inline">
  <img src="../Attachments/Attach_297036649/flowchart_1.svg" />
</div>
<p>
  <br />
</p>
<h3 style="margin-left: 0.5em;" id="Anchor_297036649_h3_1">Compilation 1 Through Compilation 4</h3>
<p>Each individual computer is responsible for one compilation.</p>
<p>Specify <code>--shader-cache-directory</code> to generate the shader cache.</p>
<p>While it is not necessary, specifying <code>--skip-convert</code> for tools that use this option will shorten compilation time.</p>
<p>This specifies that each portion of the variations will be individually compiled by a separate computer. This is specified differently for each tool.</p>
<h3 style="margin-left: 0.5em;" id="Anchor_297036649_h3_2">Convert</h3>
<p>This represents the single computer to which final conversion is assigned.</p>
<p>After collecting the shader caches generated by Compilation 1 through- Compilation 5, the <code>--shader-cache-directory</code> option is used to specify the location where final conversion processing will be performed.</p>
<h2 id="Anchor_297036649_h2_3">Variation Distribution Method by Tool</h2>
<h3 style="margin-left: 0.5em;" id="Anchor_297036649_h3_3">
  <a href="../Pages/Page_89981854.html">Shader Compiler</a>
</h3>
<p>To specify the portion of variations, edit <code>variationCount</code> and <code>pVariationValueArray</code> in <code>nngfxToolShaderCompilerComileArg</code>.</p>
<p>Essentially, this is unrelated to the omission of conversion processing, as only compilation is performed.</p>
<div class="flowchart-svg-inline">
  <img src="../Attachments/Attach_297036649/flowchart_2.svg" />
</div>
<h3 style="margin-left: 0.5em;" id="Anchor_297036649_h3_4">
  <a href="../Pages/Page_89982310.html">Shader Converter (DLL)</a>
</h3>
<p>Creating your own variation structure is similar to using <code>ShaderCompiler.dll</code>.</p>
<p>When using <code>nngfxToolShaderConverterCreateConvertArg</code> to build variation data from a variation file, the data is divided before the build by the same method as <code>ShaderConverter.exe</code>, or they are divided after the build by the same method as <code>ShaderCompiler.dll</code>.</p>
<p>Conversion processing can be omitted by not calling the <code>nngfxToolShaderConverterSerialize</code> function.</p>
<p>Alternatively, instead of using shader caches, you can perform conversion for each file, specifying the <code>--merge-shader-file</code> option or <code>nngfxToolShaderConverterConvertArg::pMergeShaderFiles</code> to merge each of the shader files into one shader file.</p>
<h3 style="margin-left: 0.5em;" id="Anchor_297036649_h3_5">
  <a href="../Pages/Page_89982392.html">Shader Converter (EXE)</a>
</h3>
<p>Specifies the variation portions by overwriting the <code>ShaderVariationValueArray</code> in the <a href="../Pages/Page_236829010.html">variation file</a>.</p>
<p>Because elements over the specified length are ignored, even if they exist, they are not an issue, even if the front half of the array is deleted and the back half is kept as is.</p>
<p>Currently there is no feature for skipping conversion processing.</p>
<div class="flowchart-svg-inline">
  <img src="../Attachments/Attach_297036649/flowchart_3.svg" />
</div>
<p>Alternatively, instead of using shader caches, you can perform conversion for each file, using the <code>--merge-shader-file</code> option to merge each of the shader files.</p>
<div class="flowchart-svg-inline">
  <img src="../Attachments/Attach_297036649/flowchart_4.svg" />
</div>
<h3 style="margin-left: 0.5em;" id="Anchor_297036649_h3_6">3D Shader Converter (NintendoWare)</h3>
<p>The portions of variations are specified by the <code>--variation-begin-ratio</code> and <code>--variation-end-ratio</code> options, as a percentage of the whole.</p>
<p>You can omit conversion processing by specifying the <code>--skip-convert</code> option.</p>
<div class="flowchart-svg-inline">
  <img src="../Attachments/Attach_297036649/flowchart_5.svg" />
</div>
<p>Alternatively, instead of using shader caches, you can perform conversion for each file, using the <code>--merge-shader-archive-file</code> option to merge each of the shader archive files.</p>
<div class="flowchart-svg-inline">
  <img src="../Attachments/Attach_297036649/flowchart_6.svg" />
</div>
<h2 id="Anchor_297036649_h2_4">Important Information</h2>
<h3 style="margin-left: 0.5em;" id="Anchor_297036649_h3_7">Effect on the Variation Constants Cache</h3>
<p>In areas where variations are generated using variation constants, and not by a preprocessor, cases exist where a single cache will be created for a particular amount of accumulated variations, rather than caches being generated for each variation. When variations are delimited for each individual computer, as long as that portion spans this accumulated unit, it is possible to perform partial compilation of that portion, without using the cache during the final conversion.</p>
<p>When the uniform variable is linked to the shader option by <code>3dShaderConverter.exe</code>, variations are internally generated using the variation constants. However, if the <code>--use-preprocessor-variation</code> option has been specified, variations are generated using all preprocessors.</p>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
<p>&nbsp;</p>
<hr />
<p>CONFIDENTIAL</p>
</div>
</div>
</body>
</html>
