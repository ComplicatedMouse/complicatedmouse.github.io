<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<script type="text/javascript" src="../template/js/jquery/jquery.js"></script>
<script type="text/javascript" src="../template/js/common/manualLib.js"></script>
<script type="text/javascript" src="../tocData.js"></script>
<script type="text/javascript" src="../tocDataApi.js"></script>
<link rel="stylesheet" type="text/css" href="../template/css/template.css" />
<title>Compressed Audio | NintendoSDK Documents</title>
</head>
<body data-reassemble="autoindex=no,forceNoLabel=yes">
<div id="autoindex_content">
<div class="body_content">
<noscript>
<div style="text-align: center;"><img src="../template/img/noscript.svg" /></div>
</noscript>
<div class="page_navigation_top">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
</table>
</div>
<div class="breadcrumb"></div>

<!-- Compressed Audio -->
<div class="pagetitle" id="PageId_83956177">Compressed Audio</div>
<div class="text_separate">
<h1 id="Anchor_83956177_h1_1">Compressed Audio</h1>
<p>
  <ul class="macro_toc">
    <li>
      <a href="#Anchor_83956177_h2_1">Overview</a>
    </li>
    <li>
      <a href="#Anchor_83956177_h2_2">Advance Preparations</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83956177_h3_1">Verifying License Conditions</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83956177_h2_3">Creating Opus Files</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83956177_h3_2">Supported Formats</a>
      </li>
      <li>
        <a href="#Anchor_83956177_h3_3">Loop Settings for the Opus File Using SoundMaker</a>
      </li>
      <li>
        <a href="#Anchor_83956177_h3_4"> Loop Settings for Compressed Audio</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83956177_h2_4">Registering in SoundMaker</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83956177_h3_5">PC Preview Playback</a>
      </li>
      <li>
        <a href="#Anchor_83956177_h3_6">Using the Hardware Accelerator</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83956177_h2_5">Troubleshooting</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83956177_h3_7">Sounds Do Not Loop</a>
      </li>
      <li>
        <a href="#Anchor_83956177_h3_8">Loop Information Cannot Be Extracted</a>
      </li>
      <li>
        <a href="#Anchor_83956177_h3_9">Unexpected Loop Information Has Been Embedded</a>
      </li>
      <li>
        <a href="#Anchor_83956177_h3_10">An Unexpected Waveform Is Played During PC Preview Playback Using SoundMaker</a>
      </li>
    </ul>
    <li>
      <a href="#Anchor_83956177_h2_6">Known Issues</a>
    </li>
    <ul>
      <li>
        <a href="#Anchor_83956177_h3_11">In some cases where the start offset is specified, files are not played back correctly.</a>
      </li>
    </ul>
  </ul>
</p>
<h2 id="Anchor_83956177_h2_1">Overview</h2>
<p>You can use the compressed audio format Opus through the <code>Atk</code> library and SoundMaker.</p>
<p>This section describes how to use Opus.</p>
<div class="info_new">
  <div class="info_new_left">Info</div>
  <div class="info_new_right">
    <p>To use Opus with the <code>atk</code> library, you must also link with the <code>codec</code> library.</p>
  </div>
</div>
<h2 id="Anchor_83956177_h2_2">Advance Preparations</h2>
<h3 id="Anchor_83956177_h3_1">Verifying License Conditions</h3>
<p>Before using Opus, make sure to check the <a href="../Pages/Page_99804830.html">Opus License Conditions</a>.</p>
<h2 id="Anchor_83956177_h2_3">Creating Opus Files</h2>
<h3 id="Anchor_83956177_h3_2">Supported Formats</h3>
<p>Only Opus files created by the <a href="../Pages/Page_99805022.html">OpusEncoder</a> in the NintendoSDK are supported.<br />In addition, only data encoded at a frame size of 20 milliseconds is supported. <br /></p>
<p>For more information, see the <a href="../Pages/Page_99805022.html">OpusEncoder Explanation Page</a>. </p>
<h3 id="Anchor_83956177_h3_3">Loop Settings for the Opus File Using SoundMaker</h3>
<p>To use a looping waveform file in Opus encoding, place the original waveform file (with a <code>.wave</code>, <code>.aiff</code>, or <code>.aif</code> filename extension) with the same name as the Opus file but a different extension in the same folder, and embed the loop information in this file.<br />SoundMaker references loop information from this file. </p>
<h4 id="Anchor_83956177_h4_1">Example</h4>
<table class="wrapped" style="margin-left: 1.5em;">
  <tbody>
    <tr>
      <th>Opus file</th>
      <td>
        <code>foo.opus</code>
      </td>
    </tr>
    <tr>
      <th>Loop information reference file</th>
      <td>
        <code>foo.wav</code>, <code>foo.aiff</code>, or <code>foo.aif</code></td>
    </tr>
  </tbody>
</table>
<div class="info_new">
  <div class="info_new_left">Info</div>
  <div class="info_new_right">
    <ul>
      <li>The order of priority in which files are accessed for loop information is WAV ＞ AIFF &gt; AIF.</li>
      <li>Reconversion is required if the wave file from which loop information is extracted is updated.</li>
    </ul>
  </div>
</div>
<h3 id="Anchor_83956177_h3_4">
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_83956177/124259561.png" class="embedded-image" />
  </span> Loop Settings for Compressed Audio</h3>
<p>Compressed formats like Opus have a silent part inserted in the decoded waveform, which produces a slight delay when replayed compared to the original waveform.<br />As a result, the actual loop range will be different from the expected loop range.</p>
<p>For example, if you adjust the loop to begin immediately after the intro, the latter half of the intro may be included in the loop.</p>
<p>
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_83956177/124259562.png" width="500" class="embedded-image" />
  </span>
</p>
<p>
  <br />
</p>
<p>To avoid this problem, you must move the loop range of the original waveform back in advance.<br />(How far back it must be moved depends on factors such as the compression ratio.)</p>
<p>By using this method, it is possible for the expected sample data to be looped even if the actual loop range is misaligned.</p>
<p>
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_83956177/124259574.png" width="500" class="embedded-image" />
  </span>
</p>
<p>
  <br />
</p>
<p>In addition, a correction process is applied before and after the loop to ensure that the loops are connected correctly.<br />In this correction process, the range of the loop is shifted back to a loop start position that connects cleanly near the top of the block.<br />To perform this shift process correctly, you must copy a waveform of about 1100 samples (more precisely, at least 1079 samples) from the loop start position to after the loop end position.<br />The following waveform must be copied before encoding.</p>
<!--Remove-->
<p>
  <br />
</p>
<p>
  <br />
</p>
<p>
  <span class="embedded-file-wrapper ">
    <img src="../Attachments/Attach_83956177/125194424.png" width="500" class="embedded-image" />
  </span>
</p>
<p>
  <br />
</p>
<div class="warn_new">
  <div class="warn_new_left">Warning</div>
  <div class="warn_new_right">
    <p>Noise may be generated during loop playback unless you specify the <code>--disable-prediction</code> option for <a href="../Pages/Page_99805022.html">OpusEncoder</a>.</p>
  </div>
</div>
<div class="info_new">
  <div class="info_new_left">Info</div>
  <div class="info_new_right">
    <ul>
      <li>When using an Opus file encoded by specifying <code>--disable-prediction</code> to <a href="../Pages/Page_99805022.html">OpusEncoder</a>, it can be played back without problems even when disabling space decoding to avoid noise when looping.</li>
      <li>For more information, see the <code>--disable-prediction</code> description for <a href="../Pages/Page_99805022.html">OpusEncoder</a>.</li>
      <li>For more information about the flag to disable space decoding, see the API reference for <code>isAdditionalDecodingOnLoopEnabled</code> in <code><span class="ApiLink_nn__atk__SoundStartable__StartInfo">nn::atk::SoundStartable::StartInfo</span></code>.</li>
    </ul>
  </div>
</div>
<h2 id="Anchor_83956177_h2_4">Registering in SoundMaker</h2>
<p>Specify an Opus file as the source file in the SoundMaker stream sound list.<br />When converting in this state, the Opus file will be copied to the stream output directory, and may be used in combination with the binary sound archive file (BFSAR file).</p>
<div class="info_new">
  <div class="info_new_left">Info</div>
  <div class="info_new_right">
    <ul>
      <li>The file you register must be an Opus file encoded in <a href="../Pages/Page_99805022.html">OpusEncoder</a>.</li>
      <li>Currently, SoundMaker does not have a feature for encoding WAV, AIFF, or AIF files as AAC files.</li>
      <li>Currently, multi-track streams are not supported.</li>
    </ul>
  </div>
</div>
<h3 id="Anchor_83956177_h3_5">PC Preview Playback</h3>
<p>It is not possible to preview Opus files directly in the SoundMaker, so preview playback is performed by referencing the file of the same name but with a different extension described in the loop information.<br />Place a file with the same name but a different extension for Opus files that do not loop.</p>
<!--Remove-->
<h3 id="Anchor_83956177_h3_6">Using the Hardware Accelerator</h3>
<p>Decoding in Opus playback is normally performed by the CPU,<br />However, you can use SoundMaker settings to have the hardware accelerator perform decoding and Opus playback.</p>
<p>
  <span style="color: rgb(255,0,0);">This feature is available in NintendoSDK NX Add-On 4.0.0 and later.</span>
</p>
<p>From <strong>Project</strong> &gt; <strong>Project Settings</strong> &gt; <strong>Convert</strong>, select <strong>Specify use of hardware in OPUS decoding in the target</strong>.<br />Playback will be performed for all Opus files using the hardware accelerator for decoding.</p>
<h2 id="Anchor_83956177_h2_5">
  <a name="Anchor_83956177_TroubleShooting"></a>Troubleshooting</h2>
<h3 id="Anchor_83956177_h3_7">Sounds Do Not Loop</h3>
<ul>
  <li>  To embed looping information, you must place a waveform file in the same folder as the Opus file, giving it the same name as the Opus file but with the relevant extension (such as <code>.wav</code>).</li>
</ul>
<h3 id="Anchor_83956177_h3_8">Loop Information Cannot Be Extracted</h3>
<ul>
  <li>  You must reconvert, and not just convert, any wave files used for extracting loop information if they have been updated.</li>
</ul>
<h3 id="Anchor_83956177_h3_9">Unexpected Loop Information Has Been Embedded</h3>
<ul>
  <li>  Loop information is being referenced from a waveform file in the same folder as the Opus file and with the same name but another extension, such as <code>.wav</code>.</li>
  <li>  If a waveform file was unintentionally named this way, you must rename either the Opus file or this other file.</li>
</ul>
<h3 id="Anchor_83956177_h3_10">An Unexpected Waveform Is Played During PC Preview Playback Using SoundMaker</h3>
<ul>
  <li>  Previewing is done by playing not the Opus file but a waveform file in the same folder with the same name but a different extension, like <code>.wav</code>.</li>
  <li>  Check whether the content of the waveform file matches the decoded content of the Opus file.</li>
</ul>
<h2 id="Anchor_83956177_h2_6">Known Issues</h2>
<h3 id="Anchor_83956177_h3_11">In some cases where the start offset is specified, files are not played back correctly.</h3>
<ul>
  <li>The current implementation is such that for playback with offset start specification, the decoding begins not from the beginning of the file but from the frame immediately prior.<br />While there have not been any verified cases where playback sounds audibly unnatural, it is possible that the waveform was not decoded correctly.</li>
</ul>
<p>
  <br />
</p>
</div>
<div class="breadcrumb_bottom"></div>
<div class="page_navigation">
<table class="page_navi_root">
<tr>
<td class="page_navi_left"></td>
<td class="page_navi_right"></td>
</tr>
<tr><td colspan="2" class="page_navi_bottom"></td></tr>
</table>
</div>
<p>&nbsp;</p>
<hr />
<p>CONFIDENTIAL</p>
</div>
</div>
<!--AddLink-->
<script>
var NintendoSdkApiRefernce = {
    idMap: {},
    linkRewrite: function ()
    {
        var idMap = NintendoSdkApiRefernce.idMap;
        function rewrite(el)
        {
            var e = idMap[el.className];
            if (e === undefined)
            {
                return;
            }
            var html = '';
            html += '<a href=';
            html += e.url;
            html += ' target="_blank" rel="noopener noreferrer" >';
            html += el.innerHTML;
            html += '</a>';
            el.innerHTML = html;
        }
        var apiLinkElems = document.querySelectorAll('span[class*="ApiLink_"]');
        for (var i = 0, n = apiLinkElems.length; i< n; ++i) {
            rewrite(apiLinkElems[i]);
        }
    }
};
function SetUrl( id, url )
{
    NintendoSdkApiRefernce.idMap[id] = { url: url };
}
SetUrl( 'ApiLink_nn__atk__SoundStartable__StartInfo', '../../../Api/HtmlNX/structnn_1_1atk_1_1_sound_startable_1_1_start_info.html' )

NintendoSdkApiRefernce.linkRewrite();
</script>
<!--AddLink-->
</body>
</html>
