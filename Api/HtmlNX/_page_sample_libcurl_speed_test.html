<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HTTP(S) download with libcurl multi interface and HTTP POST upload with the easy interface. | NintendoSDK API Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="openclose.js"></script>
<script type="text/javascript" src="searchapi.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NintendoSDK API Reference
   &#160;<span id="projectnumber">14.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="_page_sample.html">Sample Descriptions</a></li><li class="navelem"><a class="el" href="_page_sample_libcurl_root.html">Libcurl Library Samples</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">HTTP(S) download with libcurl multi interface and HTTP POST upload with the easy interface. </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#PageSampleLibcurlSpeedTest_SectionBrief">Overview</a></li>
<li class="level1"><a href="#PageSampleLibcurlSpeedTest_SectionFileStructure">File Structure</a></li>
<li class="level1"><a href="#PageSampleLibcurlSpeedTest_SectionNecessaryEnvironment">Environmental Requirements</a></li>
<li class="level1"><a href="#PageSampleLibcurlSpeedTest_SectionHowToExecute">Execution Procedure</a></li>
<li class="level1"><a href="#PageSampleLibcurlSpeedTest_SectionDetail">Description</a></li>
</ul>
</div>
<div class="textblock"><p>This sample program uses the curl multi interface for multiple HTTP downloads and HTTP POST for upload within the context of a network speed test.</p>
<h1><a class="anchor" id="PageSampleLibcurlSpeedTest_SectionBrief"></a>
Overview</h1>
<p>First, command arguments are parsed. Then the nifm library is used to request a network connection from the system. Once a network connection is acquired the socket library is initialized. Next the curl library is initialized and the program flow depends on user arguments. If the user specified the a download argument then curl easy handles are put into a single curl multi handle otherwise the upload path is taken an easy handle is created, and data is posted to the provided url.</p>
<h1><a class="anchor" id="PageSampleLibcurlSpeedTest_SectionFileStructure"></a>
File Structure</h1>
<p>The sample program is located at <a class="el" href="dir_dc29b5ef30c035c86553d4c12a67e27e.html">Samples/Sources/Applications/Libcurl/SpeedTest </a>.</p>
<h1><a class="anchor" id="PageSampleLibcurlSpeedTest_SectionNecessaryEnvironment"></a>
Environmental Requirements</h1>
<p>You must use the settings manager in advance to import network connection settings. For details, see <a href="../../Package/contents/Pages/Page_104465190.html#Anchor_104465190_SettingsManager_network">Registering Network Connection Settings</a> for more information.</p>
<p>The sample fetches the resource specified by the URL provided as an argument to the program. Below, we use <a href="http://www.example.com">http://www.example.com</a> but any HTTP(S) URL that is available to your network will suffice.</p>
<h1><a class="anchor" id="PageSampleLibcurlSpeedTest_SectionHowToExecute"></a>
Execution Procedure</h1>
<p>This sample is driven by user arguments as defined by the below table. <br  />
&#160; <b>Usage</b> <br  />
 LibcurlSpeedTest [-u &lt;arg&gt;] [-s &lt;arg&gt;] [-r &lt;arg&gt;] [-p &lt;arg&gt;] [-t &lt;arg&gt;] [-n &lt;arg&gt;] [-up &lt;arg&gt;]<br  />
 <br  />
&#160; <b>Acceptable Arguments</b>:<br  />
 &#160;&#160;&#160;-h Display help.<br  />
 &#160;&#160;&#160;-n &lt;arg&gt; "on" [default] to enable TCP Nagle algorithm or "off" to disable TCP Nagle algorithm.<br  />
 &#160;&#160;&#160;-p &lt;arg&gt; Number of simultaneous parallel connections to make to the server.<br  />
 &#160;&#160;&#160;-r &lt;arg&gt; Value to set SO_RCVBUF socket option to.<br  />
 &#160;&#160;&#160;-s &lt;arg&gt; Value to set SO_SNDBUF socket option to.<br  />
 &#160;&#160;&#160;-t &lt;arg&gt; Number of times to download or upload to the url.<br  />
 &#160;&#160;&#160;-u &lt;arg&gt; The url to connect to.<br  />
 &#160;&#160;&#160;-up &lt;arg&gt; Number of random bytes to upload.<br  />
 <br  />
&#160; <b>Examples</b><br  />
</p><ul>
<li>Run with default parameters.<br  />
 LibcurlSpeedTest -u <a href="http://www.example.com">http://www.example.com</a><br  />
<br  />
</li>
<li>Download example.com with four simultaneous connections.<br  />
 LibcurlSpeedTest -u <a href="http://www.example.com">http://www.example.com</a> -n 4<br  />
<br  />
</li>
<li>Download example.com three times.<br  />
 LibcurlSpeedTest -u <a href="http://www.example.com">http://www.example.com</a> -t 3<br  />
<br  />
</li>
<li>Download example.com with custom sized socket send and receive buffers.<br  />
 LibcurlSpeedTest -u <a href="http://www.example.com">http://www.example.com</a> -r 131072 -s 65536<br  />
<br  />
</li>
<li>Download example.com with the TCP Nagle algorithm disabled.<br  />
 LibcurlSpeedTest -u <a href="http://www.example.com">http://www.example.com</a> -n off</li>
</ul>
<h1><a class="anchor" id="PageSampleLibcurlSpeedTest_SectionDetail"></a>
Description</h1>
<p>The sample program has the following flow.</p>
<ul>
<li>Parse the user-provided arguments.</li>
<li>Initialize the nifm library with <a class="el" href="namespacenn_1_1nifm.html#a0e3aaf3209696149ec22613e1d3d6705" title="Initializes the network connection management library and makes its functionality available.">nn::nifm::Initialize()</a>, submit a network request with <a class="el" href="namespacenn_1_1nifm.html#a96f83210fc74e61335caf9308a357fff" title="Requests a network connection of the system.">nn::nifm::SubmitNetworkRequest()</a>, and wait for <a class="el" href="namespacenn_1_1nifm.html#a933a28d229a56e800703d95d4830fc6a" title="Determines whether a network connection is available.">nn::nifm::IsNetworkAvailable()</a> to return true.</li>
<li>Initialize the socket library with <a class="el" href="namespacenn_1_1socket.html#adacc3405184e8f28fb630745b9f43db0" title="Initialize socket library.">nn::socket::Initialize()</a>.</li>
<li>Initialize the curl library with <a href="https://curl.haxx.se/libcurl/c/curl_global_init.html">curl_global_init()</a>.</li>
<li>Initialize the HttpsHelper.</li>
<li>If the preprocessor macro USE_PROXY is not enabled then estimate server round-trip-time.</li>
<li>The program path forks depending on user arguments:<ul>
<li>If the arguments do not specify the upload path then the download path is taken:<ul>
<li>The size of the file to download is requested from the server.</li>
<li>The file size is split into as many chunks as specified simultaneous connections and chunk sizes are calculated.</li>
<li>Curl easy handles are created with <a href="https://curl.haxx.se/libcurl/c/curl_easy_init.html">curl_easy_init</a> to handle the chunks, options are set, and if the preprocessor USE_PROXY macro is set then the proxy is set up for the easy handle.</li>
<li>A single curl muti handle is created with <a href="https://curl.haxx.se/libcurl/c/curl_multi_init.html">curl_multi_init()</a>, easy handles added with <a href="https://curl.haxx.se/libcurl/c/curl_multi_add.html">curl_multi_add()</a>, an initial call to <a href="https://curl.haxx.se/libcurl/c/curl_multi_perform.html">curl_multi_perform()</a> is made then the <a class="el" href="namespacenn_1_1socket.html#aa523b16a6004b8748cc0116f9ed65dd2" title="Synchronous I/O multiplexing.">nn::socket::Select()</a> / <a href="https://curl.haxx.se/libcurl/c/curl_multi_perform.html">curl_multi_perform()</a> loop is entered until all easy handles complete.</li>
</ul>
</li>
<li>If the arguments specify the upload path then an easy handle is created with <a href="https://curl.haxx.se/libcurl/c/curl_easy_init.html">curl_easy_init()</a>.<ul>
<li>curl HTTP POST options set with <a href="https://curl.haxx.se/libcurl/c/curl_easy_setopt.html">curl_easy_setopt()</a></li>
<li>Data data is posted to the url provided by the specified arguments with <a href="https://curl.haxx.se/libcurl/c/curl_easy_perform.html">curl_easy_perform()</a>.</li>
</ul>
</li>
</ul>
</li>
<li>The libraries initialized on start-up are finalized in reverse order and the program exits.</li>
</ul>
<pre class="fragment">Started...
Network ready
Created the SSL context.
 HostName: ipv4.download.thinkbroadband.com
nn::nsd::ResolveEx in(ipv4.download.thinkbroadband.com) out(ipv4.download.thinkbroadband.com)
IP: 80.249.99.148
RTT: 148 ms
url: http://ipv4.download.thinkbroadband.com/100MB.zip
nn::nsd::ResolveEx in(ipv4.download.thinkbroadband.com) out(ipv4.download.thinkbroadband.com)

*******Got File size! 104857600

 * Starting download number: 1
Chunk: 26214400  0-26214399
Chunk: 26214400  26214400-52428799
Chunk: 26214400  52428800-78643199
Chunk: 26214400  78643200-104857599
Downloading...
nn::nsd::ResolveEx in(ipv4.download.thinkbroadband.com) out(ipv4.download.thinkbroadband.com)
nn::nsd::ResolveEx in(ipv4.download.thinkbroadband.com) out(ipv4.download.thinkbroadband.com)
nn::nsd::ResolveEx in(ipv4.download.thinkbroadband.com) out(ipv4.download.thinkbroadband.com)
Status: 0
nn::nsd::ResolveEx in(ipv4.download.thinkbroadband.com) out(ipv4.download.thinkbroadband.com)
CURLINFO_RESPONSE_CODE: 206
CURLINFO_HTTP_CONNECTCODE: 0
CURLINFO_SIZE_DOWNLOAD: 26214400
CURLINFO_TOTAL_TIME: 77.366 sec.
CURLINFO_SPEED_DOWNLOAD: 330.895 kbyte/sec.
CURLINFO_NAMELOOKUP_TIME: 0.013 sec.
CURLINFO_CONNECT_TIME: 0.165 sec.
Error Details 0:
CURLINFO_RESPONSE_CODE: 206
CURLINFO_HTTP_CONNECTCODE: 0
CURLINFO_SIZE_DOWNLOAD: 26214400
CURLINFO_TOTAL_TIME: 73.886 sec.
CURLINFO_SPEED_DOWNLOAD: 346.479 kbyte/sec.
CURLINFO_NAMELOOKUP_TIME: 0.016 sec.
CURLINFO_CONNECT_TIME: 0.166 sec.
Error Details 1:
CURLINFO_RESPONSE_CODE: 206
CURLINFO_HTTP_CONNECTCODE: 0
CURLINFO_SIZE_DOWNLOAD: 26214400
CURLINFO_TOTAL_TIME: 82.683 sec.
CURLINFO_SPEED_DOWNLOAD: 309.614 kbyte/sec.
CURLINFO_NAMELOOKUP_TIME: 0.015 sec.
CURLINFO_CONNECT_TIME: 0.167 sec.
Error Details 2:
CURLINFO_RESPONSE_CODE: 206
CURLINFO_HTTP_CONNECTCODE: 0
CURLINFO_SIZE_DOWNLOAD: 26214400
CURLINFO_TOTAL_TIME: 78.191 sec.
CURLINFO_SPEED_DOWNLOAD: 327.403 kbyte/sec.
CURLINFO_NAMELOOKUP_TIME: 0.014 sec.
CURLINFO_CONNECT_TIME: 0.165 sec.
Error Details 3:

 ** Finished download 1 with Status: 0
 ** Duration: 82.687 sec
 ** Downloaded: 100.000 MB
 ** Speed: 9.675 Mbits/sec

times to download: 1

******* Results *******
******* URL: http://ipv4.download.thinkbroadband.com/100MB.zip
******* Average Throughput: 9.675 Mbits/sec
******* File Size: 100.000 MB
******* Number of Downloads: 1
******* Number of Connections: 4
******* Server RTT: 148 ms</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
</body>
</html>
