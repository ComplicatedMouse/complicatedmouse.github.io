<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ViTimestamp | NintendoSDK API Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="openclose.js"></script>
<script type="text/javascript" src="searchapi.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NintendoSDK API Reference
   &#160;<span id="projectnumber">14.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="_page_sample.html">Sample Descriptions</a></li><li class="navelem"><a class="el" href="_page_sample_vi.html">Video Interface Library Samples</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ViTimestamp </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#ViTimestamp_SectionBrief">Summary</a></li>
<li class="level1"><a href="#ViTimestamp_SectionFileStructure">File List</a></li>
<li class="level1"><a href="#ViTimestamp_SectionNecessaryEnvironment">Necessary Environment</a></li>
<li class="level1"><a href="#ViTimestamp_SectionHowToOperate">Operating Procedure</a></li>
<li class="level1"><a href="#ViTimestamp_SectionPrecaution">Precautions</a></li>
<li class="level1"><a href="#ViTimestamp_SectionHowToExecute">Execution Procedure</a></li>
<li class="level1"><a href="#ViTimestamp_SectionDetail">Details</a><ul><li class="level2"><a href="#ViTimestamp_SectionSampleProgram">Sample Program</a></li>
<li class="level2"><a href="#ViTimestamp_SectionSampleDetail">Sample Program Description</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>Sample program to demonstrate how to query various timestamps from the display subsystem through <a class="el" href="namespacenn_1_1vi.html" title="Provides the necessary functionality to propagate framebuffers to the display server.">nn::vi</a>.</p>
<h1><a class="anchor" id="ViTimestamp_SectionBrief"></a>
Summary</h1>
<p>The <a class="el" href="namespacenn_1_1vi.html" title="Provides the necessary functionality to propagate framebuffers to the display server.">nn::vi</a> library allows applications to query information about frames that have been submitted to the display. Each frame will track when it was first released for use on the display, when it was first shown on the display, its current status, and a unique identifier.</p>
<p>After an application has used a graphics presentation API (i.e. nvnQueuePresentTexture), that frame's identifier can be queried with <a class="el" href="namespacenn_1_1vi.html#aa251267bb21d425b2d097d811ffaa6e7" title="Query the latest frame number generated by the display subsystem.">nn::vi::GetLatestFrameNumber</a>. This identifier may then be used in <a class="el" href="namespacenn_1_1vi.html#a8006a2df0e49f371d5b53a762b006b3a" title="Query the history of frames associated with a Layer.">nn::vi::ListFrameHistory</a> to track that frame's status and timestamps.</p>
<h1><a class="anchor" id="ViTimestamp_SectionFileStructure"></a>
File List</h1>
<p>Please refer to <a class="el" href="dir_787ad75a42faa47bd95737230b7513d4.html">Samples/Sources/Applications/ViTimestamp </a></p>
<h1><a class="anchor" id="ViTimestamp_SectionNecessaryEnvironment"></a>
Necessary Environment</h1>
<p>No extra requirements.</p>
<h1><a class="anchor" id="ViTimestamp_SectionHowToOperate"></a>
Operating Procedure</h1>
<p>Please launch this sample with TargetManager or Visual Studio.</p>
<h1><a class="anchor" id="ViTimestamp_SectionPrecaution"></a>
Precautions</h1>
<p>None.</p>
<h1><a class="anchor" id="ViTimestamp_SectionHowToExecute"></a>
Execution Procedure</h1>
<p>Please build and run the sample.</p>
<h1><a class="anchor" id="ViTimestamp_SectionDetail"></a>
Details</h1>
<h2><a class="anchor" id="ViTimestamp_SectionSampleProgram"></a>
Sample Program</h2>
<p>The main sample source code is linked below.</p>
<p><a class="el" href="_vi_timestamp_8cpp.html" title="This sample demonstrates checking various timestamps provided by the display subsystem.">ViTimestamp.cpp</a> </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*--------------------------------------------------------------------------------*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">  Copyright (C)Nintendo All rights reserved.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">  These coded instructions, statements, and computer programs contain proprietary</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">  information of Nintendo and/or its licensed developers and are protected by</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">  national and international copyright laws. They may not be disclosed to third</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">  parties or copied or duplicated in any form, in whole or in part, without the</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">  prior written consent of Nintendo.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">  The content herein is highly confidential and should be handled accordingly.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *--------------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;cstdint&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;atomic&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="util___scope_exit_8h.html">nn/util/util_ScopeExit.h</a>&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="nn___abort_8h.html">nn/nn_Abort.h</a>&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="nn___assert_8h.html">nn/nn_Assert.h</a>&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;nn/os.h&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;nn/vi.h&gt;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;nn/gfx/util/gfx_DebugFontTextWriter.h&gt;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="nv___memory_management_8h.html">nv/nv_MemoryManagement.h</a>&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="nn___log_8h.html">nn/nn_Log.h</a>&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;MallocPtr.h&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_memory_pool_8h.html">MemoryPool.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;GfxSystem.h&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="keyword">namespace</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;{</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keyword">using</span> FrameList = std::vector&lt;nn::vi::FrameInfo&gt;;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> RenderCountMax = 300;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keyword">struct </span>VsyncThreadArgs</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <a class="code" href="classnn_1_1vi_1_1_layer.html">nn::vi::Layer</a>* pLayer;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <a class="code" href="classnn_1_1os_1_1_system_event.html">nn::os::SystemEvent</a>* pVsync;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    };</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    std::uint8_t <a class="code" href="os___thread_common_8h.html#a5ce0c3c0aaceb976178a60a18d90f470">NN_OS_ALIGNAS_THREAD_STACK</a> g_VsyncThreadStack[16384];</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    std::atomic&lt;bool&gt; g_IsRunning(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    std::atomic&lt;nn::vi::FrameInfo*&gt; g_pLatestFrame(<span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordtype">void</span> VsyncThread(<span class="keywordtype">void</span>* pArg) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        VsyncThreadArgs* pArgs = <span class="keyword">static_cast&lt;</span>VsyncThreadArgs*<span class="keyword">&gt;</span>(pArg);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        FrameList frames;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        frames.reserve(RenderCountMax);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="comment">// nn::vi keeps a short history of frames. The exact length may be queried like this:</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> HistoryLengthMax = <a class="code" href="namespacenn_1_1vi.html#a8006a2df0e49f371d5b53a762b006b3a">nn::vi::ListFrameHistory</a>(<span class="keyword">nullptr</span>, 0, pArgs-&gt;pLayer);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="keyword">auto</span> pHistory = std::make_unique&lt;nn::vi::FrameInfo[]&gt;(HistoryLengthMax);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        std::uint64_t vsyncCount = 0;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="keywordflow">while</span>( g_IsRunning.load(std::memory_order_acquire) )</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            pArgs-&gt;pVsync-&gt;Wait();</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            ++vsyncCount;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            <span class="comment">// After vsync, the most recent enqueued frame&#39;s status may have changed.</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <span class="keywordtype">int</span> writeCount = <a class="code" href="namespacenn_1_1vi.html#a8006a2df0e49f371d5b53a762b006b3a">nn::vi::ListFrameHistory</a>(pHistory.get(), HistoryLengthMax, pArgs-&gt;pLayer);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = writeCount - 1; i &gt;= 0; --i )</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                <span class="keywordflow">if</span>( g_pLatestFrame != <span class="keyword">nullptr</span> &amp;&amp; pHistory[i].frameNumber &lt;= g_pLatestFrame.load()-&gt;frameNumber )</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                }</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                <span class="keywordflow">switch</span>( pHistory[i].status )</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespacenn_1_1vi.html#a52c56d265ec47dfb8d0741b67488ca00a6a9fce03df4340ea52a66e06cc39f1e3">nn::vi::FrameStatus_Enqueued</a>:</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Vsync %llu: Frame %llu Enqueued\n&quot;</span>, vsyncCount, pHistory[i].frameNumber);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                    frames.push_back(pHistory[i]);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="namespacenn_1_1vi.html#a52c56d265ec47dfb8d0741b67488ca00afe2806ecc66e6e3bddb45a209595e494">nn::vi::FrameStatus_Presented</a>:</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                    {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                        std::uint64_t frameNumber = pHistory[i].frameNumber;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                        <span class="comment">// This frame was presented, so try to update the the complete frame history that this sample tracks.</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                        <span class="keyword">auto</span> iterator = std::find_if(frames.rbegin(), frames.rend(), [frameNumber](<span class="keyword">const</span> <a class="code" href="structnn_1_1vi_1_1_frame_info.html">nn::vi::FrameInfo</a>&amp; info)</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                        {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                            return info.frameNumber == frameNumber;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                        });</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                        <span class="keywordflow">if</span>( iterator != frames.rend() )</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                        {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                            *iterator = pHistory[i];</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                        }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                        {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                            frames.push_back(pHistory[i]);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                            iterator = frames.rbegin();</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                        }</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Vsync %llu: Frame %llu Presented\n&quot;</span>, vsyncCount, iterator-&gt;frameNumber);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    From Enqueue: %lld us\n&quot;</span>, (iterator-&gt;presentationTime - iterator-&gt;enqueueTime).ToTimeSpan().GetMicroSeconds());</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                        <span class="keywordflow">if</span>( g_pLatestFrame != <span class="keyword">nullptr</span> )</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                        {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                            <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    From Last Frame: %lld us\n&quot;</span>, (iterator-&gt;presentationTime - g_pLatestFrame.load(std::memory_order_relaxed)-&gt;presentationTime).ToTimeSpan().GetMicroSeconds());</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                        }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                        <span class="comment">// Update the rendering thread with the last frame that was presented.</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                        g_pLatestFrame.store(&amp;(*iterator), std::memory_order_release);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                    }</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordtype">void</span>* NvAllocate(<span class="keywordtype">size_t</span> size, <span class="keywordtype">size_t</span> alignment, <span class="keywordtype">void</span>* userPtr) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>(userPtr);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordtype">void</span>* ptr = ::aligned_alloc(alignment, <a class="code" href="namespacenn_1_1util.html#a275a3c89db5d0ab915559d8a85f9cbdd">nn::util::align_up</a>(size, alignment));</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>(ptr);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">return</span> ptr;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    }</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160; </div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordtype">void</span> NvFree(<span class="keywordtype">void</span>* ptr, <span class="keywordtype">void</span>* userPtr) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>(userPtr);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        std::free(ptr);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keywordtype">void</span>* NvReallocate(<span class="keywordtype">void</span>* ptr, <span class="keywordtype">size_t</span> newSize, <span class="keywordtype">void</span>* userPtr) <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    {</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>(userPtr);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordtype">void</span>* newPtr = std::realloc(ptr, newSize);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>(newPtr);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordflow">return</span> newPtr;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    }</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;}</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> nnMain()</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;{</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <a class="code" href="namespacenv.html#a7d85cfdd1bae1b635cc66b8d58077688">nv::SetGraphicsAllocator</a>(NvAllocate, NvFree, NvReallocate, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <a class="code" href="namespacenv.html#a5ef00427dfc2493551bb66b37731bb35">nv::SetGraphicsDevtoolsAllocator</a>(NvAllocate, NvFree, NvReallocate, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keyword">const</span> std::size_t GraphicsMemorySize = 8 * 1024 * 1024;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    MallocPtr graphicsMemory(aligned_alloc(4096, GraphicsMemorySize));</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <a class="code" href="namespacenv.html#aacadc57952b370f2286108f5835ce726">nv::InitializeGraphics</a>(graphicsMemory.get(), GraphicsMemorySize);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <a class="code" href="util___scope_exit_8h.html#a674e2d673758265abe6e8e17426489ea">NN_UTIL_SCOPE_EXIT</a></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <a class="code" href="namespacenv.html#a368247e862f5ffc59a38af42658d7b38">nv::FinalizeGraphics</a>();</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    };</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <a class="code" href="namespacenn_1_1vi.html#acecc11f3b92d6d1e0c6b5d056d4b05fd">nn::vi::Initialize</a>();</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <a class="code" href="util___scope_exit_8h.html#a674e2d673758265abe6e8e17426489ea">NN_UTIL_SCOPE_EXIT</a></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <a class="code" href="namespacenn_1_1vi.html#a7451676fd7f7b48369ff4c01a1fa91dd">nn::vi::Finalize</a>();</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    };</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <a class="code" href="classnn_1_1vi_1_1_display.html">nn::vi::Display</a>* pDisplay;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>(<a class="code" href="namespacenn_1_1vi.html#ae9cd501562a820272816af783bd798dc">nn::vi::OpenDefaultDisplay</a>(&amp;pDisplay));</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <a class="code" href="classnn_1_1os_1_1_system_event.html">nn::os::SystemEvent</a> vsync;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>(<a class="code" href="namespacenn_1_1vi.html#a596d171dedb65273f7aab87bc74012c6">nn::vi::GetDisplayVsyncEvent</a>(vsync.<a class="code" href="classnn_1_1os_1_1_system_event.html#a27b971688da923a2eac49061327552fe">GetBase</a>(), pDisplay));</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160; </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="classnn_1_1vi_1_1_layer.html">nn::vi::Layer</a>* pLayer;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>(<a class="code" href="namespacenn_1_1vi.html#a86b2688dc743e37f3acaca99ccdf8c12">nn::vi::CreateLayer</a>(&amp;pLayer, pDisplay));</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <a class="code" href="namespacenn_1_1gfx.html#a7fdc6aeebf1a1d6cc8a8893bcc3fd128">nn::gfx::Initialize</a>();</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <a class="code" href="util___scope_exit_8h.html#a674e2d673758265abe6e8e17426489ea">NN_UTIL_SCOPE_EXIT</a></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    {</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <a class="code" href="namespacenn_1_1gfx.html#a8e776d92173c3073b31a5cf65e306dfc">nn::gfx::Finalize</a>();</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    };</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    GfxSystem gfx(pLayer);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    VsyncThreadArgs args { pLayer, &amp;vsync };</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <a class="code" href="structnn_1_1os_1_1_thread_type.html">nn::os::ThreadType</a> vsyncThread;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>(<a class="code" href="namespacenn_1_1os.html#a75f43e1d3c194c0d2173ef5d95785933">nn::os::CreateThread</a>(&amp;vsyncThread,</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                                                        VsyncThread,</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                                                        &amp;args,</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                                                        g_VsyncThreadStack,</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                                                        <span class="keyword">sizeof</span>(g_VsyncThreadStack),</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                                                        <a class="code" href="namespacenn_1_1os.html#a5985811d04e64c0823ed758fd420591d">nn::os::DefaultThreadPriority</a>));</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="namespacenn_1_1os.html#ac50b86561c15ee3e8195c83fddc8e732">nn::os::SetThreadCoreMask</a>(&amp;vsyncThread, 2, 4);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <a class="code" href="namespacenn_1_1os.html#ac50b86561c15ee3e8195c83fddc8e732">nn::os::SetThreadCoreMask</a>(<a class="code" href="namespacenn_1_1os.html#ad106866a5b13bc3d430104333966b479">nn::os::GetCurrentThread</a>(), 0, 1);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="comment">// Synchronize vsync and rendering threads to start on a vsync.</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    vsync.<a class="code" href="classnn_1_1os_1_1_system_event.html#a42a18d99d1cdef662db7b16151f80c46">Clear</a>();</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    vsync.<a class="code" href="classnn_1_1os_1_1_system_event.html#a51c8560630f9760922b6e180b75a45b2">Wait</a>();</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a18eec7c4c4c298f7abaa9ef41d6de76b">nn::os::StartThread</a>(&amp;vsyncThread);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    std::uint64_t frameNumber = 0;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <a class="code" href="structnn_1_1vi_1_1_frame_info.html">nn::vi::FrameInfo</a>* pOldLastFrame = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; RenderCountMax; ++i )</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        gfx.BeginDraw();</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keyword">auto</span> pTextWriter = gfx.GetTextWriter();</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <a class="code" href="structnn_1_1util_1_1_unorm8x4.html">nn::util::Unorm8x4</a> color = { { 255, 255, 255, 255 } };</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        pTextWriter-&gt;SetTextColor(color);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        pTextWriter-&gt;SetScale(1.75f, 1.75f);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        pTextWriter-&gt;SetCursor(0.f, 0.f);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="comment">// Working one ahead of the last frame number.</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        pTextWriter-&gt;Print(<span class="stringliteral">&quot;Displaying Frame %lld\n\n&quot;</span>, frameNumber + 1);</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160; </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <a class="code" href="structnn_1_1vi_1_1_frame_info.html">nn::vi::FrameInfo</a>* pLastFrame = g_pLatestFrame.load(std::memory_order_acquire);</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="keywordflow">if</span>( pLastFrame != <span class="keyword">nullptr</span> )</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            pTextWriter-&gt;Print(<span class="stringliteral">&quot;Frame %lld Statistics:\n&quot;</span>, pLastFrame-&gt;<a class="code" href="structnn_1_1vi_1_1_frame_info.html#af41168c427118593e9f19dc528abf871">frameNumber</a>);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            pTextWriter-&gt;SetScale(1.25f, 1.25f);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span>* status;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            <span class="keywordflow">switch</span>( pLastFrame-&gt;<a class="code" href="structnn_1_1vi_1_1_frame_info.html#a79673a902e172460d1de58977d92284f">status</a> )</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacenn_1_1vi.html#a52c56d265ec47dfb8d0741b67488ca00a6a9fce03df4340ea52a66e06cc39f1e3">nn::vi::FrameStatus_Enqueued</a>:</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                status = <span class="stringliteral">&quot;Enqueued&quot;</span>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacenn_1_1vi.html#a52c56d265ec47dfb8d0741b67488ca00afe2806ecc66e6e3bddb45a209595e494">nn::vi::FrameStatus_Presented</a>:</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                status = <span class="stringliteral">&quot;Presented&quot;</span>;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                status = <span class="stringliteral">&quot;Unknown&quot;</span>;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            }</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            <span class="comment">// Note that not all fields are valid unless the frame&#39;s status is nn::vi::FrameStatus_Presented.</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            pTextWriter-&gt;Print(<span class="stringliteral">&quot;\tStatus : %s\n&quot;</span>, status);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            pTextWriter-&gt;Print(<span class="stringliteral">&quot;\tFrom Enqueue : %lld us\n&quot;</span>, (pLastFrame-&gt;<a class="code" href="structnn_1_1vi_1_1_frame_info.html#a21d582e2aff51a89b7cac7d9c830cebc">presentationTime</a> - pLastFrame-&gt;<a class="code" href="structnn_1_1vi_1_1_frame_info.html#a951b40670f979599d9a98f68855324e7">enqueueTime</a>).ToTimeSpan().GetMicroSeconds());</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            <span class="keywordflow">if</span>( pOldLastFrame != <span class="keyword">nullptr</span> )</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                pTextWriter-&gt;Print(<span class="stringliteral">&quot;\tFrom Previous Frame : %lld us\n&quot;</span>, (pLastFrame-&gt;<a class="code" href="structnn_1_1vi_1_1_frame_info.html#a21d582e2aff51a89b7cac7d9c830cebc">presentationTime</a> - pOldLastFrame-&gt;<a class="code" href="structnn_1_1vi_1_1_frame_info.html#a21d582e2aff51a89b7cac7d9c830cebc">presentationTime</a>).ToTimeSpan().GetMicroSeconds());</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            pOldLastFrame = pLastFrame;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        }</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        gfx.EndDraw();</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="comment">// After nn::gfx::Queue::Present is invoked, nn::vi will generate a frame number.</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="comment">// This should be used to identify a specific frame in nn::vi::ListFrameHistory.</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>(<a class="code" href="namespacenn_1_1vi.html#aa251267bb21d425b2d097d811ffaa6e7">nn::vi::GetLatestFrameNumber</a>(&amp;frameNumber, pLayer));</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160; </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    g_IsRunning.store(<span class="keyword">false</span>, std::memory_order_release);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a8070c91be85c5ccb36b56e9ff3a75b26">nn::os::WaitThread</a>(&amp;vsyncThread);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;}</div>
<div class="ttc" id="a_memory_pool_8h_html"><div class="ttname"><a href="_memory_pool_8h.html">MemoryPool.h</a></div><div class="ttdoc">This file defines a wrapper around the NVNmemoryPool object that keeps track of the memory allocated ...</div></div>
<div class="ttc" id="aclassnn_1_1os_1_1_system_event_html"><div class="ttname"><a href="classnn_1_1os_1_1_system_event.html">nn::os::SystemEvent</a></div><div class="ttdoc">Class for handling system events.</div><div class="ttdef"><b>Definition:</b> os_SystemEvent.h:46</div></div>
<div class="ttc" id="aclassnn_1_1os_1_1_system_event_html_a27b971688da923a2eac49061327552fe"><div class="ttname"><a href="classnn_1_1os_1_1_system_event.html#a27b971688da923a2eac49061327552fe">nn::os::SystemEvent::GetBase</a></div><div class="ttdeci">SystemEventType * GetBase() NN_NOEXCEPT</div><div class="ttdoc">Gets a pointer to this instance's SystemEventType object.</div><div class="ttdef"><b>Definition:</b> os_SystemEvent.h:389</div></div>
<div class="ttc" id="aclassnn_1_1os_1_1_system_event_html_a42a18d99d1cdef662db7b16151f80c46"><div class="ttname"><a href="classnn_1_1os_1_1_system_event.html#a42a18d99d1cdef662db7b16151f80c46">nn::os::SystemEvent::Clear</a></div><div class="ttdeci">void Clear() NN_NOEXCEPT</div><div class="ttdoc">Clears the system event to the nonsignaled state.</div><div class="ttdef"><b>Definition:</b> os_SystemEvent.h:310</div></div>
<div class="ttc" id="aclassnn_1_1os_1_1_system_event_html_a51c8560630f9760922b6e180b75a45b2"><div class="ttname"><a href="classnn_1_1os_1_1_system_event.html#a51c8560630f9760922b6e180b75a45b2">nn::os::SystemEvent::Wait</a></div><div class="ttdeci">void Wait() NN_NOEXCEPT</div><div class="ttdoc">Waits for a system event to enter a signaled state.</div><div class="ttdef"><b>Definition:</b> os_SystemEvent.h:244</div></div>
<div class="ttc" id="aclassnn_1_1vi_1_1_display_html"><div class="ttname"><a href="classnn_1_1vi_1_1_display.html">Display</a></div><div class="ttdoc">Opaque handle to a display.</div></div>
<div class="ttc" id="aclassnn_1_1vi_1_1_layer_html"><div class="ttname"><a href="classnn_1_1vi_1_1_layer.html">Layer</a></div><div class="ttdoc">Opaque handle to a layer.</div><div class="ttdef"><b>Definition:</b> vi_Types.h:28</div></div>
<div class="ttc" id="anamespacenn_1_1gfx_html_a7fdc6aeebf1a1d6cc8a8893bcc3fd128"><div class="ttname"><a href="namespacenn_1_1gfx.html#a7fdc6aeebf1a1d6cc8a8893bcc3fd128">nn::gfx::Initialize</a></div><div class="ttdeci">void Initialize() NN_NOEXCEPT</div><div class="ttdoc">Initializes the gfx library.</div><div class="ttdef"><b>Definition:</b> gfx_Core.h:71</div></div>
<div class="ttc" id="anamespacenn_1_1gfx_html_a8e776d92173c3073b31a5cf65e306dfc"><div class="ttname"><a href="namespacenn_1_1gfx.html#a8e776d92173c3073b31a5cf65e306dfc">nn::gfx::Finalize</a></div><div class="ttdeci">void Finalize() NN_NOEXCEPT</div><div class="ttdoc">Finalizes the gfx library.</div><div class="ttdef"><b>Definition:</b> gfx_Core.h:85</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a18eec7c4c4c298f7abaa9ef41d6de76b"><div class="ttname"><a href="namespacenn_1_1os.html#a18eec7c4c4c298f7abaa9ef41d6de76b">nn::os::StartThread</a></div><div class="ttdeci">void StartThread(ThreadType *thread) NN_NOEXCEPT</div><div class="ttdoc">Starts execution on a thread.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a5985811d04e64c0823ed758fd420591d"><div class="ttname"><a href="namespacenn_1_1os.html#a5985811d04e64c0823ed758fd420591d">nn::os::DefaultThreadPriority</a></div><div class="ttdeci">const int DefaultThreadPriority</div><div class="ttdoc">Constant indicating the default value of thread priority.</div><div class="ttdef"><b>Definition:</b> os_ThreadCommon.h:47</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a75f43e1d3c194c0d2173ef5d95785933"><div class="ttname"><a href="namespacenn_1_1os.html#a75f43e1d3c194c0d2173ef5d95785933">nn::os::CreateThread</a></div><div class="ttdeci">nn::Result CreateThread(ThreadType *thread, ThreadFunction function, void *argument, void *stack, size_t stackSize, int priority, int idealCoreNumber) NN_NOEXCEPT</div><div class="ttdoc">Generates a thread.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a8070c91be85c5ccb36b56e9ff3a75b26"><div class="ttname"><a href="namespacenn_1_1os.html#a8070c91be85c5ccb36b56e9ff3a75b26">nn::os::WaitThread</a></div><div class="ttdeci">void WaitThread(ThreadType *thread) NN_NOEXCEPT</div><div class="ttdoc">Waits for the specified thread to stop.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_ac50b86561c15ee3e8195c83fddc8e732"><div class="ttname"><a href="namespacenn_1_1os.html#ac50b86561c15ee3e8195c83fddc8e732">nn::os::SetThreadCoreMask</a></div><div class="ttdeci">void SetThreadCoreMask(ThreadType *thread, int idealCore, Bit64 affinityMask) NN_NOEXCEPT</div><div class="ttdoc">Sets the target thread core assignment.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_ad106866a5b13bc3d430104333966b479"><div class="ttname"><a href="namespacenn_1_1os.html#ad106866a5b13bc3d430104333966b479">nn::os::GetCurrentThread</a></div><div class="ttdeci">ThreadType * GetCurrentThread() NN_NOEXCEPT</div><div class="ttdoc">Gets a ThreadType object for the current thread.</div></div>
<div class="ttc" id="anamespacenn_1_1util_html_a275a3c89db5d0ab915559d8a85f9cbdd"><div class="ttname"><a href="namespacenn_1_1util.html#a275a3c89db5d0ab915559d8a85f9cbdd">nn::util::align_up</a></div><div class="ttdeci">constexpr T align_up(T x, size_t align) NN_NOEXCEPT</div><div class="ttdoc">Rounds up a value so that it fits the specified alignment.</div><div class="ttdef"><b>Definition:</b> util_BitUtil.h:111</div></div>
<div class="ttc" id="anamespacenn_1_1vi_html_a52c56d265ec47dfb8d0741b67488ca00a6a9fce03df4340ea52a66e06cc39f1e3"><div class="ttname"><a href="namespacenn_1_1vi.html#a52c56d265ec47dfb8d0741b67488ca00a6a9fce03df4340ea52a66e06cc39f1e3">nn::vi::FrameStatus_Enqueued</a></div><div class="ttdeci">@ FrameStatus_Enqueued</div><div class="ttdoc">The frame will be presented to the display after rendering is complete.</div><div class="ttdef"><b>Definition:</b> vi_FrameStatus.h:34</div></div>
<div class="ttc" id="anamespacenn_1_1vi_html_a52c56d265ec47dfb8d0741b67488ca00afe2806ecc66e6e3bddb45a209595e494"><div class="ttname"><a href="namespacenn_1_1vi.html#a52c56d265ec47dfb8d0741b67488ca00afe2806ecc66e6e3bddb45a209595e494">nn::vi::FrameStatus_Presented</a></div><div class="ttdeci">@ FrameStatus_Presented</div><div class="ttdoc">The frame has been shown on the display.</div><div class="ttdef"><b>Definition:</b> vi_FrameStatus.h:35</div></div>
<div class="ttc" id="anamespacenn_1_1vi_html_a596d171dedb65273f7aab87bc74012c6"><div class="ttname"><a href="namespacenn_1_1vi.html#a596d171dedb65273f7aab87bc74012c6">nn::vi::GetDisplayVsyncEvent</a></div><div class="ttdeci">nn::Result GetDisplayVsyncEvent(nn::os::SystemEventType *pOutEvent, Display *pDisplay) NN_NOEXCEPT</div><div class="ttdoc">Initializes an event that will signal on VSYNC.</div></div>
<div class="ttc" id="anamespacenn_1_1vi_html_a7451676fd7f7b48369ff4c01a1fa91dd"><div class="ttname"><a href="namespacenn_1_1vi.html#a7451676fd7f7b48369ff4c01a1fa91dd">nn::vi::Finalize</a></div><div class="ttdeci">void Finalize() NN_NOEXCEPT</div><div class="ttdoc">Finalizes VI library.</div></div>
<div class="ttc" id="anamespacenn_1_1vi_html_a8006a2df0e49f371d5b53a762b006b3a"><div class="ttname"><a href="namespacenn_1_1vi.html#a8006a2df0e49f371d5b53a762b006b3a">nn::vi::ListFrameHistory</a></div><div class="ttdeci">int ListFrameHistory(FrameInfo *pOutFrames, int frameCountMax, const Layer *pLayer) NN_NOEXCEPT</div><div class="ttdoc">Query the history of frames associated with a Layer.</div></div>
<div class="ttc" id="anamespacenn_1_1vi_html_a86b2688dc743e37f3acaca99ccdf8c12"><div class="ttname"><a href="namespacenn_1_1vi.html#a86b2688dc743e37f3acaca99ccdf8c12">nn::vi::CreateLayer</a></div><div class="ttdeci">Result CreateLayer(Layer **pOutLayer, Display *pDisplay) NN_NOEXCEPT</div><div class="ttdoc">Creates a new layer on a particular display.</div></div>
<div class="ttc" id="anamespacenn_1_1vi_html_aa251267bb21d425b2d097d811ffaa6e7"><div class="ttname"><a href="namespacenn_1_1vi.html#aa251267bb21d425b2d097d811ffaa6e7">nn::vi::GetLatestFrameNumber</a></div><div class="ttdeci">nn::Result GetLatestFrameNumber(std::uint64_t *pOutFrameNumber, const Layer *pLayer) NN_NOEXCEPT</div><div class="ttdoc">Query the latest frame number generated by the display subsystem.</div></div>
<div class="ttc" id="anamespacenn_1_1vi_html_acecc11f3b92d6d1e0c6b5d056d4b05fd"><div class="ttname"><a href="namespacenn_1_1vi.html#acecc11f3b92d6d1e0c6b5d056d4b05fd">nn::vi::Initialize</a></div><div class="ttdeci">void Initialize() NN_NOEXCEPT</div><div class="ttdoc">Initializes VI library.</div></div>
<div class="ttc" id="anamespacenn_1_1vi_html_ae9cd501562a820272816af783bd798dc"><div class="ttname"><a href="namespacenn_1_1vi.html#ae9cd501562a820272816af783bd798dc">nn::vi::OpenDefaultDisplay</a></div><div class="ttdeci">Result OpenDefaultDisplay(Display **pOutDisplay) NN_NOEXCEPT</div><div class="ttdoc">Open the platform's default display.</div></div>
<div class="ttc" id="anamespacenv_html_a368247e862f5ffc59a38af42658d7b38"><div class="ttname"><a href="namespacenv.html#a368247e862f5ffc59a38af42658d7b38">nv::FinalizeGraphics</a></div><div class="ttdeci">void FinalizeGraphics() NN_NOEXCEPT</div><div class="ttdoc">Release resources from graphics subsystem.</div></div>
<div class="ttc" id="anamespacenv_html_a5ef00427dfc2493551bb66b37731bb35"><div class="ttname"><a href="namespacenv.html#a5ef00427dfc2493551bb66b37731bb35">nv::SetGraphicsDevtoolsAllocator</a></div><div class="ttdeci">void SetGraphicsDevtoolsAllocator(AllocateFunction allocate, FreeFunction free, ReallocateFunction reallocate, void *userPtr) NN_NOEXCEPT</div><div class="ttdoc">Set memory allocator for graphics developer tools and NVN debug layer.</div></div>
<div class="ttc" id="anamespacenv_html_a7d85cfdd1bae1b635cc66b8d58077688"><div class="ttname"><a href="namespacenv.html#a7d85cfdd1bae1b635cc66b8d58077688">nv::SetGraphicsAllocator</a></div><div class="ttdeci">void SetGraphicsAllocator(AllocateFunction allocate, FreeFunction free, ReallocateFunction reallocate, void *userPtr) NN_NOEXCEPT</div><div class="ttdoc">Set memory allocator for graphics subsystem.</div></div>
<div class="ttc" id="anamespacenv_html_aacadc57952b370f2286108f5835ce726"><div class="ttname"><a href="namespacenv.html#aacadc57952b370f2286108f5835ce726">nv::InitializeGraphics</a></div><div class="ttdeci">void InitializeGraphics(void *address, size_t size) NN_NOEXCEPT</div><div class="ttdoc">Specify the address and size of memory that is donated to graphics firmware.</div></div>
<div class="ttc" id="ann___abort_8h_html"><div class="ttname"><a href="nn___abort_8h.html">nn_Abort.h</a></div><div class="ttdoc">Declarations for API resources to abort execution when conditions are not satisfied.</div></div>
<div class="ttc" id="ann___abort_8h_html_a1e657a678a588533a020c2e947df7772"><div class="ttname"><a href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a></div><div class="ttdeci">#define NN_ABORT_UNLESS_RESULT_SUCCESS(result)</div><div class="ttdoc">Tests whether the specified nn::Result is successful or not, and stops if it is not.</div><div class="ttdef"><b>Definition:</b> nn_Abort.h:188</div></div>
<div class="ttc" id="ann___assert_8h_html"><div class="ttname"><a href="nn___assert_8h.html">nn_Assert.h</a></div><div class="ttdoc">Declarations for API resources to test whether conditions are satisfied.</div></div>
<div class="ttc" id="ann___assert_8h_html_a0473ebccccc250efd6100a9bbfec406b"><div class="ttname"><a href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a></div><div class="ttdeci">#define NN_ASSERT_NOT_NULL(pointer)</div><div class="ttdoc">Tests whether the pointer is not a null pointer.</div><div class="ttdef"><b>Definition:</b> nn_Assert.h:140</div></div>
<div class="ttc" id="ann___log_8h_html"><div class="ttname"><a href="nn___log_8h.html">nn_Log.h</a></div><div class="ttdoc">Declarations for the logging API.</div></div>
<div class="ttc" id="ann___log_8h_html_a2d720c8bc6b733bce63879350d134a84"><div class="ttname"><a href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a></div><div class="ttdeci">#define NN_LOG(...)</div><div class="ttdoc">Adds the string specified in the parameter as a log entry.</div><div class="ttdef"><b>Definition:</b> nn_Log.h:33</div></div>
<div class="ttc" id="ann___macro_8h_html_a0e31cc4dc24d85253a31e48b1a85ab33"><div class="ttname"><a href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div><div class="ttdeci">#define NN_NOEXCEPT</div><div class="ttdoc">Declares that the function does not throw exceptions.</div><div class="ttdef"><b>Definition:</b> nn_Macro.h:196</div></div>
<div class="ttc" id="ann___macro_8h_html_af2d1673769927c5eae977d8dde3ce106"><div class="ttname"><a href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a></div><div class="ttdeci">#define NN_UNUSED(variable)</div><div class="ttdoc">Suppresses compiler warnings on intentionally unused variables.</div><div class="ttdef"><b>Definition:</b> nn_Macro.h:610</div></div>
<div class="ttc" id="anv___memory_management_8h_html"><div class="ttname"><a href="nv___memory_management_8h.html">nv_MemoryManagement.h</a></div><div class="ttdoc"></div></div>
<div class="ttc" id="aos___thread_common_8h_html_a5ce0c3c0aaceb976178a60a18d90f470"><div class="ttname"><a href="os___thread_common_8h.html#a5ce0c3c0aaceb976178a60a18d90f470">NN_OS_ALIGNAS_THREAD_STACK</a></div><div class="ttdeci">#define NN_OS_ALIGNAS_THREAD_STACK</div><div class="ttdoc">Macro to specify the stack space alignment.</div><div class="ttdef"><b>Definition:</b> os_ThreadCommon.h:108</div></div>
<div class="ttc" id="astructnn_1_1os_1_1_thread_type_html"><div class="ttname"><a href="structnn_1_1os_1_1_thread_type.html">nn::os::ThreadType</a></div><div class="ttdoc">This structure defines a thread object.</div><div class="ttdef"><b>Definition:</b> os_ThreadTypes.h:92</div></div>
<div class="ttc" id="astructnn_1_1util_1_1_unorm8x4_html"><div class="ttname"><a href="structnn_1_1util_1_1_unorm8x4.html">nn::util::Unorm8x4</a></div><div class="ttdoc">Structure that holds a one-dimensional array of four elements, each a normalized 8-byte unsigned inte...</div><div class="ttdef"><b>Definition:</b> util_MathTypes.h:47</div></div>
<div class="ttc" id="astructnn_1_1vi_1_1_frame_info_html"><div class="ttname"><a href="structnn_1_1vi_1_1_frame_info.html">nn::vi::FrameInfo</a></div><div class="ttdoc">Contains frame status information.</div><div class="ttdef"><b>Definition:</b> vi_FrameInfo.h:41</div></div>
<div class="ttc" id="astructnn_1_1vi_1_1_frame_info_html_a21d582e2aff51a89b7cac7d9c830cebc"><div class="ttname"><a href="structnn_1_1vi_1_1_frame_info.html#a21d582e2aff51a89b7cac7d9c830cebc">nn::vi::FrameInfo::presentationTime</a></div><div class="ttdeci">nn::os::Tick presentationTime</div><div class="ttdoc">Timestamp when the display was set to scan from this frame.</div><div class="ttdef"><b>Definition:</b> vi_FrameInfo.h:47</div></div>
<div class="ttc" id="astructnn_1_1vi_1_1_frame_info_html_a79673a902e172460d1de58977d92284f"><div class="ttname"><a href="structnn_1_1vi_1_1_frame_info.html#a79673a902e172460d1de58977d92284f">nn::vi::FrameInfo::status</a></div><div class="ttdeci">FrameStatus status</div><div class="ttdoc">The frame's current status.</div><div class="ttdef"><b>Definition:</b> vi_FrameInfo.h:42</div></div>
<div class="ttc" id="astructnn_1_1vi_1_1_frame_info_html_a951b40670f979599d9a98f68855324e7"><div class="ttname"><a href="structnn_1_1vi_1_1_frame_info.html#a951b40670f979599d9a98f68855324e7">nn::vi::FrameInfo::enqueueTime</a></div><div class="ttdeci">nn::os::Tick enqueueTime</div><div class="ttdoc">Timestamp when the frame was queued with a graphics API to be displayed after rendering has completed...</div><div class="ttdef"><b>Definition:</b> vi_FrameInfo.h:45</div></div>
<div class="ttc" id="astructnn_1_1vi_1_1_frame_info_html_af41168c427118593e9f19dc528abf871"><div class="ttname"><a href="structnn_1_1vi_1_1_frame_info.html#af41168c427118593e9f19dc528abf871">nn::vi::FrameInfo::frameNumber</a></div><div class="ttdeci">std::uint64_t frameNumber</div><div class="ttdoc">A frame's unique identifier that is generated at queue time.</div><div class="ttdef"><b>Definition:</b> vi_FrameInfo.h:43</div></div>
<div class="ttc" id="autil___scope_exit_8h_html"><div class="ttname"><a href="util___scope_exit_8h.html">util_ScopeExit.h</a></div><div class="ttdoc">Defines the macro that writes the code to run when an object goes out of scope.</div></div>
<div class="ttc" id="autil___scope_exit_8h_html_a674e2d673758265abe6e8e17426489ea"><div class="ttname"><a href="util___scope_exit_8h.html#a674e2d673758265abe6e8e17426489ea">NN_UTIL_SCOPE_EXIT</a></div><div class="ttdeci">#define NN_UTIL_SCOPE_EXIT</div><div class="ttdoc">Macro that writes the process when an object goes out of scope.</div><div class="ttdef"><b>Definition:</b> util_ScopeExit.h:101</div></div>
</div><!-- fragment --><h2><a class="anchor" id="ViTimestamp_SectionSampleDetail"></a>
Sample Program Description</h2>
<p>This sample runs rendering on the main thread and has a separate thread that will wake up on vsync to query the frame history. The vsync thread passes the statistics about the most recent frame that was presented on the display, which will be printed on screen. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
</body>
</html>
