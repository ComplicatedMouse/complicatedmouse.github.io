<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SocketEventFd sample | NintendoSDK API Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="openclose.js"></script>
<script type="text/javascript" src="searchapi.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NintendoSDK API Reference
   &#160;<span id="projectnumber">14.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="_page_sample.html">Sample Descriptions</a></li><li class="navelem"><a class="el" href="_page_sample_socket.html">Socket Library Samples</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">SocketEventFd sample </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#PageSampleSocketEventFd_SectionFileStructure">file configuration</a></li>
<li class="level1"><a href="#PageSampleSocketEventFd_SectionNecessaryEnvironment">Necessary environment</a></li>
<li class="level1"><a href="#PageSampleSocketEventFd_SectionHowToOperate">Operating method</a></li>
<li class="level1"><a href="#PageSampleSocketEventFd_SectionPrecaution">Cautions</a></li>
<li class="level1"><a href="#PageSampleSocketEventFd_SectionHowToExecute">Execution procedure</a></li>
<li class="level1"><a href="#PageSampleSocketEventFd_SectionDetail">Explaination</a><ul><li class="level2"><a href="#PageSampleSocketEventFd_SectionSampleProgram">Sample program</a></li>
<li class="level2"><a href="#PageSampleSocketEventFd_SectionSampleDetail">Description of the sample program</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>Sample shows how to use <a class="el" href="namespacenn_1_1socket.html#a5175276a6b52a0b9d6e99a78ea330de5" title="Read from an event fd.">nn::socket::EventFdRead()</a> and <a class="el" href="namespacenn_1_1socket.html#af5535161f9c800ca7f7f9e7a854ba122" title="Write to an event fd.">nn::socket::EventFdWrite()</a> in combination with <a class="el" href="namespacenn_1_1socket.html#ad9e109d18fb43f275742d74d74d06cde" title="Synchronous I/O multiplexing.">nn::socket::Poll()</a> and <a class="el" href="namespacenn_1_1socket.html#aa523b16a6004b8748cc0116f9ed65dd2" title="Synchronous I/O multiplexing.">nn::socket::Select()</a> using various option flags.</p>
<h1><a class="anchor" id="PageSampleSocketEventFd_SectionFileStructure"></a>
file configuration</h1>
<p>This sample program is located under <a class="el" href="dir_6f6ffba629874944457a7476b2eb9fd2.html">Samples/Sources/Applications/SocketEventFd</a>.</p>
<h1><a class="anchor" id="PageSampleSocketEventFd_SectionNecessaryEnvironment"></a>
Necessary environment</h1>
<p>Nothing</p>
<h1><a class="anchor" id="PageSampleSocketEventFd_SectionHowToOperate"></a>
Operating method</h1>
<p>Nothing</p>
<h1><a class="anchor" id="PageSampleSocketEventFd_SectionPrecaution"></a>
Cautions</h1>
<p>Please be aware that this sample and EventFd's as a feature will only run on the NX. Windows is not supported.</p>
<h1><a class="anchor" id="PageSampleSocketEventFd_SectionHowToExecute"></a>
Execution procedure</h1>
<p>Build and execute the sample program.</p>
<h1><a class="anchor" id="PageSampleSocketEventFd_SectionDetail"></a>
Explaination</h1>
<h2><a class="anchor" id="PageSampleSocketEventFd_SectionSampleProgram"></a>
Sample program</h2>
<p>The source code for this sample program is quoted below.</p>
<p><a class="el" href="_socket_event_fd_8cpp.html" title="Shows an example of how to use nn::socket::EventFdRead/Write with nn::socket::Poll() and nn::socket::...">SocketEventFd.cpp</a> </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*--------------------------------------------------------------------------------*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">  Copyright (C)Nintendo All rights reserved.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">  These coded instructions, statements, and computer programs contain proprietary</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">  information of Nintendo and/or its licensed developers and are protected by</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">  national and international copyright laws. They may not be disclosed to third</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">  parties or copied or duplicated in any form, in whole or in part, without the</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">  prior written consent of Nintendo.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">  The content herein is highly confidential and should be handled accordingly.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *--------------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#include &lt;stdint.h&gt;</span> <span class="comment">// size_t</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span>   <span class="comment">// std::string</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="nn___macro_8h.html">nn/nn_Macro.h</a>&gt;</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="nn___log_8h.html">nn/nn_Log.h</a>&gt;</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="nn___abort_8h.html">nn/nn_Abort.h</a>&gt;</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="nn___time_span_8h.html">nn/nn_TimeSpan.h</a>&gt;</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="os___event_8h.html">nn/os/os_Event.h</a>&gt;</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="socket_8h.html">nn/socket.h</a>&gt;</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">// Network socket library static memory</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<a class="code" href="classnn_1_1socket_1_1_config_default_with_memory.html">nn::socket::ConfigDefaultWithMemory</a> g_SocketConfigWithMemory;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">// Worker interruptThread data</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="keyword">const</span> <span class="keywordtype">size_t</span> ThreadStackSize = 8192;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<a class="code" href="os___thread_common_8h.html#a5ce0c3c0aaceb976178a60a18d90f470">NN_OS_ALIGNAS_THREAD_STACK</a> <span class="keywordtype">char</span>  g_threadInterruptStack[ThreadStackSize];</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">// Number the semaphore EventFds are incremented by in the example.</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="keyword">const</span> <span class="keywordtype">int</span> SemaphoreCount = 3;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;} <span class="comment">// namespace</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">// Creates 4 EventFds, 1 for each type:</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">// fdNone: socket emulation</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">// fdSemaphore: socket emulation with decremented read count</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">// fdNonBlock: socket emulation with nonblocking read</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">// fdSemaphoreAndNonBlock: socket enumation with decremented read count and nonblocking</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="keyword">struct </span>ExampleEventFdData</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;{</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    ExampleEventFdData()</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="comment">// You may not want to create many EventFds because there is a limit to how many</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="comment">// fdSet the nn::socket library can handle. Limit: @ref nn::socket::FdSetSize</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        fdNone = <a class="code" href="namespacenn_1_1socket.html#ae82dfb460b32b4e583f55b500385c776">nn::socket::EventFd</a>(0, nn::socket::EventFdFlags::None);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordflow">if</span>(fdNone == -1)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <a class="code" href="nn___abort_8h.html#a205eaac89c47d49cb982bf136e113de2">NN_ABORT</a>(<span class="stringliteral">&quot;fdNone error: %d\n&quot;</span>, <a class="code" href="namespacenn_1_1socket.html#a6db6951cb084f74f4c17d655ce798890">nn::socket::GetLastError</a>());</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        fdSemaphore = <a class="code" href="namespacenn_1_1socket.html#ae82dfb460b32b4e583f55b500385c776">nn::socket::EventFd</a>(0, nn::socket::EventFdFlags::Semaphore);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="keywordflow">if</span>(fdSemaphore == -1)</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        {</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            <a class="code" href="nn___abort_8h.html#a205eaac89c47d49cb982bf136e113de2">NN_ABORT</a>(<span class="stringliteral">&quot;fdSemaphore error: %d\n&quot;</span>, <a class="code" href="namespacenn_1_1socket.html#a6db6951cb084f74f4c17d655ce798890">nn::socket::GetLastError</a>());</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        fdNonBlock = <a class="code" href="namespacenn_1_1socket.html#ae82dfb460b32b4e583f55b500385c776">nn::socket::EventFd</a>(0, nn::socket::EventFdFlags::Nonblock);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="keywordflow">if</span>(fdNonBlock == -1)</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            <a class="code" href="nn___abort_8h.html#a205eaac89c47d49cb982bf136e113de2">NN_ABORT</a>(<span class="stringliteral">&quot;fdNonBlock error: %d\n&quot;</span>, <a class="code" href="namespacenn_1_1socket.html#a6db6951cb084f74f4c17d655ce798890">nn::socket::GetLastError</a>());</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        }</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        fdSemaphoreAndNonBlock = <a class="code" href="namespacenn_1_1socket.html#ae82dfb460b32b4e583f55b500385c776">nn::socket::EventFd</a>(0, nn::socket::EventFdFlags::SemaphoreAndNonblock);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="keywordflow">if</span>(fdSemaphoreAndNonBlock == -1)</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <a class="code" href="nn___abort_8h.html#a205eaac89c47d49cb982bf136e113de2">NN_ABORT</a>(<span class="stringliteral">&quot;fdSemaphoreAndNonBlock error: %d\n&quot;</span>, <a class="code" href="namespacenn_1_1socket.html#a6db6951cb084f74f4c17d655ce798890">nn::socket::GetLastError</a>());</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <a class="code" href="namespacenn_1_1os.html#af07abef747ac6b51112b9e800ba9632c">nn::os::InitializeEvent</a>(&amp;writeNextEventFd, <span class="keyword">false</span>, <a class="code" href="namespacenn_1_1os.html#a11ab71d44973a4135958c420e5682452a31f6133098296b3ddb7e14da3dc695cc">nn::os::EventClearMode_AutoClear</a>);</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    ~ExampleEventFdData()</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <a class="code" href="namespacenn_1_1os.html#adae3d14bd5e37dd1feee56bbf1717e37">nn::os::FinalizeEvent</a>(&amp;writeNextEventFd);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <a class="code" href="namespacenn_1_1socket.html#ae01110d228e2148d830b1ecfb9aaa425">nn::socket::Close</a>(fdSemaphoreAndNonBlock);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <a class="code" href="namespacenn_1_1socket.html#ae01110d228e2148d830b1ecfb9aaa425">nn::socket::Close</a>(fdNonBlock);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <a class="code" href="namespacenn_1_1socket.html#ae01110d228e2148d830b1ecfb9aaa425">nn::socket::Close</a>(fdSemaphore);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <a class="code" href="namespacenn_1_1socket.html#ae01110d228e2148d830b1ecfb9aaa425">nn::socket::Close</a>(fdNone);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    }</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordtype">int</span> fdNone;                 <span class="comment">// Socket emulation</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordtype">int</span> fdSemaphore;            <span class="comment">// Socket emulation with decremented read count</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordtype">int</span> fdNonBlock;             <span class="comment">// Socket emulation with nonblocking read when unreadable</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keywordtype">int</span> fdSemaphoreAndNonBlock; <span class="comment">// Socket emulation with decremented read count and nonblocking read when unreadable</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment">// Used to synchronize the interrupt thread and main thread to make logging order</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <span class="comment">// deterministic and nonBlocking calls (expected failures: EAgain) determinisitc.</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="structnn_1_1os_1_1_event_type.html">nn::os::EventType</a> writeNextEventFd;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;};</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">// Convert PollEvent bit flags into a string</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;std::string PollEventToString(<a class="code" href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9">nn::socket::PollEvent</a> pe)</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;{</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    std::string out;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">if</span>(pe == nn::socket::PollEvent::PollNone)</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        out += <span class="stringliteral">&quot;(PollNone)&quot;</span>;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)(pe &amp; <a class="code" href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a1b0bed7d85ba6b2cbe91629776e3ee6d">nn::socket::PollEvent::PollIn</a>      ) != 0) { out += <span class="stringliteral">&quot;(PollIn) &quot;</span>; }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)(pe &amp; <a class="code" href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a1034fc649394d42b19fead1ab1828e54">nn::socket::PollEvent::PollPri</a>     ) != 0) { out += <span class="stringliteral">&quot;(PollPri) &quot;</span>; }</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)(pe &amp; <a class="code" href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9aca8de23660319dc20822f6e6059a727b">nn::socket::PollEvent::PollOut</a>     ) != 0) { out += <span class="stringliteral">&quot;(PollOut) &quot;</span>; }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)(pe &amp; <a class="code" href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a6aee635278505dd8cc1da7f50c4a651d">nn::socket::PollEvent::PollErr</a>     ) != 0) { out += <span class="stringliteral">&quot;(PollErr) &quot;</span>; }</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)(pe &amp; <a class="code" href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a2421093408548ab23a7a93500e8cccd3">nn::socket::PollEvent::PollHup</a>     ) != 0) { out += <span class="stringliteral">&quot;(PollHup) &quot;</span>; }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)(pe &amp; <a class="code" href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9aecf0948bef1a1db017a0d4e714f05c04">nn::socket::PollEvent::PollNVal</a>    ) != 0) { out += <span class="stringliteral">&quot;(PollNVal) &quot;</span>; }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)(pe &amp; <a class="code" href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9aaf909a6e6a64bebd393ae9fbc33f200a">nn::socket::PollEvent::PollRdNorm</a>  ) != 0) { out += <span class="stringliteral">&quot;(PollRdNorm) &quot;</span>; }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)(pe &amp; <a class="code" href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a9b8ce4bb4c25d8b2abc5e5648c9cd54a">nn::socket::PollEvent::PollRdBand</a>  ) != 0) { out += <span class="stringliteral">&quot;(PollRdBand) &quot;</span>; }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)(pe &amp; <a class="code" href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9af5abb7d0050a44e425556082ae71b547">nn::socket::PollEvent::PollWrNorm</a>  ) != 0) { out += <span class="stringliteral">&quot;(PollWrNorm) &quot;</span>; }</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)(pe &amp; <a class="code" href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a70417b0dc75887023e5fa42ca645d4c9">nn::socket::PollEvent::PollWrBand</a>  ) != 0) { out += <span class="stringliteral">&quot;(PollWrBand) &quot;</span>; }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)(pe &amp; nn::socket::PollEvent::PollMsg     ) != 0) { out += <span class="stringliteral">&quot;(PollMsg) &quot;</span>; }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)(pe &amp; nn::socket::PollEvent::PollRdHup   ) != 0) { out += <span class="stringliteral">&quot;(PollRdHup) &quot;</span>; }</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">if</span>((<span class="keywordtype">int</span>)(pe &amp; nn::socket::PollEvent::PollInIgnEof) != 0) { out += <span class="stringliteral">&quot;(PollInIgnEof) &quot;</span>; }</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    }</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">return</span> out;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;}</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160; </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">// The startup function for the interrupter thread. This thread will make eventFd&#39;s</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">// readable once it is allowed to write to them. This will then cause Poll() and</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">// Select() calls to return with the readable eventFd.</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="keywordtype">void</span> ExampleInterrupter(<span class="keywordtype">void</span> *arg)</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;{</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    ExampleEventFdData* d = <span class="keyword">static_cast&lt;</span>ExampleEventFdData*<span class="keyword">&gt;</span>(arg);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">// Structure used to hold the data for the interrupter</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keyword">struct </span>ExCase</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="keywordtype">int</span> fd;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <a class="code" href="namespacenn_1_1socket.html#ada14f217430a89abc25c5c9ed822f115">nn::socket::EventFdType</a> value;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    };</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">// &quot;1337&quot; and &quot;9001&quot; are arbitrary value numbers to write.</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="comment">// You may use whatever value you like and expect to receive it</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="comment">// when reading from EventFds&#39; with None OR NonBlock flags.</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    ExCase exCases[] =</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        { d-&gt;fdNone,                1337,          },</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        { d-&gt;fdSemaphore,           SemaphoreCount,},</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        { d-&gt;fdNonBlock,            9001,          },</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        { d-&gt;fdSemaphoreAndNonBlock,SemaphoreCount,},</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    };</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="nn___macro_8h.html#acd3a418aa2fc4a6379eaa722181a46a6">NN_ARRAY_SIZE</a>(exCases); ++i)</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="comment">// Used for nonblock examples and output log determinism.</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <a class="code" href="namespacenn_1_1os.html#aabdcb2de0b5dbdd64a0ec3d7e65c72f4">nn::os::WaitEvent</a>(&amp;d-&gt;writeNextEventFd);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;{[Interrupt Thread]} EventFdWrite(%d)\n&quot;</span>, exCases[i].value);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="comment">// By writing to the EventFd we make it readable which will make any</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="comment">// Poll() or Select() operations using the EventFd to return.</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="comment">// The order we write to the EventFd does not matter. We may write to it before or</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="comment">// during another thread&#39;s call to Poll() or Select(). The EventFd will remain</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="comment">// readable until it has been read.</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordtype">int</span> res = <a class="code" href="namespacenn_1_1socket.html#af5535161f9c800ca7f7f9e7a854ba122">nn::socket::EventFdWrite</a>(exCases[i].fd, exCases[i].value);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <a class="code" href="nn___abort_8h.html#a5c1a90d3a6474658ae0ac5dc5bcb14e4">NN_ABORT_UNLESS</a>(res == 0, <span class="stringliteral">&quot;{[Interrupt Thread]} EventFdWrite failed!\n&quot;</span>);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;}</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">// Read eventFd and print the results</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="keywordtype">void</span> ReadEventFd(<span class="keywordtype">int</span> eventFd, <span class="keyword">const</span> <span class="keywordtype">char</span>* tag)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;{</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <a class="code" href="namespacenn_1_1socket.html#ada14f217430a89abc25c5c9ed822f115">nn::socket::EventFdType</a> eventValue = 0;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordtype">int</span> readRes = 0;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">// Print that we are starting a read, the tag is for legibility.</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Reading EventFd (%s)\n&quot;</span>, tag);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="nn___macro_8h.html#a71c0f58f6d49fe1392380eed4509ab9a">NN_STATIC_CONDITION</a>(<span class="keyword">true</span>)) <span class="comment">// Logically equivalent operations</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        readRes = <a class="code" href="namespacenn_1_1socket.html#a5175276a6b52a0b9d6e99a78ea330de5">nn::socket::EventFdRead</a>(eventFd, &amp;eventValue);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">else</span>  <span class="comment">// Logically equivalent operations</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    {</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        readRes = <a class="code" href="namespacenn_1_1socket.html#ae1fd34e9d084e5bb0f17a6c2361896c2">nn::socket::Read</a>(eventFd, &amp;eventValue, <span class="keyword">sizeof</span>(eventValue));</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    }</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    EventFdRead result: %d %s\n&quot;</span>, readRes, readRes == 0 ? <span class="stringliteral">&quot;(success)&quot;</span> : <span class="stringliteral">&quot;(failed)&quot;</span>);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">if</span>(readRes == -1) <span class="comment">// Failure</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    {</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    EventFdRead Errno: %d%s\n&quot;</span>,</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            <a class="code" href="namespacenn_1_1socket.html#a6db6951cb084f74f4c17d655ce798890">nn::socket::GetLastError</a>(),</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            <a class="code" href="namespacenn_1_1socket.html#a6db6951cb084f74f4c17d655ce798890">nn::socket::GetLastError</a>() == <a class="code" href="namespacenn_1_1socket.html#ad1ade4838b158c7aaf9c9a78338e06aea54cafc2ec81f6d1fe8ba661ade3931cb">nn::socket::Errno::EAgain</a> ? <span class="stringliteral">&quot; = EAgain&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">else</span> <span class="comment">// 0 (success) OR sizeof(eventValue) depending on static condition above.</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    EventFdRead value:  %d\n&quot;</span>, eventValue);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    }</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;}</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="keywordtype">void</span> <a class="code" href="_socket_event_fd_8cpp.html#a5a2b600f6e6c5792cf99dcb421973db6">PollExample</a>()</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;{</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> EventFdIndex = 0;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> SocketFdIndex = 1;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="comment">// Interrupt thread is used to wake up the main thread from Poll()</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="structnn_1_1os_1_1_thread_type.html">nn::os::ThreadType</a> interruptThread;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160; </div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">// Contructor will creates 4 EventFds, 1 for each type:</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="comment">// fdNone:                 socket emulation</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="comment">// fdSemaphore:            socket emulation with decremented read count</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="comment">// fdNonBlock:             socket emulation with nonblocking read when unreadable</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="comment">// fdSemaphoreAndNonBlock: socket enumation with decremented read count and nonblocking read when unreadable</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    ExampleEventFdData eventFds;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="comment">// Create worker interruptThread to interrupt us from our call to Poll()</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>(<a class="code" href="namespacenn_1_1os.html#a75f43e1d3c194c0d2173ef5d95785933">nn::os::CreateThread</a>(&amp;interruptThread, ExampleInterrupter, &amp;eventFds, g_threadInterruptStack, ThreadStackSize, <a class="code" href="namespacenn_1_1os.html#a5985811d04e64c0823ed758fd420591d">nn::os::DefaultThreadPriority</a>));</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a18eec7c4c4c298f7abaa9ef41d6de76b">nn::os::StartThread</a>(&amp;interruptThread);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="comment">// Make a socket fd. In this example it will never become readable.</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordtype">int</span> socketFd = <a class="code" href="namespacenn_1_1socket.html#a9afeb564bac1d0c04af2fec1f00c739f">nn::socket::Socket</a>(<a class="code" href="namespacenn_1_1socket.html#a057d985148e23267303e6d00d7ed205daa4d833d8c15a76105639ddd11bcb614e">nn::socket::Family::Af_Inet</a>, <a class="code" href="namespacenn_1_1socket.html#a1db675083dcccec6500d1435c5dfeaeaa4cc079142a1be58955eb22bed651ebba">nn::socket::Type::Sock_Dgram</a>, <a class="code" href="namespacenn_1_1socket.html#a46347de69614965469ac8f3c8056468ea48e0b0b8eaaf71a2c2c0ebfa0e802b1a">nn::socket::Protocol::IpProto_Udp</a>);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">if</span>(socketFd &lt; 0)</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    {</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <a class="code" href="nn___abort_8h.html#a205eaac89c47d49cb982bf136e113de2">NN_ABORT</a>(<span class="stringliteral">&quot;nn::socket::Socket() failed (error %d)\n&quot;</span>, <a class="code" href="namespacenn_1_1socket.html#a6db6951cb084f74f4c17d655ce798890">nn::socket::GetLastError</a>());</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <a class="code" href="structnn_1_1socket_1_1_poll_fd.html">nn::socket::PollFd</a> fds[2] = {};</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="comment">// Wait for readable data on EventFd (ie. EventFdWrite)</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    fds[EventFdIndex].<a class="code" href="structnn_1_1socket_1_1_poll_fd.html#ab5c064cf340ae80e805a84e927dcdb9f">events</a> = <a class="code" href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a1b0bed7d85ba6b2cbe91629776e3ee6d">nn::socket::PollEvent::PollIn</a>;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    fds[EventFdIndex].<a class="code" href="structnn_1_1socket_1_1_poll_fd.html#a778aa060c42157a250cf459f7cfea273">fd</a> = -1; <span class="comment">// set later</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="comment">// Wait for readable data on socket. It will never become readable in this example.</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    fds[SocketFdIndex].<a class="code" href="structnn_1_1socket_1_1_poll_fd.html#ab5c064cf340ae80e805a84e927dcdb9f">events</a> = <a class="code" href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a1b0bed7d85ba6b2cbe91629776e3ee6d">nn::socket::PollEvent::PollIn</a>;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    fds[SocketFdIndex].<a class="code" href="structnn_1_1socket_1_1_poll_fd.html#a778aa060c42157a250cf459f7cfea273">fd</a> = socketFd;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160; </div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-----------------------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-- Poll Event Fd, Flags: None -----------------\n&quot;</span>);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-----------------------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="comment">// EventFd Flags: None</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="comment">// Description: Wait on socketFd until readable OR until our interrupt thread makes fdNone readable.</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="comment">// Set eventFd</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        fds[EventFdIndex].<a class="code" href="structnn_1_1socket_1_1_poll_fd.html#a778aa060c42157a250cf459f7cfea273">fd</a> = eventFds.fdNone;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="comment">// Reset return events</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        fds[EventFdIndex].<a class="code" href="structnn_1_1socket_1_1_poll_fd.html#aca13d3c2b88fcd0292ecbcbbbc5f85dc">revents</a> = fds[SocketFdIndex].<a class="code" href="structnn_1_1socket_1_1_poll_fd.html#aca13d3c2b88fcd0292ecbcbbbc5f85dc">revents</a> = nn::socket::PollEvent::PollNone;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="comment">// If we attempted to Poll or Read fdNone here. It would block forever unless written to by another thread.</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Starting Poll (EventFd Flags None)\n&quot;</span>);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="comment">// Signal interrupt thread to write to fdNone.</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="comment">// Synchronization is done to make behavior deterministic, removal would leave a valid program.</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <a class="code" href="namespacenn_1_1os.html#a9b959a51c1d28b76894597695fd3d081">nn::os::SignalEvent</a>(&amp;eventFds.writeNextEventFd);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="comment">// Poll until either fd becomes readable.</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordtype">int</span> pollRes = <a class="code" href="namespacenn_1_1socket.html#ad9e109d18fb43f275742d74d74d06cde">nn::socket::Poll</a>(fds, <a class="code" href="nn___macro_8h.html#acd3a418aa2fc4a6379eaa722181a46a6">NN_ARRAY_SIZE</a>(fds), <a class="code" href="namespacenn_1_1socket.html#ac63165d8f4ab675489cda23034aa9eeb">nn::socket::InfTim</a>);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Poll returned result: %d\n&quot;</span>, pollRes);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    PollEvent eventFd:  %s\n&quot;</span>, PollEventToString(fds[EventFdIndex].revents).c_str());</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    PollEvent socketFd: %s\n&quot;</span>, PollEventToString(fds[SocketFdIndex].revents).c_str());</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="comment">// Poll should only return because eventFd is now readable</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <a class="code" href="nn___abort_8h.html#a5c1a90d3a6474658ae0ac5dc5bcb14e4">NN_ABORT_UNLESS</a>(fds[EventFdIndex].revents == <a class="code" href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a1b0bed7d85ba6b2cbe91629776e3ee6d">nn::socket::PollEvent::PollIn</a>);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="comment">// Read value from event FD</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        ReadEventFd(eventFds.fdNone, <span class="stringliteral">&quot;None&quot;</span>);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="comment">// If we attempted to Poll or Read fdNone here. It would block forever unless written to by another thread.</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    }</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160; </div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160; </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-----------------------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-- Poll Event Fd, Flags: Semaphore ------------\n&quot;</span>);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-----------------------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <span class="comment">// EventFd Flags: Semaphore</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="comment">// Description: Wait on socketFd until readable OR until fdSemaphore is incremented</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <span class="comment">// in which case Poll and read SemaphoreCount times.</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="comment">// Set eventFd</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        fds[EventFdIndex].<a class="code" href="structnn_1_1socket_1_1_poll_fd.html#a778aa060c42157a250cf459f7cfea273">fd</a> = eventFds.fdSemaphore;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160; </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="comment">// If we attempted to Poll or Read (decrement) the fdSemaphore here,</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="comment">// it would block forever unless written (incremented) to by another thread.</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Start Polling (EventFd Flags Semaphore)\n&quot;</span>);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160; </div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <span class="comment">// Signal interrupt thread to write (increment) to fdSemaphore.</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <span class="comment">// Synchronization is done to make behavior deterministic, removal would leave a valid program.</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <a class="code" href="namespacenn_1_1os.html#a9b959a51c1d28b76894597695fd3d081">nn::os::SignalEvent</a>(&amp;eventFds.writeNextEventFd);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="comment">// Decrement fdSemaphore by SemaphoreCount</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; SemaphoreCount; ++i)</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            <span class="comment">// Reset return events</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            fds[EventFdIndex].<a class="code" href="structnn_1_1socket_1_1_poll_fd.html#aca13d3c2b88fcd0292ecbcbbbc5f85dc">revents</a> = fds[SocketFdIndex].<a class="code" href="structnn_1_1socket_1_1_poll_fd.html#aca13d3c2b88fcd0292ecbcbbbc5f85dc">revents</a> = nn::socket::PollEvent::PollNone;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            <span class="comment">// Poll until either fd becomes readable.</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            <span class="keywordtype">int</span> pollRes = <a class="code" href="namespacenn_1_1socket.html#ad9e109d18fb43f275742d74d74d06cde">nn::socket::Poll</a>(fds, <a class="code" href="nn___macro_8h.html#acd3a418aa2fc4a6379eaa722181a46a6">NN_ARRAY_SIZE</a>(fds), <a class="code" href="namespacenn_1_1socket.html#ac63165d8f4ab675489cda23034aa9eeb">nn::socket::InfTim</a>);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Poll returned result: %d\n&quot;</span>, pollRes);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    PollEvent eventFd:  %s\n&quot;</span>, PollEventToString(fds[EventFdIndex].revents).c_str());</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    PollEvent socketFd: %s\n&quot;</span>, PollEventToString(fds[SocketFdIndex].revents).c_str());</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160; </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            <span class="comment">// Poll should only return because eventFd is now readable</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            <a class="code" href="nn___abort_8h.html#a5c1a90d3a6474658ae0ac5dc5bcb14e4">NN_ABORT_UNLESS</a>(fds[EventFdIndex].revents == <a class="code" href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a1b0bed7d85ba6b2cbe91629776e3ee6d">nn::socket::PollEvent::PollIn</a>);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160; </div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;            <span class="comment">// Decrement fdSemaphore counter for every read</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            ReadEventFd(eventFds.fdSemaphore, <span class="stringliteral">&quot;Semaphore&quot;</span>);</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        }</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="comment">// If we attempted to Poll or Read (decrement) the fdSemaphore here,</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="comment">// it would block forever unless written (incremented) to by another thread.</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160; </div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160; </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-----------------------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-- Poll Event Fd, Flags: Nonblock -------------\n&quot;</span>);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-----------------------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="comment">// EventFd Flags: Nonblock</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="comment">// Description: Behaves the same as None option, but EventFdRead will return EAgain</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="comment">// error instead of blocking when the EventFd is not readable.</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    {</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="comment">// Set eventFd</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        fds[EventFdIndex].<a class="code" href="structnn_1_1socket_1_1_poll_fd.html#a778aa060c42157a250cf459f7cfea273">fd</a> = eventFds.fdNonBlock;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;        <span class="comment">// Reset return events</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        fds[EventFdIndex].<a class="code" href="structnn_1_1socket_1_1_poll_fd.html#aca13d3c2b88fcd0292ecbcbbbc5f85dc">revents</a> = fds[SocketFdIndex].<a class="code" href="structnn_1_1socket_1_1_poll_fd.html#aca13d3c2b88fcd0292ecbcbbbc5f85dc">revents</a> = nn::socket::PollEvent::PollNone;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160; </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="comment">// If we attempted to Poll fdNonBlock, it would block forever unless written to by another thread.</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="comment">// Attempting to read from a fdNonBlock eventFd. This will return error EAgain.</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        ReadEventFd(eventFds.fdNonBlock, <span class="stringliteral">&quot;Nonblock, EAgain expected&quot;</span>);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160; </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Starting Poll (EventFd Flags Nonblock)\n&quot;</span>);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160; </div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="comment">// Signal interrupt thread to write to fdNonBlock.</span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="comment">// Synchronization is done to make program valid and deterministic.</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <a class="code" href="namespacenn_1_1os.html#a9b959a51c1d28b76894597695fd3d081">nn::os::SignalEvent</a>(&amp;eventFds.writeNextEventFd);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160; </div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="comment">// Poll until either fd becomes readable.</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="keywordtype">int</span> pollRes = <a class="code" href="namespacenn_1_1socket.html#ad9e109d18fb43f275742d74d74d06cde">nn::socket::Poll</a>(fds, <a class="code" href="nn___macro_8h.html#acd3a418aa2fc4a6379eaa722181a46a6">NN_ARRAY_SIZE</a>(fds), <a class="code" href="namespacenn_1_1socket.html#ac63165d8f4ab675489cda23034aa9eeb">nn::socket::InfTim</a>);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Poll returned result: %d\n&quot;</span>, pollRes);</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    PollEvent eventFd:  %s\n&quot;</span>, PollEventToString(fds[EventFdIndex].revents).c_str());</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    PollEvent socketFd: %s\n&quot;</span>, PollEventToString(fds[SocketFdIndex].revents).c_str());</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="comment">// Poll should only return because eventFd is now readable</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <a class="code" href="nn___abort_8h.html#a5c1a90d3a6474658ae0ac5dc5bcb14e4">NN_ABORT_UNLESS</a>(fds[EventFdIndex].revents == <a class="code" href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a1b0bed7d85ba6b2cbe91629776e3ee6d">nn::socket::PollEvent::PollIn</a>);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="comment">// Read value from event Fd</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        ReadEventFd(eventFds.fdNonBlock, <span class="stringliteral">&quot;Nonblock&quot;</span>);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="comment">// If we attempted to Poll fdNonBlock, it would block forever unless written to by another thread.</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160; </div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        <span class="comment">// Attempting to read from a fdNonBlock eventFd. This will return error EAgain.</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;        ReadEventFd(eventFds.fdNonBlock, <span class="stringliteral">&quot;Nonblock, EAgain expected&quot;</span>);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    }</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160; </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-----------------------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-- Poll Event Fd, Flags: SemaphoreAndNonBlock -\n&quot;</span>);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-----------------------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <span class="comment">// EventFd Flags: SemaphoreAndNonBlocking</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="comment">// Description: Behaves the same as the Semaphore option, but EventFdRead will return EAagin</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="comment">// error instead of blocking when fdSemaphoreAndNonBlock cannot be decremented.</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    {</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="comment">// Set eventFd</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        fds[EventFdIndex].<a class="code" href="structnn_1_1socket_1_1_poll_fd.html#a778aa060c42157a250cf459f7cfea273">fd</a> = eventFds.fdSemaphoreAndNonBlock;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="comment">// If we attempted to Poll the fdSemaphoreAndNonBlock here,</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="comment">// it would block forever unless written (incremented) to by another thread.</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="comment">// Attempting to read from fdSemaphoreAndNonBlock eventFd. This will return error EAgain.</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        ReadEventFd(eventFds.fdSemaphoreAndNonBlock, <span class="stringliteral">&quot;Semaphore, EAgain expected&quot;</span>);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Start Polling (EventFd Flags SemaphoreAndNonBlock)\n&quot;</span>);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="comment">// Signal interrupt thread to write (increment) to fdSemaphoreAndNonBlock.</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="comment">// Synchronization is done to make program valid and deterministic.</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <a class="code" href="namespacenn_1_1os.html#a9b959a51c1d28b76894597695fd3d081">nn::os::SignalEvent</a>(&amp;eventFds.writeNextEventFd);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160; </div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="comment">// Decrement fdSemaphore by SemaphoreCount</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; SemaphoreCount; ++i)</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            <span class="comment">// Reset return events</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            fds[EventFdIndex].<a class="code" href="structnn_1_1socket_1_1_poll_fd.html#aca13d3c2b88fcd0292ecbcbbbc5f85dc">revents</a> = fds[SocketFdIndex].<a class="code" href="structnn_1_1socket_1_1_poll_fd.html#aca13d3c2b88fcd0292ecbcbbbc5f85dc">revents</a> = nn::socket::PollEvent::PollNone;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            <span class="comment">// Poll until either fd becomes readable.</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            <span class="keywordtype">int</span> pollRes = <a class="code" href="namespacenn_1_1socket.html#ad9e109d18fb43f275742d74d74d06cde">nn::socket::Poll</a>(fds, <a class="code" href="nn___macro_8h.html#acd3a418aa2fc4a6379eaa722181a46a6">NN_ARRAY_SIZE</a>(fds), <a class="code" href="namespacenn_1_1socket.html#ac63165d8f4ab675489cda23034aa9eeb">nn::socket::InfTim</a>);</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Poll returned result: %d\n&quot;</span>, pollRes);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    PollEvent eventFd:  %s\n&quot;</span>, PollEventToString(fds[EventFdIndex].revents).c_str());</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    PollEvent socketFd: %s\n&quot;</span>, PollEventToString(fds[SocketFdIndex].revents).c_str());</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            <span class="comment">// Poll should only return because eventFd is now readable</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            <a class="code" href="nn___abort_8h.html#a5c1a90d3a6474658ae0ac5dc5bcb14e4">NN_ABORT_UNLESS</a>(fds[EventFdIndex].revents == <a class="code" href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a1b0bed7d85ba6b2cbe91629776e3ee6d">nn::socket::PollEvent::PollIn</a>);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <span class="comment">// Decrement fdSemaphore counter for every read</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            ReadEventFd(eventFds.fdSemaphoreAndNonBlock, <span class="stringliteral">&quot;Semaphore&quot;</span>);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        }</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="comment">// If we attempted to Poll the fdSemaphoreAndNonBlock here,</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;        <span class="comment">// it would block forever unless written (incremented) to by another thread.</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        <span class="comment">// Attempting to read from fdSemaphoreAndNonBlock eventFd. This will return error EAgain.</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        ReadEventFd(eventFds.fdSemaphoreAndNonBlock, <span class="stringliteral">&quot;Semaphore, EAgain expected&quot;</span>);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    }</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160; </div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <a class="code" href="namespacenn_1_1socket.html#ae01110d228e2148d830b1ecfb9aaa425">nn::socket::Close</a>(socketFd);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <span class="comment">// Wait for interrupt thread to terminate, it has a ptr to the EventFds on our stack.</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a8070c91be85c5ccb36b56e9ff3a75b26">nn::os::WaitThread</a>( &amp;interruptThread );</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;}</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; </div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="keywordtype">void</span> <a class="code" href="_socket_event_fd_8cpp.html#ac3b5f1d8c72de1a4cfe464ad90f5f274">SelectExample</a>()</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;{</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="comment">// Interrupt thread is used to wakeup the main thread from Select()</span></div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <a class="code" href="structnn_1_1os_1_1_thread_type.html">nn::os::ThreadType</a> interruptThread;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="comment">// Contructor will creates 4 EventFds, 1 for each type:</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="comment">// fdNone:                 socket emulation</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="comment">// fdSemaphore:            socket emulation with decremented read count</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="comment">// fdNonBlock:             socket emulation with nonblocking read when unreadable</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="comment">// fdSemaphoreAndNonBlock: socket enumation with decremented read count and nonblocking read when unreadable</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;    ExampleEventFdData eventFds;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160; </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="comment">// Used by Select()</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <a class="code" href="structnn_1_1socket_1_1_fd_set.html">nn::socket::FdSet</a> fdSet = {};</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160; </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="comment">// Create worker interruptThread to interrupt us from our Select() call</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>(<a class="code" href="namespacenn_1_1os.html#a75f43e1d3c194c0d2173ef5d95785933">nn::os::CreateThread</a>(&amp;interruptThread, ExampleInterrupter, &amp;eventFds, g_threadInterruptStack, ThreadStackSize, <a class="code" href="namespacenn_1_1os.html#a5985811d04e64c0823ed758fd420591d">nn::os::DefaultThreadPriority</a>));</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a18eec7c4c4c298f7abaa9ef41d6de76b">nn::os::StartThread</a>(&amp;interruptThread);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="comment">// Make a socket fd. In this example it will never become readable.</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordtype">int</span> socketFd = <a class="code" href="namespacenn_1_1socket.html#a9afeb564bac1d0c04af2fec1f00c739f">nn::socket::Socket</a>(<a class="code" href="namespacenn_1_1socket.html#a057d985148e23267303e6d00d7ed205daa4d833d8c15a76105639ddd11bcb614e">nn::socket::Family::Af_Inet</a>, <a class="code" href="namespacenn_1_1socket.html#a1db675083dcccec6500d1435c5dfeaeaa4cc079142a1be58955eb22bed651ebba">nn::socket::Type::Sock_Dgram</a>, <a class="code" href="namespacenn_1_1socket.html#a46347de69614965469ac8f3c8056468ea48e0b0b8eaaf71a2c2c0ebfa0e802b1a">nn::socket::Protocol::IpProto_Udp</a>);</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">if</span>(socketFd &lt; 0)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <a class="code" href="nn___abort_8h.html#a205eaac89c47d49cb982bf136e113de2">NN_ABORT</a>(<span class="stringliteral">&quot;nn::socket::Socket() failed (error %d)\n&quot;</span>, <a class="code" href="namespacenn_1_1socket.html#a6db6951cb084f74f4c17d655ce798890">nn::socket::GetLastError</a>());</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    }</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160; </div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="comment">// Get max fdIndex</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <span class="keywordtype">int</span> maxFdIndex = -1;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="keywordflow">if</span>(socketFd                        &gt; maxFdIndex) maxFdIndex = socketFd;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="keywordflow">if</span>(eventFds.fdNone                 &gt; maxFdIndex) maxFdIndex = eventFds.fdNone;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordflow">if</span>(eventFds.fdSemaphore            &gt; maxFdIndex) maxFdIndex = eventFds.fdSemaphore;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="keywordflow">if</span>(eventFds.fdNonBlock             &gt; maxFdIndex) maxFdIndex = eventFds.fdNonBlock;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="keywordflow">if</span>(eventFds.fdSemaphoreAndNonBlock &gt; maxFdIndex) maxFdIndex = eventFds.fdSemaphoreAndNonBlock;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    }</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    maxFdIndex += 1;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-------------------------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-- Select Event Fd, Flags: None -----------------\n&quot;</span>);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-------------------------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="comment">// EventFd Flags: None</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="comment">// Description: Wait on socketFd until readable OR until our interrupt thread makes fdNone readable</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    {</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <span class="comment">// Set eventFd</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <a class="code" href="namespacenn_1_1socket.html#aa62380fb58406f3d7e83ea25c6deab35">nn::socket::FdSetZero</a>(&amp;fdSet);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        <a class="code" href="namespacenn_1_1socket.html#a1ea80c65c3a931a374bf2f0aab5153d1">nn::socket::FdSetSet</a>(eventFds.fdNone, &amp;fdSet);</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <a class="code" href="namespacenn_1_1socket.html#a1ea80c65c3a931a374bf2f0aab5153d1">nn::socket::FdSetSet</a>(socketFd, &amp;fdSet);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <span class="comment">// If we attempted to Select or Read fdNone here. It would block forever unless written to by another thread.</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160; </div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Select started (EventFd Flags None)\n&quot;</span>);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160; </div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="comment">// Signal interrupt thread write to fdNone.</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="comment">// Synchronization is done to make behavior deterministic, removal would leave a valid program.</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <a class="code" href="namespacenn_1_1os.html#a9b959a51c1d28b76894597695fd3d081">nn::os::SignalEvent</a>(&amp;eventFds.writeNextEventFd);</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160; </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="comment">// Select until either fd becomes readable.</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="keywordtype">int</span> selectRes = <a class="code" href="namespacenn_1_1socket.html#aa523b16a6004b8748cc0116f9ed65dd2">nn::socket::Select</a>(maxFdIndex, &amp;fdSet, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Select returned result: %d\n&quot;</span>, selectRes);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    Select eventFd is %sreadable\n&quot;</span>, <a class="code" href="namespacenn_1_1socket.html#a8f66b219c3bb6d59b09f26ee75348f82">nn::socket::FdSetIsSet</a>(eventFds.fdNone, &amp;fdSet) ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;not &quot;</span>);</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    Select socketFd is %sreadable\n&quot;</span>, <a class="code" href="namespacenn_1_1socket.html#a8f66b219c3bb6d59b09f26ee75348f82">nn::socket::FdSetIsSet</a>(socketFd, &amp;fdSet) ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;not &quot;</span>);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="comment">// Read value from event FD</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        ReadEventFd(eventFds.fdNone, <span class="stringliteral">&quot;None&quot;</span>);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160; </div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="comment">// If we attempted to Select or Read again. It would block forever unless written to by another thread.</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    }</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-------------------------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-- Select Event Fd, Flags: Semaphore ------------\n&quot;</span>);</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-------------------------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="comment">// EventFd Flags: Semaphore</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <span class="comment">// Description: wait on socketFd until readable OR until fdSemaphore is incremented</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    <span class="comment">// in which case Select and read SemaphoreCount times.</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    {</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <span class="comment">// If we attempted to Select or Read (decrement) the fdSemaphore here,</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        <span class="comment">// it would block forever unless written (incremented) to by another thread.</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160; </div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Select started (EventFd Flags Semaphore)\n&quot;</span>);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160; </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="comment">// Signal interrupt thread write (increment) to fdSemaphore.</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="comment">// Synchronization is done to make behavior deterministic, removal would leave a valid program.</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <a class="code" href="namespacenn_1_1os.html#a9b959a51c1d28b76894597695fd3d081">nn::os::SignalEvent</a>(&amp;eventFds.writeNextEventFd);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160; </div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <span class="comment">// Decrement fdSemaphore by SemaphoreCount</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; SemaphoreCount; ++i)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        {</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            <span class="comment">// Set eventFd</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            <a class="code" href="namespacenn_1_1socket.html#aa62380fb58406f3d7e83ea25c6deab35">nn::socket::FdSetZero</a>(&amp;fdSet);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            <a class="code" href="namespacenn_1_1socket.html#a1ea80c65c3a931a374bf2f0aab5153d1">nn::socket::FdSetSet</a>(eventFds.fdSemaphore, &amp;fdSet);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            <a class="code" href="namespacenn_1_1socket.html#a1ea80c65c3a931a374bf2f0aab5153d1">nn::socket::FdSetSet</a>(socketFd, &amp;fdSet);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160; </div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            <span class="keywordtype">int</span> selectRes = <a class="code" href="namespacenn_1_1socket.html#aa523b16a6004b8748cc0116f9ed65dd2">nn::socket::Select</a>(maxFdIndex, &amp;fdSet, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Select returned result: %d\n&quot;</span>, selectRes);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    Select eventFd is %sreadable\n&quot;</span>, <a class="code" href="namespacenn_1_1socket.html#a8f66b219c3bb6d59b09f26ee75348f82">nn::socket::FdSetIsSet</a>(eventFds.fdSemaphore, &amp;fdSet) ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;not &quot;</span>);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    Select socketFd is %sreadable\n&quot;</span>, <a class="code" href="namespacenn_1_1socket.html#a8f66b219c3bb6d59b09f26ee75348f82">nn::socket::FdSetIsSet</a>(socketFd, &amp;fdSet) ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;not &quot;</span>);</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160; </div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <span class="comment">// Reading will decrement fdSemaphore&#39;s counter</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            ReadEventFd(eventFds.fdSemaphore, <span class="stringliteral">&quot;Semaphore&quot;</span>);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        }</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;        <span class="comment">// If we attempted to Select or Read (decrement) the fdSemaphore here,</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <span class="comment">// it would block forever unless written (incremented) to by another thread.</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160; </div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-------------------------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-- Select Event Fd, Flags: Nonblock -------------\n&quot;</span>);</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-------------------------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="comment">// EventFd Flags: Nonblock</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <span class="comment">// Description: Behaves the same as None, but Read will return an error instead of blocking</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    {</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="comment">// Set eventFd</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <a class="code" href="namespacenn_1_1socket.html#aa62380fb58406f3d7e83ea25c6deab35">nn::socket::FdSetZero</a>(&amp;fdSet);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        <a class="code" href="namespacenn_1_1socket.html#a1ea80c65c3a931a374bf2f0aab5153d1">nn::socket::FdSetSet</a>(eventFds.fdNonBlock, &amp;fdSet);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <a class="code" href="namespacenn_1_1socket.html#a1ea80c65c3a931a374bf2f0aab5153d1">nn::socket::FdSetSet</a>(socketFd, &amp;fdSet);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160; </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;        <span class="comment">// If we attempted to Select fdNonBlock, it would block forever unless written to by another thread.</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160; </div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <span class="comment">// Attempting to read from a fdNonBlock eventFd. This will return error EAgain.</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        ReadEventFd(eventFds.fdNonBlock, <span class="stringliteral">&quot;Nonblock, EAgain expected&quot;</span>);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Select started (EventFd Flags Nonblock)\n&quot;</span>);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160; </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="comment">// Signal interrupt thread to write to fdNonBlock.</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="comment">// Synchronization is done to make program valid and deterministic.</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <a class="code" href="namespacenn_1_1os.html#a9b959a51c1d28b76894597695fd3d081">nn::os::SignalEvent</a>(&amp;eventFds.writeNextEventFd);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        <span class="comment">// Select until either fd becomes readable.</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordtype">int</span> selectRes = <a class="code" href="namespacenn_1_1socket.html#aa523b16a6004b8748cc0116f9ed65dd2">nn::socket::Select</a>(maxFdIndex, &amp;fdSet, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Select returned result: %d\n&quot;</span>, selectRes);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    Select eventFd is %sreadable\n&quot;</span>, <a class="code" href="namespacenn_1_1socket.html#a8f66b219c3bb6d59b09f26ee75348f82">nn::socket::FdSetIsSet</a>(eventFds.fdNonBlock, &amp;fdSet) ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;not &quot;</span>);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    Select socketFd is %sreadable\n&quot;</span>, <a class="code" href="namespacenn_1_1socket.html#a8f66b219c3bb6d59b09f26ee75348f82">nn::socket::FdSetIsSet</a>(socketFd, &amp;fdSet) ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;not &quot;</span>);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160; </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="comment">// Read value from event Fd</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        ReadEventFd(eventFds.fdNonBlock, <span class="stringliteral">&quot;Nonblock&quot;</span>);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160; </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        <span class="comment">// If we attempted to Select fdNonBlock, it would block forever unless written to by another thread.</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160; </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="comment">// Attempting to read from a fdNonBlock eventFd. This will return error EAgain.</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        ReadEventFd(eventFds.fdNonBlock, <span class="stringliteral">&quot;Nonblock, EAgain expected&quot;</span>);</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160; </div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-------------------------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-- Select Event Fd, Flags: SemaphoreAndNonBlock -\n&quot;</span>);</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;-------------------------------------------------\n&quot;</span>);</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="comment">// EventFd Flags: SemaphoreAndNonBlocking</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    <span class="comment">// Description: Same as fdSemaphore with the addition that a call to read will return an error instead of blocking</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="comment">// See examples above for details</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    {</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;        <span class="comment">// If we attempted to Select the fdSemaphoreAndNonBlock here,</span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="comment">// it would block forever unless written (incremented) to by another thread.</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160; </div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        <span class="comment">// Attempting to read from fdSemaphoreAndNonBlock eventFd. This will return error EAgain.</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;        ReadEventFd(eventFds.fdSemaphoreAndNonBlock, <span class="stringliteral">&quot;SemaphoreAndNonBlock, EAgain expected&quot;</span>);</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;        <span class="comment">// Signal interrupt thread to write (increment) to fdSemaphoreAndNonBlock.</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <span class="comment">// Synchronization is done to make program valid and deterministic.</span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <a class="code" href="namespacenn_1_1os.html#a9b959a51c1d28b76894597695fd3d081">nn::os::SignalEvent</a>(&amp;eventFds.writeNextEventFd);</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="comment">// Decrement fdSemaphore by SemaphoreCount</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; SemaphoreCount; ++i)</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        {</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            <span class="comment">// Set eventFd</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            <a class="code" href="namespacenn_1_1socket.html#aa62380fb58406f3d7e83ea25c6deab35">nn::socket::FdSetZero</a>(&amp;fdSet);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;            <a class="code" href="namespacenn_1_1socket.html#a1ea80c65c3a931a374bf2f0aab5153d1">nn::socket::FdSetSet</a>(eventFds.fdSemaphoreAndNonBlock, &amp;fdSet);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;            <a class="code" href="namespacenn_1_1socket.html#a1ea80c65c3a931a374bf2f0aab5153d1">nn::socket::FdSetSet</a>(socketFd, &amp;fdSet);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160; </div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Select started (EventFd Flags SemaphoreAndNonBlock)\n&quot;</span>);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;            <span class="keywordtype">int</span> selectRes = <a class="code" href="namespacenn_1_1socket.html#aa523b16a6004b8748cc0116f9ed65dd2">nn::socket::Select</a>(maxFdIndex, &amp;fdSet, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;            <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Select returned result: %d\n&quot;</span>, selectRes);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    Select eventFd is %sreadable\n&quot;</span>, <a class="code" href="namespacenn_1_1socket.html#a8f66b219c3bb6d59b09f26ee75348f82">nn::socket::FdSetIsSet</a>(eventFds.fdSemaphoreAndNonBlock, &amp;fdSet) ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;not &quot;</span>);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;    Select socketFd is %sreadable\n&quot;</span>, <a class="code" href="namespacenn_1_1socket.html#a8f66b219c3bb6d59b09f26ee75348f82">nn::socket::FdSetIsSet</a>(socketFd, &amp;fdSet) ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;not &quot;</span>);</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160; </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            <span class="comment">// Decrement fdSemaphore counter for every read</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            ReadEventFd(eventFds.fdSemaphoreAndNonBlock, <span class="stringliteral">&quot;SemaphoreAndNonBlock&quot;</span>);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        }</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160; </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <span class="comment">// If we attempted to Select the fdSemaphoreAndNonBlock here,</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="comment">// it would block forever unless written (incremented) to by another thread.</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160; </div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="comment">// Attempting to read from fdSemaphoreAndNonBlock eventFd. This will return error EAgain.</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        ReadEventFd(eventFds.fdSemaphoreAndNonBlock, <span class="stringliteral">&quot;SemaphoreAndNonBlock, EAgain expected&quot;</span>);</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    }</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <a class="code" href="namespacenn_1_1socket.html#ae01110d228e2148d830b1ecfb9aaa425">nn::socket::Close</a>(socketFd);</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    <span class="comment">// Wait for interrupt thread to terminate, it has a ptr to the EventFds on our stack.</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a8070c91be85c5ccb36b56e9ff3a75b26">nn::os::WaitThread</a>(&amp;interruptThread);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;}</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> <a class="code" href="_socket_event_fd_8cpp.html#ae79180f8ae90e05743b47a872f305a52">nnMain</a>()</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;{</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="comment">// Initialize the socket library</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="namespacenn_1_1socket.html#adacc3405184e8f28fb630745b9f43db0">nn::socket::Initialize</a>(g_SocketConfigWithMemory).IsFailure())</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    {</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <a class="code" href="nn___abort_8h.html#a205eaac89c47d49cb982bf136e113de2">NN_ABORT</a>(<span class="stringliteral">&quot;nn::socket::Initialize failed, ensure that your SDEV is properly configured\n&quot;</span>);</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    }</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="comment">// EventFd&#39;s usage with Poll()</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <a class="code" href="_socket_event_fd_8cpp.html#a5a2b600f6e6c5792cf99dcb421973db6">PollExample</a>();</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160; </div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="comment">// EventFd&#39;s usage with Select()</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    <a class="code" href="_socket_event_fd_8cpp.html#ac3b5f1d8c72de1a4cfe464ad90f5f274">SelectExample</a>();</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160; </div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="comment">// Finalize the socket library</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    <a class="code" href="namespacenn_1_1socket.html#a28a801f086aadf0b731a721567f3e4b2">nn::socket::Finalize</a>();</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;}</div>
<div class="ttc" id="a_socket_event_fd_8cpp_html_a5a2b600f6e6c5792cf99dcb421973db6"><div class="ttname"><a href="_socket_event_fd_8cpp.html#a5a2b600f6e6c5792cf99dcb421973db6">PollExample</a></div><div class="ttdeci">void PollExample()</div><div class="ttdoc">PollExample Example usage of nn::socket::Poll() and eventFd for all eventFd flags.</div><div class="ttdef"><b>Definition:</b> SocketEventFd.cpp:276</div></div>
<div class="ttc" id="a_socket_event_fd_8cpp_html_ac3b5f1d8c72de1a4cfe464ad90f5f274"><div class="ttname"><a href="_socket_event_fd_8cpp.html#ac3b5f1d8c72de1a4cfe464ad90f5f274">SelectExample</a></div><div class="ttdeci">void SelectExample()</div><div class="ttdoc">SelectExample Example usage of nn::socket::Select() and eventFd for all eventFd flags.</div><div class="ttdef"><b>Definition:</b> SocketEventFd.cpp:487</div></div>
<div class="ttc" id="a_socket_event_fd_8cpp_html_ae79180f8ae90e05743b47a872f305a52"><div class="ttname"><a href="_socket_event_fd_8cpp.html#ae79180f8ae90e05743b47a872f305a52">nnMain</a></div><div class="ttdeci">void nnMain()</div><div class="ttdoc">nnMain Sample program, SocketEventFd, entry point.</div><div class="ttdef"><b>Definition:</b> SocketEventFd.cpp:681</div></div>
<div class="ttc" id="aclassnn_1_1socket_1_1_config_default_with_memory_html"><div class="ttname"><a href="classnn_1_1socket_1_1_config_default_with_memory.html">nn::socket::ConfigDefaultWithMemory</a></div><div class="ttdoc">Class specifying a default configuration.</div><div class="ttdef"><b>Definition:</b> socket_Config.h:627</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a11ab71d44973a4135958c420e5682452a31f6133098296b3ddb7e14da3dc695cc"><div class="ttname"><a href="namespacenn_1_1os.html#a11ab71d44973a4135958c420e5682452a31f6133098296b3ddb7e14da3dc695cc">nn::os::EventClearMode_AutoClear</a></div><div class="ttdeci">@ EventClearMode_AutoClear</div><div class="ttdoc">Automatically cleared event.</div><div class="ttdef"><b>Definition:</b> os_EventCommon.h:33</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a18eec7c4c4c298f7abaa9ef41d6de76b"><div class="ttname"><a href="namespacenn_1_1os.html#a18eec7c4c4c298f7abaa9ef41d6de76b">nn::os::StartThread</a></div><div class="ttdeci">void StartThread(ThreadType *thread) NN_NOEXCEPT</div><div class="ttdoc">Starts execution on a thread.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a5985811d04e64c0823ed758fd420591d"><div class="ttname"><a href="namespacenn_1_1os.html#a5985811d04e64c0823ed758fd420591d">nn::os::DefaultThreadPriority</a></div><div class="ttdeci">const int DefaultThreadPriority</div><div class="ttdoc">Constant indicating the default value of thread priority.</div><div class="ttdef"><b>Definition:</b> os_ThreadCommon.h:47</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a75f43e1d3c194c0d2173ef5d95785933"><div class="ttname"><a href="namespacenn_1_1os.html#a75f43e1d3c194c0d2173ef5d95785933">nn::os::CreateThread</a></div><div class="ttdeci">nn::Result CreateThread(ThreadType *thread, ThreadFunction function, void *argument, void *stack, size_t stackSize, int priority, int idealCoreNumber) NN_NOEXCEPT</div><div class="ttdoc">Generates a thread.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a8070c91be85c5ccb36b56e9ff3a75b26"><div class="ttname"><a href="namespacenn_1_1os.html#a8070c91be85c5ccb36b56e9ff3a75b26">nn::os::WaitThread</a></div><div class="ttdeci">void WaitThread(ThreadType *thread) NN_NOEXCEPT</div><div class="ttdoc">Waits for the specified thread to stop.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a9b959a51c1d28b76894597695fd3d081"><div class="ttname"><a href="namespacenn_1_1os.html#a9b959a51c1d28b76894597695fd3d081">nn::os::SignalEvent</a></div><div class="ttdeci">void SignalEvent(EventType *event) NN_NOEXCEPT</div><div class="ttdoc">Puts an EventType object in a signaled state.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_aabdcb2de0b5dbdd64a0ec3d7e65c72f4"><div class="ttname"><a href="namespacenn_1_1os.html#aabdcb2de0b5dbdd64a0ec3d7e65c72f4">nn::os::WaitEvent</a></div><div class="ttdeci">void WaitEvent(EventType *event) NN_NOEXCEPT</div><div class="ttdoc">Waits for an EventType object to enter a signaled state.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_adae3d14bd5e37dd1feee56bbf1717e37"><div class="ttname"><a href="namespacenn_1_1os.html#adae3d14bd5e37dd1feee56bbf1717e37">nn::os::FinalizeEvent</a></div><div class="ttdeci">void FinalizeEvent(EventType *event) NN_NOEXCEPT</div><div class="ttdoc">Finalizes an EventType object.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_af07abef747ac6b51112b9e800ba9632c"><div class="ttname"><a href="namespacenn_1_1os.html#af07abef747ac6b51112b9e800ba9632c">nn::os::InitializeEvent</a></div><div class="ttdeci">void InitializeEvent(EventType *event, bool initiallySignaled, EventClearMode clearMode) NN_NOEXCEPT</div><div class="ttdoc">Initializes an EventType object.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a057d985148e23267303e6d00d7ed205daa4d833d8c15a76105639ddd11bcb614e"><div class="ttname"><a href="namespacenn_1_1socket.html#a057d985148e23267303e6d00d7ed205daa4d833d8c15a76105639ddd11bcb614e">nn::socket::Family::Af_Inet</a></div><div class="ttdeci">@ Af_Inet</div><div class="ttdoc">Internet Version 4.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a1db675083dcccec6500d1435c5dfeaeaa4cc079142a1be58955eb22bed651ebba"><div class="ttname"><a href="namespacenn_1_1socket.html#a1db675083dcccec6500d1435c5dfeaeaa4cc079142a1be58955eb22bed651ebba">nn::socket::Type::Sock_Dgram</a></div><div class="ttdeci">@ Sock_Dgram</div><div class="ttdoc">Datagram socket.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a1ea80c65c3a931a374bf2f0aab5153d1"><div class="ttname"><a href="namespacenn_1_1socket.html#a1ea80c65c3a931a374bf2f0aab5153d1">nn::socket::FdSetSet</a></div><div class="ttdeci">long FdSetSet(int fd, FdSet *pFdset) NN_NOEXCEPT</div><div class="ttdoc">Includes a particular descriptor fd in fdset.</div><div class="ttdef"><b>Definition:</b> socket_Api.h:1425</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a28a801f086aadf0b731a721567f3e4b2"><div class="ttname"><a href="namespacenn_1_1socket.html#a28a801f086aadf0b731a721567f3e4b2">nn::socket::Finalize</a></div><div class="ttdeci">Result Finalize() NN_NOEXCEPT</div><div class="ttdoc">Finalize socket library.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a2b8c53cba8a2be170c93a76742b092c9"><div class="ttname"><a href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9">nn::socket::PollEvent</a></div><div class="ttdeci">PollEvent</div><div class="ttdoc">Poll events.</div><div class="ttdef"><b>Definition:</b> socket_Types.h:128</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a2b8c53cba8a2be170c93a76742b092c9a1034fc649394d42b19fead1ab1828e54"><div class="ttname"><a href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a1034fc649394d42b19fead1ab1828e54">nn::socket::PollEvent::PollPri</a></div><div class="ttdeci">@ PollPri</div><div class="ttdoc">High priority data may be read without blocking.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a2b8c53cba8a2be170c93a76742b092c9a1b0bed7d85ba6b2cbe91629776e3ee6d"><div class="ttname"><a href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a1b0bed7d85ba6b2cbe91629776e3ee6d">nn::socket::PollEvent::PollIn</a></div><div class="ttdeci">@ PollIn</div><div class="ttdoc">Data other than high priority data may be read without blocking.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a2b8c53cba8a2be170c93a76742b092c9a2421093408548ab23a7a93500e8cccd3"><div class="ttname"><a href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a2421093408548ab23a7a93500e8cccd3">nn::socket::PollEvent::PollHup</a></div><div class="ttdeci">@ PollHup</div><div class="ttdoc">The device or socket has been disconnected.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a2b8c53cba8a2be170c93a76742b092c9a6aee635278505dd8cc1da7f50c4a651d"><div class="ttname"><a href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a6aee635278505dd8cc1da7f50c4a651d">nn::socket::PollEvent::PollErr</a></div><div class="ttdeci">@ PollErr</div><div class="ttdoc">An exceptional condition has occurred on the device or socket.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a2b8c53cba8a2be170c93a76742b092c9a70417b0dc75887023e5fa42ca645d4c9"><div class="ttname"><a href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a70417b0dc75887023e5fa42ca645d4c9">nn::socket::PollEvent::PollWrBand</a></div><div class="ttdeci">@ PollWrBand</div><div class="ttdoc">Data with a non-zero priority may be written without blocking.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a2b8c53cba8a2be170c93a76742b092c9a9b8ce4bb4c25d8b2abc5e5648c9cd54a"><div class="ttname"><a href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9a9b8ce4bb4c25d8b2abc5e5648c9cd54a">nn::socket::PollEvent::PollRdBand</a></div><div class="ttdeci">@ PollRdBand</div><div class="ttdoc">Data with a non-zero priority may be read without blocking.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a2b8c53cba8a2be170c93a76742b092c9aaf909a6e6a64bebd393ae9fbc33f200a"><div class="ttname"><a href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9aaf909a6e6a64bebd393ae9fbc33f200a">nn::socket::PollEvent::PollRdNorm</a></div><div class="ttdeci">@ PollRdNorm</div><div class="ttdoc">Normal data may be read without blocking.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a2b8c53cba8a2be170c93a76742b092c9aca8de23660319dc20822f6e6059a727b"><div class="ttname"><a href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9aca8de23660319dc20822f6e6059a727b">nn::socket::PollEvent::PollOut</a></div><div class="ttdeci">@ PollOut</div><div class="ttdoc">File descriptor is writeable.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a2b8c53cba8a2be170c93a76742b092c9aecf0948bef1a1db017a0d4e714f05c04"><div class="ttname"><a href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9aecf0948bef1a1db017a0d4e714f05c04">nn::socket::PollEvent::PollNVal</a></div><div class="ttdeci">@ PollNVal</div><div class="ttdoc">The file descriptor is not open.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a2b8c53cba8a2be170c93a76742b092c9af5abb7d0050a44e425556082ae71b547"><div class="ttname"><a href="namespacenn_1_1socket.html#a2b8c53cba8a2be170c93a76742b092c9af5abb7d0050a44e425556082ae71b547">nn::socket::PollEvent::PollWrNorm</a></div><div class="ttdeci">@ PollWrNorm</div><div class="ttdoc">Normal data may be written without blocking.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a46347de69614965469ac8f3c8056468ea48e0b0b8eaaf71a2c2c0ebfa0e802b1a"><div class="ttname"><a href="namespacenn_1_1socket.html#a46347de69614965469ac8f3c8056468ea48e0b0b8eaaf71a2c2c0ebfa0e802b1a">nn::socket::Protocol::IpProto_Udp</a></div><div class="ttdeci">@ IpProto_Udp</div><div class="ttdoc">User datagram protocol.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a5175276a6b52a0b9d6e99a78ea330de5"><div class="ttname"><a href="namespacenn_1_1socket.html#a5175276a6b52a0b9d6e99a78ea330de5">nn::socket::EventFdRead</a></div><div class="ttdeci">int EventFdRead(int fd, EventFdType *value) NN_NOEXCEPT</div><div class="ttdoc">Read from an event fd.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a6db6951cb084f74f4c17d655ce798890"><div class="ttname"><a href="namespacenn_1_1socket.html#a6db6951cb084f74f4c17d655ce798890">nn::socket::GetLastError</a></div><div class="ttdeci">Errno GetLastError() NN_NOEXCEPT</div><div class="ttdoc">Read the global variable errno.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a8f66b219c3bb6d59b09f26ee75348f82"><div class="ttname"><a href="namespacenn_1_1socket.html#a8f66b219c3bb6d59b09f26ee75348f82">nn::socket::FdSetIsSet</a></div><div class="ttdeci">bool FdSetIsSet(int fd, const FdSet *pFdset) NN_NOEXCEPT</div><div class="ttdoc">Returns non-zero if fd is a member of pFdset, zero otherwise.</div><div class="ttdef"><b>Definition:</b> socket_Api.h:1467</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_a9afeb564bac1d0c04af2fec1f00c739f"><div class="ttname"><a href="namespacenn_1_1socket.html#a9afeb564bac1d0c04af2fec1f00c739f">nn::socket::Socket</a></div><div class="ttdeci">int Socket(Family domain, Type type, Protocol protocol) NN_NOEXCEPT</div><div class="ttdoc">Create endpoint for communication.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_aa523b16a6004b8748cc0116f9ed65dd2"><div class="ttname"><a href="namespacenn_1_1socket.html#aa523b16a6004b8748cc0116f9ed65dd2">nn::socket::Select</a></div><div class="ttdeci">int Select(int numberOfDescriptors, FdSet *pReadDescriptors, FdSet *pWriteDescriptors, FdSet *pExceptDescriptors, TimeVal *pTimeout) NN_NOEXCEPT</div><div class="ttdoc">Synchronous I/O multiplexing.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_aa62380fb58406f3d7e83ea25c6deab35"><div class="ttname"><a href="namespacenn_1_1socket.html#aa62380fb58406f3d7e83ea25c6deab35">nn::socket::FdSetZero</a></div><div class="ttdeci">void FdSetZero(FdSet *pFdset) NN_NOEXCEPT</div><div class="ttdoc">Initializes a descriptor set s to the null set.</div><div class="ttdef"><b>Definition:</b> socket_Api.h:1399</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_ac63165d8f4ab675489cda23034aa9eeb"><div class="ttname"><a href="namespacenn_1_1socket.html#ac63165d8f4ab675489cda23034aa9eeb">nn::socket::InfTim</a></div><div class="ttdeci">const int InfTim</div><div class="ttdoc">If poll timeout is InfTim (-1), the poll blocks indefinitely.</div><div class="ttdef"><b>Definition:</b> socket_Constants.h:99</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_ad1ade4838b158c7aaf9c9a78338e06aea54cafc2ec81f6d1fe8ba661ade3931cb"><div class="ttname"><a href="namespacenn_1_1socket.html#ad1ade4838b158c7aaf9c9a78338e06aea54cafc2ec81f6d1fe8ba661ade3931cb">nn::socket::Errno::EAgain</a></div><div class="ttdeci">@ EAgain</div><div class="ttdoc">11</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_ad9e109d18fb43f275742d74d74d06cde"><div class="ttname"><a href="namespacenn_1_1socket.html#ad9e109d18fb43f275742d74d74d06cde">nn::socket::Poll</a></div><div class="ttdeci">int Poll(PollFd *pSocketDescriptors, NfdsT numberOfDescriptors, int timeoutMilliseconds) NN_NOEXCEPT</div><div class="ttdoc">Synchronous I/O multiplexing.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_ada14f217430a89abc25c5c9ed822f115"><div class="ttname"><a href="namespacenn_1_1socket.html#ada14f217430a89abc25c5c9ed822f115">nn::socket::EventFdType</a></div><div class="ttdeci">uint64_t EventFdType</div><div class="ttdoc">Type for EventFdRead and EventFdWrite.</div><div class="ttdef"><b>Definition:</b> socket_Types.h:354</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_adacc3405184e8f28fb630745b9f43db0"><div class="ttname"><a href="namespacenn_1_1socket.html#adacc3405184e8f28fb630745b9f43db0">nn::socket::Initialize</a></div><div class="ttdeci">Result Initialize(const Config &amp;config) NN_NOEXCEPT</div><div class="ttdoc">Initialize socket library.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_ae01110d228e2148d830b1ecfb9aaa425"><div class="ttname"><a href="namespacenn_1_1socket.html#ae01110d228e2148d830b1ecfb9aaa425">nn::socket::Close</a></div><div class="ttdeci">int Close(int socket) NN_NOEXCEPT</div><div class="ttdoc">Delete a descriptor.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_ae1fd34e9d084e5bb0f17a6c2361896c2"><div class="ttname"><a href="namespacenn_1_1socket.html#ae1fd34e9d084e5bb0f17a6c2361896c2">nn::socket::Read</a></div><div class="ttdeci">int Read(int socket, void *outBuffer, size_t outBufferLength) NN_NOEXCEPT</div><div class="ttdoc">Read input.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_ae82dfb460b32b4e583f55b500385c776"><div class="ttname"><a href="namespacenn_1_1socket.html#ae82dfb460b32b4e583f55b500385c776">nn::socket::EventFd</a></div><div class="ttdeci">int EventFd(uint64_t initialValue, EventFdFlags flags) NN_NOEXCEPT</div><div class="ttdoc">Create an event fd.</div></div>
<div class="ttc" id="anamespacenn_1_1socket_html_af5535161f9c800ca7f7f9e7a854ba122"><div class="ttname"><a href="namespacenn_1_1socket.html#af5535161f9c800ca7f7f9e7a854ba122">nn::socket::EventFdWrite</a></div><div class="ttdeci">int EventFdWrite(int fd, EventFdType value) NN_NOEXCEPT</div><div class="ttdoc">Write to an event fd.</div></div>
<div class="ttc" id="ann___abort_8h_html"><div class="ttname"><a href="nn___abort_8h.html">nn_Abort.h</a></div><div class="ttdoc">Declarations for API resources to abort execution when conditions are not satisfied.</div></div>
<div class="ttc" id="ann___abort_8h_html_a1e657a678a588533a020c2e947df7772"><div class="ttname"><a href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a></div><div class="ttdeci">#define NN_ABORT_UNLESS_RESULT_SUCCESS(result)</div><div class="ttdoc">Tests whether the specified nn::Result is successful or not, and stops if it is not.</div><div class="ttdef"><b>Definition:</b> nn_Abort.h:188</div></div>
<div class="ttc" id="ann___abort_8h_html_a205eaac89c47d49cb982bf136e113de2"><div class="ttname"><a href="nn___abort_8h.html#a205eaac89c47d49cb982bf136e113de2">NN_ABORT</a></div><div class="ttdeci">#define NN_ABORT(...)</div><div class="ttdoc">Stops execution.</div><div class="ttdef"><b>Definition:</b> nn_Abort.h:29</div></div>
<div class="ttc" id="ann___abort_8h_html_a5c1a90d3a6474658ae0ac5dc5bcb14e4"><div class="ttname"><a href="nn___abort_8h.html#a5c1a90d3a6474658ae0ac5dc5bcb14e4">NN_ABORT_UNLESS</a></div><div class="ttdeci">#define NN_ABORT_UNLESS(condition,...)</div><div class="ttdoc">Tests whether a condition has been satisfied and stops execution if it has not.</div><div class="ttdef"><b>Definition:</b> nn_Abort.h:38</div></div>
<div class="ttc" id="ann___log_8h_html"><div class="ttname"><a href="nn___log_8h.html">nn_Log.h</a></div><div class="ttdoc">Declarations for the logging API.</div></div>
<div class="ttc" id="ann___log_8h_html_a2d720c8bc6b733bce63879350d134a84"><div class="ttname"><a href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a></div><div class="ttdeci">#define NN_LOG(...)</div><div class="ttdoc">Adds the string specified in the parameter as a log entry.</div><div class="ttdef"><b>Definition:</b> nn_Log.h:33</div></div>
<div class="ttc" id="ann___macro_8h_html"><div class="ttname"><a href="nn___macro_8h.html">nn_Macro.h</a></div><div class="ttdoc">Defines the macros used throughout all libraries.</div></div>
<div class="ttc" id="ann___macro_8h_html_a71c0f58f6d49fe1392380eed4509ab9a"><div class="ttname"><a href="nn___macro_8h.html#a71c0f58f6d49fe1392380eed4509ab9a">NN_STATIC_CONDITION</a></div><div class="ttdeci">#define NN_STATIC_CONDITION(condition)</div><div class="ttdoc">Suppresses compiler warnings on intentional, explicitly specified conditional constants.</div><div class="ttdef"><b>Definition:</b> nn_Macro.h:626</div></div>
<div class="ttc" id="ann___macro_8h_html_acd3a418aa2fc4a6379eaa722181a46a6"><div class="ttname"><a href="nn___macro_8h.html#acd3a418aa2fc4a6379eaa722181a46a6">NN_ARRAY_SIZE</a></div><div class="ttdeci">#define NN_ARRAY_SIZE(array)</div><div class="ttdoc">Gets the array size.</div><div class="ttdef"><b>Definition:</b> nn_Macro.h:696</div></div>
<div class="ttc" id="ann___time_span_8h_html"><div class="ttname"><a href="nn___time_span_8h.html">nn_TimeSpan.h</a></div><div class="ttdoc">TimeSpan class declarations.</div></div>
<div class="ttc" id="aos___event_8h_html"><div class="ttname"><a href="os___event_8h.html">os_Event.h</a></div><div class="ttdoc">Public header file for Event objects.</div></div>
<div class="ttc" id="aos___thread_common_8h_html_a5ce0c3c0aaceb976178a60a18d90f470"><div class="ttname"><a href="os___thread_common_8h.html#a5ce0c3c0aaceb976178a60a18d90f470">NN_OS_ALIGNAS_THREAD_STACK</a></div><div class="ttdeci">#define NN_OS_ALIGNAS_THREAD_STACK</div><div class="ttdoc">Macro to specify the stack space alignment.</div><div class="ttdef"><b>Definition:</b> os_ThreadCommon.h:108</div></div>
<div class="ttc" id="asocket_8h_html"><div class="ttname"><a href="socket_8h.html">socket.h</a></div><div class="ttdoc">Top level header defining the socket library API.</div></div>
<div class="ttc" id="astructnn_1_1os_1_1_event_type_html"><div class="ttname"><a href="structnn_1_1os_1_1_event_type.html">nn::os::EventType</a></div><div class="ttdoc">This structure defines an event object.</div><div class="ttdef"><b>Definition:</b> os_EventTypes.h:62</div></div>
<div class="ttc" id="astructnn_1_1os_1_1_thread_type_html"><div class="ttname"><a href="structnn_1_1os_1_1_thread_type.html">nn::os::ThreadType</a></div><div class="ttdoc">This structure defines a thread object.</div><div class="ttdef"><b>Definition:</b> os_ThreadTypes.h:92</div></div>
<div class="ttc" id="astructnn_1_1socket_1_1_fd_set_html"><div class="ttname"><a href="structnn_1_1socket_1_1_fd_set.html">nn::socket::FdSet</a></div><div class="ttdoc">Structure used for Select().</div><div class="ttdef"><b>Definition:</b> socket_Types.h:552</div></div>
<div class="ttc" id="astructnn_1_1socket_1_1_poll_fd_html"><div class="ttname"><a href="structnn_1_1socket_1_1_poll_fd.html">nn::socket::PollFd</a></div><div class="ttdoc">Structure used for Poll().</div><div class="ttdef"><b>Definition:</b> socket_Types.h:534</div></div>
<div class="ttc" id="astructnn_1_1socket_1_1_poll_fd_html_a778aa060c42157a250cf459f7cfea273"><div class="ttname"><a href="structnn_1_1socket_1_1_poll_fd.html#a778aa060c42157a250cf459f7cfea273">nn::socket::PollFd::fd</a></div><div class="ttdeci">int fd</div><div class="ttdoc">File descriptor to poll.</div><div class="ttdef"><b>Definition:</b> socket_Types.h:539</div></div>
<div class="ttc" id="astructnn_1_1socket_1_1_poll_fd_html_ab5c064cf340ae80e805a84e927dcdb9f"><div class="ttname"><a href="structnn_1_1socket_1_1_poll_fd.html#ab5c064cf340ae80e805a84e927dcdb9f">nn::socket::PollFd::events</a></div><div class="ttdeci">PollEvent events</div><div class="ttdoc">Events to poll for.</div><div class="ttdef"><b>Definition:</b> socket_Types.h:542</div></div>
<div class="ttc" id="astructnn_1_1socket_1_1_poll_fd_html_aca13d3c2b88fcd0292ecbcbbbc5f85dc"><div class="ttname"><a href="structnn_1_1socket_1_1_poll_fd.html#aca13d3c2b88fcd0292ecbcbbbc5f85dc">nn::socket::PollFd::revents</a></div><div class="ttdeci">PollEvent revents</div><div class="ttdoc">Events which may occur.</div><div class="ttdef"><b>Definition:</b> socket_Types.h:545</div></div>
</div><!-- fragment --><h2><a class="anchor" id="PageSampleSocketEventFd_SectionSampleDetail"></a>
Description of the sample program</h2>
<p>In this example we create a thread to write to the EventFd while our main thread is blocked in a call to Poll() or Select(). Once the thread writing to the EventFd has completed, our main thread will detect (via. Poll or Select) that the eventFd has become readable. Once we have returned from Poll() or Select() we can check to see if we have returned because of our EventFd or other events we are waiting on from the call.</p>
<p>For the above sample program the program layout is as follows.</p>
<ul>
<li><a class="el" href="_socket_event_fd_8cpp.html#ae79180f8ae90e05743b47a872f305a52" title="nnMain Sample program, SocketEventFd, entry point.">nnMain()</a> will initialize <a class="el" href="namespacenn_1_1socket.html" title="Socket library namespace.">nn::socket</a> library then call into the <a class="el" href="_socket_event_fd_8cpp.html#a5a2b600f6e6c5792cf99dcb421973db6" title="PollExample Example usage of nn::socket::Poll() and eventFd for all eventFd flags.">PollExample()</a> and <a class="el" href="_socket_event_fd_8cpp.html#ac3b5f1d8c72de1a4cfe464ad90f5f274" title="SelectExample Example usage of nn::socket::Select() and eventFd for all eventFd flags.">SelectExample()</a>.</li>
<li>In both <a class="el" href="_socket_event_fd_8cpp.html#a5a2b600f6e6c5792cf99dcb421973db6" title="PollExample Example usage of nn::socket::Poll() and eventFd for all eventFd flags.">PollExample()</a> and <a class="el" href="_socket_event_fd_8cpp.html#ac3b5f1d8c72de1a4cfe464ad90f5f274" title="SelectExample Example usage of nn::socket::Select() and eventFd for all eventFd flags.">SelectExample()</a> we create a interrupter thread which will write to given EventFd(s) to make them readable when appropriate.</li>
<li>The main thread will call Poll() and Select() multiple times and return once the the interrupter thread has made the EventFd readable.</li>
<li>The main thread has 4 examples in <a class="el" href="_socket_event_fd_8cpp.html#a5a2b600f6e6c5792cf99dcb421973db6" title="PollExample Example usage of nn::socket::Poll() and eventFd for all eventFd flags.">PollExample()</a> and <a class="el" href="_socket_event_fd_8cpp.html#ac3b5f1d8c72de1a4cfe464ad90f5f274" title="SelectExample Example usage of nn::socket::Select() and eventFd for all eventFd flags.">SelectExample()</a> which cover the different flags which may be set on the EventFd. EventFd flag behavior: fdNone: socket emulation. fdSemaphore: socket emulation with decremented read count. fdNonBlock: socket emulation with nonblocking read. fdSemaphoreAndNonBlock: socket enumation with decremented read count and nonblocking.</li>
<li>Once <a class="el" href="_socket_event_fd_8cpp.html#a5a2b600f6e6c5792cf99dcb421973db6" title="PollExample Example usage of nn::socket::Poll() and eventFd for all eventFd flags.">PollExample()</a> and <a class="el" href="_socket_event_fd_8cpp.html#ac3b5f1d8c72de1a4cfe464ad90f5f274" title="SelectExample Example usage of nn::socket::Select() and eventFd for all eventFd flags.">SelectExample()</a> have finished they wait for the the interrupter thread to complete.</li>
<li>After <a class="el" href="_socket_event_fd_8cpp.html#ae79180f8ae90e05743b47a872f305a52" title="nnMain Sample program, SocketEventFd, entry point.">nnMain()</a> returns from <a class="el" href="_socket_event_fd_8cpp.html#a5a2b600f6e6c5792cf99dcb421973db6" title="PollExample Example usage of nn::socket::Poll() and eventFd for all eventFd flags.">PollExample()</a> and <a class="el" href="_socket_event_fd_8cpp.html#ac3b5f1d8c72de1a4cfe464ad90f5f274" title="SelectExample Example usage of nn::socket::Select() and eventFd for all eventFd flags.">SelectExample()</a> it will then finalize the <a class="el" href="namespacenn_1_1socket.html" title="Socket library namespace.">nn::socket</a> library.</li>
</ul>
<pre class="fragment">-----------------------------------------------
-- Poll Event Fd, Flags: None -----------------
-----------------------------------------------
Starting Poll (EventFd Flags None)
{[Interrupt Thread]} EventFdWrite(1337)
Poll returned result: 1
    PollEvent eventFd:  (PollIn) 
    PollEvent socketFd: (PollNone)
Reading EventFd (None)
    EventFdRead result: 0 (success)
    EventFdRead value:  1337
-----------------------------------------------
-- Poll Event Fd, Flags: Semaphore ------------
-----------------------------------------------
Start Polling (EventFd Flags Semaphore)
{[Interrupt Thread]} EventFdWrite(3)
Poll returned result: 1
    PollEvent eventFd:  (PollIn) 
    PollEvent socketFd: (PollNone)
Reading EventFd (Semaphore)
    EventFdRead result: 0 (success)
    EventFdRead value:  1
Poll returned result: 1
    PollEvent eventFd:  (PollIn) 
    PollEvent socketFd: (PollNone)
Reading EventFd (Semaphore)
    EventFdRead result: 0 (success)
    EventFdRead value:  1
Poll returned result: 1
    PollEvent eventFd:  (PollIn) 
    PollEvent socketFd: (PollNone)
Reading EventFd (Semaphore)
    EventFdRead result: 0 (success)
    EventFdRead value:  1
-----------------------------------------------
-- Poll Event Fd, Flags: Nonblock -------------
-----------------------------------------------
Reading EventFd (Nonblock, EAgain expected)
    EventFdRead result: -1 (failed)
    EventFdRead Errno: 11 = EAgain
Starting Poll (EventFd Flags Nonblock)
{[Interrupt Thread]} EventFdWrite(9001)
Poll returned result: 1
    PollEvent eventFd:  (PollIn) 
    PollEvent socketFd: (PollNone)
Reading EventFd (Nonblock)
    EventFdRead result: 0 (success)
    EventFdRead value:  9001
Reading EventFd (Nonblock, EAgain expected)
    EventFdRead result: -1 (failed)
    EventFdRead Errno: 11 = EAgain
-----------------------------------------------
-- Poll Event Fd, Flags: SemaphoreAndNonBlock -
-----------------------------------------------
Reading EventFd (Semaphore, EAgain expected)
    EventFdRead result: -1 (failed)
    EventFdRead Errno: 11 = EAgain
Start Polling (EventFd Flags SemaphoreAndNonBlock)
{[Interrupt Thread]} EventFdWrite(3)
Poll returned result: 1
    PollEvent eventFd:  (PollIn) 
    PollEvent socketFd: (PollNone)
Reading EventFd (Semaphore)
    EventFdRead result: 0 (success)
    EventFdRead value:  1
Poll returned result: 1
    PollEvent eventFd:  (PollIn) 
    PollEvent socketFd: (PollNone)
Reading EventFd (Semaphore)
    EventFdRead result: 0 (success)
    EventFdRead value:  1
Poll returned result: 1
    PollEvent eventFd:  (PollIn) 
    PollEvent socketFd: (PollNone)
Reading EventFd (Semaphore)
    EventFdRead result: 0 (success)
    EventFdRead value:  1
Reading EventFd (Semaphore, EAgain expected)
    EventFdRead result: -1 (failed)
    EventFdRead Errno: 11 = EAgain
-------------------------------------------------
-- Select Event Fd, Flags: None -----------------
-------------------------------------------------
Select started (EventFd Flags None)
{[Interrupt Thread]} EventFdWrite(1337)
Select returned result: 1
    Select eventFd is readable
    Select socketFd is not readable
Reading EventFd (None)
    EventFdRead result: 0 (success)
    EventFdRead value:  1337
-------------------------------------------------
-- Select Event Fd, Flags: Semaphore ------------
-------------------------------------------------
Select started (EventFd Flags Semaphore)
{[Interrupt Thread]} EventFdWrite(3)
Select returned result: 1
    Select eventFd is readable
    Select socketFd is not readable
Reading EventFd (Semaphore)
    EventFdRead result: 0 (success)
    EventFdRead value:  1
Select returned result: 1
    Select eventFd is readable
    Select socketFd is not readable
Reading EventFd (Semaphore)
    EventFdRead result: 0 (success)
    EventFdRead value:  1
Select returned result: 1
    Select eventFd is readable
    Select socketFd is not readable
Reading EventFd (Semaphore)
    EventFdRead result: 0 (success)
    EventFdRead value:  1
-------------------------------------------------
-- Select Event Fd, Flags: Nonblock -------------
-------------------------------------------------
Reading EventFd (Nonblock, EAgain expected)
    EventFdRead result: -1 (failed)
    EventFdRead Errno: 11 = EAgain
Select started (EventFd Flags Nonblock)
{[Interrupt Thread]} EventFdWrite(9001)
Select returned result: 1
    Select eventFd is readable
    Select socketFd is not readable
Reading EventFd (Nonblock)
    EventFdRead result: 0 (success)
    EventFdRead value:  9001
Reading EventFd (Nonblock, EAgain expected)
    EventFdRead result: -1 (failed)
    EventFdRead Errno: 11 = EAgain
-------------------------------------------------
-- Select Event Fd, Flags: SemaphoreAndNonBlock -
-------------------------------------------------
Reading EventFd (SemaphoreAndNonBlock, EAgain expected)
    EventFdRead result: -1 (failed)
    EventFdRead Errno: 11 = EAgain
Select started (EventFd Flags SemaphoreAndNonBlock)
{[Interrupt Thread]} EventFdWrite(3)
Select returned result: 1
    Select eventFd is readable
    Select socketFd is not readable
Reading EventFd (SemaphoreAndNonBlock)
    EventFdRead result: 0 (success)
    EventFdRead value:  1
Select started (EventFd Flags SemaphoreAndNonBlock)
Select returned result: 1
    Select eventFd is readable
    Select socketFd is not readable
Reading EventFd (SemaphoreAndNonBlock)
    EventFdRead result: 0 (success)
    EventFdRead value:  1
Select started (EventFd Flags SemaphoreAndNonBlock)
Select returned result: 1
    Select eventFd is readable
    Select socketFd is not readable
Reading EventFd (SemaphoreAndNonBlock)
    EventFdRead result: 0 (success)
    EventFdRead value:  1
Reading EventFd (SemaphoreAndNonBlock, EAgain expected)
    EventFdRead result: -1 (failed)
    EventFdRead Errno: 11 = EAgain
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
</body>
</html>
