<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Khronos APIs | NintendoSDK API Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="openclose.js"></script>
<script type="text/javascript" src="searchapi.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NintendoSDK API Reference
   &#160;<span id="projectnumber">14.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="_page_graphics_for_n_x.html">Graphics Environment for NX</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Khronos APIs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#khronos_guide_sec_1">1. Introduction</a></li>
<li class="level1"><a href="#khronos_guide_sec_2">2. EGL</a><ul><li class="level2"><a href="#khronos_guide_sec_2_1">2.1. Memory management</a></li>
<li class="level2"><a href="#khronos_guide_sec_2_2">2.2. Building</a></li>
<li class="level2"><a href="#khronos_guide_sec_2_3">2.3. Creating Contexts</a></li>
<li class="level2"><a href="#khronos_guide_sec_2_4">2.4. Interoperation with nn::vi</a></li>
<li class="level2"><a href="#khronos_guide_sec_2_5">2.5. Known issues</a></li>
</ul>
</li>
<li class="level1"><a href="#khronos_guide_sec_3">3. OpenGL and OpenGL ES</a><ul><li class="level2"><a href="#khronos_guide_sec_3_1">3.1. Building</a></li>
<li class="level2"><a href="#khronos_guide_sec_3_2">3.2. Using OpenGL and OpenGL ES</a></li>
<li class="level2"><a href="#khronos_guide_sec_3_3">3.3. GLSL</a></li>
</ul>
</li>
<li class="level1"><a href="#khronos_guide_sec_4">4. Vulkan</a><ul><li class="level2"><a href="#khronos_guide_sec_4_1">4.1. Memory management</a></li>
<li class="level2"><a href="#khronos_guide_sec_4_2">4.2. Building</a></li>
<li class="level2"><a href="#khronos_guide_sec_4_3">4.3. Interoperation with nn::vi</a></li>
<li class="level2"><a href="#khronos_guide_sec_4_4">4.4. Performance</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_D__Home_teamcity_work_sdk_Externals_odin2_nvn_samples_docs_doxygen_KHRONOS_khronos_ApiProgrammingGuide"></a></p>
<h1><a class="anchor" id="khronos_guide_sec_1"></a>
1. Introduction</h1>
<p>In addition to NVN, NX devices support a number of industry-standard graphics APIs. These include EGL, OpenGL, OpenGL ES, and Vulkan. These APIs are well documented in numerous resources, including the <a href="https://www.khronos.org/">Khronos website</a>. However, there are some aspects specific to the NX platform that merit additional discussion, such as window system integration and interoperation with the NVN API. This document provides a "grab bag" of tips specific to the NX platform that might not be otherwise obvious to application developers familiar with these APIs.</p>
<h1><a class="anchor" id="khronos_guide_sec_2"></a>
2. EGL</h1>
<h2><a class="anchor" id="khronos_guide_sec_2_1"></a>
2.1. Memory management</h2>
<ul>
<li>EGL uses thread-local storage, so applications must enable dynamic memory for thread-local storage using <a class="el" href="namespacenn_1_1os.html#a347a69381452967e4a51b3c18aae7807" title="Registers the compiler thread local implementation memory allocator and memory deallocator.">nn::os::SetMemoryAllocatorForThreadLocal</a> inside nninitStartup.</li>
<li>Before calling any EGL API function, applications must program memory allocation callbacks for the driver using <a class="el" href="namespacenv.html#a7d85cfdd1bae1b635cc66b8d58077688" title="Set memory allocator for graphics subsystem.">nv::SetGraphicsAllocator</a>.</li>
</ul>
<h2><a class="anchor" id="khronos_guide_sec_2_2"></a>
2.2. Building</h2>
<ul>
<li>To use EGL, an application must link with the opengl.nso library, which exports the EGL core entry points.</li>
<li>The NX platform uses a custom version of the eglplatform.h header, rather than the standard one authored by The Khronos Group, providing types compatible with the <a class="el" href="namespacenn_1_1vi.html" title="Provides the necessary functionality to propagate framebuffers to the display server.">nn::vi</a> window system. Specifically, the <code>EGLNativeDisplayType</code>, <code>EGLNativePixmapType</code>, and <code>EGLNativeWindowType</code> types are defined as <code>void*</code>.</li>
</ul>
<h2><a class="anchor" id="khronos_guide_sec_2_3"></a>
2.3. Creating Contexts</h2>
<ul>
<li>When calling <code>eglChooseConfig</code>, an application should always specify the <code>EGL_RENDERABLE_TYPE</code> attribute. The default value of this attribute is <code>EGL_OPENGL_ES_BIT</code>, which specifically refers to OpenGL ES 1.x. This version of OpenGL ES is not supported, and no configs will be returned.</li>
</ul>
<h2><a class="anchor" id="khronos_guide_sec_2_4"></a>
2.4. Interoperation with nn::vi</h2>
<ul>
<li>Pointers to <code><a class="el" href="classnn_1_1vi_1_1_display.html" title="Opaque handle to a display.">nn::vi::Display</a></code> objects are <em>not</em> compatible with <code>EGLNativeDisplayType</code>. <code>eglGetDisplay</code> should only be called with <code>EGL_DEFAULT_DISPLAY</code>.</li>
<li>Valid instances of <code><a class="el" href="namespacenn_1_1vi.html#a4d5f9e1b22348c0080755ad26cb980c1" title="Platform-dependent handle to a window.">nn::vi::NativeWindowHandle</a></code> are compatible with <code>EGLNativeWindowType</code>, and should be used for invocations of <code>eglCreateWindowSurface</code>.</li>
<li>Unlike Vulkan and NVN, the EGL interface does not provide explicit management of the buffers in the swap chain of a window. Instead, buffers are automatically created the first time a window surface is used in <code>eglMakeCurrent</code>. Three buffers are created with a color format compatible with the <code>EGLConfig</code> used for the context and surface. If the corresponding <code><a class="el" href="classnn_1_1vi_1_1_layer.html" title="Opaque handle to a layer.">nn::vi::Layer</a></code> object was initialized with a specified size, then that size is used for the buffers. If no size is specified, then the buffers are created with a size of 1280x720.</li>
</ul>
<h2><a class="anchor" id="khronos_guide_sec_2_5"></a>
2.5. Known issues</h2>
<ul>
<li>After calling <code><a class="el" href="namespacenv.html#a368247e862f5ffc59a38af42658d7b38" title="Release resources from graphics subsystem.">nv::FinalizeGraphics</a></code>, some memory allocated by the EGL driver might not be freed. To minimize this, <code>eglTerminate</code> should be called during application cleanup, and <code>eglReleaseThread</code> should be called before terminating threads that use the EGL API.</li>
</ul>
<h1><a class="anchor" id="khronos_guide_sec_3"></a>
3. OpenGL and OpenGL ES</h1>
<h2><a class="anchor" id="khronos_guide_sec_3_1"></a>
3.1. Building</h2>
<ul>
<li>To use either OpenGL or OpenGL ES, an application must link with the opengl.nso library. The library exports the OpenGL ES 3.2 core entry points directly. These entry points can be used for other OpenGL ES versions or for OpenGL contexts. All core and extension entry points for supported OpenGL and OpenGL ES versions can be obtained via <code>eglGetProcAddress</code>.</li>
</ul>
<h2><a class="anchor" id="khronos_guide_sec_3_2"></a>
3.2. Using OpenGL and OpenGL ES</h2>
<ul>
<li>OpenGL ES 1.0 and 1.1 are not supported. Equivalent functionality exists in OpenGL (compatibility profile), which should be used instead.</li>
<li>If OpenGL or OpenGL ES is used in the same process as NVN, it is necessary to make a context current <em>before</em> invoking any NVN entry point.</li>
</ul>
<h2><a class="anchor" id="khronos_guide_sec_3_3"></a>
3.3. GLSL</h2>
<ul>
<li>Program binaries produced by glGetProgramBinary can be saved to persistent storage and used as a baked asset consumed by glProgramBinary. However, the format of such a binary is not stable between releases of the OpenGL driver. To use such binaries as persistent assets, the same OpenGL driver must be used. Specifically, the application must be linked to the same opengl.nso library. The specific system firmware version does not affect compatibility directly. If the driver version is changed, the binaries must be regenerated. Additionally, the binaries are not compatible across platforms (e.g., the Windows reference implementation and the NX device). If incompatible binary data is passed to glProgramBinary, the <code>LINK_STATUS</code> of the program object will be set to <code>FALSE</code>, and the program's info log will report the error.</li>
</ul>
<h1><a class="anchor" id="khronos_guide_sec_4"></a>
4. Vulkan</h1>
<h2><a class="anchor" id="khronos_guide_sec_4_1"></a>
4.1. Memory management</h2>
<ul>
<li>EGL uses thread-local storage, so applications must enable dynamic memory for thread-local storage using <a class="el" href="namespacenn_1_1os.html#a347a69381452967e4a51b3c18aae7807" title="Registers the compiler thread local implementation memory allocator and memory deallocator.">nn::os::SetMemoryAllocatorForThreadLocal</a> inside nninitStartup.</li>
<li>Before calling any Vulkan API function, applications must program memory allocation callbacks for the driver using <a class="el" href="namespacenv.html#a7d85cfdd1bae1b635cc66b8d58077688" title="Set memory allocator for graphics subsystem.">nv::SetGraphicsAllocator</a>.</li>
<li>Memory allocation callbacks specified via VkAllocationCallbacks will be respected where appropriate, though the driver may still fall back to callbacks specified in <a class="el" href="namespacenv.html#a7d85cfdd1bae1b635cc66b8d58077688" title="Set memory allocator for graphics subsystem.">nv::SetGraphicsAllocator</a> for incidental internal allocations, or if required for correct functionality.</li>
</ul>
<h2><a class="anchor" id="khronos_guide_sec_4_2"></a>
4.2. Building</h2>
<ul>
<li>The vulkan.nso library implements a loader for the Vulkan API and exports its core entry points. The library also depends on the opengl.nso library. Both must be linked to an application that uses Vulkan.</li>
</ul>
<h2><a class="anchor" id="khronos_guide_sec_4_3"></a>
4.3. Interoperation with nn::vi</h2>
<ul>
<li>The only supported window system interface on the NX device is <code>VK_NN_vi_surface</code> Vulkan extension, which is documented in the current Vulkan specification. The extension itself is implemented as an implicit layer inside vulkan.nso.</li>
</ul>
<h2><a class="anchor" id="khronos_guide_sec_4_4"></a>
4.4. Performance</h2>
<ul>
<li><p class="startli">Some entry points, such as vkQueueSubmit(), can have long or difficult-to-predict execution times. Applications may find it advantageous to execute such functions asynchronously, using dedicated worker threads or higher-level constructs, such as std::async. This can allow more effective CPU utilization at the cost of potential added latency between the scheduling of the call on one thread and its completion on another.</p>
<p class="startli">Please refer to the Vulkan documentation for any synchronization requirements when using Vulkan in multiple threads.</p>
</li>
<li>Performance may vary between releases due to optimizations, bug fixes, and feature enhancements. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
</body>
</html>
