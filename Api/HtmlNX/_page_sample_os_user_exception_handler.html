<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>User Exception Handler Sample | NintendoSDK API Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="openclose.js"></script>
<script type="text/javascript" src="searchapi.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NintendoSDK API Reference
   &#160;<span id="projectnumber">14.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="_page_sample.html">Sample Descriptions</a></li><li class="navelem"><a class="el" href="_page_sample_os.html">Operating System Library Samples</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">User Exception Handler Sample </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#PageSampleOsUserExceptionHandler_SectionBrief">Overview</a></li>
<li class="level1"><a href="#PageSampleOsUserExceptionHandler_SectionFileStructure">File Structure</a></li>
<li class="level1"><a href="#PageSampleOsUserExceptionHandler_SectionNecessaryEnvironment">Required Environment</a></li>
<li class="level1"><a href="#PageSampleOsUserExceptionHandler_SectionHowToOperate">How to Use</a></li>
<li class="level1"><a href="#PageSampleOsUserExceptionHandler_SectionPrecaution">Important Information</a></li>
<li class="level1"><a href="#PageSampleOsUserExceptionHandler_SectionHowToExecute">Execution Procedure</a></li>
<li class="level1"><a href="#PageSampleOsUserExceptionHandler_SectionDetail">Description</a><ul><li class="level2"><a href="#PageSampleOsUserExceptionHandler_SectionSampleProgram">Sample Program</a></li>
<li class="level2"><a href="#PageSampleOsUserExceptionHandler_SectionSampleDetail">Sample Program Description</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>This sample program demonstrates the user exception handler feature.</p>
<h1><a class="anchor" id="PageSampleOsUserExceptionHandler_SectionBrief"></a>
Overview</h1>
<p>This is a description of a sample program that registers a customized user exception handler.</p>
<p>For more information about using the user exception handler feature, see the <a class="el" href="namespacenn_1_1os.html">OS API Reference</a>.</p>
<h1><a class="anchor" id="PageSampleOsUserExceptionHandler_SectionFileStructure"></a>
File Structure</h1>
<p>This sample program is located in <code><a class="el" href="dir_4416cbc5e7941a1ff1d7ddda8bdedd05.html">Samples/Sources/Applications/OsUserExceptionHandler/ </a> </code>. This sample cannot be used in a Windows environment. Visual Studio files are only provided for development device environments.</p>
<h1><a class="anchor" id="PageSampleOsUserExceptionHandler_SectionNecessaryEnvironment"></a>
Required Environment</h1>
<p>Nothing specific.</p>
<h1><a class="anchor" id="PageSampleOsUserExceptionHandler_SectionHowToOperate"></a>
How to Use</h1>
<p>Nothing specific.</p>
<h1><a class="anchor" id="PageSampleOsUserExceptionHandler_SectionPrecaution"></a>
Important Information</h1>
<p>This sample program does not display anything on the screen. The execution results are output to a log.</p>
<h1><a class="anchor" id="PageSampleOsUserExceptionHandler_SectionHowToExecute"></a>
Execution Procedure</h1>
<p>Build the sample program and then run it.</p>
<h1><a class="anchor" id="PageSampleOsUserExceptionHandler_SectionDetail"></a>
Description</h1>
<h2><a class="anchor" id="PageSampleOsUserExceptionHandler_SectionSampleProgram"></a>
Sample Program</h2>
<p>This sample program uses the following source code.</p>
<p><a class="el" href="_os_user_exception_handler_8cpp.html" title="Sample program demonstrating the user exception handler feature.">OsUserExceptionHandler.cpp</a> </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*--------------------------------------------------------------------------------*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">  Copyright Nintendo.  All rights reserved.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">  These coded instructions, statements, and computer programs contain proprietary</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">  information of Nintendo and/or its licensed developers and are protected by</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">  national and international copyright laws. They may not be disclosed to third</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">  parties or copied or duplicated in any form, in whole or in part, without the</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">  prior written consent of Nintendo.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">  The content herein is highly confidential and should be handled accordingly.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *--------------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#include &lt;nn/os.h&gt;</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="keyword">extern</span> <span class="keywordtype">void</span> SetOriginalUserExceptionHandler() <a class="code" href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">//-----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">//  The main function.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;extern &quot;C&quot; <span class="keywordtype">void</span> nnMain()</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;{</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="comment">// Register an original user exception handler.</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    SetOriginalUserExceptionHandler();</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="comment">// Make the user exception handler work even when connected to the VSI debugger.</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a52dba2921df0ef2adf203a4b9829a6d6">nn::os::EnableUserExceptionHandlerOnDebugging</a>(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="comment">// Deliberately throw an exception.</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">volatile </span>uint32_t*<span class="keyword">&gt;</span>(NULL) = 0;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div>
<div class="ttc" id="anamespacenn_1_1os_html_a52dba2921df0ef2adf203a4b9829a6d6"><div class="ttname"><a href="namespacenn_1_1os.html#a52dba2921df0ef2adf203a4b9829a6d6">nn::os::EnableUserExceptionHandlerOnDebugging</a></div><div class="ttdeci">void EnableUserExceptionHandlerOnDebugging(bool isEnabled) NN_NOEXCEPT</div><div class="ttdoc">Sets whether to enable the user exception handler even when connected to the debugger.</div></div>
<div class="ttc" id="ann___macro_8h_html_a0e31cc4dc24d85253a31e48b1a85ab33"><div class="ttname"><a href="nn___macro_8h.html#a0e31cc4dc24d85253a31e48b1a85ab33">NN_NOEXCEPT</a></div><div class="ttdeci">#define NN_NOEXCEPT</div><div class="ttdoc">Declares that the function does not throw exceptions.</div><div class="ttdef"><b>Definition:</b> nn_Macro.h:196</div></div>
</div><!-- fragment --><h2><a class="anchor" id="PageSampleOsUserExceptionHandler_SectionSampleDetail"></a>
Sample Program Description</h2>
<p>This sample program has the following flow.</p>
<ul>
<li>In <code>nnMain()</code>, call the function for registering an original user exception handler.</li>
<li>Specify that the user exception handler work even when connected to the VSI debugger.</li>
<li>Deliberately throw a data access exception to not write to a null address.</li>
<li>Trigger the user exception handler and output to a log.</li>
</ul>
<p>The implementations of the bodies of the <code>SetOriginalUserExceptionHandler()</code> function and the user exception handler used this sample program can be found in <code><a class="el" href="_os_user_exception_handler_sample_8cpp-example.html">Samples/Sources/Applications/OsUserExceptionHandler/OsUserExceptionHandlerSample.cpp </a> </code>. Customize this handler function as desired.</p>
<p>If <code>true</code> is specified for <code><a class="el" href="namespacenn_1_1os.html#a52dba2921df0ef2adf203a4b9829a6d6" title="Sets whether to enable the user exception handler even when connected to the debugger.">nn::os::EnableUserExceptionHandlerOnDebugging()</a></code>, the user exception handler will work even when connected to the VSI debugger, but the debugger will stop after the user exception handler has run. You must note that the pc registers and other values that can be monitored on the debugger are not the values from when the exception was thrown.</p>
<p>User exception handlers are only enabled in the NX32 and NX64 build environments. The result of executing the NX64 build of the sample program is as follows.</p>
<pre class="fragment">UserException handler is called.
==============================================================================
  Invalid Data Access  (ExceptionType=0x0101)
  Accessed to unmapped memory space. (DFSC=0x05)
  Accessed to: 0x0000000000000000
==============================================================================

Thread         : 0x000000131C4828F8 (MainThread)
  Stack Top    : 0x00000073E0F38000
  Stack Bottom : 0x00000073E1038000 (size=0x100000)

r0      = 0x0000000000000001 (                    1)
r1      = 0x000000131B6124C0 (          82063729856)
r2      = 0x0000000000004000 (                16384)
r3      = 0x0000000000000000 (                    0)
r4      = 0x0000000000000000 (                    0)
r5      = 0x0000000000000000 (                    0)
r6      = 0x000000131B603280 (          82063667840)
r7      = 0x000000131B603280 (          82063667840)
r8      = 0x0000000000000000 (                    0)
r9      = 0x000000131C482C98 (          82078870680)
r10     = 0x0000000000000018 (                   24)
r11     = 0x0000000000002877 (                10359)
r12     = 0x0000000000000000 (                    0)
r13     = 0x0000000000000000 (                    0)
r14     = 0x0000000000000000 (                    0)
r15     = 0x0000000000000000 (                    0)
r16     = 0x000000131BB07500 (          82068927744)
r17     = 0x000000131B612230 (          82063729200)
r18     = 0x0000000000000000 (                    0)
r19     = 0x000000131B600830 (          82063657008)
r20     = 0x000000131B601720 (          82063660832)
r21     = 0x000000131B604000 (          82063671296)
r22     = 0x0000000000008000 (                32768)
r23     = 0x0000000000000000 (                    0)
r24     = 0x0000000000000000 (                    0)
r25     = 0x0000000000000000 (                    0)
r26     = 0x0000000000000000 (                    0)
r27     = 0x0000000000000000 (                    0)
r28     = 0x0000000000000000 (                    0)
r29     = 0x00000073E1037FC0 (         497696341952)
r30(lr) = 0x000000131B60D244 (          82063708740)
sp      = 0x00000073E1037FC0 (         497696341952)
pc      = 0x000000131B60D248 (          82063708744)

pstate  = 0x20000000 (N=0 Z=0 C=1 V=0 Q=0 J=0 E=0 T=0 IT=0x00 GE=0x0)
afsr0   = 0x00000000
afsr1   = 0x00000000
esr     = 0x92000045 (EC=0x24 IL=1 ISS=0x000045)
far     = 0x0000000000000000

V0  = 0x000000000000000000000000FFFFFFFF (0.000000E+00)
V1  = 0xFFFFFF80FFFFFFD800000073E1037B60 (0.000000E+00)
V2  = 0x00000073E1037B9000000073E1037BF0 (0.000000E+00)
V3  = 0x00000000000004040000000000000404 (0.000000E+00)
V4  = 0x00000000000000000000000000000000 (0.000000E+00)
V5  = 0x00000000000000000000000000000000 (0.000000E+00)
V6  = 0x00000000000053D00000000000005088 (0.000000E+00)
V7  = 0x00000000000000000000000000000000 (0.000000E+00)
V8  = 0x00000000000000000000000000000000 (0.000000E+00)
V9  = 0x00000000000000000000000000000000 (0.000000E+00)
V10 = 0x00000000000000000000000000000000 (0.000000E+00)
V11 = 0x00000000000000000000000000000000 (0.000000E+00)
V12 = 0x00000000000000000000000000000000 (0.000000E+00)
V13 = 0x00000000000000000000000000000000 (0.000000E+00)
V14 = 0x00000000000000000000000000000000 (0.000000E+00)
V15 = 0x00000000000000000000000000000000 (0.000000E+00)
V16 = 0x00000000000004030000000000000403 (0.000000E+00)
V17 = 0x00000000000015700000000000001540 (0.000000E+00)
V18 = 0x000000000000533000000000000053D8 (0.000000E+00)
V19 = 0x00000000000000000000000000000000 (0.000000E+00)
V20 = 0x00000000000000000000000000000000 (0.000000E+00)
V21 = 0x00000000000000000000000000000000 (0.000000E+00)
V22 = 0x00000000000000000000000000000000 (0.000000E+00)
V23 = 0x00000000000000000000000000000000 (0.000000E+00)
V24 = 0x00000000000000000000000000000000 (0.000000E+00)
V25 = 0x00000000000000000000000000000000 (0.000000E+00)
V26 = 0x00000000000000000000000000000000 (0.000000E+00)
V27 = 0x00000000000000000000000000000000 (0.000000E+00)
V28 = 0x00000000000000000000000000000000 (0.000000E+00)
V29 = 0x00000000000000000000000000000000 (0.000000E+00)
V30 = 0x00000000000000000000000000000000 (0.000000E+00)
V31 = 0x00000000000000000000000000000000 (0.000000E+00)

Stack dump:
0x00000073E1037FC0: F0 7F 03 E1  73 00 00 00  4C FC A2 1B  13 00 00 00  ....s...L.......
0x00000073E1037FD0: 00 00 00 00  00 00 00 00  08 30 60 1B  13 00 00 00  .........0`.....
0x00000073E1037FE0: 00 00 60 1B  13 00 00 00  00 80 00 00  00 00 00 00  ..`.............
0x00000073E1037FF0: 00 00 00 00  00 00 00 00  C0 00 60 1B  13 00 00 00  ..........`.....

Stack trace:
  0x000000131B60D248 nnMain + 0x0000000000000018
  0x000000131BA2FC4C (unknown)

Modules:
  base               size               id                                       path
  0x000000131B600000 0x000000000000D000 c5148af8032b9b2300fd059ab3b2ccaf442339bd nnrtld
  0x000000131B60D000 0x000000000000A000 783fd54003a23dd804ca11075dfe7cb56ef1aec8 OsUserExceptionHandler
  0x000000131B617000 0x0000000000E96000 e3919b9cd1447b4bd59775764db2c3d55df16704 nnSdkJp
</pre><p>This sample cannot be used in a Windows environment. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
</body>
</html>
