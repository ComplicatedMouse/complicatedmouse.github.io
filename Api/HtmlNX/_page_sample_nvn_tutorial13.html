<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NVN Tutorial 13: Deferred Renderer with Screen Space Ambient Occlusion | NintendoSDK API Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="openclose.js"></script>
<script type="text/javascript" src="searchapi.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NintendoSDK API Reference
   &#160;<span id="projectnumber">14.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="_page_sample.html">Sample Descriptions</a></li><li class="navelem"><a class="el" href="_page_sample_nvn.html">NVN</a></li><li class="navelem"><a class="el" href="_page_sample_nvn_tutorial.html">NVN Tutorial</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">NVN Tutorial 13: Deferred Renderer with Screen Space Ambient Occlusion </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#PageSampleNvnTutorial13_SectionBrief">Overview</a><ul><li class="level2"><a href="#autotoc_md394">Scalable Ambient Obscurance</a></li>
<li class="level2"><a href="#PageSampleNvnTutorial13_SectionExpectedOutput">Expected Output</a></li>
</ul>
</li>
<li class="level1"><a href="#PageSampleNvnTutorial13_SectionFileStructure">File Structure</a></li>
<li class="level1"><a href="#PageSampleNvnTutorial13_SectionNecessaryEnvironment">System Requirements</a></li>
<li class="level1"><a href="#PageSampleNvnTutorial13_SectionHowToOperate">Operation Procedure</a><ul><li class="level2"><a href="#autotoc_md395">NX Controls</a></li>
<li class="level2"><a href="#autotoc_md396">Windows Controls</a></li>
</ul>
</li>
<li class="level1"><a href="#PageSampleNvnTutorial13_SectionPrecaution">Precautions</a></li>
<li class="level1"><a href="#PageSampleNvnTutorial13_SectionHowToExecute">Execution Procedure</a></li>
<li class="level1"><a href="#PageSampleNvnTutorial13_SectionDetail">Description</a><ul><li class="level2"><a href="#PageSampleNvnTutorial13_SectionSampleProgram">Sample Program</a></li>
<li class="level2"><a href="#PageSampleNvnTutorial13_SectionSampleDetail">Sample Program Description</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>This tutorial adds screen space ambient occlusion to the deferred renderer presented in the previous sample using the Scalable Ambient Obscurance (SAO) algorithm.</p>
<h1><a class="anchor" id="PageSampleNvnTutorial13_SectionBrief"></a>
Overview</h1>
<p>This tutorial adds screen space ambient occlusion to the deferred renderer presented in the previous sample using the Scalable Ambient Obscurance (SAO) algorithm.</p>
<h2><a class="anchor" id="autotoc_md394"></a>
Scalable Ambient Obscurance</h2>
<p>The main idea behind the SAO algorithm is to provide a faster and more stable performance than the traditional SSAO algorithm. This is acheived by creating and sampling mipmaps of the depth buffer to avoid memory thrashing when the camera is close to a surface. This happens because the neighbor samples taken from the depth buffer are determined in view space. This means that they become further and further apart in screen space (and memory) as the camera get close to a surface.</p>
<p>The algorithm is split into four passes following the g-buffer pass.</p>
<p>Depth Linearization - The depth buffer output from the g-buffer pass is converted to a linear view space depth buffer.</p>
<p>Depth Mipmap Generation - A mipmap chain is generated from the linearixzed depth buffer.</p>
<p>SAO Pass - Performs the AO calculation. Accesses a mip level of the depth buffer depending on how close the camera is to a surface. This keeps samples close together in memory as the pixels of the lower mip levels cover a larger ranger of view space.</p>
<p>Blur Pass - Applies a bilateral filter to the output of the SAO pass using depth information saved from the SAO pass.</p>
<h2><a class="anchor" id="PageSampleNvnTutorial13_SectionExpectedOutput"></a>
Expected Output</h2>
<div class="image">
<img src="NvnTutorial13.png" alt=""/>
</div>
<h1><a class="anchor" id="PageSampleNvnTutorial13_SectionFileStructure"></a>
File Structure</h1>
<p>The main tutorial file and other files that make up the tutorial as well as the Visual Studio solutions can be found at <a class="el" href="dir_cc260d20753b1b4b6d3d3da5619286fa.html">Samples/Sources/Applications/NvnTutorial13ScreenSpaceAO </a></p>
<p>The tutorial library which contains common code shared by the tutorials can be found at Samples/Sources/Libraries/NvnTutorial</p>
<h1><a class="anchor" id="PageSampleNvnTutorial13_SectionNecessaryEnvironment"></a>
System Requirements</h1>
<p>No extra system requirements.</p>
<h1><a class="anchor" id="PageSampleNvnTutorial13_SectionHowToOperate"></a>
Operation Procedure</h1>
<h2><a class="anchor" id="autotoc_md395"></a>
NX Controls</h2>
<ul>
<li>Left Stick - Pan the camera around the plane made up of its right and view vector.</li>
<li>ZR/ZL - Pan the camera up/down.</li>
<li>Right Stick - Change the camera's orientation.</li>
<li>X - Toggle the point light debug draw.</li>
<li>B - Toggle wire frame rendering.</li>
<li>Y - Toggle screen space ambient occlusion.</li>
<li>Up/Down Dpad - Select SAO parameter.</li>
<li>Left/Right Dpad - Increase/decrease parameter value.</li>
<li>R/L - Scroll through the debug targets.</li>
<li>Touch Screen - Exits the program.</li>
</ul>
<h2><a class="anchor" id="autotoc_md396"></a>
Windows Controls</h2>
<ul>
<li>W/A/S/D - Pan the camera forward/left/back/right.</li>
<li>E/Q - Pan the camera up/down.</li>
<li>Left Click and Drag - Change the camera's orientation.</li>
<li>X - Toggle the point light debug draw.</li>
<li>C - Toggle wire frame rendering.</li>
<li>Y - Toggle screen space ambient occlusion.</li>
<li>U/J - Select SAO parameter.</li>
<li>H/K - Increase/decrease parameter value.</li>
<li>Left/Right Arrow - Scroll through the debug targets.</li>
<li>Esc - Exits the program.</li>
</ul>
<h1><a class="anchor" id="PageSampleNvnTutorial13_SectionPrecaution"></a>
Precautions</h1>
<p>None.</p>
<h1><a class="anchor" id="PageSampleNvnTutorial13_SectionHowToExecute"></a>
Execution Procedure</h1>
<p>Build the Visual Solution and run it.</p>
<h1><a class="anchor" id="PageSampleNvnTutorial13_SectionDetail"></a>
Description</h1>
<h2><a class="anchor" id="PageSampleNvnTutorial13_SectionSampleProgram"></a>
Sample Program</h2>
<p>Below is the source code for the main tutorial file for this sample.</p>
<p><a class="el" href="_nvn_tutorial13_8cpp.html" title="This tutorial adds screen space ambient occlusion to the deferred renderer presented in the previous ...">NvnTutorial13.cpp</a> </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*--------------------------------------------------------------------------------*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">  Copyright (C)Nintendo All rights reserved.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">  These coded instructions, statements, and computer programs contain proprietary</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">  information of Nintendo and/or its licensed developers and are protected by</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">  national and international copyright laws. They may not be disclosed to third</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">  parties or copied or duplicated in any form, in whole or in part, without the</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">  prior written consent of Nintendo.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">  The content herein is highly confidential and should be handled accordingly.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *--------------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_nvn_tutorial13_8h.html">NvnTutorial13.h</a>&quot;</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="nn___log_8h.html">nn/nn_Log.h</a>&gt;</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="nn___assert_8h.html">nn/nn_Assert.h</a>&gt;</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="fs_8h.html">nn/fs.h</a>&gt;</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="_aligned_allocator_8h.html">nvntutorial/AlignedAllocator.h</a>&gt;</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="_load_scene_8h.html">nvntutorial/LoadScene.h</a>&gt;</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160; </div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="preprocessor">#ifdef NN_BUILD_TARGET_PLATFORM_OS_WIN</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">//#define USE_WIN_NVNGD</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="preprocessor">#ifdef USE_WIN_NVNGD</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="preprocessor">    #include &lt;windows.h&gt;</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">     * Scene file to load:</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">     * Scene.xml: Main scene. Two offices plus a hallway</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">     * TestScene.xml: Test scene with varying roughness metallic/dielectric spheres.</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* g_SceneFileName = <span class="stringliteral">&quot;SceneSAO.xml&quot;</span>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="preprocessor">#define DEBUGTEXT</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="keyword">const</span> <span class="keywordtype">size_t</span> AmbientOcclusion::g_GPUTimeBeforeOffset   = 0;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="keyword">const</span> <span class="keywordtype">size_t</span> AmbientOcclusion::g_GPUTimeAfterOffset    = 16;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="keyword">const</span> <span class="keywordtype">size_t</span> AmbientOcclusion::g_SAODepthBeforeOffset  = 32;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="keyword">const</span> <span class="keywordtype">size_t</span> AmbientOcclusion::g_SAODepthAfterOffset   = 48;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="keyword">const</span> <span class="keywordtype">size_t</span> AmbientOcclusion::g_SAOMipmapBeforeOffset = 64;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="keyword">const</span> <span class="keywordtype">size_t</span> AmbientOcclusion::g_SAOMipmapAfterOffset  = 80;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="keyword">const</span> <span class="keywordtype">size_t</span> AmbientOcclusion::g_SAOBeforeOffset       = 96;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="keyword">const</span> <span class="keywordtype">size_t</span> AmbientOcclusion::g_SAOAfterOffset        = 112;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="keyword">const</span> <span class="keywordtype">size_t</span> AmbientOcclusion::g_SAOBlurBeforeOffset   = 128;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="keyword">const</span> <span class="keywordtype">size_t</span> AmbientOcclusion::g_SAOBlurAfterOffset    = 144;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment"> * AmbientOcclusion Constructor</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment"> * ----------------------------</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment"> * Sets up default member data values</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;AmbientOcclusion::AmbientOcclusion() : m_pQueueMemory(nullptr),</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                                       m_pShaderScratchMemoryPool(nullptr),</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                                       m_Near(0.1f),</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                                       m_Far(1000.0f),</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                                       m_GlobalAmbient(0.1f),</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                                       m_FoV(45.0f),</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                                       m_ScreenWidth(1920),</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                                       m_ScreenHeight(1080),</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                                       m_pRenderTargetMemoryPool(nullptr),</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                                       m_pTextureIDManager(nullptr),</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                                       m_pAssetLoader(nullptr),</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                                       m_pUniformBufferManager(nullptr),</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                       m_pStaticUniformBufferManager(nullptr),</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                                       m_BackBufferCommandBuffer(nullptr),</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                                       m_GBufferCommandBuffer(nullptr),</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                                       m_ShadowMapPassCommandBuffer(nullptr),</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                                       m_LightingPassCommandBuffer(nullptr),</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                                       m_SkyBoxCommandBuffer(nullptr),</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                                       m_pScreenSpaceQuadPass(nullptr),</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                                       m_pScalableAODepthPass(nullptr),</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                                       m_pScalableAOMipmapPass(nullptr),</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                                       m_pScalableAOPass(nullptr),</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                                       m_pScalableAOBlurPass(nullptr),</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                                       m_pDirectionalLightPassAO(nullptr),</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                                       m_pSkyBox(nullptr),</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                                       m_pFrameBufferedSyncManager(nullptr),</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                                       m_pDebugTextRenderer(nullptr),</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                                       m_pPresentHandle(nullptr),</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                                       m_pPresentPass(nullptr),</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                                       m_pShadowMapDisplaySampler(nullptr),</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                                       m_PointLightDebugDraw(false),</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                                       m_GenerateShadows(true),</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                                       m_SAOEnabled(true),</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                                       m_SAOParamsSelected(SAOParam::BIAS),</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                                       m_PrevFrameTime(0),</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                                       m_CPUTime(0),</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                                       m_CurrentBeginFrameTime(0),</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                                       m_PrevGPUTime(0),</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                                       m_CurrentTimeStamp(0)</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;{</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; g_NumBackBuffers; ++i)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        m_ScreenRenderTargets[i] = NULL;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    AlignedAllocator::GetInstance()-&gt;Resize(320 * 1024 * 1024);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="preprocessor">#ifdef NN_BUILD_TARGET_PLATFORM_OS_WIN</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    m_Camera.Init(&amp;m_InputManager, .125f, .25f);</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    m_Camera.Init(&amp;m_InputManager, .125f, 2.0f);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    nn::util::MatrixIdentity(&amp;m_ProjMat44);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    m_SAOParams[SAOParam::BIAS].first           = <span class="stringliteral">&quot;Bias:           %g&quot;</span>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    m_SAOParams[SAOParam::RADIUS].first         = <span class="stringliteral">&quot;Radius:         %g&quot;</span>;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    m_SAOParams[SAOParam::INTENSITY].first      = <span class="stringliteral">&quot;Intensity:      %g&quot;</span>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    m_SAOParams[SAOParam::POWER_EXPONENT].first = <span class="stringliteral">&quot;Power Exponent: %g&quot;</span>;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;}</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160; </div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment"> * AmbientOcclusion Destructor</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment"> * ---------------------------</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment"> * Empty Destructor</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;AmbientOcclusion::~AmbientOcclusion()</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;{</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;}</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160; </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment"> * AmbientOcclusion::Init</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment"> * ----------------------</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment"> * Initialize NVN, load asset files, and create objects needed for the</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment"> * application to run.</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::Init(PFNNVNBOOTSTRAPLOADERPROC pLoader, <a class="code" href="group__nvn__c__api__typedefs.html#ga05b6b3dd5b965bd81efe2d03cee0bbbd">NVNnativeWindow</a> nativeWindow)</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;{</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(pLoader != NULL, <span class="stringliteral">&quot;Bootstrap loader function pointer is NULL\n&quot;</span>);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160; </div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="preprocessor">#ifdef USE_WIN_NVNGD</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160; </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="keyword">const</span> std::string interceptionLibrary = <span class="stringliteral">&quot;NV_TargetGLInterceptor.dll&quot;</span>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    std::string interceptionLibraryPath;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="comment">/* Try in the directory for the application */</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    std::array&lt;char, MAX_PATH&gt; exePath;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    GetModuleFileNameA(<span class="keyword">nullptr</span>, exePath.data(), DWORD(exePath.size()));</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    interceptionLibraryPath = exePath.data();</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160; </div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="comment">/* Strip the exe name from the path and create the interception library path */</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">size_t</span> lastSlashPos = interceptionLibraryPath.find_last_of(<span class="charliteral">&#39;\\&#39;</span>);</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    interceptionLibraryPath = interceptionLibraryPath.substr(0, lastSlashPos + 1) + interceptionLibrary;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="comment">/* Attempt to load interception library */</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    HMODULE hGraphicsDebugger = LoadLibraryA(interceptionLibraryPath.c_str());</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">if</span> (!hGraphicsDebugger)</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            <span class="comment">/* Failed in the application directory, try in the SDK path */</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        LPCTSTR pathSDKVar = L<span class="stringliteral">&quot;NINTENDO_SDK_ROOT&quot;</span>;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        DWORD pathSDKLen = <a class="code" href="namespacenn_1_1htc.html#a370e114a42a12b384ef2b2246618168e">GetEnvironmentVariable</a>(pathSDKVar, <span class="keyword">nullptr</span>, 0);</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keywordflow">if</span> (pathSDKLen)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            std::vector&lt;char&gt; pathSDKBuffer(pathSDKLen);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            <a class="code" href="namespacenn_1_1htc.html#a370e114a42a12b384ef2b2246618168e">GetEnvironmentVariable</a>(pathSDKVar, (LPTSTR)pathSDKBuffer.data(), pathSDKLen);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160; </div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            interceptionLibraryPath = pathSDKBuffer.data();</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            interceptionLibraryPath += <span class="stringliteral">&quot;\\..\\NvnGraphicsDebugger\\target\\windows-desktop-nvn-x64\\&quot;</span> + interceptionLibrary;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160; </div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        hGraphicsDebugger = LoadLibraryA(interceptionLibraryPath.c_str());</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">if</span> (hGraphicsDebugger)</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        pfnc_nvnDeviceGetProcAddress = (<a class="code" href="group__nvn__c__entryfuncptrs.html#ga9557d931192cd70c7d2810a6425326eb">PFNNVNDEVICEGETPROCADDRESSPROC</a>)GetProcAddress(hGraphicsDebugger, <span class="stringliteral">&quot;nvnDeviceGetProcAddress&quot;</span>);</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            <span class="comment">/* Load the function pointer to get other nvn function pointers. */</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        pfnc_nvnDeviceGetProcAddress = (<a class="code" href="group__nvn__c__entryfuncptrs.html#ga9557d931192cd70c7d2810a6425326eb">PFNNVNDEVICEGETPROCADDRESSPROC</a>)(*pLoader)(<span class="stringliteral">&quot;nvnDeviceGetProcAddress&quot;</span>);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="keywordflow">if</span> (pfnc_nvnDeviceGetProcAddress == NULL)</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                <span class="comment">/* This can happen if an NVN driver is not installed on a Windows PC. */</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(0, <span class="stringliteral">&quot;BootstrapLoader failed to find nvnDeviceGetProcAddress&quot;</span>);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        }</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160; </div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">         * Load function pointers for creating nvn device</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    nvnLoadCProcs(NULL, pfnc_nvnDeviceGetProcAddress);</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160; </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="comment">/* Check the API version. */</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordtype">int</span> majorVersion, minorVersion;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    nvnDeviceGetInteger(NULL, NVN_DEVICE_INFO_API_MAJOR_VERSION, &amp;majorVersion);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    nvnDeviceGetInteger(NULL, NVN_DEVICE_INFO_API_MINOR_VERSION, &amp;minorVersion);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">if</span> (majorVersion != <a class="code" href="group__nvn__c__defines.html#ga4eb83fe713146d844b1ac7f8e9c3dada">NVN_API_MAJOR_VERSION</a> || minorVersion &lt; <a class="code" href="group__nvn__c__defines.html#gaa8b4a49a0c4f852b73be3b50bb3f270e">NVN_API_MINOR_VERSION</a>)</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>( 0, <span class="stringliteral">&quot;NVN SDK not supported by current driver.&quot;</span> );</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="comment">/* If debug or develop is enabled, turn on NVN&#39;s debug layer. */</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordtype">int</span> deviceFlags = 0;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="preprocessor">#if defined(NN_SDK_BUILD_DEBUG) || defined(NN_SDK_BUILD_DEVELOP)</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    deviceFlags = <a class="code" href="group__nvn__c__enum.html#gga9c68350bf64f2e7a90a23290c26872d3a12928b2591c67a2a61cf67c5b1d4c5e9">NVN_DEVICE_FLAG_DEBUG_ENABLE_LEVEL_4_BIT</a>;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160; </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <a class="code" href="struct_n_v_ndevice_builder.html">NVNdeviceBuilder</a> deviceBuilder;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    nvnDeviceBuilderSetDefaults(&amp;deviceBuilder);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    nvnDeviceBuilderSetFlags(&amp;deviceBuilder, deviceFlags);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160; </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keywordflow">if</span> (nvnDeviceInitialize(&amp;m_Device, &amp;deviceBuilder) == <span class="keyword">false</span>)</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">             * This can fail for a few reasons; the most likely on Horizon is</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">             * insufficent device memory.</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(0, <span class="stringliteral">&quot;nvnDeviceInitialize&quot;</span>);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    }</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160; </div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">         * Ensure function pointers are all loaded properly</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    nvnLoadCProcs(&amp;m_Device, pfnc_nvnDeviceGetProcAddress);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="comment">/* Setup the debug callback for the debug layer. */</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordflow">if</span> (deviceFlags &amp; NVN_DEVICE_FLAG_DEBUG_ENABLE_LEVEL_4_BIT)</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        nvnDeviceInstallDebugCallback(</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            &amp;m_Device,</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="group__nvn__c__funcptrs.html#gab106acc34961bf1c3a43514686dbfc4b">PFNNVNDEBUGCALLBACKPROC</a><span class="keyword">&gt;</span>(&amp;DebugLayerCallback),</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            NULL, <span class="comment">// For testing purposes; any pointer is OK here.</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            <a class="code" href="group__nvn__c__defines.html#ga48151b7e768a13685d77d1a4c464a33b">NVN_TRUE</a> <span class="comment">// NVN_TRUE = Enable the callback.</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            );</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    }</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="comment">/* Initialize the queue. */</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    <a class="code" href="struct_n_v_nqueue_builder.html">NVNqueueBuilder</a> queueBuilder;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    nvnQueueBuilderSetDevice(&amp;queueBuilder, &amp;m_Device);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    nvnQueueBuilderSetDefaults(&amp;queueBuilder);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="comment">/* Set the queue control memory size */</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordtype">int</span> defaultQueueControlMemorySize = 0;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    nvnDeviceGetInteger(&amp;m_Device, NVN_DEVICE_INFO_QUEUE_CONTROL_MEMORY_DEFAULT_SIZE, &amp;defaultQueueControlMemorySize);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    nvnQueueBuilderSetControlMemorySize(&amp;queueBuilder, defaultQueueControlMemorySize * 2);</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="comment">/* Set the queue command memory size */</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <span class="keywordtype">int</span> minQueueCommandMemorySize = 0;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    nvnDeviceGetInteger(&amp;m_Device, NVN_DEVICE_INFO_QUEUE_COMMAND_MEMORY_MIN_SIZE, &amp;minQueueCommandMemorySize);</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    nvnQueueBuilderSetCommandMemorySize(&amp;queueBuilder, minQueueCommandMemorySize);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    nvnQueueBuilderSetCommandFlushThreshold(&amp;queueBuilder, minQueueCommandMemorySize);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordtype">size_t</span> neededQueueMemorySize = nvnQueueBuilderGetQueueMemorySize(&amp;queueBuilder);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160; </div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">if</span> ((neededQueueMemorySize % <a class="code" href="group__nvn__c__defines.html#gadfd69601d2d9f953c55808127ba60853">NVN_MEMORY_POOL_STORAGE_GRANULARITY</a>) != 0)</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(0, <span class="stringliteral">&quot;Memory size reported for queue is not the proper granularity&quot;</span>);</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    }</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="preprocessor">#if defined( NN_BUILD_TARGET_PLATFORM_OS_WIN )</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    m_pQueueMemory = NULL;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    m_pQueueMemory = AlignedAllocate(neededQueueMemorySize, <a class="code" href="group__nvn__c__defines.html#gace820e752b400cf7aa36e9684a7f45cb">NVN_MEMORY_POOL_STORAGE_ALIGNMENT</a>);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    nvnQueueBuilderSetQueueMemory(&amp;queueBuilder, m_pQueueMemory, neededQueueMemorySize);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">if</span> (nvnQueueInitialize(&amp;m_Queue, &amp;queueBuilder) == <span class="keyword">false</span>)</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    {</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(0, <span class="stringliteral">&quot;nvnQueueInitialize failed&quot;</span>);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="comment">/* Set up command buffers*/</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    m_BackBufferCommandBuffer = <span class="keyword">new</span> ManagedCommandBuffer(&amp;m_Device, g_CommandMemoryChunkSize, g_ControlMemoryChunkSize, g_NumBackBuffers);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    m_GBufferCommandBuffer = <span class="keyword">new</span> ManagedCommandBuffer(&amp;m_Device, 64 * g_CommandMemoryChunkSize, 96 * g_ControlMemoryChunkSize, g_NumBackBuffers);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    m_ScalableAODepthCommandBuffer = <span class="keyword">new</span> ManagedCommandBuffer(&amp;m_Device, g_CommandMemoryChunkSize, g_ControlMemoryChunkSize, g_NumBackBuffers);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    m_ScalableAOMipmapCommandBuffer = <span class="keyword">new</span> ManagedCommandBuffer(&amp;m_Device, 2 * g_CommandMemoryChunkSize, 2 * g_ControlMemoryChunkSize, g_NumBackBuffers);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    m_ScalableAOCommandBuffer = <span class="keyword">new</span> ManagedCommandBuffer(&amp;m_Device, g_CommandMemoryChunkSize, g_ControlMemoryChunkSize, g_NumBackBuffers);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    m_ScalableAOBlurCommandBuffer = <span class="keyword">new</span> ManagedCommandBuffer(&amp;m_Device, g_CommandMemoryChunkSize, g_ControlMemoryChunkSize, g_NumBackBuffers);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    m_ShadowMapPassCommandBuffer = <span class="keyword">new</span> ManagedCommandBuffer(&amp;m_Device, 64 * g_CommandMemoryChunkSize, 96 * g_ControlMemoryChunkSize, g_NumBackBuffers);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    m_LightingPassCommandBuffer = <span class="keyword">new</span> ManagedCommandBuffer(&amp;m_Device, 16 * g_CommandMemoryChunkSize, 16 * g_ControlMemoryChunkSize, g_NumBackBuffers);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    m_SkyBoxCommandBuffer = <span class="keyword">new</span> ManagedCommandBuffer(&amp;m_Device, g_CommandMemoryChunkSize, g_ControlMemoryChunkSize, g_NumBackBuffers);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="comment">/* Set up builders */</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    nvnSamplerBuilderSetDevice(&amp;m_SamplerBuilder, &amp;m_Device);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    nvnSamplerBuilderSetDefaults(&amp;m_SamplerBuilder);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160; </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    nvnBufferBuilderSetDevice(&amp;m_BufferBuilder, &amp;m_Device);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    nvnBufferBuilderSetDefaults(&amp;m_BufferBuilder);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160; </div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    nvnTextureBuilderSetDevice(&amp;m_RenderTargetBuilder, &amp;m_Device);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    nvnTextureBuilderSetDefaults(&amp;m_RenderTargetBuilder);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160; </div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="comment">/* Create texture ID manager and asset loader */</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    m_pTextureIDManager = <span class="keyword">new</span> TextureIDManager(&amp;m_Device);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    m_pAssetLoader = <span class="keyword">new</span> AssetFileLoadingHelper(&amp;m_Device, m_pTextureIDManager);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="comment">/* Create uniform buffer managers */</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    m_pUniformBufferManager = <span class="keyword">new</span> UniformBufferManager(&amp;m_Device, 8 * 1024 * 1024, g_NumBackBuffers);</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    m_pStaticUniformBufferManager = <span class="keyword">new</span> UniformBufferManager(&amp;m_Device, 16 * 1024 * 1024, 1);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="comment">/* Register memory managers with the sync manager */</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    m_pFrameBufferedSyncManager = <span class="keyword">new</span> FrameBufferedSyncManager(&amp;m_Device, &amp;m_Queue, g_NumBackBuffers);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    m_pFrameBufferedSyncManager-&gt;RegisterMemoryManager(m_pUniformBufferManager);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    m_pFrameBufferedSyncManager-&gt;RegisterMemoryManager(m_BackBufferCommandBuffer);</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    m_pFrameBufferedSyncManager-&gt;RegisterMemoryManager(m_GBufferCommandBuffer);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    m_pFrameBufferedSyncManager-&gt;RegisterMemoryManager(m_ScalableAODepthCommandBuffer);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    m_pFrameBufferedSyncManager-&gt;RegisterMemoryManager(m_ScalableAOMipmapCommandBuffer);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    m_pFrameBufferedSyncManager-&gt;RegisterMemoryManager(m_ScalableAOCommandBuffer);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    m_pFrameBufferedSyncManager-&gt;RegisterMemoryManager(m_ScalableAOBlurCommandBuffer);</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    m_pFrameBufferedSyncManager-&gt;RegisterMemoryManager(m_LightingPassCommandBuffer);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    m_pFrameBufferedSyncManager-&gt;RegisterMemoryManager(m_SkyBoxCommandBuffer);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    m_pFrameBufferedSyncManager-&gt;RegisterMemoryManager(m_ShadowMapPassCommandBuffer);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    <span class="keywordtype">size_t</span> cacheSize;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <a class="code" href="classnn_1_1_result.html">nn::Result</a> result = <a class="code" href="namespacenn_1_1fs.html#a5df6e3385c795a5bd046790ef7f17f2d">nn::fs::QueryMountRomCacheSize</a>(&amp;cacheSize);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(result.IsSuccess());</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160; </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordtype">char</span>* mountRomCacheBuffer = <span class="keyword">new</span>(std::nothrow) <span class="keywordtype">char</span>[cacheSize];</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>(mountRomCacheBuffer);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    result = <a class="code" href="namespacenn_1_1fs.html#a2e453fe1fbf8f818dc45bbd2897105cd">nn::fs::MountRom</a>(<span class="stringliteral">&quot;rom&quot;</span>, (<span class="keywordtype">void</span>*)mountRomCacheBuffer, cacheSize);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <a class="code" href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a>(result);</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="comment">/* Load scene */</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    SetupSceneFromFile(g_SceneFileName);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="comment">/* Set up the screen space quad pass */</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordtype">void</span>* place = AlignedAllocate(<span class="keyword">sizeof</span>(ScreenSpaceQuadPass), <a class="code" href="nn___macro_8h.html#ac6f80ca2ebf15f619391e35806e9635f">NN_ALIGNOF</a>(ScreenSpaceQuadPass));</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    m_pScreenSpaceQuadPass = <span class="keyword">new</span>(place) ScreenSpaceQuadPass;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    m_pScreenSpaceQuadPass-&gt;Init(m_Shaders[<span class="stringliteral">&quot;ScreenSpaceQuad.out&quot;</span>]);</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    m_pScreenSpaceQuadPass-&gt;SetupUniforms(m_pUniformBufferManager);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    place = AlignedAllocate(<span class="keyword">sizeof</span>(ScalableAODepthPass), <a class="code" href="nn___macro_8h.html#ac6f80ca2ebf15f619391e35806e9635f">NN_ALIGNOF</a>(ScalableAODepthPass));</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    m_pScalableAODepthPass = <span class="keyword">new</span>(place) ScalableAODepthPass;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    m_pScalableAODepthPass-&gt;Init(m_Shaders[<span class="stringliteral">&quot;ScalableAODepth.out&quot;</span>]);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    m_pScalableAODepthPass-&gt;SetupUniforms(m_pUniformBufferManager);</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    place = AlignedAllocate(<span class="keyword">sizeof</span>(ScalableAOMipmapPass), <a class="code" href="nn___macro_8h.html#ac6f80ca2ebf15f619391e35806e9635f">NN_ALIGNOF</a>(ScalableAOMipmapPass));</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    m_pScalableAOMipmapPass = <span class="keyword">new</span>(place) ScalableAOMipmapPass;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    m_pScalableAOMipmapPass-&gt;Init(m_Shaders[<span class="stringliteral">&quot;ScalableAOMipmap.out&quot;</span>]);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    m_pScalableAOMipmapPass-&gt;SetupUniforms(m_pUniformBufferManager);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160; </div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    nvnSamplerBuilderSetDefaults(&amp;m_SamplerBuilder);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160; </div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="preprocessor">#ifdef DEBUGTEXT</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="comment">/* Setup the debug text renderer */</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    m_pDebugTextRenderer = DebugTextRenderer::GetInstance();</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    m_pDebugTextRenderer-&gt;Init(&amp;m_Device, &amp;m_Queue, m_pTextureIDManager, m_pFrameBufferedSyncManager, g_NumBackBuffers);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    m_pDebugTextRenderer-&gt;SetDrawEnable(<span class="keyword">true</span>);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    m_pDebugTextRenderer-&gt;SetSpacing(<span class="keyword">false</span>);</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    m_pDebugTextRenderer-&gt;SetGridSize(120.0f, 36.0f);</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    m_pDebugTextRenderer-&gt;SetColor(1.0f, 0.0f, 0.0f, 1.0f);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160; </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <a class="code" href="namespacenn_1_1fs.html#ac8a95249afd4a87a55d319dfecb0466c">nn::fs::Unmount</a>(<span class="stringliteral">&quot;rom&quot;</span>);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keyword">delete</span>[] mountRomCacheBuffer;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="comment">/* Setup the window builder */</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    nvnWindowBuilderSetDefaults(&amp;m_WindowBuilder);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    nvnWindowBuilderSetDevice(&amp;m_WindowBuilder, &amp;m_Device);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    nvnWindowBuilderSetNativeWindow(&amp;m_WindowBuilder, nativeWindow);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160; </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="comment">/* Blend State */</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    nvnBlendStateSetDefaults(&amp;m_BlendState);</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="comment">/* Channel Mask State */</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    nvnChannelMaskStateSetDefaults(&amp;m_ChannelMaskState);</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160; </div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="comment">/* Color State */</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    nvnColorStateSetDefaults(&amp;m_ColorState);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    nvnColorStateSetBlendEnable(&amp;m_ColorState, 0, <a class="code" href="group__nvn__c__defines.html#ga48151b7e768a13685d77d1a4c464a33b">NVN_TRUE</a>);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160; </div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        <span class="comment">/* Depth Stencil State */</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    nvnDepthStencilStateSetDefaults(&amp;m_DepthStencilState);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    nvnDepthStencilStateSetDepthTestEnable(&amp;m_DepthStencilState, <a class="code" href="group__nvn__c__defines.html#ga48151b7e768a13685d77d1a4c464a33b">NVN_TRUE</a>);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    nvnDepthStencilStateSetDepthWriteEnable(&amp;m_DepthStencilState, <a class="code" href="group__nvn__c__defines.html#ga48151b7e768a13685d77d1a4c464a33b">NVN_TRUE</a>);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    nvnDepthStencilStateSetDepthFunc(&amp;m_DepthStencilState, NVN_DEPTH_FUNC_LESS);</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="comment">/* Multisample state */</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    nvnMultisampleStateSetDefaults(&amp;m_MultisampleState);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160; </div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="comment">/* Initialize the input manager */</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    m_InputManager.Init();</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160; </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    nvnSyncInitialize(&amp;m_WindowSync, &amp;m_Device);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;        <span class="comment">/* Setup the default target to present*/</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    m_pPresentHandle = &amp;m_FinalTarget.m_TextureHandle;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    m_PresentTargetName = <span class="stringliteral">&quot;Final Image&quot;</span>;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    m_pPresentPass = m_pScreenSpaceQuadPass;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160; </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="comment">/* Create a sampler for visualizing the directional shadow map */</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    nvnSamplerBuilderSetWrapMode(&amp;m_SamplerBuilder, NVN_WRAP_MODE_CLAMP_TO_EDGE, NVN_WRAP_MODE_CLAMP_TO_EDGE, NVN_WRAP_MODE_CLAMP_TO_EDGE);</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    m_pShadowMapDisplaySampler = <span class="keyword">new</span> <a class="code" href="struct_n_v_nsampler.html">NVNsampler</a>();</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    nvnSamplerInitialize(m_pShadowMapDisplaySampler, &amp;m_SamplerBuilder);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    m_ShadowMapDisplaySamplerID = m_pTextureIDManager-&gt;RegisterSampler(m_pShadowMapDisplaySampler);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    AssetFileDataHolder* shaderData = m_Shaders[<span class="stringliteral">&quot;PointShadowMap.out&quot;</span>];</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    std::string programName = shaderData-&gt;GetSpecializedProgramData()[0]-&gt;m_pProgramName;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <a class="code" href="struct_n_v_ncommand_buffer.html">NVNcommandBuffer</a>* pCommandBuffer = m_ShadowMapPassCommandBuffer-&gt;GetCommandBuffer();</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160; </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="comment">/* Point Light Shadows */</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; m_DeferredPointLightObjects.size(); ++i)</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    {</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordflow">if</span> (m_DeferredPointLightObjects[i]-&gt;IsShadowCaster())</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        {</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            <span class="keywordflow">for</span> (uint32_t mapIdx = 0; mapIdx &lt; 6; ++mapIdx)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                RenderPointLightShadowFace(m_DeferredPointLightObjects[i], pCommandBuffer, mapIdx, shaderData);</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;                    <span class="comment">/*</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">                     * Because the same command buffer is being used for each face, the memory</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">                     * needs to be swapped. If this was being done at run time instead of on</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">                     * load, this kind of syncing and flushing should be avoided.</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">                     */</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                m_pFrameBufferedSyncManager-&gt;InsertFence();</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                m_pFrameBufferedSyncManager-&gt;SwapPools();</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            }</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        }</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;= g_MaxMipLevel; ++i)</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        nvnTextureViewSetDefaults(&amp;m_SAODepthBufferTextureView[i]);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        nvnTextureViewSetLevels(&amp;m_SAODepthBufferTextureView[i], i, 1);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    }</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        <span class="comment">/* Setup buffer for GPU times measurement */</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    m_TimeStampBufferSize = <span class="keyword">sizeof</span>(int64_t) * 20;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    m_TimeStampPool.Init(<span class="keyword">nullptr</span>, g_NumBackBuffers * m_TimeStampBufferSize, NVN_MEMORY_POOL_FLAGS_CPU_UNCACHED_BIT | NVN_MEMORY_POOL_FLAGS_GPU_UNCACHED_BIT, &amp;m_Device);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160; </div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <a class="code" href="struct_n_v_nbuffer_builder.html">NVNbufferBuilder</a> timeStampBuilder;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    nvnBufferBuilderSetDefaults(&amp;timeStampBuilder);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    nvnBufferBuilderSetDevice(&amp;timeStampBuilder, &amp;m_Device);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160; </div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    nvnBufferBuilderSetStorage(&amp;timeStampBuilder, m_TimeStampPool.GetMemoryPool(), 0, g_NumBackBuffers * m_TimeStampBufferSize);</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    nvnBufferInitialize(&amp;m_TimeStampBuffer, &amp;timeStampBuilder);</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;}<span class="comment">//NOLINT(impl/function_size)</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment"> * AmbientOcclusion::Resize</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment"> * ------------------------</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment"> * This method is called everytime the window is resized and is passed</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment"> * the new size of the window. It frees the old render targets and creates a new</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment"> * render targets with the new screen size. Then it resets the point light static uniforms with</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment"> * the new texture handles, regenerates shadow map and sets a new render target for the gaussian blur</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::Resize(<span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height)</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;{</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="comment">/* Make sure nothing is currently in use */</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    nvnQueueFinish(&amp;m_Queue);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160; </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="comment">/* Save the new width and height */</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    m_ScreenWidth  = width;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    m_ScreenHeight = height;</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160; </div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <span class="comment">/* Get the size of each type of texture to create */</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="keywordtype">size_t</span> colorTargetSize =    TextureUtil::GetTextureSize(NVN_TEXTURE_FLAGS_DISPLAY_BIT |</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                                                            NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                                                            m_ScreenWidth,</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                                                            m_ScreenHeight,</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                                                            NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                                                            NVN_FORMAT_RGBA8_SRGB,</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                                                            m_RenderTargetBuilder);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordtype">size_t</span> dataTargetSize =     TextureUtil::GetTextureSize(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                                                            m_ScreenWidth,</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                                                            m_ScreenHeight,</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                                                            NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                                                            NVN_FORMAT_R11G11B10F,</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                                                            m_RenderTargetBuilder);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordtype">size_t</span> depthTargetSize =    TextureUtil::GetTextureSize(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                                                            m_ScreenWidth,</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                                                            m_ScreenHeight,</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                                                            NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                                                            NVN_FORMAT_DEPTH24_STENCIL8,</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                                                            m_RenderTargetBuilder);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160; </div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordtype">size_t</span> diffuseTargetSize =  TextureUtil::GetTextureSize(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                                                            m_ScreenWidth,</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                                                            m_ScreenHeight,</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                                                            NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                                                            NVN_FORMAT_RGBA8,</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                                                            m_RenderTargetBuilder);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160; </div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="keywordtype">size_t</span> specularTargetSize = TextureUtil::GetTextureSize(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                                                            m_ScreenWidth,</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                                                            m_ScreenHeight,</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                                                            NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                                                            NVN_FORMAT_RGBA8,</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                                                            m_RenderTargetBuilder);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keywordtype">size_t</span> shadowTargetSize =   TextureUtil::GetTextureSize(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                                                            m_pDirectionalLightPassAO-&gt;GetShadowMapWidth(),</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                                                            m_pDirectionalLightPassAO-&gt;GetShadowMapHeight(),</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                                                            NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                                                            NVN_FORMAT_DEPTH32F,</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                                                            m_RenderTargetBuilder);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordtype">size_t</span> saoDepthBufferTargetSize =  TextureUtil::GetTextureSize(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                                                                   m_pScalableAOPass-&gt;GetWidth(),</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                                                                   m_pScalableAOPass-&gt;GetHeight(),</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                                                                   NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                                                                   NVN_FORMAT_R32F,</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                                                                   m_RenderTargetBuilder,</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                                                                   g_MaxMipLevel + 1);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160; </div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <span class="keywordtype">size_t</span> saoTargetSize = TextureUtil::GetTextureSize(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                                                       m_pScalableAOPass-&gt;GetWidth(),</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                                                       m_pScalableAOPass-&gt;GetHeight(),</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                                                       NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                                                       NVN_FORMAT_RGBA8,</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                                                       m_RenderTargetBuilder);</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keywordtype">size_t</span> saoBlurTargetSize = TextureUtil::GetTextureSize(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                                                           m_pScalableAOPass-&gt;GetWidth(),</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                                                           m_pScalableAOPass-&gt;GetHeight(),</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                                                           NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                                                           NVN_FORMAT_RGBA8,</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                                                           m_RenderTargetBuilder);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160; </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="keywordtype">size_t</span> saoFinalTargetSize = TextureUtil::GetTextureSize(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                                                            m_pScalableAOPass-&gt;GetWidth(),</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                                                            m_pScalableAOPass-&gt;GetHeight(),</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                                                            NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                                                            NVN_FORMAT_R8,</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                                                            m_RenderTargetBuilder);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160; </div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">         * If this pool already exists, finalize the window, finalize all</span></div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">         * textures allocated from it, and shutdown the pool.</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordflow">if</span> (m_pRenderTargetMemoryPool)</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    {</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        nvnWindowFinalize(&amp;m_Window);</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        nvnTextureFinalize(&amp;m_DepthBuffer.m_Texture);</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        nvnTextureFinalize(&amp;m_DiffuseTarget.m_Texture);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        nvnTextureFinalize(&amp;m_SpecularTarget.m_Texture);</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        nvnTextureFinalize(&amp;m_NormalTarget.m_Texture);</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        nvnTextureFinalize(&amp;m_DirectionalShadowMap.m_Texture);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        nvnTextureFinalize(&amp;m_ScalableAODepthTarget.m_Texture);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        nvnTextureFinalize(&amp;m_ScalableAOTarget.m_Texture);</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        nvnTextureFinalize(&amp;m_ScalableAOBlurTarget.m_Texture);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        nvnTextureFinalize(&amp;m_ScalableAOFinalTarget.m_Texture);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        nvnTextureFinalize(&amp;m_FinalTarget.m_Texture);</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160; </div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        m_pRenderTargetMemoryPool-&gt;Shutdown();</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    }</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        m_pRenderTargetMemoryPool = <span class="keyword">new</span> <a class="code" href="namespacenn_1_1gfx.html#ad620d8208dd309eb7c4dd5973a6aeee5">MemoryPool</a>();</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    }</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160; </div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <span class="comment">/* Create the render target memory pool with the appropriate size */</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    m_pRenderTargetMemoryPool-&gt;Init(NULL,</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                                    colorTargetSize * g_NumBackBuffers +</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                                    shadowTargetSize +</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                                    depthTargetSize +</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                                    dataTargetSize +</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                                    2 * diffuseTargetSize +</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                                    specularTargetSize +</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                                    saoDepthBufferTargetSize +</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                                    saoTargetSize +</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                                    saoBlurTargetSize +</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                                    saoFinalTargetSize,</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                                    NVN_MEMORY_POOL_FLAGS_CPU_NO_ACCESS_BIT |</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                                    NVN_MEMORY_POOL_FLAGS_GPU_CACHED_BIT |</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                                    NVN_MEMORY_POOL_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                                    &amp;m_Device);</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160; </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <span class="comment">/* Create each texture at the proper offset in the render target pool */</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    ptrdiff_t currentOffset = 0;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; g_NumBackBuffers; ++i)</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        m_ScreenRenderTargets[i] = <span class="keyword">new</span> <a class="code" href="struct_n_v_ntexture.html">NVNtexture</a>;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160; </div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        TextureUtil::CreateTexture(NVN_TEXTURE_FLAGS_DISPLAY_BIT |</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                                   NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                                   m_ScreenWidth,</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                                   m_ScreenHeight,</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                                   NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                                   NVN_FORMAT_RGBA8_SRGB,</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                                   m_pRenderTargetMemoryPool,</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                                   currentOffset,</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                                   m_RenderTargetBuilder,</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                                   m_ScreenRenderTargets[i]);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160; </div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        currentOffset += colorTargetSize;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    }</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160; </div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    TextureUtil::CreateRenderTarget(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                                    m_ScreenWidth,</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                                    m_ScreenHeight,</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                                    NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                                    NVN_FORMAT_DEPTH24_STENCIL8,</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                                    m_pRenderTargetMemoryPool,</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                                    currentOffset,</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;                                    m_RenderTargetBuilder,</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;                                    m_SamplerBuilder,</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;                                    m_pTextureIDManager,</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                                    &amp;m_Device,</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                                    &amp;m_DepthBuffer);</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160; </div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    currentOffset += depthTargetSize;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160; </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    TextureUtil::CreateRenderTarget(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                                    m_ScreenWidth,</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                                    m_ScreenHeight,</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;                                    NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                                    NVN_FORMAT_R11G11B10F,</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                                    m_pRenderTargetMemoryPool,</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                                    currentOffset,</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;                                    m_RenderTargetBuilder,</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                                    m_SamplerBuilder,</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;                                    m_pTextureIDManager,</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                                    &amp;m_Device,</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                                    &amp;m_NormalTarget);</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160; </div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    currentOffset += dataTargetSize;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160; </div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    TextureUtil::CreateRenderTarget(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                                    m_ScreenWidth,</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                                    m_ScreenHeight,</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                                    NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                                    NVN_FORMAT_RGBA8,</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                                    m_pRenderTargetMemoryPool,</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                                    currentOffset,</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                                    m_RenderTargetBuilder,</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                                    m_SamplerBuilder,</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                                    m_pTextureIDManager,</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                                    &amp;m_Device,</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                                    &amp;m_DiffuseTarget);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    currentOffset += diffuseTargetSize;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160; </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    TextureUtil::CreateRenderTarget(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                                    m_ScreenWidth,</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                                    m_ScreenHeight,</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                                    NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                                    NVN_FORMAT_RGBA8_SRGB,</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                                    m_pRenderTargetMemoryPool,</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                                    currentOffset,</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                                    m_RenderTargetBuilder,</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                                    m_SamplerBuilder,</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                                    m_pTextureIDManager,</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                                    &amp;m_Device,</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                                    &amp;m_FinalTarget);</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160; </div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    currentOffset += diffuseTargetSize;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160; </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    TextureUtil::CreateRenderTarget(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                                    m_pDirectionalLightPassAO-&gt;GetShadowMapWidth(),</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                                    m_pDirectionalLightPassAO-&gt;GetShadowMapHeight(),</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                                    NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                                    NVN_FORMAT_DEPTH32F,</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                                    m_pRenderTargetMemoryPool,</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                                    currentOffset,</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                                    m_RenderTargetBuilder,</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                                    m_SamplerBuilder,</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                                    m_pTextureIDManager,</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                                    &amp;m_Device,</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                                    &amp;m_DirectionalShadowMap,</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                                    <span class="keyword">true</span>);</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160; </div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    currentOffset += shadowTargetSize;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160; </div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    TextureUtil::CreateRenderTarget(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                                    m_ScreenWidth,</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                                    m_ScreenHeight,</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                                    NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                                    NVN_FORMAT_RGBA8,</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                                    m_pRenderTargetMemoryPool,</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                                    currentOffset,</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                                    m_RenderTargetBuilder,</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                                    m_SamplerBuilder,</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                                    m_pTextureIDManager,</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                                    &amp;m_Device,</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                                    &amp;m_SpecularTarget);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160; </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    currentOffset += specularTargetSize;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160; </div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    TextureUtil::CreateRenderTarget(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                                    m_pScalableAOPass-&gt;GetWidth(),</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                                    m_pScalableAOPass-&gt;GetHeight(),</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                                    NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                                    NVN_FORMAT_R32F,</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                                    m_pRenderTargetMemoryPool,</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                                    currentOffset,</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                                    m_RenderTargetBuilder,</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                                    m_SamplerBuilder,</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                                    m_pTextureIDManager,</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;                                    &amp;m_Device,</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                                    &amp;m_ScalableAODepthTarget,</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                                    <span class="keyword">false</span>,</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                                    NVN_TEXTURE_SWIZZLE_R,</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                                    NVN_TEXTURE_SWIZZLE_R,</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                                    NVN_TEXTURE_SWIZZLE_R,</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                                    NVN_TEXTURE_SWIZZLE_ONE,</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                                    g_MaxMipLevel + 1);</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160; </div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    currentOffset += saoDepthBufferTargetSize;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160; </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    TextureUtil::CreateRenderTarget(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                                    m_pScalableAOPass-&gt;GetWidth(),</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                                    m_pScalableAOPass-&gt;GetHeight(),</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                                    NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                                    NVN_FORMAT_RGBA8,</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                                    m_pRenderTargetMemoryPool,</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;                                    currentOffset,</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;                                    m_RenderTargetBuilder,</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;                                    m_SamplerBuilder,</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                                    m_pTextureIDManager,</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;                                    &amp;m_Device,</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                                    &amp;m_ScalableAOTarget,</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                                    <span class="keyword">false</span>,</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;                                    NVN_TEXTURE_SWIZZLE_R,</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                                    NVN_TEXTURE_SWIZZLE_G,</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;                                    NVN_TEXTURE_SWIZZLE_B,</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;                                    NVN_TEXTURE_SWIZZLE_ONE);</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160; </div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; </div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    currentOffset += saoTargetSize;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160; </div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    TextureUtil::CreateRenderTarget(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                                    m_pScalableAOPass-&gt;GetWidth(),</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                                    m_pScalableAOPass-&gt;GetHeight(),</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;                                    NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                                    NVN_FORMAT_RGBA8,</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                                    m_pRenderTargetMemoryPool,</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                                    currentOffset,</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                                    m_RenderTargetBuilder,</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                                    m_SamplerBuilder,</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                                    m_pTextureIDManager,</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                                    &amp;m_Device,</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                                    &amp;m_ScalableAOBlurTarget,</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                                    <span class="keyword">false</span>,</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                                    NVN_TEXTURE_SWIZZLE_R,</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                                    NVN_TEXTURE_SWIZZLE_G,</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;                                    NVN_TEXTURE_SWIZZLE_B,</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                                    NVN_TEXTURE_SWIZZLE_ONE);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160; </div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    currentOffset += saoBlurTargetSize;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160; </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    TextureUtil::CreateRenderTarget(NVN_TEXTURE_FLAGS_COMPRESSIBLE_BIT,</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                                    m_pScalableAOPass-&gt;GetWidth(),</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                                    m_pScalableAOPass-&gt;GetHeight(),</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;                                    NVN_TEXTURE_TARGET_2D,</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                                    NVN_FORMAT_R8,</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                                    m_pRenderTargetMemoryPool,</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                                    currentOffset,</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                                    m_RenderTargetBuilder,</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                                    m_SamplerBuilder,</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                                    m_pTextureIDManager,</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                                    &amp;m_Device,</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                                    &amp;m_ScalableAOFinalTarget,</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                                    <span class="keyword">false</span>,</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                                    NVN_TEXTURE_SWIZZLE_R,</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                                    NVN_TEXTURE_SWIZZLE_R,</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                                    NVN_TEXTURE_SWIZZLE_R,</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                                    NVN_TEXTURE_SWIZZLE_ONE);</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160; </div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    currentOffset += saoFinalTargetSize;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160; </div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        <span class="comment">/* Setup the projection matrix */</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    nn::util::MatrixPerspectiveFieldOfViewRightHanded(&amp;m_ProjMat44, m_FoV * DEG_TO_RAD, <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(m_ScreenWidth) / <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(m_ScreenHeight), m_Near, m_Far);</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160; </div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="keywordflow">if</span> (m_pSkyBox)</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        m_pSkyBox-&gt;SetProjectionMatrix(m_ProjMat44);</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    }</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160; </div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        <span class="comment">/* Set the back buffers and create the window */</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    nvnWindowBuilderSetTextures(&amp;m_WindowBuilder, g_NumBackBuffers, m_ScreenRenderTargets);</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    nvnWindowInitialize(&amp;m_Window, &amp;m_WindowBuilder);</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160; </div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <span class="comment">/* Reset the point light static uniforms with the new texture handles */</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    DeferredPointLightObject::SetTextureHandles(m_DiffuseTarget.m_TextureHandle,</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                                                m_SpecularTarget.m_TextureHandle,</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                                                m_NormalTarget.m_TextureHandle,</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                                                m_DepthBuffer.m_TextureHandle);</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160; </div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    DeferredPointLightObject::SetupStaticUniforms(m_pStaticUniformBufferManager, m_pUniformBufferManager);</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160; </div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        <span class="comment">/* Set the new screen size */</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; m_DeferredPointLightObjects.size(); ++i)</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    {</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        m_DeferredPointLightObjects[i]-&gt;SetScreenSize(m_ScreenWidth, m_ScreenHeight);</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    }</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160; </div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <span class="comment">/* Regen the shadows and get a new shadow map display texture handle */</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    m_GenerateShadows = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    m_ShadowMapDisplayHandle = nvnDeviceGetTextureHandle(&amp;m_Device, m_DirectionalShadowMap.m_TextureID, m_ShadowMapDisplaySamplerID);</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160; </div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    m_pScalableAODepthPass-&gt;SetClipInfo(m_Near, m_Far);</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;} <span class="comment">//NOLINT(impl/function_size)</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160; </div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment"> * AmbientOcclusion::RenderPointLightShadowFace</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment"> * --------------------------------------------</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="comment"> * Records and submits a command buffer to render one of the cubemap</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="comment"> * faces for a point light shadow map.</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::RenderPointLightShadowFace(DeferredPointLightObject* pPointLight,</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                                                  <a class="code" href="struct_n_v_ncommand_buffer.html">NVNcommandBuffer</a>* pCommandBuffer,</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                                                  uint32_t mapIdx,</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                                                  AssetFileDataHolder* shaderData)</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;{</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    std::string programName = shaderData-&gt;GetSpecializedProgramData()[0]-&gt;m_pProgramName;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160; </div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    nvnCommandBufferBeginRecording(pCommandBuffer);</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160; </div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    nvnCommandBufferBindBlendState(pCommandBuffer, &amp;m_BlendState);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    nvnCommandBufferBindChannelMaskState(pCommandBuffer, &amp;m_ChannelMaskState);</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    nvnCommandBufferBindColorState(pCommandBuffer, &amp;m_ColorState);</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;    nvnCommandBufferBindDepthStencilState(pCommandBuffer, &amp;m_DepthStencilState);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;    nvnCommandBufferBindMultisampleState(pCommandBuffer, &amp;m_MultisampleState);</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160; </div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    m_pTextureIDManager-&gt;SetSamplerPool(pCommandBuffer);</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    m_pTextureIDManager-&gt;SetTexturePool(pCommandBuffer);</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160; </div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;        <span class="comment">/* Update the model uniforms for the scene objects */</span></div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> objIdx = 0; objIdx &lt; m_SceneObjects.size(); ++objIdx)</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    {</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        <span class="keywordflow">if</span> (pPointLight-&gt;IsIgnoreShadow(m_SceneObjects[objIdx].GetName()))</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        {</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        }</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160; </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;            <span class="comment">/* Set the shadow camera and projection matrices for the face */</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        m_SceneObjects[objIdx].SetCameraMatrix(pPointLight-&gt;GetShadowCameraMatrices()[mapIdx]);</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        m_SceneObjects[objIdx].SetProjectionMatrix(pPointLight-&gt;GetShadowProjMatrix());</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        m_SceneObjects[objIdx].UpdateModelUniforms(programName);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    }</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160; </div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        <span class="comment">/* Update and bind the point light shadow mapping uniform */</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    pPointLight-&gt;UpdateShadowMapUniforms();</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    pPointLight-&gt;BindShadowMapUniforms(pCommandBuffer);</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160; </div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <a class="code" href="struct_n_v_ntexture.html">NVNtexture</a>* target = &amp;pPointLight-&gt;GetShadowMapTarget()-&gt;m_Texture;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160; </div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <span class="comment">/* Set the depth target to the shadow cubemap and set the view for the appropriate face */</span></div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    nvnCommandBufferSetRenderTargets(pCommandBuffer, 0, NULL, NULL, target, &amp;(pPointLight-&gt;GetShadowViews()[mapIdx]));</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160; </div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    nvnCommandBufferSetScissor(pCommandBuffer, 0, 0, pPointLight-&gt;GetShadowMapWidth(), pPointLight-&gt;GetShadowMapHeight());</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    nvnCommandBufferSetViewport(pCommandBuffer, 0, 0, pPointLight-&gt;GetShadowMapWidth(), pPointLight-&gt;GetShadowMapHeight());</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160; </div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    <span class="keywordflow">if</span> (m_pShaderScratchMemoryPool)</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    {</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        nvnCommandBufferSetShaderScratchMemory(pCommandBuffer, m_pShaderScratchMemoryPool-&gt;GetMemoryPool(), 0, m_ShaderScratchSize);</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    }</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160; </div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    nvnCommandBufferClearDepthStencil(pCommandBuffer, 1.0, <a class="code" href="group__nvn__c__defines.html#ga48151b7e768a13685d77d1a4c464a33b">NVN_TRUE</a>, 0, 0);</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160; </div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    nvnCommandBufferBarrier(pCommandBuffer, NVNbarrierBits::NVN_BARRIER_INVALIDATE_SHADER_BIT);</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160; </div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <span class="comment">/* Set the shadow state on and draw each object */</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> objIdx = 0; objIdx &lt; m_SceneObjects.size(); ++objIdx)</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    {</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        <span class="keywordflow">if</span> (pPointLight-&gt;IsIgnoreShadow(m_SceneObjects[objIdx].GetName()))</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        {</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        }</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160; </div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        m_SceneObjects[objIdx].SetShadowState();</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        m_SceneObjects[objIdx].Draw(pCommandBuffer, programName, m_Models, shaderData);</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    }</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160; </div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    <a class="code" href="group__nvn__c__handle.html#gab7f10945ffe1f6161c87238c75ae411d">NVNcommandHandle</a> handle = nvnCommandBufferEndRecording(pCommandBuffer);</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;    nvnQueueSubmitCommands(&amp;m_Queue, 1, &amp;handle);</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;}</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160; </div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment"> * AmbientOcclusion::Shutdown</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment"> * --------------------------</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment"> * Cleans up all dynamically allocated memory and NVN objects.</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::Shutdown()</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;{</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    nvnQueueFinish(&amp;m_Queue);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160; </div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    nvnBufferFinalize(&amp;m_TimeStampBuffer);</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    m_TimeStampPool.Shutdown();</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160; </div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="keywordflow">if</span> (m_BackBufferCommandBuffer)</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    {</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <span class="keyword">delete</span> m_BackBufferCommandBuffer;</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        m_BackBufferCommandBuffer = NULL;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    }</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160; </div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="keywordflow">if</span> (m_GBufferCommandBuffer)</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;    {</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        <span class="keyword">delete</span> m_GBufferCommandBuffer;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        m_GBufferCommandBuffer = NULL;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    }</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160; </div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="keywordflow">if</span> (m_ShadowMapPassCommandBuffer)</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    {</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <span class="keyword">delete</span> m_ShadowMapPassCommandBuffer;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        m_ShadowMapPassCommandBuffer = NULL;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    }</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160; </div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="keywordflow">if</span> (m_LightingPassCommandBuffer)</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    {</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        <span class="keyword">delete</span> m_LightingPassCommandBuffer;</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        m_LightingPassCommandBuffer = NULL;</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    }</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160; </div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="keywordflow">if</span> (m_SkyBoxCommandBuffer)</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    {</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        <span class="keyword">delete</span> m_SkyBoxCommandBuffer;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;        m_SkyBoxCommandBuffer = NULL;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    }</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160; </div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="keywordflow">if</span> (m_ScalableAODepthCommandBuffer)</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    {</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        <span class="keyword">delete</span> m_ScalableAODepthCommandBuffer;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;        m_ScalableAODepthCommandBuffer = NULL;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    }</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160; </div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;    <span class="keywordflow">if</span> (m_ScalableAOMipmapCommandBuffer)</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    {</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        <span class="keyword">delete</span> m_ScalableAOMipmapCommandBuffer;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        m_ScalableAOMipmapCommandBuffer = NULL;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    }</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160; </div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    <span class="keywordflow">if</span> (m_ScalableAOCommandBuffer)</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    {</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        <span class="keyword">delete</span> m_ScalableAOCommandBuffer;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        m_ScalableAOCommandBuffer = NULL;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    }</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160; </div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <span class="keywordflow">if</span> (m_ScalableAOBlurCommandBuffer)</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    {</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        <span class="keyword">delete</span> m_ScalableAOBlurCommandBuffer;</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        m_ScalableAOBlurCommandBuffer = NULL;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    }</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160; </div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    nvnWindowFinalize(&amp;m_Window);</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    nvnSyncFinalize(&amp;m_WindowSync);</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160; </div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    nvnTextureFinalize(&amp;m_DepthBuffer.m_Texture);</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    nvnTextureFinalize(&amp;m_DiffuseTarget.m_Texture);</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    nvnTextureFinalize(&amp;m_SpecularTarget.m_Texture);</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    nvnTextureFinalize(&amp;m_NormalTarget.m_Texture);</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    nvnTextureFinalize(&amp;m_DirectionalShadowMap.m_Texture);</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    nvnTextureFinalize(&amp;m_ScalableAODepthTarget.m_Texture);</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    nvnTextureFinalize(&amp;m_ScalableAOTarget.m_Texture);</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    nvnTextureFinalize(&amp;m_ScalableAOBlurTarget.m_Texture);</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    nvnTextureFinalize(&amp;m_ScalableAOFinalTarget.m_Texture);</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    nvnTextureFinalize(&amp;m_FinalTarget.m_Texture);</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160; </div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; g_NumBackBuffers; ++i)</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    {</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;        nvnTextureFinalize(m_ScreenRenderTargets[i]);</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        <span class="keyword">delete</span> m_ScreenRenderTargets[i];</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        m_ScreenRenderTargets[i] = NULL;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    }</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160; </div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;std::string, AssetFileDataHolder*&gt;::iterator itr = m_Shaders.begin(); itr != m_Shaders.end(); ++itr)</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    {</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        <span class="keyword">delete</span> itr-&gt;second;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    }</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    m_Shaders.clear();</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160; </div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="keywordflow">for</span> (std::map&lt;std::string, AssetFileDataHolder*&gt;::iterator itr = m_Textures.begin(); itr != m_Textures.end(); ++itr)</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    {</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;        <span class="keyword">delete</span> itr-&gt;second;</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    }</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    m_Textures.clear();</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160; </div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <span class="keywordflow">if</span> (m_pShadowMapDisplaySampler)</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    {</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        nvnSamplerFinalize(m_pShadowMapDisplaySampler);</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="keyword">delete</span> m_pShadowMapDisplaySampler;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    }</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160; </div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="keywordflow">if</span> (m_pSkyBox)</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    {</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        AlignedDeallocate(m_pSkyBox);</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        m_pSkyBox = NULL;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160; </div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    <span class="keywordflow">if</span> (m_pDirectionalLightPassAO)</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    {</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;        AlignedDeallocate(m_pDirectionalLightPassAO);</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;        m_pDirectionalLightPassAO = NULL;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    }</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160; </div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; m_DeferredPointLightObjects.size(); ++i)</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    {</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        m_DeferredPointLightObjects[i]-&gt;Shutdown();</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        AlignedDeallocate(m_DeferredPointLightObjects[i]);</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    }</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    m_DeferredPointLightObjects.clear();</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160; </div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="keywordflow">if</span> (m_pScreenSpaceQuadPass)</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    {</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        AlignedDeallocate(m_pScreenSpaceQuadPass);</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        m_pScreenSpaceQuadPass = NULL;</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    }</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160; </div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <span class="keywordflow">if</span> (m_pScalableAODepthPass)</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    {</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        AlignedDeallocate(m_pScalableAODepthPass);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        m_pScalableAODepthPass = NULL;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    }</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160; </div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="keywordflow">if</span> (m_pScalableAOMipmapPass)</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    {</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        AlignedDeallocate(m_pScalableAOMipmapPass);</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        m_pScalableAOMipmapPass = NULL;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    }</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160; </div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="keywordflow">if</span> (m_pScalableAOPass)</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    {</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;        AlignedDeallocate(m_pScalableAOPass);</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;        m_pScalableAOPass = NULL;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    }</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160; </div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="keywordflow">if</span> (m_pScalableAOBlurPass)</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    {</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        AlignedDeallocate(m_pScalableAOBlurPass);</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        m_pScalableAOBlurPass = NULL;</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    }</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160; </div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <span class="keywordflow">if</span> (m_pAssetLoader != NULL)</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    {</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        <span class="keyword">delete</span> m_pAssetLoader;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;        m_pAssetLoader = NULL;</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    }</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160; </div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    <span class="keywordflow">if</span> (m_pTextureIDManager != NULL)</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    {</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        <span class="keyword">delete</span> m_pTextureIDManager;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;        m_pTextureIDManager = NULL;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    }</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160; </div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    m_SceneObjects.clear();</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    m_Models.clear();</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160; </div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="keywordflow">if</span> (m_pDebugTextRenderer != NULL)</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    {</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        m_pDebugTextRenderer-&gt;CleanUp();</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        m_pDebugTextRenderer = NULL;</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    }</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160; </div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    <span class="keywordflow">if</span> (m_pRenderTargetMemoryPool)</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    {</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        m_pRenderTargetMemoryPool-&gt;Shutdown();</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        <span class="keyword">delete</span> m_pRenderTargetMemoryPool;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        m_pRenderTargetMemoryPool = NULL;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    }</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160; </div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="keywordflow">if</span> (m_pShaderScratchMemoryPool)</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    {</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;        m_pShaderScratchMemoryPool-&gt;Shutdown();</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;        <span class="keyword">delete</span> m_pShaderScratchMemoryPool;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        m_pShaderScratchMemoryPool = NULL;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    }</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160; </div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <span class="keywordflow">if</span> (m_pUniformBufferManager)</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    {</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        <span class="keyword">delete</span> m_pUniformBufferManager;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        m_pUniformBufferManager = NULL;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    }</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160; </div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;    <span class="keywordflow">if</span> (m_pStaticUniformBufferManager)</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    {</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;        <span class="keyword">delete</span> m_pStaticUniformBufferManager;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;        m_pStaticUniformBufferManager = NULL;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    }</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160; </div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="keywordflow">if</span> (m_pFrameBufferedSyncManager != NULL)</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;    {</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        <span class="keyword">delete</span> m_pFrameBufferedSyncManager;</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;        m_pFrameBufferedSyncManager = NULL;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    }</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160; </div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    nvnQueueFinalize(&amp;m_Queue);</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="keywordflow">if</span> (m_pQueueMemory)</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    {</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;        AlignedDeallocate(m_pQueueMemory);</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        m_pQueueMemory = NULL;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    }</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160; </div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    nvnDeviceFinalize(&amp;m_Device);</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;}<span class="comment">//NOLINT(impl/function_size)</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160; </div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="comment"> * AmbientOcclusion::Draw</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="comment"> * ----------------------</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment"> * Runs each pass needed to draw the scene.</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::Draw(uint64_t millisec)</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;{</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>(millisec);</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160; </div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    m_CurrentBeginFrameTime = <a class="code" href="namespacenn_1_1os.html#a79e29821bfb2b0c3a5c222488e90cc89">nn::os::GetSystemTick</a>().<a class="code" href="classnn_1_1os_1_1_tick.html#aae2542ec136248db4dc662cbdf95f3ad">ToTimeSpan</a>().<a class="code" href="classnn_1_1_time_span.html#a03c119fa6c678e9b251f14f7ca8431c5">GetNanoSeconds</a>();</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160; </div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        <span class="comment">/* Update the input manager and the camera. */</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    UpdateScene();</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160; </div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;         <span class="comment">/* Update SAO parameters for debugging purposes. */</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    UpdateSAOParameters();</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160; </div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;        <span class="comment">/* Render the G-buffer */</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    GBufferPass();</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160; </div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <span class="keywordflow">if</span> (m_SAOEnabled)</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    {</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;            <span class="comment">/* Converts the hardware depth buffer to a view space z buffer */</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;        RenderSAODepthBuffer();</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160; </div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;            <span class="comment">/* Creates a mipmap of the view space z buffer */</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        RenderSAOMipmap();</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160; </div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;            <span class="comment">/* Render scalable ambient obscurance */</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        RenderSAO();</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160; </div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;            <span class="comment">/* Apply blur to SAO render target */</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;        RenderSAOBlur();</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    }</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160; </div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        <span class="comment">/* Generate the directional shadows as needed. Currently once per resize */</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;    <span class="keywordflow">if</span> (m_GenerateShadows)</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    {</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        DirectionalShadowPass();</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        m_GenerateShadows = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    }</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160; </div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        <span class="comment">/* Apply the directional and point light contributions */</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    LightingPass();</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160; </div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;        <span class="comment">/* Render the skybox anywhere geometry hasn&#39;t already been rendered */</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    RenderSkyBox();</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160; </div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        <span class="comment">/* Choose which target to show on screen (for debugging) */</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    GetTargetToPresent();</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160; </div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;        <span class="comment">/* Present the chosen texture */</span></div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    PresentTexture(*m_pPresentHandle, m_pPresentPass);</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160; </div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;        <span class="comment">/* Swap the buffered memory objects */</span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    m_pFrameBufferedSyncManager-&gt;InsertFence();</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    m_pFrameBufferedSyncManager-&gt;SwapPools();</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160; </div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    m_PrevFrameTime = <a class="code" href="namespacenn_1_1os.html#a79e29821bfb2b0c3a5c222488e90cc89">nn::os::GetSystemTick</a>().<a class="code" href="classnn_1_1os_1_1_tick.html#aae2542ec136248db4dc662cbdf95f3ad">ToTimeSpan</a>().<a class="code" href="classnn_1_1_time_span.html#a03c119fa6c678e9b251f14f7ca8431c5">GetNanoSeconds</a>() - m_CurrentBeginFrameTime;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160; </div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="keywordtype">size_t</span> timeStampBufferOffset = ((m_CurrentTimeStamp + 1) % g_NumBackBuffers);</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160; </div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="preprocessor">#ifdef NN_BUILD_TARGET_PLATFORM_OS_WIN</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;    uint64_t before = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_GPUTimeBeforeOffset)-&gt;timestamp;</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    uint64_t after  = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_GPUTimeAfterOffset )-&gt;timestamp;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160; </div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    uint64_t depthStart = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_SAODepthBeforeOffset)-&gt;timestamp;</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;    uint64_t depthEnd   = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_SAODepthAfterOffset )-&gt;timestamp;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160; </div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    uint64_t mipStart   = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_SAOMipmapBeforeOffset)-&gt;timestamp;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    uint64_t mipEnd     = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_SAOMipmapAfterOffset )-&gt;timestamp;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160; </div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    uint64_t saoStart   = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_SAOBeforeOffset)-&gt;timestamp;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    uint64_t saoEnd     = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_SAOAfterOffset )-&gt;timestamp;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160; </div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    uint64_t blurStart  = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_SAOBlurBeforeOffset)-&gt;timestamp;</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    uint64_t blurEnd    = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_SAOBlurAfterOffset )-&gt;timestamp;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    uint64_t before = nvnDeviceGetTimestampInNanoseconds(&amp;m_Device, <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_GPUTimeBeforeOffset));</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    uint64_t after  = nvnDeviceGetTimestampInNanoseconds(&amp;m_Device, <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_GPUTimeAfterOffset ));</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160; </div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    uint64_t depthStart = nvnDeviceGetTimestampInNanoseconds(&amp;m_Device, <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_SAODepthBeforeOffset));</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    uint64_t depthEnd   = nvnDeviceGetTimestampInNanoseconds(&amp;m_Device, <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_SAODepthAfterOffset ));</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160; </div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    uint64_t mipStart   = nvnDeviceGetTimestampInNanoseconds(&amp;m_Device, <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_SAOMipmapBeforeOffset));</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    uint64_t mipEnd     = nvnDeviceGetTimestampInNanoseconds(&amp;m_Device, <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_SAOMipmapAfterOffset ));</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160; </div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    uint64_t saoStart   = nvnDeviceGetTimestampInNanoseconds(&amp;m_Device, <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_SAOBeforeOffset));</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    uint64_t saoEnd     = nvnDeviceGetTimestampInNanoseconds(&amp;m_Device, <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_SAOAfterOffset ));</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160; </div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    uint64_t blurStart  = nvnDeviceGetTimestampInNanoseconds(&amp;m_Device, <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_SAOBlurBeforeOffset));</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    uint64_t blurEnd    = nvnDeviceGetTimestampInNanoseconds(&amp;m_Device, <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="struct_n_v_ncounter_data.html">NVNcounterData</a>*<span class="keyword">&gt;</span>((<span class="keywordtype">char</span>*)nvnBufferMap(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * timeStampBufferOffset + g_SAOBlurAfterOffset ));</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160; </div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    m_CurrentTimeStamp++;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160; </div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    m_PrevGPUTime = (after - before);</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160; </div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    m_PrevSAODepthTime  = (depthEnd - depthStart);</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    m_PrevSAOMipmapTime = (mipEnd   - mipStart);</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    m_PrevSAOTime       = (saoEnd   - saoStart);</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    m_PrevSAOBlurTime   = (blurEnd  - blurStart);</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    m_PrevAOTime        = (blurEnd - depthStart);</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;}</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160; </div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="comment"> * AmbientOcclusion::SetupSceneFromFile</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="comment"> * ------------------------------------</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="comment"> * Loads the scene from a given input scene file.</span></div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::SetupSceneFromFile(std::string fileName)</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;{</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    nvnSamplerBuilderSetDefaults(&amp;m_SamplerBuilder);</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    nvnSamplerBuilderSetMinMagFilter(&amp;m_SamplerBuilder, NVNminFilter::NVN_MIN_FILTER_LINEAR_MIPMAP_NEAREST, NVNmagFilter::NVN_MAG_FILTER_LINEAR);</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160; </div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    rapidxml::xml_document&lt;&gt; xmlDoc;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160; </div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    std::pair&lt;rapidxml::xml_node&lt;&gt;*, <span class="keywordtype">char</span>*&gt; xmlLoad = SceneFileLoad::LoadAndParseXMLFile(fileName, xmlDoc);</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160; </div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    rapidxml::xml_node&lt;&gt;* rootNode = xmlLoad.first;</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(rootNode);</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160; </div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    SceneFileLoad::LoadGlobalData(rootNode, m_Near, m_Far, m_GlobalAmbient);</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160; </div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    SceneFileLoad::LoadCameraInfo(rootNode, &amp;m_Camera);</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160; </div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    SceneFileLoad::LoadShaders(rootNode, m_Shaders, m_pAssetLoader);</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160; </div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    SceneFileLoad::LoadTextures(rootNode,</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;                                m_pAssetLoader,</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;                                &amp;m_Device,</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;                                &amp;m_SamplerBuilder,</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                                m_pTextureIDManager,</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;                                m_Textures);</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160; </div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    SceneFileLoad::LoadPBRObjects(rootNode,</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                                  &amp;m_Device,</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;                                  m_pUniformBufferManager,</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;                                  m_pStaticUniformBufferManager,</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;                                  m_Shaders,</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;                                  m_Textures,</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                                  m_Models,</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                                  m_SceneObjects);</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160; </div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    SceneFileLoad::LoadDirectionalLightAO(rootNode,</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                                          m_Shaders,</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;                                          m_pUniformBufferManager,</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;                                          &amp;m_Camera,</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;                                          m_GlobalAmbient,</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                                          &amp;m_pDirectionalLightPassAO);</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160; </div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    SceneFileLoad::LoadPointLights(rootNode,</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                                   &amp;m_Device,</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;                                   m_ScreenWidth,</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;                                   m_ScreenHeight,</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;                                   m_Shaders,</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                                   m_Models,</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;                                   &amp;m_Camera,</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;                                   m_pUniformBufferManager,</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;                                   m_pTextureIDManager,</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                                   m_DeferredPointLightObjects);</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160; </div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    SceneFileLoad::LoadSkyBox(rootNode,</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;                              &amp;m_Device,</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                              m_pUniformBufferManager,</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;                              m_Textures,</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;                              m_Shaders,</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;                              m_Models,</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;                              m_Far,</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;                              &amp;m_pSkyBox);</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160; </div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    SceneFileLoad::LoadSAO(rootNode,</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;                           m_FoV * DEG_TO_RAD,</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;                           m_ScreenWidth,</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;                           m_ScreenHeight,</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;                           m_pUniformBufferManager,</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;                           m_Shaders,</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;                           &amp;m_pScalableAOPass);</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160; </div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;    SceneFileLoad::LoadSAOBlur(rootNode,</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;                               m_pUniformBufferManager,</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;                               m_Shaders,</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;                               &amp;m_pScalableAOBlurPass);</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160; </div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    AlignedDeallocate(xmlLoad.second);</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;}</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160; </div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment"> * AmbientOcclusion::UpdateScene</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment"> * -----------------------------</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment"> * Updates the input manager and the camera.</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::UpdateScene()</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;{</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    m_InputManager.Update();</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    m_Camera.Update();</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160; </div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;        <span class="comment">/* Update objects with the new camera info */</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <span class="keywordflow">if</span> (m_pDirectionalLightPassAO)</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    {</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        m_pDirectionalLightPassAO-&gt;SetEyePos(<a class="code" href="classnn_1_1util_1_1_vector4f.html">nn::util::Vector4f</a>(m_Camera.GetPosition(), 1.0f));</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    }</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160; </div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    <span class="keywordflow">if</span> (m_pSkyBox)</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    {</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;        m_pSkyBox-&gt;SetCameraRotation(m_Camera.GetXRotationAsRadian(), m_Camera.GetYRotationAsRadian());</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;    }</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160; </div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="preprocessor">#ifdef NN_BUILD_TARGET_PLATFORM_OS_WIN</span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    InputManager::ButtonState pointLightDebugState = m_InputManager.GetKeyboardButtonState(<span class="charliteral">&#39;X&#39;</span>);</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    InputManager::ButtonState debugState = m_InputManager.GetKeyboardButtonState(<span class="charliteral">&#39;C&#39;</span>);</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    InputManager::ButtonState saoState = m_InputManager.GetKeyboardButtonState(<span class="charliteral">&#39;Y&#39;</span>);</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    InputManager::ButtonState pointLightDebugState = m_InputManager.GetGamepadButtonState(InputManagerNX::GamepadButton_X);</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    InputManager::ButtonState debugState = m_InputManager.GetGamepadButtonState(InputManagerNX::GamepadButton_B);</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    InputManager::ButtonState saoState = m_InputManager.GetGamepadButtonState(InputManagerNX::GamepadButton_Y);</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160; </div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;        <span class="comment">/* Toggle point light debug draw */</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="keywordflow">if</span> (pointLightDebugState == InputManager::ButtonState_Triggered)</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    {</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;        m_PointLightDebugDraw = !m_PointLightDebugDraw;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    }</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160; </div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="keywordflow">if</span> (debugState == InputManager::ButtonState_Triggered)</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    {</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; m_SceneObjects.size(); ++i)</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;        {</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;            m_SceneObjects[i].TogglePolygonMode();</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;        }</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    }</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160; </div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    <span class="keywordflow">if</span> (saoState == InputManager::ButtonState_Triggered)</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    {</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        m_SAOEnabled = m_pDirectionalLightPassAO-&gt;ToggleUseSSAO();</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    }</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;}</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160; </div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="comment"> * AmbientOcclusion::GetTargetToPresent</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="comment"> * ------------------------------------</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="comment"> * Chooses which render target to display on screen for debug purposes.</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::GetTargetToPresent()</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;{</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">int</span> index = 0;</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160; </div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160; </div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        <span class="comment">/* Target handles */</span></div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    <span class="keyword">static</span> <a class="code" href="group__nvn__c__handle.html#gaa1a1fc7a9e690ce93870bcd71ea6b446">NVNtextureHandle</a>* targets[] = { &amp;m_FinalTarget.m_TextureHandle,</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;                                           &amp;m_ScalableAOFinalTarget.m_TextureHandle };</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160; </div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        <span class="comment">/* Target names */</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <span class="keyword">static</span> std::string targetNames[] = { <span class="stringliteral">&quot;Final Image&quot;</span>,</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;                                         <span class="stringliteral">&quot;SAO Final Buffer&quot;</span> };</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160; </div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">int</span> total = <span class="keyword">sizeof</span>(targets) / <span class="keyword">sizeof</span>(targets[0]);</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160; </div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    InputManager::ButtonState stateL;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    InputManager::ButtonState stateR;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160; </div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="preprocessor">#ifdef NN_BUILD_TARGET_PLATFORM_OS_WIN</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    stateL = m_InputManager.GetKeyboardButtonState(<span class="charliteral">&#39;L&#39;</span>);</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    stateR = m_InputManager.GetKeyboardButtonState(<span class="charliteral">&#39;R&#39;</span>);</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160; </div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    stateL = m_InputManager.GetGamepadButtonState(InputManagerNX::GamepadButton_L);</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    stateR = m_InputManager.GetGamepadButtonState(InputManagerNX::GamepadButton_R);</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160; </div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <span class="keywordflow">if</span> (stateL == InputManager::ButtonState_Triggered)</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    {</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;        index -= 1;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;    }</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stateR == InputManager::ButtonState_Triggered)</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    {</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;        index += 1;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    }</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160; </div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    <span class="keywordflow">if</span> (index &lt; 0)</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    {</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        index = total + index;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    }</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160; </div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    <span class="keywordflow">if</span> (index &gt;= total)</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    {</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        index = 0;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    }</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160; </div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    m_pPresentHandle = targets[index];</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    m_PresentTargetName = targetNames[index];</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;}</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160; </div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="comment"> * AmbientOcclusion::UpdateSSAOParameters</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="comment"> * --------------------------------------</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="comment"> * Modifies the SSAO parameters in runtime.</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::UpdateSAOParameters()</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;{</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">int</span> saoParamIndex = 0;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160; </div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="preprocessor">#ifdef NN_BUILD_TARGET_PLATFORM_OS_WIN</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    InputManager::ButtonState stateLeft = m_InputManager.GetKeyboardButtonState(<span class="charliteral">&#39;H&#39;</span>);</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;    InputManager::ButtonState stateRight = m_InputManager.GetKeyboardButtonState(<span class="charliteral">&#39;K&#39;</span>);</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    InputManager::ButtonState stateUp = m_InputManager.GetKeyboardButtonState(<span class="charliteral">&#39;U&#39;</span>);</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    InputManager::ButtonState stateDown = m_InputManager.GetKeyboardButtonState(<span class="charliteral">&#39;J&#39;</span>);</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    InputManager::ButtonState stateLeft = m_InputManager.GetGamepadButtonState(InputManagerNX::GamepadButton_Left);</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    InputManager::ButtonState stateRight = m_InputManager.GetGamepadButtonState(InputManagerNX::GamepadButton_Right);</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    InputManager::ButtonState stateUp = m_InputManager.GetGamepadButtonState(InputManagerNX::GamepadButton_Up);</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    InputManager::ButtonState stateDown = m_InputManager.GetGamepadButtonState(InputManagerNX::GamepadButton_Down);</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160; </div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    <span class="keywordflow">if</span> (stateUp == InputManager::ButtonState_Triggered)</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;    {</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        saoParamIndex -= 1;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    }</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stateDown == InputManager::ButtonState_Triggered)</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    {</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;        saoParamIndex += 1;</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    }</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160; </div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    <span class="keywordflow">if</span> (saoParamIndex &lt; 0)</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    {</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;        saoParamIndex = saoParamIndex + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(SAOParam::TOTAL);</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    }</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160; </div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    <span class="keywordflow">if</span> (saoParamIndex &gt;= <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(SAOParam::TOTAL))</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    {</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        saoParamIndex = 0;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    }</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160; </div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;    <span class="keywordtype">int</span> stepDirection = 0;</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160; </div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    <span class="keywordflow">if</span> (stateRight == InputManager::ButtonState_Triggered)</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    {</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;        stepDirection = 1;</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    }</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stateLeft == InputManager::ButtonState_Triggered)</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    {</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        stepDirection = -1;</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    }</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160; </div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    m_SAOParamsSelected = <span class="keyword">static_cast&lt;</span>SAOParam<span class="keyword">&gt;</span>(saoParamIndex);</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160; </div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    <span class="keywordflow">if</span> (stepDirection != 0)</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    {</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        <span class="keywordflow">switch</span> (m_SAOParamsSelected)</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        {</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;            <span class="keywordflow">case</span> SAOParam::BIAS:</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;            {</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;                <span class="keywordtype">float</span> min = 0.03125f;</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;                <span class="keywordtype">float</span> max = 0.25f;</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;                <span class="keywordtype">float</span> singleStep = 0.03125f;</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;                <span class="keywordtype">float</span> value = 0.0f;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;                value = m_SAOParams[SAOParam::BIAS].second + singleStep * stepDirection;</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160; </div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;                <span class="keywordflow">if</span> (value &lt; min)</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                {</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;                    value = max;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;                }</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value &gt; max)</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;                {</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                    value = min;</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;                }</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160; </div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;                m_pScalableAOPass-&gt;SetBias(value);</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;                stepDirection = 0;</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;            }</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;            <span class="keywordflow">case</span> SAOParam::RADIUS:</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;            {</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;                <span class="keywordtype">float</span> min = 0.1f;</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;                <span class="keywordtype">float</span> max = 2.0f;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;                <span class="keywordtype">float</span> singleStep = 0.1f;</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;                <span class="keywordtype">float</span> value = 0.0f;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;                value = m_SAOParams[SAOParam::RADIUS].second + singleStep * stepDirection;</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160; </div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                <span class="keywordflow">if</span> (value &lt; min)</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;                {</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;                    value = max;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;                }</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value &gt; max)</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;                {</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;                    value = min;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;                }</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160; </div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;                m_pScalableAOPass-&gt;SetRadius(value);</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;                stepDirection = 0;</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;            }</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;            <span class="keywordflow">case</span> SAOParam::INTENSITY:</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;            {</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;                <span class="keywordtype">float</span> min = 1.0f;</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;                <span class="keywordtype">float</span> max = 7.0f;</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;                <span class="keywordtype">float</span> singleStep = 0.2f;</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;                <span class="keywordtype">float</span> value = 0.0f;</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;                value = m_SAOParams[SAOParam::INTENSITY].second + singleStep * stepDirection;</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160; </div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;                <span class="keywordflow">if</span> (value &lt; min)</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;                {</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;                    value = max;</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                }</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value &gt; max)</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;                {</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;                    value = min;</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;                }</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160; </div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;                m_pScalableAOPass-&gt;SetIntensity(value);</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;                stepDirection = 0;</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;            }</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;            <span class="keywordflow">case</span> SAOParam::POWER_EXPONENT:</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;            {</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;                <span class="keywordtype">float</span> min = 0.5f;</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;                <span class="keywordtype">float</span> max = 4.0f;</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;                <span class="keywordtype">float</span> singleStep = 0.1f;</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                <span class="keywordtype">float</span> value = 0.0f;</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;                value = m_SAOParams[SAOParam::POWER_EXPONENT].second + singleStep * stepDirection;</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160; </div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;                <span class="keywordflow">if</span> (value &lt; min)</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;                {</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                    value = max;</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;                }</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (value &gt; max)</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                {</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;                    value = min;</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;                }</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160; </div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                m_pScalableAOPass-&gt;SetPowerExponent(value);</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;                stepDirection = 0;</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;            }</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;            {</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;                <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(<span class="keyword">false</span>, <span class="stringliteral">&quot;Unhandled SAO parameter&quot;</span>);</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;            }</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;        }</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    }</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160; </div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    m_SAOParams[SAOParam::BIAS].second           = m_pScalableAOPass-&gt;GetBias();</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    m_SAOParams[SAOParam::RADIUS].second         = m_pScalableAOPass-&gt;GetRadius();</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    m_SAOParams[SAOParam::INTENSITY].second      = m_pScalableAOPass-&gt;GetIntensity();</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    m_SAOParams[SAOParam::POWER_EXPONENT].second = m_pScalableAOPass-&gt;GetPowerExponent();</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;} <span class="comment">// NOLINT(impl/function_size)</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160; </div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="comment"> * AmbientOcclusion::GBufferPass</span></div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;<span class="comment"> * -----------------------------</span></div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;<span class="comment"> * Records and submits a command buffer to render all of the scene</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;<span class="comment"> * geometry to the three target of the G-buffer. These are:</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;<span class="comment"> * 1. Diffuse RGB, Roughness A</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;<span class="comment"> * 2. Normal RGB</span></div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;<span class="comment"> * 3. Specular R, Metallic G, Lit B, Drawn A</span></div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;<span class="comment"> * Note: Target 3 is the only one that is cleared per frame as the</span></div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;<span class="comment"> * alpha channel controls whether that fragment is ignored is later</span></div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="comment"> * passes.</span></div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::GBufferPass()</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;{</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    AssetFileDataHolder* shaderData = m_Shaders[<span class="stringliteral">&quot;DeferredGBuffer.out&quot;</span>];</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    std::string programName = shaderData-&gt;GetSpecializedProgramData()[0]-&gt;m_pProgramName;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160; </div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    <a class="code" href="structnn_1_1util_1_1_matrix_row_major4x4f_type.html">nn::util::Matrix4x4fType</a> camMat;</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;    nn::util::MatrixConvert(&amp;camMat, m_Camera.GetCameraMatrix());</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160; </div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;        <span class="comment">/* Update the scene objects&#39; model uniforms */</span></div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    <span class="keywordflow">for</span> (std::vector&lt;PBRObject::Object&gt;::iterator itr = m_SceneObjects.begin(); itr != m_SceneObjects.end(); ++itr)</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;    {</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;        itr-&gt;SetProjectionMatrix(m_ProjMat44);</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        itr-&gt;SetCameraMatrix(camMat);</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;        itr-&gt;UpdateModelUniforms(programName);</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160; </div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;        itr-&gt;UpdateLodInfo(programName, m_Camera.GetPosition());</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    }</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160; </div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    <a class="code" href="struct_n_v_ncommand_buffer.html">NVNcommandBuffer</a>* pCommandBuffer = m_GBufferCommandBuffer-&gt;GetCommandBuffer();</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160; </div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    nvnCommandBufferBeginRecording(pCommandBuffer);</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160; </div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    nvnCommandBufferReportCounter(pCommandBuffer, NVN_COUNTER_TYPE_TIMESTAMP, nvnBufferGetAddress( &amp;m_TimeStampBuffer ) + m_TimeStampBufferSize * (m_CurrentTimeStamp % g_NumBackBuffers) + g_GPUTimeBeforeOffset);</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160; </div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;    nvnCommandBufferBindBlendState(pCommandBuffer, &amp;m_BlendState);</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    nvnCommandBufferBindChannelMaskState(pCommandBuffer, &amp;m_ChannelMaskState);</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;    nvnCommandBufferBindColorState(pCommandBuffer, &amp;m_ColorState);</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    nvnCommandBufferBindDepthStencilState(pCommandBuffer, &amp;m_DepthStencilState);</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    nvnCommandBufferBindMultisampleState(pCommandBuffer, &amp;m_MultisampleState);</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160; </div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    <a class="code" href="struct_n_v_ntexture.html">NVNtexture</a>* buffers[3];</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    buffers[0] = &amp;m_DiffuseTarget.m_Texture;</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    buffers[1] = &amp;m_NormalTarget.m_Texture;</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    buffers[2] = &amp;m_SpecularTarget.m_Texture;</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160; </div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    nvnCommandBufferSetRenderTargets(pCommandBuffer, 3, buffers, NULL, &amp;m_DepthBuffer.m_Texture, NULL);</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160; </div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    m_pTextureIDManager-&gt;SetSamplerPool(pCommandBuffer);</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    m_pTextureIDManager-&gt;SetTexturePool(pCommandBuffer);</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160; </div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    nvnCommandBufferSetScissor(pCommandBuffer, 0, 0, m_ScreenWidth, m_ScreenHeight);</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    nvnCommandBufferSetViewport(pCommandBuffer, 0, 0, m_ScreenWidth, m_ScreenHeight);</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160; </div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="keywordflow">if</span> (m_pShaderScratchMemoryPool)</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    {</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;        nvnCommandBufferSetShaderScratchMemory(pCommandBuffer, m_pShaderScratchMemoryPool-&gt;GetMemoryPool(), 0, m_ShaderScratchSize);</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    }</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160; </div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;        <span class="comment">/* Clear specular target, alpha value used to discard during lighting */</span></div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    <span class="keywordtype">float</span> clear_color[4] = { 0.0f, 0.0f, 0.0f, 0.0f };</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    nvnCommandBufferClearColor(pCommandBuffer, 2, clear_color, NVN_CLEAR_COLOR_MASK_RGBA);</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    nvnCommandBufferClearDepthStencil(pCommandBuffer, 1.0f, <a class="code" href="group__nvn__c__defines.html#ga48151b7e768a13685d77d1a4c464a33b">NVN_TRUE</a>, 0, 0xFF);</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160; </div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    nvnCommandBufferBarrier(pCommandBuffer, NVNbarrierBits::NVN_BARRIER_INVALIDATE_SHADER_BIT);</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160; </div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;        <span class="comment">/* Set the state for and draw each object. All objects are drawn via call commands */</span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    <span class="keywordflow">for</span> (std::vector&lt;PBRObject::Object&gt;::iterator itr = m_SceneObjects.begin(); itr != m_SceneObjects.end(); ++itr)</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    {</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;        itr-&gt;SetDefaultState();</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;        itr-&gt;Draw(pCommandBuffer, programName, m_Models, shaderData);</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    }</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160; </div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    <a class="code" href="group__nvn__c__handle.html#gab7f10945ffe1f6161c87238c75ae411d">NVNcommandHandle</a> commandHandle = nvnCommandBufferEndRecording(pCommandBuffer);</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    nvnQueueSubmitCommands(&amp;m_Queue, 1, &amp;commandHandle);</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;}</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160; </div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;<span class="comment"> * AmbientOcclusion::RenderSAODepthBuffer</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="comment"> * --------------------------------------</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;<span class="comment"> * Converts the depth buffer to a view space depth buffer</span></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::RenderSAODepthBuffer()</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;{</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>(m_pScalableAODepthPass);</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160; </div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    m_pScalableAODepthPass-&gt;SetTextureHandle(m_DepthBuffer.m_TextureHandle);</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    m_pScalableAODepthPass-&gt;UpdateUniforms();</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160; </div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;    <a class="code" href="struct_n_v_ncommand_buffer.html">NVNcommandBuffer</a>* pCommandBuffer = m_ScalableAODepthCommandBuffer-&gt;GetCommandBuffer();</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    nvnCommandBufferBeginRecording(pCommandBuffer);</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160; </div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;    nvnCommandBufferReportCounter(pCommandBuffer, NVN_COUNTER_TYPE_TIMESTAMP, nvnBufferGetAddress(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * (m_CurrentTimeStamp % g_NumBackBuffers) + g_SAODepthBeforeOffset);</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160; </div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    nvnCommandBufferBarrier(pCommandBuffer, NVNbarrierBits::NVN_BARRIER_ORDER_FRAGMENTS_BIT);</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160; </div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <a class="code" href="struct_n_v_ntexture.html">NVNtexture</a>* targets[] = { &amp;m_ScalableAODepthTarget.m_Texture };</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    <a class="code" href="struct_n_v_ntexture_view.html">NVNtextureView</a>* views[] = { &amp;m_SAODepthBufferTextureView[0] };</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    nvnCommandBufferSetRenderTargets(pCommandBuffer, 1, targets, views, NULL, NULL);</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160; </div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    nvnCommandBufferSetScissor(pCommandBuffer, 0, 0, m_pScalableAOPass-&gt;GetWidth(), m_pScalableAOPass-&gt;GetHeight());</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    nvnCommandBufferSetViewport(pCommandBuffer, 0, 0, m_pScalableAOPass-&gt;GetWidth(), m_pScalableAOPass-&gt;GetHeight());</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160; </div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <span class="keywordflow">if</span> (m_pShaderScratchMemoryPool)</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    {</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        nvnCommandBufferSetShaderScratchMemory(pCommandBuffer, m_pShaderScratchMemoryPool-&gt;GetMemoryPool(), 0, m_ShaderScratchSize);</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;    }</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160; </div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;    m_pScalableAODepthPass-&gt;BindState(pCommandBuffer);</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;    m_pScalableAODepthPass-&gt;Draw(pCommandBuffer);</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160; </div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    nvnCommandBufferReportCounter(pCommandBuffer, NVN_COUNTER_TYPE_TIMESTAMP, nvnBufferGetAddress(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * (m_CurrentTimeStamp % g_NumBackBuffers) + g_SAODepthAfterOffset);</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160; </div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <a class="code" href="group__nvn__c__handle.html#gab7f10945ffe1f6161c87238c75ae411d">NVNcommandHandle</a> commandHandle = nvnCommandBufferEndRecording(pCommandBuffer);</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    nvnQueueSubmitCommands(&amp;m_Queue, 1, &amp;commandHandle);</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;}</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160; </div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="comment"> * AmbientOcclusion::RenderSAOMipmap</span></div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment"> * ---------------------------------</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment"> * Creates mipmaps of the view space depth buffer</span></div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::RenderSAOMipmap()</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;{</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;    <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>(m_pScalableAOMipmapPass);</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160; </div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    m_pScalableAOMipmapPass-&gt;SetTextureHandle(m_ScalableAODepthTarget.m_TextureHandle);</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160; </div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;    <a class="code" href="struct_n_v_ncommand_buffer.html">NVNcommandBuffer</a>* pCommandBuffer = m_ScalableAOMipmapCommandBuffer-&gt;GetCommandBuffer();</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160; </div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    <span class="keywordtype">int</span> baseWidth = m_pScalableAOPass-&gt;GetWidth();</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;    <span class="keywordtype">int</span> baseHeight = m_pScalableAOPass-&gt;GetHeight();</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160; </div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    <a class="code" href="struct_n_v_ntexture.html">NVNtexture</a>* targets[] = { &amp;m_ScalableAODepthTarget.m_Texture };</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160; </div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    m_pScalableAOMipmapPass-&gt;UpdateUniforms();</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160; </div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    nvnCommandBufferBeginRecording(pCommandBuffer);</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160; </div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;    nvnCommandBufferReportCounter(pCommandBuffer, NVN_COUNTER_TYPE_TIMESTAMP, nvnBufferGetAddress(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * (m_CurrentTimeStamp % g_NumBackBuffers) + g_SAOMipmapBeforeOffset);</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160; </div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= g_MaxMipLevel; ++i)</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;    {</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;        <span class="keywordtype">int</span> width = baseWidth &gt;&gt; i;</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;        <span class="keywordtype">int</span> height = baseHeight &gt;&gt; i;</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160; </div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;        <span class="keywordflow">if</span> (width &lt; 1) width = 1;</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;        <span class="keywordflow">if</span> (height &lt; 1) height = 1;</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160; </div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;        nvnCommandBufferBarrier(pCommandBuffer, NVNbarrierBits::NVN_BARRIER_ORDER_FRAGMENTS_BIT);</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160; </div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        <span class="keywordflow">if</span> (m_pShaderScratchMemoryPool)</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;        {</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;            nvnCommandBufferSetShaderScratchMemory(pCommandBuffer, m_pShaderScratchMemoryPool-&gt;GetMemoryPool(), 0, m_ShaderScratchSize);</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;        }</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160; </div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;        m_pScalableAOMipmapPass-&gt;SetCurrentMipLevel(i);</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160; </div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;        <a class="code" href="struct_n_v_ntexture_view.html">NVNtextureView</a>* views[] = { &amp;m_SAODepthBufferTextureView[i] };</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;        nvnCommandBufferSetRenderTargets(pCommandBuffer, 1, targets, views, NULL, NULL);</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160; </div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;        nvnCommandBufferSetScissor(pCommandBuffer, 0, 0, width, height);</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;        nvnCommandBufferSetViewport(pCommandBuffer, 0, 0, width, height);</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160; </div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;        m_pScalableAOMipmapPass-&gt;BindState(pCommandBuffer);</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;        m_pScalableAOMipmapPass-&gt;Draw(pCommandBuffer);</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    }</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160; </div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    nvnCommandBufferReportCounter(pCommandBuffer, NVN_COUNTER_TYPE_TIMESTAMP, nvnBufferGetAddress(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * (m_CurrentTimeStamp % g_NumBackBuffers) + g_SAOMipmapAfterOffset);</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160; </div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    <a class="code" href="group__nvn__c__handle.html#gab7f10945ffe1f6161c87238c75ae411d">NVNcommandHandle</a> commandHandle = nvnCommandBufferEndRecording(pCommandBuffer);</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    nvnQueueSubmitCommands(&amp;m_Queue, 1, &amp;commandHandle);</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;}</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160; </div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="comment"> * AmbientOcclusion::RenderSAO</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="comment"> * ---------------------------</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;<span class="comment"> * Renders scalable ambient obscurance</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::RenderSAO()</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;{</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>(m_pScalableAOPass);</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160; </div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;    <a class="code" href="structnn_1_1util_1_1_matrix_row_major4x4f_type.html">nn::util::Matrix4x4fType</a> camMat;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    nn::util::MatrixConvert(&amp;camMat, m_Camera.GetCameraMatrix());</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160; </div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;    m_pScalableAOPass-&gt;SetTextureHandle(m_ScalableAODepthTarget.m_TextureHandle);</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;    m_pScalableAOPass-&gt;SetMatrices(m_ProjMat44);</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    m_pScalableAOPass-&gt;UpdateUniforms();</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160; </div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    <a class="code" href="struct_n_v_ncommand_buffer.html">NVNcommandBuffer</a>* pCommandBuffer = m_ScalableAOCommandBuffer-&gt;GetCommandBuffer();</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;    nvnCommandBufferBeginRecording(pCommandBuffer);</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160; </div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;    nvnCommandBufferReportCounter(pCommandBuffer, NVN_COUNTER_TYPE_TIMESTAMP, nvnBufferGetAddress(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * (m_CurrentTimeStamp % g_NumBackBuffers) + g_SAOBeforeOffset);</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160; </div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    nvnCommandBufferBarrier(pCommandBuffer, NVNbarrierBits::NVN_BARRIER_ORDER_FRAGMENTS_BIT);</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160; </div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    <a class="code" href="struct_n_v_ntexture.html">NVNtexture</a>* targets[] = { &amp;m_ScalableAOTarget.m_Texture };</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    nvnCommandBufferSetRenderTargets(pCommandBuffer, 1, targets, NULL, NULL, NULL);</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160; </div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    nvnCommandBufferSetScissor(pCommandBuffer, 0, 0, m_pScalableAOPass-&gt;GetWidth(), m_pScalableAOPass-&gt;GetHeight());</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;    nvnCommandBufferSetViewport(pCommandBuffer, 0, 0, m_pScalableAOPass-&gt;GetWidth(), m_pScalableAOPass-&gt;GetHeight());</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160; </div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;    <span class="keywordflow">if</span> (m_pShaderScratchMemoryPool)</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;    {</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;        nvnCommandBufferSetShaderScratchMemory(pCommandBuffer, m_pShaderScratchMemoryPool-&gt;GetMemoryPool(), 0, m_ShaderScratchSize);</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    }</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160; </div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;    m_pScalableAOPass-&gt;BindState(pCommandBuffer);</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;    m_pScalableAOPass-&gt;Draw(pCommandBuffer);</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160; </div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    nvnCommandBufferReportCounter(pCommandBuffer, NVN_COUNTER_TYPE_TIMESTAMP, nvnBufferGetAddress(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * (m_CurrentTimeStamp % g_NumBackBuffers) + g_SAOAfterOffset);</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160; </div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    <a class="code" href="group__nvn__c__handle.html#gab7f10945ffe1f6161c87238c75ae411d">NVNcommandHandle</a> commandHandle = nvnCommandBufferEndRecording(pCommandBuffer);</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    nvnQueueSubmitCommands(&amp;m_Queue, 1, &amp;commandHandle);</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;}</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160; </div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;<span class="comment"> * AmbientOcclusion::RenderSAOBlur</span></div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;<span class="comment"> * -------------------------------</span></div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment"> * Blurs the SAO texture</span></div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::RenderSAOBlur()</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;{</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    <a class="code" href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a>(m_pScalableAOBlurPass);</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160; </div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    m_pScalableAOBlurPass-&gt;SetTextureHandles(m_ScalableAOTarget.m_TextureHandle, m_ScalableAOBlurTarget.m_TextureHandle);</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    m_pScalableAOBlurPass-&gt;SetRenderTargets(&amp;m_ScalableAOBlurTarget.m_Texture, &amp;m_ScalableAOFinalTarget.m_Texture);</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    m_pScalableAOBlurPass-&gt;UpdateUniforms();</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160; </div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    <a class="code" href="struct_n_v_ncommand_buffer.html">NVNcommandBuffer</a>* pCommandBuffer = m_ScalableAOBlurCommandBuffer-&gt;GetCommandBuffer();</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;    nvnCommandBufferBeginRecording(pCommandBuffer);</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160; </div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    nvnCommandBufferReportCounter(pCommandBuffer, NVN_COUNTER_TYPE_TIMESTAMP, nvnBufferGetAddress(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * (m_CurrentTimeStamp % g_NumBackBuffers) + g_SAOBlurBeforeOffset);</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160; </div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;    nvnCommandBufferBarrier(pCommandBuffer, NVNbarrierBits::NVN_BARRIER_ORDER_FRAGMENTS_BIT);</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160; </div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;    nvnCommandBufferSetScissor(pCommandBuffer, 0, 0, m_ScreenWidth, m_ScreenHeight);</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    nvnCommandBufferSetViewport(pCommandBuffer, 0, 0, m_ScreenWidth, m_ScreenHeight);</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160; </div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    <span class="keywordflow">if</span> (m_pShaderScratchMemoryPool)</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    {</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;        nvnCommandBufferSetShaderScratchMemory(pCommandBuffer, m_pShaderScratchMemoryPool-&gt;GetMemoryPool(), 0, m_ShaderScratchSize);</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;    }</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160; </div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    m_pScalableAOBlurPass-&gt;BindState(pCommandBuffer);</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160; </div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;    m_pScalableAOBlurPass-&gt;Draw(pCommandBuffer);</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160; </div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;    nvnCommandBufferReportCounter(pCommandBuffer, NVN_COUNTER_TYPE_TIMESTAMP, nvnBufferGetAddress(&amp;m_TimeStampBuffer) + m_TimeStampBufferSize * (m_CurrentTimeStamp % g_NumBackBuffers) + g_SAOBlurAfterOffset);</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160; </div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;    <a class="code" href="group__nvn__c__handle.html#gab7f10945ffe1f6161c87238c75ae411d">NVNcommandHandle</a> commandHandle = nvnCommandBufferEndRecording(pCommandBuffer);</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;    nvnQueueSubmitCommands(&amp;m_Queue, 1, &amp;commandHandle);</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;}</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160; </div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="comment"> * AmbientOcclusion::DirectionalShadowPass</span></div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="comment"> * ---------------------------------------</span></div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="comment"> * This pass renders the shadow map for the scene&#39;s directional</span></div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;<span class="comment"> * light. AS the scene is static, this currently happens once at</span></div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="comment"> * load time and whenever AmbientOcclusion::Resize is called.</span></div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::DirectionalShadowPass()</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;{</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    AssetFileDataHolder* shaderData = m_Shaders[<span class="stringliteral">&quot;ShadowMap.out&quot;</span>];</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    std::string programName = shaderData-&gt;GetSpecializedProgramData()[0]-&gt;m_pProgramName;</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160; </div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;        <span class="comment">/* Update the model uniforms with the shadow matrices */</span></div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; m_SceneObjects.size(); ++i)</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;    {</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;        m_SceneObjects[i].SetCameraMatrix(m_pDirectionalLightPassAO-&gt;GetLightViewMatrix());</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;        m_SceneObjects[i].SetProjectionMatrix(m_pDirectionalLightPassAO-&gt;GetLightProjectionMatrix());</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;        m_SceneObjects[i].UpdateModelUniforms(programName);</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;    }</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160; </div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    <a class="code" href="struct_n_v_ncommand_buffer.html">NVNcommandBuffer</a>* pCommandBuffer = m_ShadowMapPassCommandBuffer-&gt;GetCommandBuffer();</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160; </div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    nvnCommandBufferBeginRecording(pCommandBuffer);</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160; </div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    nvnCommandBufferBindBlendState(pCommandBuffer, &amp;m_BlendState);</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    nvnCommandBufferBindChannelMaskState(pCommandBuffer, &amp;m_ChannelMaskState);</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    nvnCommandBufferBindColorState(pCommandBuffer, &amp;m_ColorState);</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    nvnCommandBufferBindDepthStencilState(pCommandBuffer, &amp;m_DepthStencilState);</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    nvnCommandBufferBindMultisampleState(pCommandBuffer, &amp;m_MultisampleState);</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160; </div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    nvnCommandBufferSetRenderTargets(pCommandBuffer, 0, NULL, NULL, &amp;m_DirectionalShadowMap.m_Texture, NULL);</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160; </div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;    m_pTextureIDManager-&gt;SetSamplerPool(pCommandBuffer);</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    m_pTextureIDManager-&gt;SetTexturePool(pCommandBuffer);</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160; </div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;    nvnCommandBufferSetScissor(pCommandBuffer, 0, 0, m_pDirectionalLightPassAO-&gt;GetShadowMapWidth(), m_pDirectionalLightPassAO-&gt;GetShadowMapHeight());</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    nvnCommandBufferSetViewport(pCommandBuffer, 0, 0, m_pDirectionalLightPassAO-&gt;GetShadowMapWidth(), m_pDirectionalLightPassAO-&gt;GetShadowMapHeight());</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160; </div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;    <span class="keywordflow">if</span> (m_pShaderScratchMemoryPool)</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    {</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;        nvnCommandBufferSetShaderScratchMemory(pCommandBuffer, m_pShaderScratchMemoryPool-&gt;GetMemoryPool(), 0, m_ShaderScratchSize);</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;    }</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160; </div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    nvnCommandBufferClearDepthStencil(pCommandBuffer, 1.0, <a class="code" href="group__nvn__c__defines.html#ga48151b7e768a13685d77d1a4c464a33b">NVN_TRUE</a>, 0, 0);</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160; </div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    nvnCommandBufferBarrier(pCommandBuffer, NVNbarrierBits::NVN_BARRIER_INVALIDATE_SHADER_BIT);</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160; </div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;        <span class="comment">/* Set the shadow state and draw the objects */</span></div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; m_SceneObjects.size(); ++i)</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;    {</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;        m_SceneObjects[i].SetShadowState();</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;        m_SceneObjects[i].Draw(pCommandBuffer, programName, m_Models, shaderData);</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    }</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160; </div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    <a class="code" href="group__nvn__c__handle.html#gab7f10945ffe1f6161c87238c75ae411d">NVNcommandHandle</a> commandHandle = nvnCommandBufferEndRecording(pCommandBuffer);</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    nvnQueueSubmitCommands(&amp;m_Queue, 1, &amp;commandHandle);</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;}</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160; </div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;<span class="comment"> * AmbientOcclusion::LightingPass</span></div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;<span class="comment"> * ------------------------------</span></div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;<span class="comment"> * This pass performs lighting for the directional light and each</span></div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;<span class="comment"> * point light in the scene. The directional light is drawn as a</span></div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;<span class="comment"> * screen space quad and the point lights are drawn using a front</span></div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;<span class="comment"> * face culled sphere.</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::LightingPass()</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;{</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;    <a class="code" href="struct_n_v_ncommand_buffer.html">NVNcommandBuffer</a>* pCommandBuffer = m_LightingPassCommandBuffer-&gt;GetCommandBuffer();</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;    <a class="code" href="structnn_1_1util_1_1_matrix_row_major4x4f_type.html">nn::util::Matrix4x4fType</a> camMat;</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;    nn::util::MatrixConvert(&amp;camMat, m_Camera.GetCameraMatrix());</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160; </div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;        <span class="comment">/* Update the directional light uniforms */</span></div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;    <span class="keywordflow">if</span> (m_pDirectionalLightPassAO)</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;    {</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        m_pDirectionalLightPassAO-&gt;SetLightTextureHandles(m_DiffuseTarget.m_TextureHandle,</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;                                                          m_SpecularTarget.m_TextureHandle,</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;                                                          m_NormalTarget.m_TextureHandle,</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;                                                          m_DirectionalShadowMap.m_TextureHandle,</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;                                                          m_DepthBuffer.m_TextureHandle);</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160; </div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;        m_pDirectionalLightPassAO-&gt;SetSSAOTextureHandle(m_ScalableAOFinalTarget.m_TextureHandle);</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160; </div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;        m_pDirectionalLightPassAO-&gt;SetScreenSize(m_ScreenWidth, m_ScreenHeight);</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;        m_pDirectionalLightPassAO-&gt;SetMatrices(camMat, m_ProjMat44);</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;        m_pDirectionalLightPassAO-&gt;UpdateUniforms();</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    }</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160; </div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;        <span class="comment">/* Update the camera matrix for the point lights */</span></div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    DeferredPointLightObject::SetMatrices(camMat, m_ProjMat44);</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160; </div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;        <span class="comment">/* Update the point light uniforms */</span></div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; m_DeferredPointLightObjects.size(); ++i)</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;    {</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;        m_DeferredPointLightObjects[i]-&gt;SetEyePos(m_Camera.GetPosition());</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;        m_DeferredPointLightObjects[i]-&gt;UpdateUniforms();</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    }</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160; </div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    nvnCommandBufferBeginRecording(pCommandBuffer);</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160; </div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;    <a class="code" href="struct_n_v_ntexture.html">NVNtexture</a>* targets[] = { &amp;m_FinalTarget.m_Texture };</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    nvnCommandBufferSetRenderTargets(pCommandBuffer, 1, targets, NULL, NULL, NULL);</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160; </div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    m_pTextureIDManager-&gt;SetSamplerPool(pCommandBuffer);</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;    m_pTextureIDManager-&gt;SetTexturePool(pCommandBuffer);</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160; </div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;    nvnCommandBufferSetScissor(pCommandBuffer, 0, 0, m_ScreenWidth, m_ScreenHeight);</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;    nvnCommandBufferSetViewport(pCommandBuffer, 0, 0, m_ScreenWidth, m_ScreenHeight);</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160; </div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    <span class="keywordflow">if</span> (m_pShaderScratchMemoryPool)</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;    {</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;        nvnCommandBufferSetShaderScratchMemory(pCommandBuffer, m_pShaderScratchMemoryPool-&gt;GetMemoryPool(), 0, m_ShaderScratchSize);</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;    }</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160; </div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    nvnCommandBufferBarrier(pCommandBuffer, NVNbarrierBits::NVN_BARRIER_ORDER_FRAGMENTS_BIT |</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;                                            NVNbarrierBits::NVN_BARRIER_INVALIDATE_TEXTURE_BIT |</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;                                            NVNbarrierBits::NVN_BARRIER_INVALIDATE_SHADER_BIT);</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160; </div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;<span class="comment">         * Draw the directional light pass. Draws a screen space quad and</span></div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;<span class="comment">         * calculates the lighting contribution per fragment.</span></div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;    <span class="keywordflow">if</span> (m_pDirectionalLightPassAO)</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    {</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;        m_pDirectionalLightPassAO-&gt;BindState(pCommandBuffer);</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;        m_pDirectionalLightPassAO-&gt;Draw(pCommandBuffer);</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    }</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160; </div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;    nvnCommandBufferSetRenderTargets(pCommandBuffer, 1, targets, NULL, &amp;m_DepthBuffer.m_Texture, NULL);</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160; </div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    nvnCommandBufferBarrier(pCommandBuffer, NVNbarrierBits::NVN_BARRIER_ORDER_FRAGMENTS_BIT |</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;                                            NVNbarrierBits::NVN_BARRIER_INVALIDATE_TEXTURE_BIT |</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;                                            NVNbarrierBits::NVN_BARRIER_INVALIDATE_SHADER_BIT);</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160; </div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    nvnCommandBufferSetStencilRef(pCommandBuffer, NVNface::NVN_FACE_FRONT_AND_BACK, 1);</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160; </div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; m_DeferredPointLightObjects.size(); ++i)</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    {</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;        m_DeferredPointLightObjects[i]-&gt;SetStencilBufferState();</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;        m_DeferredPointLightObjects[i]-&gt;BindState(pCommandBuffer);</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;        m_DeferredPointLightObjects[i]-&gt;DrawStencil(pCommandBuffer);</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160; </div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;<span class="comment">             * Draw the point light. Draws a front face culled sphere and</span></div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;<span class="comment">             * calculates the lighting contribution for each fragment that</span></div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;<span class="comment">             * falls within that sphere.</span></div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;        m_DeferredPointLightObjects[i]-&gt;SetPointLightState();</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;        m_DeferredPointLightObjects[i]-&gt;BindState(pCommandBuffer);</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;        m_DeferredPointLightObjects[i]-&gt;Draw(pCommandBuffer);</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160; </div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;            <span class="comment">/* Draw the light as a wire frame sphere if debug draw is enabled */</span></div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;        <span class="keywordflow">if</span> (m_PointLightDebugDraw)</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        {</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;            m_DeferredPointLightObjects[i]-&gt;SetDebugDrawState();</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;            m_DeferredPointLightObjects[i]-&gt;BindState(pCommandBuffer);</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;            m_DeferredPointLightObjects[i]-&gt;DebugDraw(pCommandBuffer);</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;        }</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;    }</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160; </div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;    <a class="code" href="group__nvn__c__handle.html#gab7f10945ffe1f6161c87238c75ae411d">NVNcommandHandle</a> lightingHandle = nvnCommandBufferEndRecording(pCommandBuffer);</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    nvnQueueSubmitCommands(&amp;m_Queue, 1, &amp;lightingHandle);</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;}</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160; </div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;<span class="comment"> * AmbientOcclusion::RenderSkyBox</span></div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;<span class="comment"> * ------------------------------</span></div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;<span class="comment"> * This pass draws the skybox after the rest of the scene has</span></div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;<span class="comment"> * been rendered. It is drawn as a large sphere with a radius</span></div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;<span class="comment"> * close to the value of the far plane distance and with the</span></div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;<span class="comment"> * depth test on. This is to avoid the overdraw that would</span></div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;<span class="comment"> * happen if it was drawn first.</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::RenderSkyBox()</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;{</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    <span class="keywordflow">if</span> (m_pSkyBox)</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;    {</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;        <a class="code" href="struct_n_v_ncommand_buffer.html">NVNcommandBuffer</a>* pCommandBuffer = m_SkyBoxCommandBuffer-&gt;GetCommandBuffer();</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160; </div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;        m_pSkyBox-&gt;UpdateUniforms();</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160; </div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;        nvnCommandBufferBeginRecording(pCommandBuffer);</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160; </div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;        <a class="code" href="struct_n_v_ntexture.html">NVNtexture</a>* targets[] = { &amp;m_FinalTarget.m_Texture };</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;        nvnCommandBufferSetRenderTargets(pCommandBuffer, 1, targets, NULL, &amp;m_DepthBuffer.m_Texture, NULL);</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160; </div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;        m_pTextureIDManager-&gt;SetSamplerPool(pCommandBuffer);</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;        m_pTextureIDManager-&gt;SetTexturePool(pCommandBuffer);</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160; </div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;        nvnCommandBufferSetScissor(pCommandBuffer, 0, 0, m_ScreenWidth, m_ScreenHeight);</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;        nvnCommandBufferSetViewport(pCommandBuffer, 0, 0, m_ScreenWidth, m_ScreenHeight);</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160; </div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;        <span class="keywordflow">if</span> (m_pShaderScratchMemoryPool)</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;        {</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;            nvnCommandBufferSetShaderScratchMemory(pCommandBuffer, m_pShaderScratchMemoryPool-&gt;GetMemoryPool(), 0, m_ShaderScratchSize);</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;        }</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160; </div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;        nvnCommandBufferBarrier(pCommandBuffer, NVNbarrierBits::NVN_BARRIER_INVALIDATE_SHADER_BIT);</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160; </div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;            <span class="comment">/* Bind state and draw */</span></div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;        m_pSkyBox-&gt;BindState(pCommandBuffer);</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;        m_pSkyBox-&gt;Draw(pCommandBuffer);</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160; </div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;        <a class="code" href="group__nvn__c__handle.html#gab7f10945ffe1f6161c87238c75ae411d">NVNcommandHandle</a> skyBoxHandle = nvnCommandBufferEndRecording(pCommandBuffer);</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;        nvnQueueSubmitCommands(&amp;m_Queue, 1, &amp;skyBoxHandle);</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;    }</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;}</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160; </div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="comment"> * AmbientOcclusion::PresentTexture</span></div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;<span class="comment"> * --------------------------------</span></div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;<span class="comment"> * Draws the given texture to a screen space quad and</span></div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;<span class="comment"> * presents it to the screen. Depth targets can choose</span></div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;<span class="comment"> * to use a special pass that will linearize the displayed</span></div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;<span class="comment"> * values.</span></div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;<span class="keywordtype">void</span> AmbientOcclusion::PresentTexture(<a class="code" href="group__nvn__c__handle.html#gaa1a1fc7a9e690ce93870bcd71ea6b446">NVNtextureHandle</a> textureHandle, ScreenSpaceQuadPass* pPass)</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;{</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;        <span class="comment">/* Get next render target to be used */</span></div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;    <span class="keywordtype">int</span> bufferIndex;</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    <a class="code" href="group__nvn__c__enum.html#ga58e9b155d7f2272b95044eed1f40415e">NVNwindowAcquireTextureResult</a> result = nvnWindowAcquireTexture(&amp;m_Window, &amp;m_WindowSync, &amp;bufferIndex);</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160; </div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(result == NVN_WINDOW_ACQUIRE_TEXTURE_RESULT_SUCCESS);</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;    <a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>(result);</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160; </div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;    <a class="code" href="struct_n_v_ncommand_buffer.html">NVNcommandBuffer</a>* pCommandBuffer = m_BackBufferCommandBuffer-&gt;GetCommandBuffer();</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160; </div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;        <span class="comment">/* Update the uniforms */</span></div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    pPass-&gt;SetTextureHandle(textureHandle);</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;    pPass-&gt;SetInvScreenSize(1.0f / m_ScreenWidth, 1.0f / m_ScreenHeight);</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    pPass-&gt;UpdateUniforms();</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160; </div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;    nvnCommandBufferBeginRecording(pCommandBuffer);</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;    {</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;        nvnCommandBufferSetRenderTargets(pCommandBuffer, 1, &amp;m_ScreenRenderTargets[bufferIndex], NULL, NULL, NULL);</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160; </div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;        m_pTextureIDManager-&gt;SetSamplerPool(pCommandBuffer);</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;        m_pTextureIDManager-&gt;SetTexturePool(pCommandBuffer);</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160; </div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;        nvnCommandBufferSetScissor(pCommandBuffer, 0, 0, m_ScreenWidth, m_ScreenHeight);</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;        nvnCommandBufferSetViewport(pCommandBuffer, 0, 0, m_ScreenWidth, m_ScreenHeight);</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160; </div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;        <span class="keywordflow">if</span> (m_pShaderScratchMemoryPool)</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;        {</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;            nvnCommandBufferSetShaderScratchMemory(pCommandBuffer, m_pShaderScratchMemoryPool-&gt;GetMemoryPool(), 0, m_ShaderScratchSize);</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;        }</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160; </div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;        nvnCommandBufferBarrier(pCommandBuffer, NVNbarrierBits::NVN_BARRIER_ORDER_FRAGMENTS_BIT | NVNbarrierBits::NVN_BARRIER_INVALIDATE_TEXTURE_BIT | NVNbarrierBits::NVN_BARRIER_INVALIDATE_SHADER_BIT);</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160; </div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;            <span class="comment">/* Bind state and draw the screen space quad */</span></div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;        pPass-&gt;BindState(pCommandBuffer);</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;        pPass-&gt;Draw(pCommandBuffer);</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160; </div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;        nvnCommandBufferReportCounter(pCommandBuffer, NVN_COUNTER_TYPE_TIMESTAMP, nvnBufferGetAddress( &amp;m_TimeStampBuffer ) + m_TimeStampBufferSize * (m_CurrentTimeStamp % g_NumBackBuffers) + g_GPUTimeAfterOffset);</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;    }</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160; </div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;    <a class="code" href="group__nvn__c__handle.html#gab7f10945ffe1f6161c87238c75ae411d">NVNcommandHandle</a> presentHandle = nvnCommandBufferEndRecording(pCommandBuffer);</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160; </div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;    m_CPUTime = <a class="code" href="namespacenn_1_1os.html#a79e29821bfb2b0c3a5c222488e90cc89">nn::os::GetSystemTick</a>().<a class="code" href="classnn_1_1os_1_1_tick.html#aae2542ec136248db4dc662cbdf95f3ad">ToTimeSpan</a>().<a class="code" href="classnn_1_1_time_span.html#a03c119fa6c678e9b251f14f7ca8431c5">GetNanoSeconds</a>() - m_CurrentBeginFrameTime;</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160; </div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;        <span class="comment">/* Wait for the window texture to be available */</span></div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;    nvnSyncWait(&amp;m_WindowSync, <a class="code" href="group__nvn__c__defines.html#ga6c3444e501307a094f1d57abf1059aed">NVN_WAIT_TIMEOUT_MAXIMUM</a>);</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160; </div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;    nvnQueueSubmitCommands(&amp;m_Queue, 1, &amp;presentHandle);</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160; </div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;<span class="preprocessor">#ifdef DEBUGTEXT</span></div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;    m_pDebugTextRenderer-&gt;SetColor(1.0f, 0.0f, 0.0f, 1.0f);</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;    m_pDebugTextRenderer-&gt;Printf(0, 0, m_PresentTargetName.c_str());</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;    m_pDebugTextRenderer-&gt;Printf(1, 1, <span class="stringliteral">&quot;Frame Time: %f&quot;</span>,    m_PrevFrameTime / 1000000.0f);</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    m_pDebugTextRenderer-&gt;Printf(1, 2, <span class="stringliteral">&quot;CPU Time:    %f&quot;</span>,   m_CPUTime / 1000000.0f);</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;    m_pDebugTextRenderer-&gt;Printf(1, 3, <span class="stringliteral">&quot;GPU Time:   %f&quot;</span>,    m_PrevGPUTime / 1000000.0f);</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160; </div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    <span class="keywordflow">if</span>(m_SAOEnabled)</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;    {</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;        m_pDebugTextRenderer-&gt;Printf(2, 4, <span class="stringliteral">&quot;Total AO Time: %f&quot;</span>, m_PrevAOTime / 1000000.0f);</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;        m_pDebugTextRenderer-&gt;Printf(3, 5, <span class="stringliteral">&quot;Depth Time:   %f&quot;</span>,  m_PrevSAODepthTime / 1000000.0f);</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;        m_pDebugTextRenderer-&gt;Printf(3, 6, <span class="stringliteral">&quot;Mipmap Time:  %f&quot;</span>,  m_PrevSAOMipmapTime / 1000000.0f);</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;        m_pDebugTextRenderer-&gt;Printf(3, 7, <span class="stringliteral">&quot;SAO Time:     %f&quot;</span>,  m_PrevSAOTime / 1000000.0f);</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;        m_pDebugTextRenderer-&gt;Printf(3, 8, <span class="stringliteral">&quot;Blur Time:    %f&quot;</span>,  m_PrevSAOBlurTime / 1000000.0f);</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    }</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    {</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;        m_pDebugTextRenderer-&gt;Printf(2, 4, <span class="stringliteral">&quot;Total AO Time: %f&quot;</span>, 0.0f);</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;        m_pDebugTextRenderer-&gt;Printf(3, 5, <span class="stringliteral">&quot;Depth Time:   %f&quot;</span>,  0.0f);</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;        m_pDebugTextRenderer-&gt;Printf(3, 6, <span class="stringliteral">&quot;Mipmap Time:  %f&quot;</span>,  0.0f);</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        m_pDebugTextRenderer-&gt;Printf(3, 7, <span class="stringliteral">&quot;SAO Time:     %f&quot;</span>,  0.0f);</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;        m_pDebugTextRenderer-&gt;Printf(3, 8, <span class="stringliteral">&quot;Blur Time:    %f&quot;</span>,  0.0f);</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;    }</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160; </div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160; </div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    std::string saoStateStr = m_SAOEnabled ? <span class="stringliteral">&quot;True&quot;</span> : <span class="stringliteral">&quot;False&quot;</span>;</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    m_pDebugTextRenderer-&gt;SetColor(0.0f, 0.5f, 0.5f, 1.0f);</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    m_pDebugTextRenderer-&gt;Printf(0, 9, <span class="stringliteral">&quot;SAO Enabled: %s&quot;</span>, saoStateStr.c_str());</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160; </div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; static_cast&lt;int&gt;(SAOParam::TOTAL); i++)</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;    {</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;        <span class="keywordtype">int</span> saoParamsIndex = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(m_SAOParamsSelected);</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;        <span class="keywordflow">if</span> (i == saoParamsIndex)</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        {</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;            m_pDebugTextRenderer-&gt;SetColor(0.0f, 0.5f, 0.5f, 1.0f);</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;        }</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;        {</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;            m_pDebugTextRenderer-&gt;SetColor(0.0f, 0.1f, 0.5f, 1.0f);</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;        }</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;        m_pDebugTextRenderer-&gt;Printf(1, <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(i + 10), m_SAOParams[i].first.c_str(), m_SAOParams[i].second);</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;    }</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160; </div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    m_pDebugTextRenderer-&gt;Draw(m_ScreenRenderTargets[bufferIndex], m_ScreenWidth, m_ScreenHeight);</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160; </div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;    nvnQueuePresentTexture(&amp;m_Queue, &amp;m_Window, bufferIndex);</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;}</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160; </div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;<span class="keywordtype">void</span> NVNAPIENTRY AmbientOcclusion::DebugLayerCallback(<a class="code" href="group__nvn__c__enum.html#ga70a49f98019e4832818240297bee7eb3">NVNdebugCallbackSource</a> source,</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;                                                      <a class="code" href="group__nvn__c__enum.html#ga661d03f0e1c886c81d5ccc67935df182">NVNdebugCallbackType</a> type,</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;                                                      <span class="keywordtype">int</span> <span class="keywordtype">id</span>,</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;                                                      <a class="code" href="group__nvn__c__enum.html#ga6d72003c068d7795201e77d27bf8c7ac">NVNdebugCallbackSeverity</a> severity,</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;                                                      <span class="keyword">const</span> <span class="keywordtype">char</span>* message,</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;                                                      <span class="keywordtype">void</span>* pUser)</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;{</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(pUser == NULL);</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;    <a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>(pUser);</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160; </div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;NVN Debug Layer Callback:\n&quot;</span>);</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;  source:       0x%08x\n&quot;</span>, source);</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;  type:         0x%08x\n&quot;</span>, type);</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;  id:           0x%08x\n&quot;</span>, <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;  severity:     0x%08x\n&quot;</span>, severity);</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;  message:      %s\n&quot;</span>, message);</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160; </div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;    <a class="code" href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a>(<span class="keyword">false</span>, <span class="stringliteral">&quot;NVN debug layer hit\n&quot;</span>);</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;}</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160; </div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;TutorialBaseClass* t()</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;{</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;    <span class="keyword">static</span> AmbientOcclusion tut;</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;    <span class="keywordflow">return</span> (&amp;tut);</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;}</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160; </div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> nnMain()</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;{</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;    TutorialRun();</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;}</div>
<div class="ttc" id="a_aligned_allocator_8h_html"><div class="ttname"><a href="_aligned_allocator_8h.html">AlignedAllocator.h</a></div><div class="ttdoc">This file defines a simple aligned allocator that takes care of keeping track of the original allocat...</div></div>
<div class="ttc" id="a_load_scene_8h_html"><div class="ttname"><a href="_load_scene_8h.html">LoadScene.h</a></div><div class="ttdoc">This file defines some helper functions for loading the various objects, textures,...</div></div>
<div class="ttc" id="a_nvn_tutorial13_8h_html"><div class="ttname"><a href="_nvn_tutorial13_8h.html">NvnTutorial13.h</a></div><div class="ttdoc">This tutorial adds screen space ambient occlusion to the deferred renderer presented in the previous ...</div></div>
<div class="ttc" id="aclassnn_1_1_result_html"><div class="ttname"><a href="classnn_1_1_result.html">nn::Result</a></div><div class="ttdoc">Represents the generic result of an operation.</div><div class="ttdef"><b>Definition:</b> nn_Result.h:32</div></div>
<div class="ttc" id="aclassnn_1_1_time_span_html_a03c119fa6c678e9b251f14f7ca8431c5"><div class="ttname"><a href="classnn_1_1_time_span.html#a03c119fa6c678e9b251f14f7ca8431c5">nn::TimeSpan::GetNanoSeconds</a></div><div class="ttdeci">constexpr int64_t GetNanoSeconds() const NN_NOEXCEPT</div><div class="ttdoc">Gets the time in nanoseconds.</div><div class="ttdef"><b>Definition:</b> nn_TimeSpan.h:691</div></div>
<div class="ttc" id="aclassnn_1_1os_1_1_tick_html_aae2542ec136248db4dc662cbdf95f3ad"><div class="ttname"><a href="classnn_1_1os_1_1_tick.html#aae2542ec136248db4dc662cbdf95f3ad">nn::os::Tick::ToTimeSpan</a></div><div class="ttdeci">nn::TimeSpan ToTimeSpan() const NN_NOEXCEPT</div><div class="ttdoc">Converts to a nn::TimeSpan value.</div><div class="ttdef"><b>Definition:</b> os_TickTypes.h:121</div></div>
<div class="ttc" id="aclassnn_1_1util_1_1_vector4f_html"><div class="ttname"><a href="classnn_1_1util_1_1_vector4f.html">nn::util::Vector4f</a></div><div class="ttdoc">Class that expresses four-dimensional vectors using a single precision floating number type.</div><div class="ttdef"><b>Definition:</b> util_Vector.h:573</div></div>
<div class="ttc" id="afs_8h_html"><div class="ttname"><a href="fs_8h.html">fs.h</a></div><div class="ttdoc">Declarations of API resources for the file system.</div></div>
<div class="ttc" id="agroup__nvn__c__api__typedefs_html_ga05b6b3dd5b965bd81efe2d03cee0bbbd"><div class="ttname"><a href="group__nvn__c__api__typedefs.html#ga05b6b3dd5b965bd81efe2d03cee0bbbd">NVNnativeWindow</a></div><div class="ttdeci">void * NVNnativeWindow</div><div class="ttdoc">Platform native window type.</div><div class="ttdef"><b>Definition:</b> nvn.h:159</div></div>
<div class="ttc" id="agroup__nvn__c__defines_html_ga48151b7e768a13685d77d1a4c464a33b"><div class="ttname"><a href="group__nvn__c__defines.html#ga48151b7e768a13685d77d1a4c464a33b">NVN_TRUE</a></div><div class="ttdeci">#define NVN_TRUE</div><div class="ttdoc">Boolean condition with a value of true.</div><div class="ttdef"><b>Definition:</b> nvn.h:4566</div></div>
<div class="ttc" id="agroup__nvn__c__defines_html_ga4eb83fe713146d844b1ac7f8e9c3dada"><div class="ttname"><a href="group__nvn__c__defines.html#ga4eb83fe713146d844b1ac7f8e9c3dada">NVN_API_MAJOR_VERSION</a></div><div class="ttdeci">#define NVN_API_MAJOR_VERSION</div><div class="ttdoc">Major version of the NVN API.</div><div class="ttdef"><b>Definition:</b> nvn.h:59</div></div>
<div class="ttc" id="agroup__nvn__c__defines_html_ga6c3444e501307a094f1d57abf1059aed"><div class="ttname"><a href="group__nvn__c__defines.html#ga6c3444e501307a094f1d57abf1059aed">NVN_WAIT_TIMEOUT_MAXIMUM</a></div><div class="ttdeci">#define NVN_WAIT_TIMEOUT_MAXIMUM</div><div class="ttdoc">When waiting on NVNsync objects, wait indefinitely until the sync object is signaled.</div><div class="ttdef"><b>Definition:</b> nvn.h:4574</div></div>
<div class="ttc" id="agroup__nvn__c__defines_html_gaa8b4a49a0c4f852b73be3b50bb3f270e"><div class="ttname"><a href="group__nvn__c__defines.html#gaa8b4a49a0c4f852b73be3b50bb3f270e">NVN_API_MINOR_VERSION</a></div><div class="ttdeci">#define NVN_API_MINOR_VERSION</div><div class="ttdoc">Minor version of the NVN API.</div><div class="ttdef"><b>Definition:</b> nvn.h:62</div></div>
<div class="ttc" id="agroup__nvn__c__defines_html_gace820e752b400cf7aa36e9684a7f45cb"><div class="ttname"><a href="group__nvn__c__defines.html#gace820e752b400cf7aa36e9684a7f45cb">NVN_MEMORY_POOL_STORAGE_ALIGNMENT</a></div><div class="ttdeci">#define NVN_MEMORY_POOL_STORAGE_ALIGNMENT</div><div class="ttdoc">Required base address alignment for app-specified memory used to back memory pools.</div><div class="ttdef"><b>Definition:</b> nvn.h:4578</div></div>
<div class="ttc" id="agroup__nvn__c__defines_html_gadfd69601d2d9f953c55808127ba60853"><div class="ttname"><a href="group__nvn__c__defines.html#gadfd69601d2d9f953c55808127ba60853">NVN_MEMORY_POOL_STORAGE_GRANULARITY</a></div><div class="ttdeci">#define NVN_MEMORY_POOL_STORAGE_GRANULARITY</div><div class="ttdoc">Required size alignment for app-specified memory used to back memory pools.</div><div class="ttdef"><b>Definition:</b> nvn.h:4582</div></div>
<div class="ttc" id="agroup__nvn__c__entryfuncptrs_html_ga9557d931192cd70c7d2810a6425326eb"><div class="ttname"><a href="group__nvn__c__entryfuncptrs.html#ga9557d931192cd70c7d2810a6425326eb">PFNNVNDEVICEGETPROCADDRESSPROC</a></div><div class="ttdeci">PFNNVNGENERICFUNCPTRPROC(* PFNNVNDEVICEGETPROCADDRESSPROC)(const NVNdevice *device, const char *name)</div><div class="ttdoc">Function pointer type to call nvnDeviceGetProcAddress().</div><div class="ttdef"><b>Definition:</b> nvn.h:15922</div></div>
<div class="ttc" id="agroup__nvn__c__enum_html_ga58e9b155d7f2272b95044eed1f40415e"><div class="ttname"><a href="group__nvn__c__enum.html#ga58e9b155d7f2272b95044eed1f40415e">NVNwindowAcquireTextureResult</a></div><div class="ttdeci">NVNwindowAcquireTextureResult</div><div class="ttdoc">Specifies the result of acquiring a texture from a window.</div><div class="ttdef"><b>Definition:</b> nvn.h:2673</div></div>
<div class="ttc" id="agroup__nvn__c__enum_html_ga661d03f0e1c886c81d5ccc67935df182"><div class="ttname"><a href="group__nvn__c__enum.html#ga661d03f0e1c886c81d5ccc67935df182">NVNdebugCallbackType</a></div><div class="ttdeci">NVNdebugCallbackType</div><div class="ttdoc">Specifies the type of event triggering a debug callback.</div><div class="ttdef"><b>Definition:</b> nvn.h:2924</div></div>
<div class="ttc" id="agroup__nvn__c__enum_html_ga6d72003c068d7795201e77d27bf8c7ac"><div class="ttname"><a href="group__nvn__c__enum.html#ga6d72003c068d7795201e77d27bf8c7ac">NVNdebugCallbackSeverity</a></div><div class="ttdeci">NVNdebugCallbackSeverity</div><div class="ttdoc">Specifies the severity of the event triggering a debug callback.</div><div class="ttdef"><b>Definition:</b> nvn.h:2954</div></div>
<div class="ttc" id="agroup__nvn__c__enum_html_ga70a49f98019e4832818240297bee7eb3"><div class="ttname"><a href="group__nvn__c__enum.html#ga70a49f98019e4832818240297bee7eb3">NVNdebugCallbackSource</a></div><div class="ttdeci">NVNdebugCallbackSource</div><div class="ttdoc">Specifies the type of operation being performed when a debug callback is made.</div><div class="ttdef"><b>Definition:</b> nvn.h:2902</div></div>
<div class="ttc" id="agroup__nvn__c__enum_html_gga9c68350bf64f2e7a90a23290c26872d3a12928b2591c67a2a61cf67c5b1d4c5e9"><div class="ttname"><a href="group__nvn__c__enum.html#gga9c68350bf64f2e7a90a23290c26872d3a12928b2591c67a2a61cf67c5b1d4c5e9">NVN_DEVICE_FLAG_DEBUG_ENABLE_LEVEL_4_BIT</a></div><div class="ttdeci">@ NVN_DEVICE_FLAG_DEBUG_ENABLE_LEVEL_4_BIT</div><div class="ttdoc">Enable (TRUE) or disable (FALSE) level 4 debug layer for the device.</div><div class="ttdef"><b>Definition:</b> nvn.h:2849</div></div>
<div class="ttc" id="agroup__nvn__c__funcptrs_html_gab106acc34961bf1c3a43514686dbfc4b"><div class="ttname"><a href="group__nvn__c__funcptrs.html#gab106acc34961bf1c3a43514686dbfc4b">PFNNVNDEBUGCALLBACKPROC</a></div><div class="ttdeci">void(* PFNNVNDEBUGCALLBACKPROC)(NVNdebugCallbackSource source, NVNdebugCallbackType type, int id, NVNdebugCallbackSeverity severity, const char *message, void *userParam)</div><div class="ttdoc">Function pointer type used to specify a function to call for debug callbacks.</div><div class="ttdef"><b>Definition:</b> nvn.h:4674</div></div>
<div class="ttc" id="agroup__nvn__c__handle_html_gaa1a1fc7a9e690ce93870bcd71ea6b446"><div class="ttname"><a href="group__nvn__c__handle.html#gaa1a1fc7a9e690ce93870bcd71ea6b446">NVNtextureHandle</a></div><div class="ttdeci">uint64_t NVNtextureHandle</div><div class="ttdoc">GPU handle used to refer to a texture object for texture mapping operations.</div><div class="ttdef"><b>Definition:</b> nvn.h:441</div></div>
<div class="ttc" id="agroup__nvn__c__handle_html_gab7f10945ffe1f6161c87238c75ae411d"><div class="ttname"><a href="group__nvn__c__handle.html#gab7f10945ffe1f6161c87238c75ae411d">NVNcommandHandle</a></div><div class="ttdeci">uint64_t NVNcommandHandle</div><div class="ttdoc">GPU handle used to refer to a command buffer object.</div><div class="ttdef"><b>Definition:</b> nvn.h:437</div></div>
<div class="ttc" id="anamespacenn_1_1fs_html_a2e453fe1fbf8f818dc45bbd2897105cd"><div class="ttname"><a href="namespacenn_1_1fs.html#a2e453fe1fbf8f818dc45bbd2897105cd">nn::fs::MountRom</a></div><div class="ttdeci">Result MountRom(const char *name, void *pFileSystemCacheBuffer, size_t fileSystemCacheBufferSize) NN_NOEXCEPT</div><div class="ttdoc">Mounts ROM resource data.</div></div>
<div class="ttc" id="anamespacenn_1_1fs_html_a5df6e3385c795a5bd046790ef7f17f2d"><div class="ttname"><a href="namespacenn_1_1fs.html#a5df6e3385c795a5bd046790ef7f17f2d">nn::fs::QueryMountRomCacheSize</a></div><div class="ttdeci">Result QueryMountRomCacheSize(size_t *pOutValue) NN_NOEXCEPT</div><div class="ttdoc">Get the size needed for the nn::fs::MountRom file system cache.</div></div>
<div class="ttc" id="anamespacenn_1_1fs_html_ac8a95249afd4a87a55d319dfecb0466c"><div class="ttname"><a href="namespacenn_1_1fs.html#ac8a95249afd4a87a55d319dfecb0466c">nn::fs::Unmount</a></div><div class="ttdeci">void Unmount(const char *name) NN_NOEXCEPT</div><div class="ttdoc">Unmounts a mounted file system and frees the resources.</div></div>
<div class="ttc" id="anamespacenn_1_1gfx_html_ad620d8208dd309eb7c4dd5973a6aeee5"><div class="ttname"><a href="namespacenn_1_1gfx.html#ad620d8208dd309eb7c4dd5973a6aeee5">nn::gfx::MemoryPool</a></div><div class="ttdeci">TMemoryPool&lt; TargetConfig::Variation &gt; MemoryPool</div><div class="ttdoc">The type definition representing a memory pool.</div><div class="ttdef"><b>Definition:</b> gfx_Types.h:116</div></div>
<div class="ttc" id="anamespacenn_1_1htc_html_a370e114a42a12b384ef2b2246618168e"><div class="ttname"><a href="namespacenn_1_1htc.html#a370e114a42a12b384ef2b2246618168e">nn::htc::GetEnvironmentVariable</a></div><div class="ttdeci">Result GetEnvironmentVariable(size_t *pOutSize, char *outBuffer, size_t bufferSize, const char *variableName) NN_NOEXCEPT</div><div class="ttdoc">Gets the value of the specified environment variable as a UTF-8 string from the host.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a79e29821bfb2b0c3a5c222488e90cc89"><div class="ttname"><a href="namespacenn_1_1os.html#a79e29821bfb2b0c3a5c222488e90cc89">nn::os::GetSystemTick</a></div><div class="ttdeci">Tick GetSystemTick() NN_NOEXCEPT</div><div class="ttdoc">Gets the system tick value.</div></div>
<div class="ttc" id="ann___abort_8h_html_a1e657a678a588533a020c2e947df7772"><div class="ttname"><a href="nn___abort_8h.html#a1e657a678a588533a020c2e947df7772">NN_ABORT_UNLESS_RESULT_SUCCESS</a></div><div class="ttdeci">#define NN_ABORT_UNLESS_RESULT_SUCCESS(result)</div><div class="ttdoc">Tests whether the specified nn::Result is successful or not, and stops if it is not.</div><div class="ttdef"><b>Definition:</b> nn_Abort.h:188</div></div>
<div class="ttc" id="ann___assert_8h_html"><div class="ttname"><a href="nn___assert_8h.html">nn_Assert.h</a></div><div class="ttdoc">Declarations for API resources to test whether conditions are satisfied.</div></div>
<div class="ttc" id="ann___assert_8h_html_a0473ebccccc250efd6100a9bbfec406b"><div class="ttname"><a href="nn___assert_8h.html#a0473ebccccc250efd6100a9bbfec406b">NN_ASSERT_NOT_NULL</a></div><div class="ttdeci">#define NN_ASSERT_NOT_NULL(pointer)</div><div class="ttdoc">Tests whether the pointer is not a null pointer.</div><div class="ttdef"><b>Definition:</b> nn_Assert.h:140</div></div>
<div class="ttc" id="ann___assert_8h_html_ade59d1d911907a16c0241f8fe3b31542"><div class="ttname"><a href="nn___assert_8h.html#ade59d1d911907a16c0241f8fe3b31542">NN_ASSERT</a></div><div class="ttdeci">#define NN_ASSERT(condition,...)</div><div class="ttdoc">Tests whether a condition is satisfied.</div><div class="ttdef"><b>Definition:</b> nn_Assert.h:124</div></div>
<div class="ttc" id="ann___log_8h_html"><div class="ttname"><a href="nn___log_8h.html">nn_Log.h</a></div><div class="ttdoc">Declarations for the logging API.</div></div>
<div class="ttc" id="ann___log_8h_html_a2d720c8bc6b733bce63879350d134a84"><div class="ttname"><a href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a></div><div class="ttdeci">#define NN_LOG(...)</div><div class="ttdoc">Adds the string specified in the parameter as a log entry.</div><div class="ttdef"><b>Definition:</b> nn_Log.h:33</div></div>
<div class="ttc" id="ann___macro_8h_html_ac6f80ca2ebf15f619391e35806e9635f"><div class="ttname"><a href="nn___macro_8h.html#ac6f80ca2ebf15f619391e35806e9635f">NN_ALIGNOF</a></div><div class="ttdeci">#define NN_ALIGNOF(type)</div><div class="ttdoc">Gets the byte alignment.</div><div class="ttdef"><b>Definition:</b> nn_Macro.h:170</div></div>
<div class="ttc" id="ann___macro_8h_html_af2d1673769927c5eae977d8dde3ce106"><div class="ttname"><a href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a></div><div class="ttdeci">#define NN_UNUSED(variable)</div><div class="ttdoc">Suppresses compiler warnings on intentionally unused variables.</div><div class="ttdef"><b>Definition:</b> nn_Macro.h:610</div></div>
<div class="ttc" id="astruct_n_v_nbuffer_builder_html"><div class="ttname"><a href="struct_n_v_nbuffer_builder.html">NVNbufferBuilder</a></div><div class="ttdoc">Object specifying state used to construct new buffer objects.</div><div class="ttdef"><b>Definition:</b> nvn.h:313</div></div>
<div class="ttc" id="astruct_n_v_ncommand_buffer_html"><div class="ttname"><a href="struct_n_v_ncommand_buffer.html">NVNcommandBuffer</a></div><div class="ttdoc">Collection of commands to send to the GPU via queues.</div><div class="ttdef"><b>Definition:</b> nvn.h:236</div></div>
<div class="ttc" id="astruct_n_v_ncounter_data_html"><div class="ttname"><a href="struct_n_v_ncounter_data.html">NVNcounterData</a></div><div class="ttdoc">Data structure describing how counter values are written to buffer memory.</div><div class="ttdef"><b>Definition:</b> nvn.h:4331</div></div>
<div class="ttc" id="astruct_n_v_ndevice_builder_html"><div class="ttname"><a href="struct_n_v_ndevice_builder.html">NVNdeviceBuilder</a></div><div class="ttdoc">Object specifying state used to construct new device objects.</div><div class="ttdef"><b>Definition:</b> nvn.h:216</div></div>
<div class="ttc" id="astruct_n_v_nqueue_builder_html"><div class="ttname"><a href="struct_n_v_nqueue_builder.html">NVNqueueBuilder</a></div><div class="ttdoc">Object specifying state used to construct new queue objects.</div><div class="ttdef"><b>Definition:</b> nvn.h:226</div></div>
<div class="ttc" id="astruct_n_v_nsampler_html"><div class="ttname"><a href="struct_n_v_nsampler.html">NVNsampler</a></div><div class="ttdoc">GPU-accessible object controlling how texture data are fetched and filtered.</div><div class="ttdef"><b>Definition:</b> nvn.h:358</div></div>
<div class="ttc" id="astruct_n_v_ntexture_html"><div class="ttname"><a href="struct_n_v_ntexture.html">NVNtexture</a></div><div class="ttdoc">Block of GPU-accessible memory and related state used to hold image data.</div><div class="ttdef"><b>Definition:</b> nvn.h:325</div></div>
<div class="ttc" id="astruct_n_v_ntexture_view_html"><div class="ttname"><a href="struct_n_v_ntexture_view.html">NVNtextureView</a></div><div class="ttdoc">Object used to specify an alternate 'view' of a full texture object for various rendering operations.</div><div class="ttdef"><b>Definition:</b> nvn.h:347</div></div>
<div class="ttc" id="astructnn_1_1util_1_1_matrix_row_major4x4f_type_html"><div class="ttname"><a href="structnn_1_1util_1_1_matrix_row_major4x4f_type.html">nn::util::MatrixRowMajor4x4fType</a></div><div class="ttdoc">Represents a four-row, four-column, row-major matrix using a single precision floating point data typ...</div><div class="ttdef"><b>Definition:</b> util_MathTypes.h:422</div></div>
</div><!-- fragment --><h2><a class="anchor" id="PageSampleNvnTutorial13_SectionSampleDetail"></a>
Sample Program Description</h2>
<p>This sample draws a hallway with a spiral staircase at one end and a detective's office at the other. There are five point lights in the hallway and one in each of the office rooms. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
</body>
</html>
