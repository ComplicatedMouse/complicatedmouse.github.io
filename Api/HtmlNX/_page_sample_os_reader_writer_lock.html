<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ReaderWriterLock Sample | NintendoSDK API Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="openclose.js"></script>
<script type="text/javascript" src="searchapi.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">NintendoSDK API Reference
   &#160;<span id="projectnumber">14.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="_page_sample.html">Sample Descriptions</a></li><li class="navelem"><a class="el" href="_page_sample_os.html">Operating System Library Samples</a></li>  </ul>
</div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ReaderWriterLock Sample </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#PageSampleOsReaderWriterLock_SectionBrief">Overview</a></li>
<li class="level1"><a href="#PageSampleOsReaderWriterLock_SectionFileStructure">File Structure</a></li>
<li class="level1"><a href="#PageSampleOsReaderWriterLock_SectionNecessaryEnvironment">Required Environment</a></li>
<li class="level1"><a href="#PageSampleOsReaderWriterLock_SectionHowToOperate">How to Use</a></li>
<li class="level1"><a href="#PageSampleOsReaderWriterLock_SectionPrecaution">Important Information</a></li>
<li class="level1"><a href="#PageSampleOsReaderWriterLock_SectionHowToExecute">Execution Procedure</a></li>
<li class="level1"><a href="#PageSampleOsReaderWriterLock_SectionDetail">Description</a><ul><li class="level2"><a href="#PageSampleOsReaderWriterLock_SectionSampleProgram">Sample Program</a></li>
<li class="level2"><a href="#PageSampleOsReaderWriterLock_SectionSampleDetail">Sample Program Description</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>A sample program for the Reader-Writer lock feature.</p>
<h1><a class="anchor" id="PageSampleOsReaderWriterLock_SectionBrief"></a>
Overview</h1>
<p>This sample uses the Reader-Writer lock feature.</p>
<p>For information about using the Reader-Writer lock feature, see the Reader-Writer Lock Feature Manual and the <a class="el" href="namespacenn_1_1os.html">OS API Reference</a>.</p>
<h1><a class="anchor" id="PageSampleOsReaderWriterLock_SectionFileStructure"></a>
File Structure</h1>
<p>This sample program is located in <code><a class="el" href="dir_598a2cff4e3e5d68e8f6a8431014c1f7.html">Samples/Sources/Applications/OsReaderWriterLock/ </a> </code>.</p>
<h1><a class="anchor" id="PageSampleOsReaderWriterLock_SectionNecessaryEnvironment"></a>
Required Environment</h1>
<p>Nothing specific.</p>
<h1><a class="anchor" id="PageSampleOsReaderWriterLock_SectionHowToOperate"></a>
How to Use</h1>
<p>Nothing specific.</p>
<h1><a class="anchor" id="PageSampleOsReaderWriterLock_SectionPrecaution"></a>
Important Information</h1>
<p>This sample program does not display anything on the screen. The execution results are output to a log.</p>
<h1><a class="anchor" id="PageSampleOsReaderWriterLock_SectionHowToExecute"></a>
Execution Procedure</h1>
<p>Build the sample program and then run it.</p>
<h1><a class="anchor" id="PageSampleOsReaderWriterLock_SectionDetail"></a>
Description</h1>
<h2><a class="anchor" id="PageSampleOsReaderWriterLock_SectionSampleProgram"></a>
Sample Program</h2>
<p>This sample program uses the following source code.</p>
<p><a class="el" href="_os_reader_writer_lock_8cpp.html" title="Sample program showing how to use the Reader-Writer lock feature.">OsReaderWriterLock.cpp</a> </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*--------------------------------------------------------------------------------*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">  Copyright Nintendo.  All rights reserved.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">  These coded instructions, statements, and computer programs contain proprietary</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">  information of Nintendo and/or its licensed developers and are protected by</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">  national and international copyright laws. They may not be disclosed to third</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">  parties or copied or duplicated in any form, in whole or in part, without the</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">  prior written consent of Nintendo.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">  The content herein is highly confidential and should be handled accordingly.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *--------------------------------------------------------------------------------*/</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="nn___macro_8h.html">nn/nn_Macro.h</a>&gt;</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="nn___log_8h.html">nn/nn_Log.h</a>&gt;</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="nn___abort_8h.html">nn/nn_Abort.h</a>&gt;</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="preprocessor">#include &lt;nn/os.h&gt;</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">//-----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="keyword">namespace </span>{</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="keyword">const</span> <span class="keywordtype">size_t</span>                    ThreadStackSize = 8192;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<a class="code" href="os___thread_common_8h.html#a5ce0c3c0aaceb976178a60a18d90f470">NN_OS_ALIGNAS_THREAD_STACK</a> <span class="keywordtype">char</span> g_ThreadStack1[ ThreadStackSize ];</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<a class="code" href="os___thread_common_8h.html#a5ce0c3c0aaceb976178a60a18d90f470">NN_OS_ALIGNAS_THREAD_STACK</a> <span class="keywordtype">char</span> g_ThreadStack2[ ThreadStackSize ];</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<a class="code" href="os___thread_common_8h.html#a5ce0c3c0aaceb976178a60a18d90f470">NN_OS_ALIGNAS_THREAD_STACK</a> <span class="keywordtype">char</span> g_ThreadStack3[ ThreadStackSize ];</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="keywordtype">int</span>                             g_Value1 = 0;   <span class="comment">// Lock target variable 1.</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="keywordtype">int</span>                             g_Value2 = 0;   <span class="comment">// Lock target variable 2.</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<a class="code" href="structnn_1_1os_1_1_reader_writer_lock_type.html">nn::os::ReaderWriterLockType</a>    g_Rwlock;       <span class="comment">// Reader-Writer lock.</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keyword">const</span> <span class="keywordtype">int</span>   LoopCount = 10000;                  <span class="comment">// Loop count.</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;}   <span class="comment">// namespace</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">//-----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">//  First thread.</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="keywordtype">void</span> SubThread1(<span class="keywordtype">void</span> *arg)</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;{</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>(arg);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; LoopCount; ++i)</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <a class="code" href="namespacenn_1_1os.html#a6fa888b2694902212ebc056ccaa4354b">nn::os::AcquireReadLock</a>( &amp;g_Rwlock );</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        <span class="keyword">auto</span> value1 = g_Value1;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="keyword">auto</span> value2 = g_Value2;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <a class="code" href="nn___abort_8h.html#a5c1a90d3a6474658ae0ac5dc5bcb14e4">NN_ABORT_UNLESS</a>( value1 * 2 == value2 );</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <a class="code" href="namespacenn_1_1os.html#a4d8f51bbfa3341c9678758b191896a05">nn::os::ReleaseReadLock</a>( &amp;g_Rwlock );</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;}</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">//  Second thread.</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="keywordtype">void</span> SubThread2(<span class="keywordtype">void</span> *arg)</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;{</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>(arg);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; LoopCount; ++i)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <a class="code" href="namespacenn_1_1os.html#a6fa888b2694902212ebc056ccaa4354b">nn::os::AcquireReadLock</a>( &amp;g_Rwlock );</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keyword">auto</span> value1 = g_Value1;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keyword">auto</span> value2 = g_Value2;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <a class="code" href="nn___abort_8h.html#a5c1a90d3a6474658ae0ac5dc5bcb14e4">NN_ABORT_UNLESS</a>( value1 * 2 == value2 );</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <a class="code" href="namespacenn_1_1os.html#a4d8f51bbfa3341c9678758b191896a05">nn::os::ReleaseReadLock</a>( &amp;g_Rwlock );</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;}</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">//  Third thread.</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="keywordtype">void</span> SubThread3(<span class="keywordtype">void</span> *arg)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;{</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a>(arg);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; LoopCount; ++i)</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <a class="code" href="namespacenn_1_1os.html#a97d3e3f946b214bcbf85e4aebb61699f">nn::os::AcquireWriteLock</a>( &amp;g_Rwlock );</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        g_Value1 += 1;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <a class="code" href="namespacenn_1_1os.html#a96b335e87af44c60a0d6dca75f11c9d2">nn::os::SleepThread</a>( <a class="code" href="classnn_1_1_time_span.html#acce769d0612ece9d5f87d32150d1f706">nn::TimeSpan::FromMicroSeconds</a>(10) );</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        g_Value2 += 2;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <a class="code" href="namespacenn_1_1os.html#ae30220320ff7ba5af52183fd5fbe1312">nn::os::ReleaseWriteLock</a>( &amp;g_Rwlock );</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;}</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160; </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">//  The main function.</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> <span class="keywordtype">void</span> nnMain()</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;{</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <a class="code" href="structnn_1_1os_1_1_thread_type.html">nn::os::ThreadType</a>  thread1;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <a class="code" href="structnn_1_1os_1_1_thread_type.html">nn::os::ThreadType</a>  thread2;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <a class="code" href="structnn_1_1os_1_1_thread_type.html">nn::os::ThreadType</a>  thread3;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160; </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="comment">// Initialize Rwlock.</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a659d0526afb3df351ed0a95ddc0776fa">nn::os::InitializeReaderWriterLock</a>( &amp;g_Rwlock );</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">// Generate threads.</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="keyword">auto</span> result = <a class="code" href="namespacenn_1_1os.html#a75f43e1d3c194c0d2173ef5d95785933">nn::os::CreateThread</a>( &amp;thread1, SubThread1, NULL, g_ThreadStack1, ThreadStackSize, <a class="code" href="namespacenn_1_1os.html#a5985811d04e64c0823ed758fd420591d">nn::os::DefaultThreadPriority</a>, 0 );</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <a class="code" href="nn___abort_8h.html#a5c1a90d3a6474658ae0ac5dc5bcb14e4">NN_ABORT_UNLESS</a>( result.IsSuccess(), <span class="stringliteral">&quot;Cannot create thread1.&quot;</span> );</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160; </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    result = <a class="code" href="namespacenn_1_1os.html#a75f43e1d3c194c0d2173ef5d95785933">nn::os::CreateThread</a>( &amp;thread2, SubThread2, NULL, g_ThreadStack2, ThreadStackSize, <a class="code" href="namespacenn_1_1os.html#a5985811d04e64c0823ed758fd420591d">nn::os::DefaultThreadPriority</a>, 1 );</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <a class="code" href="nn___abort_8h.html#a5c1a90d3a6474658ae0ac5dc5bcb14e4">NN_ABORT_UNLESS</a>( result.IsSuccess(), <span class="stringliteral">&quot;Cannot create thread2.&quot;</span> );</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    result = <a class="code" href="namespacenn_1_1os.html#a75f43e1d3c194c0d2173ef5d95785933">nn::os::CreateThread</a>( &amp;thread3, SubThread3, NULL, g_ThreadStack3, ThreadStackSize, <a class="code" href="namespacenn_1_1os.html#a5985811d04e64c0823ed758fd420591d">nn::os::DefaultThreadPriority</a>, 2 );</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <a class="code" href="nn___abort_8h.html#a5c1a90d3a6474658ae0ac5dc5bcb14e4">NN_ABORT_UNLESS</a>( result.IsSuccess(), <span class="stringliteral">&quot;Cannot create thread3.&quot;</span> );</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// Start thread execution.</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a18eec7c4c4c298f7abaa9ef41d6de76b">nn::os::StartThread</a>( &amp;thread1 );</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a18eec7c4c4c298f7abaa9ef41d6de76b">nn::os::StartThread</a>( &amp;thread2 );</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a18eec7c4c4c298f7abaa9ef41d6de76b">nn::os::StartThread</a>( &amp;thread3 );</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Start the ReaderWriterLock sample.\n&quot;</span>);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">// Wait for the thread to end.</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a8070c91be85c5ccb36b56e9ff3a75b26">nn::os::WaitThread</a>( &amp;thread1 );</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a8070c91be85c5ccb36b56e9ff3a75b26">nn::os::WaitThread</a>( &amp;thread2 );</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a8070c91be85c5ccb36b56e9ff3a75b26">nn::os::WaitThread</a>( &amp;thread3 );</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="comment">// Verify the final counter value.</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;g_Value1 = %d\n&quot;</span>, g_Value1);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;g_Value2 = %d\n&quot;</span>, g_Value2);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <a class="code" href="nn___abort_8h.html#a5c1a90d3a6474658ae0ac5dc5bcb14e4">NN_ABORT_UNLESS</a>( g_Value1 * 2 == g_Value2 );</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <a class="code" href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a>(<span class="stringliteral">&quot;Ok.\n&quot;</span>);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="comment">// Free threads.</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a9dbfcfb82583a9e34431e8c11d2411dd">nn::os::DestroyThread</a>( &amp;thread1 );</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a9dbfcfb82583a9e34431e8c11d2411dd">nn::os::DestroyThread</a>( &amp;thread2 );</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a9dbfcfb82583a9e34431e8c11d2411dd">nn::os::DestroyThread</a>( &amp;thread3 );</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <span class="comment">// Free Rwlock.</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="namespacenn_1_1os.html#a6b179b4351145d32ec583bc5a52452bb">nn::os::FinalizeReaderWriterLock</a>( &amp;g_Rwlock );</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;}</div>
<div class="ttc" id="aclassnn_1_1_time_span_html_acce769d0612ece9d5f87d32150d1f706"><div class="ttname"><a href="classnn_1_1_time_span.html#acce769d0612ece9d5f87d32150d1f706">nn::TimeSpan::FromMicroSeconds</a></div><div class="ttdeci">static constexpr TimeSpan FromMicroSeconds(int64_t microSeconds) NN_NOEXCEPT</div><div class="ttdoc">Generates a TimeSpan object from a value specified in microseconds.</div><div class="ttdef"><b>Definition:</b> nn_TimeSpan.h:537</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a18eec7c4c4c298f7abaa9ef41d6de76b"><div class="ttname"><a href="namespacenn_1_1os.html#a18eec7c4c4c298f7abaa9ef41d6de76b">nn::os::StartThread</a></div><div class="ttdeci">void StartThread(ThreadType *thread) NN_NOEXCEPT</div><div class="ttdoc">Starts execution on a thread.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a4d8f51bbfa3341c9678758b191896a05"><div class="ttname"><a href="namespacenn_1_1os.html#a4d8f51bbfa3341c9678758b191896a05">nn::os::ReleaseReadLock</a></div><div class="ttdeci">void ReleaseReadLock(ReaderWriterLockType *rwlock) NN_NOEXCEPT</div><div class="ttdoc">Releases a single readers lock.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a5985811d04e64c0823ed758fd420591d"><div class="ttname"><a href="namespacenn_1_1os.html#a5985811d04e64c0823ed758fd420591d">nn::os::DefaultThreadPriority</a></div><div class="ttdeci">const int DefaultThreadPriority</div><div class="ttdoc">Constant indicating the default value of thread priority.</div><div class="ttdef"><b>Definition:</b> os_ThreadCommon.h:47</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a659d0526afb3df351ed0a95ddc0776fa"><div class="ttname"><a href="namespacenn_1_1os.html#a659d0526afb3df351ed0a95ddc0776fa">nn::os::InitializeReaderWriterLock</a></div><div class="ttdeci">void InitializeReaderWriterLock(ReaderWriterLockType *rwlock) NN_NOEXCEPT</div><div class="ttdoc">Initializes a ReaderWriterLockType object.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a6b179b4351145d32ec583bc5a52452bb"><div class="ttname"><a href="namespacenn_1_1os.html#a6b179b4351145d32ec583bc5a52452bb">nn::os::FinalizeReaderWriterLock</a></div><div class="ttdeci">void FinalizeReaderWriterLock(ReaderWriterLockType *rwlock) NN_NOEXCEPT</div><div class="ttdoc">Frees a ReaderWriterLockType object.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a6fa888b2694902212ebc056ccaa4354b"><div class="ttname"><a href="namespacenn_1_1os.html#a6fa888b2694902212ebc056ccaa4354b">nn::os::AcquireReadLock</a></div><div class="ttdeci">void AcquireReadLock(ReaderWriterLockType *rwlock) NN_NOEXCEPT</div><div class="ttdoc">Gets a readers lock.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a75f43e1d3c194c0d2173ef5d95785933"><div class="ttname"><a href="namespacenn_1_1os.html#a75f43e1d3c194c0d2173ef5d95785933">nn::os::CreateThread</a></div><div class="ttdeci">nn::Result CreateThread(ThreadType *thread, ThreadFunction function, void *argument, void *stack, size_t stackSize, int priority, int idealCoreNumber) NN_NOEXCEPT</div><div class="ttdoc">Generates a thread.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a8070c91be85c5ccb36b56e9ff3a75b26"><div class="ttname"><a href="namespacenn_1_1os.html#a8070c91be85c5ccb36b56e9ff3a75b26">nn::os::WaitThread</a></div><div class="ttdeci">void WaitThread(ThreadType *thread) NN_NOEXCEPT</div><div class="ttdoc">Waits for the specified thread to stop.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a96b335e87af44c60a0d6dca75f11c9d2"><div class="ttname"><a href="namespacenn_1_1os.html#a96b335e87af44c60a0d6dca75f11c9d2">nn::os::SleepThread</a></div><div class="ttdeci">void SleepThread(TimeSpan time) NN_NOEXCEPT</div><div class="ttdoc">Puts the current thread to sleep for the specified amount of time.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a97d3e3f946b214bcbf85e4aebb61699f"><div class="ttname"><a href="namespacenn_1_1os.html#a97d3e3f946b214bcbf85e4aebb61699f">nn::os::AcquireWriteLock</a></div><div class="ttdeci">void AcquireWriteLock(ReaderWriterLockType *rwlock) NN_NOEXCEPT</div><div class="ttdoc">Acquires a writer lock.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_a9dbfcfb82583a9e34431e8c11d2411dd"><div class="ttname"><a href="namespacenn_1_1os.html#a9dbfcfb82583a9e34431e8c11d2411dd">nn::os::DestroyThread</a></div><div class="ttdeci">void DestroyThread(ThreadType *thread) NN_NOEXCEPT</div><div class="ttdoc">Deletes a thread.</div></div>
<div class="ttc" id="anamespacenn_1_1os_html_ae30220320ff7ba5af52183fd5fbe1312"><div class="ttname"><a href="namespacenn_1_1os.html#ae30220320ff7ba5af52183fd5fbe1312">nn::os::ReleaseWriteLock</a></div><div class="ttdeci">void ReleaseWriteLock(ReaderWriterLockType *rwlock) NN_NOEXCEPT</div><div class="ttdoc">Releases a single writer lock.</div></div>
<div class="ttc" id="ann___abort_8h_html"><div class="ttname"><a href="nn___abort_8h.html">nn_Abort.h</a></div><div class="ttdoc">Declarations for API resources to abort execution when conditions are not satisfied.</div></div>
<div class="ttc" id="ann___abort_8h_html_a5c1a90d3a6474658ae0ac5dc5bcb14e4"><div class="ttname"><a href="nn___abort_8h.html#a5c1a90d3a6474658ae0ac5dc5bcb14e4">NN_ABORT_UNLESS</a></div><div class="ttdeci">#define NN_ABORT_UNLESS(condition,...)</div><div class="ttdoc">Tests whether a condition has been satisfied and stops execution if it has not.</div><div class="ttdef"><b>Definition:</b> nn_Abort.h:38</div></div>
<div class="ttc" id="ann___log_8h_html"><div class="ttname"><a href="nn___log_8h.html">nn_Log.h</a></div><div class="ttdoc">Declarations for the logging API.</div></div>
<div class="ttc" id="ann___log_8h_html_a2d720c8bc6b733bce63879350d134a84"><div class="ttname"><a href="nn___log_8h.html#a2d720c8bc6b733bce63879350d134a84">NN_LOG</a></div><div class="ttdeci">#define NN_LOG(...)</div><div class="ttdoc">Adds the string specified in the parameter as a log entry.</div><div class="ttdef"><b>Definition:</b> nn_Log.h:33</div></div>
<div class="ttc" id="ann___macro_8h_html"><div class="ttname"><a href="nn___macro_8h.html">nn_Macro.h</a></div><div class="ttdoc">Defines the macros used throughout all libraries.</div></div>
<div class="ttc" id="ann___macro_8h_html_af2d1673769927c5eae977d8dde3ce106"><div class="ttname"><a href="nn___macro_8h.html#af2d1673769927c5eae977d8dde3ce106">NN_UNUSED</a></div><div class="ttdeci">#define NN_UNUSED(variable)</div><div class="ttdoc">Suppresses compiler warnings on intentionally unused variables.</div><div class="ttdef"><b>Definition:</b> nn_Macro.h:610</div></div>
<div class="ttc" id="aos___thread_common_8h_html_a5ce0c3c0aaceb976178a60a18d90f470"><div class="ttname"><a href="os___thread_common_8h.html#a5ce0c3c0aaceb976178a60a18d90f470">NN_OS_ALIGNAS_THREAD_STACK</a></div><div class="ttdeci">#define NN_OS_ALIGNAS_THREAD_STACK</div><div class="ttdoc">Macro to specify the stack space alignment.</div><div class="ttdef"><b>Definition:</b> os_ThreadCommon.h:108</div></div>
<div class="ttc" id="astructnn_1_1os_1_1_reader_writer_lock_type_html"><div class="ttname"><a href="structnn_1_1os_1_1_reader_writer_lock_type.html">nn::os::ReaderWriterLockType</a></div><div class="ttdoc">The structure for defining a readers-writer lock object.</div><div class="ttdef"><b>Definition:</b> os_ReaderWriterLockTypes.h:58</div></div>
<div class="ttc" id="astructnn_1_1os_1_1_thread_type_html"><div class="ttname"><a href="structnn_1_1os_1_1_thread_type.html">nn::os::ThreadType</a></div><div class="ttdoc">This structure defines a thread object.</div><div class="ttdef"><b>Definition:</b> os_ThreadTypes.h:92</div></div>
</div><!-- fragment --><h2><a class="anchor" id="PageSampleOsReaderWriterLock_SectionSampleDetail"></a>
Sample Program Description</h2>
<p>This sample program has the following flow.</p>
<ul>
<li>Three threads are created with <code>nnMain()</code>. Each is assigned to CPU cores 0 through 2, respectively.</li>
<li>Have the global variables, <code><em>g_Value1</em></code> and <em>g_Value2</em>, ready to access from the three threads.</li>
<li>Have <em>g_Rwlock</em>, an <code><a class="el" href="structnn_1_1os_1_1_reader_writer_lock_type.html" title="The structure for defining a readers-writer lock object.">nn::os::ReaderWriterLockType</a></code> object, ready to exclude access to the above variables.</li>
<li>Initialize <code><em>g_Rwlock</em></code> near the start of <code>nnMain()</code>.</li>
<li>In the thread <code>SubThread1</code>, refer to the two global variable values using a read lock.</li>
<li>Implement the <code>SubThread2</code> thread exactly as you implemented the first thread.</li>
<li>In the <code>SubThread3</code> thread, overwrite the two global variable values using a write lock.</li>
<li>In <code>nnMain()</code>, wait until the three threads complete.</li>
<li>The three threads are destroyed in <code>nnMain()</code>.</li>
<li>Destroy <code>g_Rwlock</code> in <code>nnMain()</code>.</li>
</ul>
<p>The <code>SubThread1</code> and <code>SubThread2</code> threads only have read access to global variables, so the variables are accessed after getting the read lock. These two threads are not mutually exclusive.</p>
<p>On the other hand, because the third thread has write access to global variables, the variables are accessed after getting the write lock. During the period of this write lock, read lock get operations for the first and second thread are blocked.</p>
<p>If the lock was not working correctly, the values for the two global variables within the first and second threads could be compared, resulting in an exited process. You can confirm this phenomenon by changing the lock in <code>SubThread3</code> to a read lock.</p>
<p>These types of locks can be correctly implemented using exclusive control with <code><a class="el" href="structnn_1_1os_1_1_mutex_type.html" title="This structure defines a mutex object.">nn::os::MutexType</a></code>. Use of the Reader-Writer lock feature can allow for greater efficiency and flexibility than <code><a class="el" href="structnn_1_1os_1_1_mutex_type.html" title="This structure defines a mutex object.">nn::os::MutexType</a></code>, however, in situations where you have multiple read threads and do not want to block the other threads as you read.</p>
<p>Run the sample. The following message appears, informing you that the read and write locks are working correctly to exclude each other.</p>
<pre class="fragment">Start ReaderWriterLock sample.
g_Value1 = 10000
g_Value2 = 20000
Ok.
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
</body>
</html>
